<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>MEM52220 - Applied Econometrics</title>
  <meta name="description" content="This manual constitutues the classroom material of the applied econometrics course at Tallinn University of Technology" />
  <meta name="generator" content="bookdown #bookdown:version# and GitBook 2.6.7" />

  <meta property="og:title" content="MEM52220 - Applied Econometrics" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="images/TalTech_Gradient_print.jpg" />
  <meta property="og:description" content="This manual constitutues the classroom material of the applied econometrics course at Tallinn University of Technology" />
  <meta name="github-repo" content="nreigl/MEM5220" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="MEM52220 - Applied Econometrics" />
  
  <meta name="twitter:description" content="This manual constitutues the classroom material of the applied econometrics course at Tallinn University of Technology" />
  <meta name="twitter:image" content="images/TalTech_Gradient_print.jpg" />

<meta name="author" content="Nicolas Reigl" />


<meta name="date" content="2021-03-20" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
<script src="libs/header-attrs/header-attrs.js"></script>
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-clipboard.css" rel="stylesheet" />
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/clipboard.min.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script src="libs/gitbook/js/plugin-clipboard.js"></script>
<script src="libs/kePrint/kePrint.js"></script>
<link href="libs/lightable/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



<!--bookdown:title:start-->
<div id="header">
<h1 class="title">MEM52220 - Applied Econometrics</h1>
<h2 class="subtitle"><em>Spring semester 2021</em></h2>
<p class="author"><em>Nicolas Reigl</em></p>
<p class="date"><em>2021-03-20</em></p>
</div>
<!--bookdown:title:end-->

<!--bookdown:toc:start-->
  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">
<!--bookdown:toc2:start-->
<ul>
<li><a href="#introduction">Introduction</a>
<ul>
<li><a href="#prerequisites">Prerequisites</a>
<ul>
<li><a href="#installation-of-r-and-rstudio">Installation of R and RStudio</a></li>
</ul></li>
<li><a href="#resources">Resources</a>
<ul>
<li><a href="#attribution">Attribution</a></li>
</ul></li>
<li><a href="#updates">Updates</a>
<ul>
<li><a href="#version-3.1.0.">Version 3.1.0.</a></li>
</ul></li>
<li><a href="#software-information-and-conventions">Software information and conventions</a></li>
<li><a href="#contribute">Contribute</a></li>
<li><a href="#acknowledgements">Acknowledgements</a></li>
</ul></li>
<li><a href="#linearregression"><span class="toc-section-number">1</span> Linear Regression</a>
<ul>
<li><a href="#simple-linear-regression"><span class="toc-section-number">1.1</span> Simple Linear Regression</a>
<ul>
<li><a href="#regression-through-the-origin-and-regression-on-a-constant"><span class="toc-section-number">1.1.1</span> Regression through the Origin and Regression on a Constant</a></li>
<li><a href="#simulating-slr"><span class="toc-section-number">1.1.2</span> Simulating SLR</a></li>
<li><a href="#polynomials-and-logarithms"><span class="toc-section-number">1.1.3</span> Polynomials and Logarithms</a></li>
</ul></li>
<li><a href="#multiple-linear-regression"><span class="toc-section-number">1.2</span> Multiple Linear Regression</a>
<ul>
<li><a href="#ceteris-paribus-interpretation-and-omitted-variable-bias"><span class="toc-section-number">1.2.1</span> Ceteris Paribus Interpretation and Omitted Variable bias</a></li>
<li><a href="#standard-errors-multicollinearity-and-vif"><span class="toc-section-number">1.2.2</span> Standard errors, Multicollinearity and VIF</a></li>
<li><a href="#reporting-regression-results"><span class="toc-section-number">1.2.3</span> Reporting Regression Results</a></li>
<li><a href="#model-formulae"><span class="toc-section-number">1.2.4</span> Model Formulae</a></li>
<li><a href="#mlr-prediction"><span class="toc-section-number">1.2.5</span> MLR Prediction</a></li>
</ul></li>
<li><a href="#mlr-analysis-with-qualitative-regressors"><span class="toc-section-number">1.3</span> MLR Analysis with Qualitative Regressors</a>
<ul>
<li><a href="#dummy-variabes"><span class="toc-section-number">1.3.1</span> Dummy variabes</a></li>
<li><a href="#logical-variables"><span class="toc-section-number">1.3.2</span> Logical variables</a></li>
<li><a href="#factor-variables"><span class="toc-section-number">1.3.3</span> Factor variables</a></li>
<li><a href="#interactions-and-differences-in-regression-functions-across-groups"><span class="toc-section-number">1.3.4</span> Interactions and differences in regression functions across groups</a></li>
</ul></li>
<li><a href="#statistical-significance"><span class="toc-section-number">1.4</span> Statistical significance</a></li>
<li><a href="#heteroskedasticity"><span class="toc-section-number">1.5</span> Heteroskedasticity</a>
<ul>
<li><a href="#spotting-heteroskedasticity-in-scatter-plots"><span class="toc-section-number">1.5.1</span> Spotting Heteroskedasticity in Scatter Plots</a></li>
<li><a href="#heteroskedasticity-tests"><span class="toc-section-number">1.5.2</span> Heteroskedasticity Tests</a></li>
</ul></li>
<li><a href="#weighted-least-squares"><span class="toc-section-number">1.6</span> Weighted least squares</a></li>
<li><a href="#model-specification-and-parameter-heterogeneity"><span class="toc-section-number">1.7</span> Model specification and Parameter Heterogeneity</a>
<ul>
<li><a href="#functional-form-misspecifcation"><span class="toc-section-number">1.7.1</span> Functional Form Misspecifcation</a></li>
</ul></li>
<li><a href="#least-absolute-deviations-lad-estimation"><span class="toc-section-number">1.8</span> Least absolute Deviations (LAD) Estimation</a></li>
<li><a href="#quantile-regression"><span class="toc-section-number">1.9</span> Quantile regression</a></li>
</ul></li>
<li><a href="#IV"><span class="toc-section-number">2</span> Instrumental Variables and Two Stage Least Squares</a>
<ul>
<li><a href="#introduction-endogeneity-problem-and-its-solution"><span class="toc-section-number">2.1</span> Introduction: Endogeneity Problem and its Solution</a></li>
<li><a href="#examples-of-endogeneity-problem"><span class="toc-section-number">2.2</span> Examples of Endogeneity Problem</a></li>
<li><a href="#idea-of-iv-regression"><span class="toc-section-number">2.3</span> Idea of IV Regression</a>
<ul>
<li><a href="#discussion-on-iv"><span class="toc-section-number">2.3.1</span> Discussion on IV</a></li>
</ul></li>
<li><a href="#two-stage-least-squares-2sls"><span class="toc-section-number">2.4</span> Two stage least squares (2SLS)</a></li>
<li><a href="#instrumental-variables"><span class="toc-section-number">2.5</span> Instrumental variables</a>
<ul>
<li><a href="#overidentifying-restrictions-test"><span class="toc-section-number">2.5.1</span> Overidentifying Restrictions Test</a></li>
<li><a href="#multiple-instruments"><span class="toc-section-number">2.5.2</span> Multiple instruments</a></li>
</ul></li>
<li><a href="#gmm-iv"><span class="toc-section-number">2.6</span> GMM IV</a></li>
<li><a href="#panel-iv"><span class="toc-section-number">2.7</span> Panel IV</a></li>
</ul></li>
<li><a href="#references">References</a></li>
</ul>
<!--bookdown:toc2:end-->
      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">MEM52220 - Applied Econometrics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<!--bookdown:toc:end-->
<!--bookdown:body:start-->
<div id="introduction" class="section level1 unnumbered">
<h1 class="unnumbered">Introduction</h1>
<div class="figure" style="text-align: center">
<a href="https://stackoverflow.com/questions/31794876/ggplot2-how-to-curve-small-gaussian-densities-on-a-regression-line" target="_blank"><img src="images/lregression.jpeg" alt="Normal and simulated Gaussian densities on a regression line" width="70%" /></a>
<p class="caption">
(#fig:unnamed-chunk-3)Normal and simulated Gaussian densities on a regression line
</p>
</div>
<p>This handout is designed for the use with MEM5220 - Applied Econometrics at <a href="https://taltech.ee/en/department-economics-and-finance">Tallinn University of Technology, Department of Economics and Finance</a>.</p>
<div id="prerequisites" class="section level2 unnumbered">
<h2 class="unnumbered">Prerequisites</h2>
<p>A basic knowledge of the R <span class="citation">(<a href="#ref-team2013r" role="doc-biblioref">Team 2013</a>)</span> programming language is required.</p>
<p>In order to reproduce the examples in this script you need the statistical software package R. Additionally I recommend using the <a href="https://www.rstudio.com">RStudio</a> integrated developer environment (IDE) which will improve your R working experience.</p>
<div id="installation-of-r-and-rstudio" class="section level3 unnumbered">
<h3 class="unnumbered">Installation of R and RStudio</h3>
<p>Go to the following webpages and download the software adequate for Your operating system:</p>
<ol style="list-style-type: decimal">
<li><a href="http://cran.r-project.org">The Statistical Software Package R:</a></li>
<li>The GUI <a href="https://www.rstudio.com">RStudio:</a></li>
</ol>
<p>Install R first and then proceed with RStudio. Afterwards start RStudio. For accessing packages and datasets from <a href="https://github.com/">github</a> we need to install the <strong>devtools</strong> package. On Windows, download and install <a href="https://cran.r-project.org/bin/windows/Rtools/">Rtools</a>, and devtools takes care of the rest. On Mac, install the Xcode command line tools. On Linux, install the R development package, usually called r-devel or r-base-dev.</p>
</div>
</div>
<div id="resources" class="section level2 unnumbered">
<h2 class="unnumbered">Resources</h2>
<p>Our primary resource is <span class="citation"><a href="#ref-heiss2016using" role="doc-biblioref">Heiss</a> (<a href="#ref-heiss2016using" role="doc-biblioref">2016</a>)</span>.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> The book is available as free <a href="http://www.urfie.net/read.html">online</a> version. For theoretical concepts I refer to <span class="citation"><a href="#ref-wooldridge2015introductory" role="doc-biblioref">Wooldridge</a> (<a href="#ref-wooldridge2015introductory" role="doc-biblioref">2015</a>)</span><a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>.
For the timeseries part of the course a good reference material is <a href="https://www.cambridge.org/pt/academic/subjects/economics/finance/introductory-econometrics-finance-3rd-edition?format=PB&amp;isbn=9781107661455">Introductory Econometircs for Finance</a>.</p>
<div id="attribution" class="section level3 unnumbered">
<h3 class="unnumbered">Attribution</h3>
<p>This lecture material would not possible without many other open-source econometrics teaching materials and of course the R package developers. In addition to the main resources, examples and code of this workbook have been drawn from a number of free econometrics eBooks, blogs, R-vignette help pages and other researchers teaching materials.</p>
<p>Chapter 1.1.2 Simulating SLR is based on <span class="citation"><a href="#ref-heiss2016using" role="doc-biblioref">Heiss</a> (<a href="#ref-heiss2016using" role="doc-biblioref">2016</a>)</span> but adds parts of <span class="citation"><a href="#ref-dalpiaz2016" role="doc-biblioref">Dalpiaz</a> (<a href="#ref-dalpiaz2016" role="doc-biblioref">2016</a>)</span> and <span class="citation"><a href="#ref-colonescu2018" role="doc-biblioref">Colonescu</a> (<a href="#ref-colonescu2018" role="doc-biblioref">2018</a>)</span> teaching materials. Chapter 1.2.2 includes additional material from <span class="citation"><a href="#ref-Hanck2018" role="doc-biblioref">Hanck et al.</a> (<a href="#ref-Hanck2018" role="doc-biblioref">2018</a>)</span>. Chapter 1.4 Heteroskedasticity has been amended with material from <span class="citation"><a href="#ref-Rodrigues2018" role="doc-biblioref">Rodrigues</a> (<a href="#ref-Rodrigues2018" role="doc-biblioref">2018</a>)</span> blog. The time series part is closely related to the teaching material of Andres Vörk. The finite distributed lags model is adapted from Constantin Colonescu.</p>
<ul>
<li><a href="https://emwikts1970.github.io/URFITE-Bookdown/">Using R for Introduction to Econometrics</a>, <span class="citation"><a href="#ref-Hanck2018" role="doc-biblioref">Hanck et al.</a> (<a href="#ref-Hanck2018" role="doc-biblioref">2018</a>)</span></li>
<li><a href="https://daviddalpiaz.github.io/appliedstats/">Applied Statistics with R</a>, <span class="citation"><a href="#ref-dalpiaz2016" role="doc-biblioref">Dalpiaz</a> (<a href="#ref-dalpiaz2016" role="doc-biblioref">2016</a>)</span></li>
<li><a href="https://bookdown.org/ccolonescu/RPoE4/">Principles of Econometrics with R</a>, <span class="citation"><a href="#ref-colonescu2018" role="doc-biblioref">Colonescu</a> (<a href="#ref-colonescu2018" role="doc-biblioref">2018</a>)</span></li>
<li><a href="https://scpoecon.github.io/ScPoEconometrics/">Introduction to Econometrics with R</a>, <span class="citation"><a href="#ref-oswald2018introduction" role="doc-biblioref">Oswald and Robin</a> (<a href="#ref-oswald2018introduction" role="doc-biblioref">2018</a>)</span></li>
<li><a href="https://bookdown.org/roback/bookdown-bysh/">Broadening Your Statistical Horizons</a></li>
</ul>
</div>
</div>
<div id="updates" class="section level2 unnumbered">
<h2 class="unnumbered">Updates</h2>
<p>For a brief rundown of the version history, we have:</p>
<div id="version-3.1.0." class="section level3 unnumbered">
<h3 class="unnumbered">Version 3.1.0.</h3>
<p>I released the 3.1.0 version of this teaching material in March 15, 2021.</p>
<ul>
<li>Cleanup of certain outdated functions (dplyr::arrange)</li>
<li>Remove <code>renv</code></li>
<li>Add quantile regression subsection to LM.Rmd</li>
<li>Add heteroskedasdicity simulations</li>
</ul>
<p>Known bugs:</p>
<ul>
<li>Line 2267 in LM.Rmd: <code>waldtest</code> fails to compile in the bookdown version but works in the script version</li>
</ul>
</div>
</div>
<div id="software-information-and-conventions" class="section level2 unnumbered">
<h2 class="unnumbered">Software information and conventions</h2>
<p>The R session information when compiling this book is shown below:</p>
<p>I do not add prompts (<code>&gt;</code> and <code>+</code>) to R source code in this book, and I comment out the text output with two hashes <code>##</code> by default, as you can see from the R session information above. This is for your convenience when you want to copy and run the code (the text output will be ignored since it is commented out).</p>
<ul>
<li>R code blocks and their output appear in a gray background. E.g.,</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">==</span> <span class="dv">5</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="cn">FALSE</span></span></code></pre></div>
<ul>
<li><p>Functions and inline code are in a typewriter font and followed by parentheses, all atop a gray background (e.g., <code>brm()</code>).</p></li>
<li><p>When I want to make explicit the package a given function comes from, I insert the double-colon operator <code>::</code> between the package name and the function (e.g., <code>tidybayes::mode_hdi()</code>).</p></li>
</ul>
<p>Package names are in bold text (e.g., <strong>rmarkdown</strong>). Content with <strong>Note</strong>, <strong>Your turn</strong> and <strong>Overthinking</strong> is surrounded by two horizontal lines. <strong>Overthinking</strong> sections serve as additional information for the interested reader but will not be covered in detail in class.</p>
</div>
<div id="contribute" class="section level2 unnumbered">
<h2 class="unnumbered">Contribute</h2>
<p>You can contribute to this teaching material. Please fill an issue, improve the material or checkout alternative versions of this project.</p>
<p>The source code of the project is available on GitHub at <a href="https://github.com/nreigl/MEM5220">https://github.com/nreigl/MEM5220</a>.</p>
<p>And if you’re unacquainted with GitHub, check out my short <a href="https://github.com/nreigl/git-for-economists">Git for Economists</a> presentation or take a look at <span class="citation">(<a href="#ref-bryanHappyGitGitHub2020" role="doc-biblioref"><strong>bryanHappyGitGitHub2020?</strong></a>)</span> <a href="https://happygitwithr.com/"><em>Happy Git and GitHub for the useR</em></a>.</p>
</div>
<div id="acknowledgements" class="section level2 unnumbered">
<h2 class="unnumbered">Acknowledgements</h2>
<p>I thank Kadri Männasoo and Juan Carlos Cuestas for their useful comments.</p>
<!--chapter:end:index.Rmd-->
</div>
</div>
<div id="linearregression" class="section level1" number="1">
<h1 number="1"><span class="header-section-number">1</span> Linear Regression</h1>
<p>To load the dataset and necessary functions:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This function 1. checks if the packages are installed. 2. It installs the packages if they were not in the list of installed packages. 3. It loads the packages into the workspace</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">&quot;devtools&quot;</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>))</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">install.packages</span>(<span class="st">&quot;devtools&quot;</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>PACKAGES<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">&quot;pacman&quot;</span>, </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;wooldridge&quot;</span>,  <span class="co"># Wooldrige Datasets</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;tidyverse&quot;</span>,  <span class="co"># for data manipulation and ggplots</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;tibble&quot;</span>,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;MCMCpack&quot;</span>, <span class="co"># Markov Chain Monte Carlo Methods</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;bindrcpp&quot;</span>, <span class="co"># faster rbinds</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;kableExtra&quot;</span>, <span class="co"># Construct complex tables </span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;broom&quot;</span>,  <span class="co"># Tidy regression output</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;ggpubr&quot;</span>,  <span class="co"># Multiple ggplots on a page. Note that, the installation of ggpubr will automatically install the gridExtra and the cowplot package; so you don’t need to re-install them.</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;ggfortify&quot;</span>, <span class="co"># Simple ggplot recipe for lm objects)</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;plot3D&quot;</span>,  <span class="co">#  3D graphs</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;car&quot;</span>, <span class="co"># Companion to applied regression</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;knitr&quot;</span>, <span class="co"># knit functions</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>            <span class="co"># &quot;kableExtra&quot;, # extended knit functions for objects exported from other packages</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;huxtable&quot;</span>, <span class="co">#  Regression tables, broom compatible</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;modelsummary&quot;</span>, <span class="co"># Regression tables, broom compatible, work also very well with panel data</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;texreg&quot;</span>, <span class="co"># One of the few regression table packages that plays nice with quantreg</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;skimr&quot;</span>, <span class="co"># nice summary tables</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;mice&quot;</span>,  <span class="co"># multiple imputation</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;VIM&quot;</span>, <span class="co"># visualizing missing data</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;stargazer&quot;</span>, <span class="co"># Regression tables</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;AER&quot;</span>, <span class="co">#  Functions, data sets, examples, demos, and vignettes for the book Christian Kleiber and Achim Zeileis (2008)</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;MASS&quot;</span>,  <span class="co">#  Functions and datasets to support Venables and Ripley,  &quot;Modern Applied Statistics with S&quot;</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;mvtnorm&quot;</span>, <span class="co"># Multivariate Normal and t Distributions</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;summarytools&quot;</span>, <span class="co"># Report regression summary tables</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;scales&quot;</span>, <span class="co"># scale helper functions such as percent</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;OutliersO3&quot;</span>, <span class="co"># Outlier comparison method</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;robustbase&quot;</span>, <span class="co"># Basic robust statistics</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;quantreg&quot;</span>, <span class="co"># Quantile regression</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;estimatr&quot;</span>, <span class="co"># Fast Estimators for Design-Based Inference</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;modelr&quot;</span>, <span class="co"># model simulation/ boostraping the modern way</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;magrittr&quot;</span>) <span class="co">#  pipes</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>inst<span class="ot">&lt;-</span><span class="fu">match</span>(PACKAGES, <span class="fu">.packages</span>(<span class="at">all=</span><span class="cn">TRUE</span>))</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>need<span class="ot">&lt;-</span><span class="fu">which</span>(<span class="fu">is.na</span>(inst))</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(need)<span class="sc">&gt;</span><span class="dv">0</span>) <span class="fu">install.packages</span>(PACKAGES[need], <span class="at">repos =</span> <span class="fu">c</span>(<span class="at">CRAN=</span><span class="st">&quot;https://cran.rstudio.com&quot;</span>))</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(PACKAGES, require, <span class="at">character.only=</span>T)</span></code></pre></div>
<div id="simple-linear-regression" class="section level2" number="1.1">
<h2 number="1.1"><span class="header-section-number">1.1</span> Simple Linear Regression</h2>
<p>We start off with a simple OLS Regression. We will work with multiple
data sources:</p>
<ul>
<li>Data from <span class="citation"><a href="#ref-wooldridge2015introductory" role="doc-biblioref">Wooldridge</a> (<a href="#ref-wooldridge2015introductory" role="doc-biblioref">2015</a>)</span> : Introductory Econometrics: A
Modern Approach.</li>
<li>R data sets for “Principles of Econometrics” by <span class="citation"><a href="#ref-hill2008principles" role="doc-biblioref">Hill et al.</a> (<a href="#ref-hill2008principles" role="doc-biblioref">2008</a>)</span></li>
<li>Build in examples such as the <code>airquality</code> dataset</li>
</ul>
<p>Classic examples of quantities modelled with simple linear regression:</p>
<ul>
<li>College GPA <span class="math inline">\(\sim\)</span> SAT scores <span class="math inline">\(\beta &gt; 0\)</span></li>
<li>Change in GDP <span class="math inline">\(\sim\)</span> change in unemployment <span class="math inline">\(\beta &lt; 0\)</span></li>
<li>House price <span class="math inline">\(\sim\)</span> number of bedrooms <span class="math inline">\(\beta &gt; 0\)</span></li>
<li>Species heart weight <span class="math inline">\(\sim\)</span> species body weight <span class="math inline">\(\beta &gt; 0\)</span></li>
<li>Fatalities per year <span class="math inline">\(\sim\)</span> speed limit <span class="math inline">\(\beta &lt; 0\)</span></li>
</ul>
<p>Notice that these simple linear regressions are simplifications of more
complex relationships between the variables in question.</p>
<p>In this exercise we use the dataset <em>ceosal1</em>. Let us analyse the
dataset first</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;ceosal1&quot;</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">help</span>(<span class="st">&quot;ceosal1&quot;</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>?ceosal1</span></code></pre></div>
<p>As we see from the R documentation the <em>ceosal1</em> dataset contain of a
random sample of data reported in the May 6, 1991 issue of Businessweek.</p>
<p>To get a first look at the data you can use the <code>View()</code> function inside
R Studio.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(ceosal1) <span class="co"># For the compilation we omit the full View()</span></span></code></pre></div>
<table>
<caption>
(#tab:unnamed-chunk-10)A table of the first eight columns and ten rows of the ceosal1 data.
</caption>
<thead>
<tr>
<th style="text-align:right;">
salary
</th>
<th style="text-align:right;">
pcsalary
</th>
<th style="text-align:right;">
sales
</th>
<th style="text-align:right;">
roe
</th>
<th style="text-align:right;">
pcroe
</th>
<th style="text-align:right;">
ros
</th>
<th style="text-align:right;">
indus
</th>
<th style="text-align:right;">
finance
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1095
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
27595.0
</td>
<td style="text-align:right;">
14.1
</td>
<td style="text-align:right;">
106.4
</td>
<td style="text-align:right;">
191
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
1001
</td>
<td style="text-align:right;">
32
</td>
<td style="text-align:right;">
9958.0
</td>
<td style="text-align:right;">
10.9
</td>
<td style="text-align:right;">
-30.6
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
1122
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
6125.9
</td>
<td style="text-align:right;">
23.5
</td>
<td style="text-align:right;">
-16.3
</td>
<td style="text-align:right;">
14
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
578
</td>
<td style="text-align:right;">
-9
</td>
<td style="text-align:right;">
16246.0
</td>
<td style="text-align:right;">
5.9
</td>
<td style="text-align:right;">
-25.7
</td>
<td style="text-align:right;">
-21
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
1368
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
21783.2
</td>
<td style="text-align:right;">
13.8
</td>
<td style="text-align:right;">
-3.0
</td>
<td style="text-align:right;">
56
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
1145
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
6021.4
</td>
<td style="text-align:right;">
20.0
</td>
<td style="text-align:right;">
1.0
</td>
<td style="text-align:right;">
55
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
1078
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
2266.7
</td>
<td style="text-align:right;">
16.4
</td>
<td style="text-align:right;">
-5.9
</td>
<td style="text-align:right;">
62
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
1094
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
2966.8
</td>
<td style="text-align:right;">
16.3
</td>
<td style="text-align:right;">
-1.6
</td>
<td style="text-align:right;">
44
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
1237
</td>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
4570.2
</td>
<td style="text-align:right;">
10.5
</td>
<td style="text-align:right;">
-70.2
</td>
<td style="text-align:right;">
37
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
833
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2830.0
</td>
<td style="text-align:right;">
26.3
</td>
<td style="text-align:right;">
-23.9
</td>
<td style="text-align:right;">
37
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
<p>We could also take a look at the variable names, the dimension of the
data frame, and some sample observations with <code>str()</code>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(ceosal1)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;data.frame&#39;</span><span class="sc">:</span>   <span class="dv">209</span> obs. of  <span class="dv">12</span> variables<span class="sc">:</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a> <span class="er">$</span> salary  <span class="sc">:</span> int  <span class="dv">1095</span> <span class="dv">1001</span> <span class="dv">1122</span> <span class="dv">578</span> <span class="dv">1368</span> <span class="dv">1145</span> <span class="dv">1078</span> <span class="dv">1094</span> <span class="dv">1237</span> <span class="dv">833</span> ...</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> pcsalary<span class="sc">:</span> int  <span class="dv">20</span> <span class="dv">32</span> <span class="dv">9</span> <span class="sc">-</span><span class="dv">9</span> <span class="dv">7</span> <span class="dv">5</span> <span class="dv">10</span> <span class="dv">7</span> <span class="dv">16</span> <span class="dv">5</span> ...</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> sales   <span class="sc">:</span> num  <span class="dv">27595</span> <span class="dv">9958</span> <span class="dv">6126</span> <span class="dv">16246</span> <span class="dv">21783</span> ...</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> roe     <span class="sc">:</span> num  <span class="fl">14.1</span> <span class="fl">10.9</span> <span class="fl">23.5</span> <span class="fl">5.9</span> <span class="fl">13.8</span> ...</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> pcroe   <span class="sc">:</span> num  <span class="fl">106.4</span> <span class="sc">-</span><span class="fl">30.6</span> <span class="sc">-</span><span class="fl">16.3</span> <span class="sc">-</span><span class="fl">25.7</span> <span class="sc">-</span><span class="dv">3</span> ...</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> ros     <span class="sc">:</span> int  <span class="dv">191</span> <span class="dv">13</span> <span class="dv">14</span> <span class="sc">-</span><span class="dv">21</span> <span class="dv">56</span> <span class="dv">55</span> <span class="dv">62</span> <span class="dv">44</span> <span class="dv">37</span> <span class="dv">37</span> ...</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> indus   <span class="sc">:</span> int  <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> ...</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> finance <span class="sc">:</span> int  <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> ...</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> consprod<span class="sc">:</span> int  <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> ...</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> utility <span class="sc">:</span> int  <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> ...</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> lsalary <span class="sc">:</span> num  <span class="dv">7</span> <span class="fl">6.91</span> <span class="fl">7.02</span> <span class="fl">6.36</span> <span class="fl">7.22</span> ...</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> lsales  <span class="sc">:</span> num  <span class="fl">10.23</span> <span class="fl">9.21</span> <span class="fl">8.72</span> <span class="fl">9.7</span> <span class="fl">9.99</span> ...</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a> <span class="sc">-</span> <span class="fu">attr</span>(<span class="sc">*</span>, <span class="st">&quot;time.stamp&quot;</span>)<span class="ot">=</span> chr <span class="st">&quot;25 Jun 2011 23:03&quot;</span></span></code></pre></div>
<p>As we have seen before in the general R tutorial, there are a number of
additional functions to access some of this information directly.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(ceosal1)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">209</span>  <span class="dv">12</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(ceosal1)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">209</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ncol</span>(ceosal1)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">12</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ceosal1)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>     salary         pcsalary          sales              roe       </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a> Min.   <span class="sc">:</span>  <span class="dv">223</span>   Min.   <span class="sc">:-</span><span class="fl">61.00</span>   Min.   <span class="sc">:</span>  <span class="fl">175.2</span>   Min.   <span class="sc">:</span> <span class="fl">0.50</span>  </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a> 1st Qu.<span class="sc">:</span>  <span class="dv">736</span>   1st Qu.<span class="sc">:</span> <span class="sc">-</span><span class="fl">1.00</span>   1st Qu.<span class="sc">:</span> <span class="fl">2210.3</span>   1st Qu.<span class="sc">:</span><span class="fl">12.40</span>  </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a> Median <span class="sc">:</span> <span class="dv">1039</span>   Median <span class="sc">:</span>  <span class="fl">9.00</span>   Median <span class="sc">:</span> <span class="fl">3705.2</span>   Median <span class="sc">:</span><span class="fl">15.50</span>  </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a> Mean   <span class="sc">:</span> <span class="dv">1281</span>   Mean   <span class="sc">:</span> <span class="fl">13.28</span>   Mean   <span class="sc">:</span> <span class="fl">6923.8</span>   Mean   <span class="sc">:</span><span class="fl">17.18</span>  </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a> 3rd Qu.<span class="sc">:</span> <span class="dv">1407</span>   3rd Qu.<span class="sc">:</span> <span class="fl">20.00</span>   3rd Qu.<span class="sc">:</span> <span class="fl">7177.0</span>   3rd Qu.<span class="sc">:</span><span class="fl">20.00</span>  </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a> Max.   <span class="sc">:</span><span class="dv">14822</span>   Max.   <span class="sc">:</span><span class="fl">212.00</span>   Max.   <span class="sc">:</span><span class="fl">97649.9</span>   Max.   <span class="sc">:</span><span class="fl">56.30</span>  </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>     pcroe            ros            indus           finance      </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a> Min.   <span class="sc">:-</span><span class="fl">98.9</span>   Min.   <span class="sc">:-</span><span class="fl">58.0</span>   Min.   <span class="sc">:</span><span class="fl">0.0000</span>   Min.   <span class="sc">:</span><span class="fl">0.0000</span>  </span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a> 1st Qu.<span class="sc">:-</span><span class="fl">21.2</span>   1st Qu.<span class="sc">:</span> <span class="fl">21.0</span>   1st Qu.<span class="sc">:</span><span class="fl">0.0000</span>   1st Qu.<span class="sc">:</span><span class="fl">0.0000</span>  </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a> Median <span class="sc">:</span> <span class="sc">-</span><span class="fl">3.0</span>   Median <span class="sc">:</span> <span class="fl">52.0</span>   Median <span class="sc">:</span><span class="fl">0.0000</span>   Median <span class="sc">:</span><span class="fl">0.0000</span>  </span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a> Mean   <span class="sc">:</span> <span class="fl">10.8</span>   Mean   <span class="sc">:</span> <span class="fl">61.8</span>   Mean   <span class="sc">:</span><span class="fl">0.3206</span>   Mean   <span class="sc">:</span><span class="fl">0.2201</span>  </span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a> 3rd Qu.<span class="sc">:</span> <span class="fl">19.5</span>   3rd Qu.<span class="sc">:</span> <span class="fl">81.0</span>   3rd Qu.<span class="sc">:</span><span class="fl">1.0000</span>   3rd Qu.<span class="sc">:</span><span class="fl">0.0000</span>  </span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a> Max.   <span class="sc">:</span><span class="fl">977.0</span>   Max.   <span class="sc">:</span><span class="fl">418.0</span>   Max.   <span class="sc">:</span><span class="fl">1.0000</span>   Max.   <span class="sc">:</span><span class="fl">1.0000</span>  </span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    consprod         utility          lsalary          lsales      </span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a> Min.   <span class="sc">:</span><span class="fl">0.0000</span>   Min.   <span class="sc">:</span><span class="fl">0.0000</span>   Min.   <span class="sc">:</span><span class="fl">5.407</span>   Min.   <span class="sc">:</span> <span class="fl">5.166</span>  </span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a> 1st Qu.<span class="sc">:</span><span class="fl">0.0000</span>   1st Qu.<span class="sc">:</span><span class="fl">0.0000</span>   1st Qu.<span class="sc">:</span><span class="fl">6.601</span>   1st Qu.<span class="sc">:</span> <span class="fl">7.701</span>  </span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a> Median <span class="sc">:</span><span class="fl">0.0000</span>   Median <span class="sc">:</span><span class="fl">0.0000</span>   Median <span class="sc">:</span><span class="fl">6.946</span>   Median <span class="sc">:</span> <span class="fl">8.217</span>  </span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a> Mean   <span class="sc">:</span><span class="fl">0.2871</span>   Mean   <span class="sc">:</span><span class="fl">0.1722</span>   Mean   <span class="sc">:</span><span class="fl">6.950</span>   Mean   <span class="sc">:</span> <span class="fl">8.292</span>  </span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a> 3rd Qu.<span class="sc">:</span><span class="fl">1.0000</span>   3rd Qu.<span class="sc">:</span><span class="fl">0.0000</span>   3rd Qu.<span class="sc">:</span><span class="fl">7.249</span>   3rd Qu.<span class="sc">:</span> <span class="fl">8.879</span>  </span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a> Max.   <span class="sc">:</span><span class="fl">1.0000</span>   Max.   <span class="sc">:</span><span class="fl">1.0000</span>   Max.   <span class="sc">:</span><span class="fl">9.604</span>   Max.   <span class="sc">:</span><span class="fl">11.489</span>  </span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># kable(skim(ceosal1)) #  for bookdown</span></span></code></pre></div>
<p>The interesting task here is to determine how far a high the CEO salary
is, for a given return on equity.</p>
<hr />
<p><strong>Your turn</strong></p>
<p>What sign would be expect of <span class="math inline">\(\beta\)</span> (the slope)?</p>
<p>A: Without seeing the data <strong>my</strong> prior is that <span class="math inline">\(\beta &gt; 0\)</span>.</p>
<hr />
<p><strong>Note</strong></p>
<p>A simple linear model as assumes that the mean of each <span class="math inline">\(y_{i}\)</span>
conditioned on <span class="math inline">\(x_{i}\)</span> is a linear function of <span class="math inline">\(x_{i}\)</span>. But notice that
simple linear regressions are simplifications of more complex
relationships between the variables in question <span class="citation"><a href="#ref-dalpiaz2016" role="doc-biblioref">Dalpiaz</a> (<a href="#ref-dalpiaz2016" role="doc-biblioref">2016</a>)</span>.</p>
<hr />
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use ggplot style</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ceosal1, <span class="fu">aes</span>(<span class="at">x =</span> roe, <span class="at">y =</span> salary)) <span class="sc">+</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MEM5220_R_files/figure-html/ceosal1-1.png" alt="Relationship between ROE and Salary" width="70%" />
<p class="caption">
(#fig:ceosal1)Relationship between ROE and Salary
</p>
</div>
<p>Consider a simple regression model</p>
<p><span class="math inline">\(salary = \beta_0 + \beta_1roe + u\)</span></p>
<p>In the general form the linear regression model can be written as:</p>
<span class="math display">\[\begin{equation}
y = \beta_{0} + \beta_{1}x + u
(\#eq:simplelinearregressionmodel)
\end{equation}\]</span>
<p>We are concerned with the population parameter <span class="math inline">\(\beta_{0}\)</span> and
<span class="math inline">\(\beta_{1}\)</span>. The ordinary least squares (OLS) estimators are:</p>
<span class="math display">\[\begin{equation}
\hat{\beta}_{0} = \bar{y} - \hat{\beta}_{1}\bar{x}
(\#eq:populationparameterBeta0)
\end{equation}\]</span>
<p>The ordinary least squares (OLS) estimators are</p>
<span class="math display">\[\begin{equation}
\hat{\beta}_{1} = \frac{Cov(x,y)}{Var(x)}
(\#eq:populationparameterBeta1)
\end{equation}\]</span>
<p>Ingredients for the OLS formulas</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(ceosal1)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cov</span>(roe, salary)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">1342.538</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(roe)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">72.56499</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(salary)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">1281.12</span></span></code></pre></div>
<p>Manual calculation of the OLS coefficients</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>b1hat <span class="ot">&lt;-</span> <span class="fu">cov</span>(roe,salary)<span class="sc">/</span><span class="fu">var</span>(roe)</span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>b0hat <span class="ot">&lt;-</span> <span class="fu">mean</span>(salary) <span class="sc">-</span> b1hat <span class="sc">*</span> <span class="fu">mean</span>(roe)</span></code></pre></div>
<p>Or use the <code>lm()</code> function</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(salary <span class="sc">~</span> roe, <span class="at">data=</span>ceosal1)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> salary <span class="sc">~</span> roe, <span class="at">data =</span> ceosal1)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>(Intercept)          roe  </span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>      <span class="fl">963.2</span>         <span class="fl">18.5</span>  </span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>lm1_ceosal1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(salary <span class="sc">~</span> roe, <span class="at">data=</span>ceosal1)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm1_ceosal1)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> salary <span class="sc">~</span> roe, <span class="at">data =</span> ceosal1)</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>Residuals<span class="sc">:</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    Min      1Q  Median      3Q     Max </span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">1160.2</span>  <span class="sc">-</span><span class="fl">526.0</span>  <span class="sc">-</span><span class="fl">254.0</span>   <span class="fl">138.8</span> <span class="fl">13499.9</span> </span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>            Estimate Std. Error t value <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)    </span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>(Intercept)   <span class="fl">963.19</span>     <span class="fl">213.24</span>   <span class="fl">4.517</span> <span class="fl">1.05e-05</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>roe            <span class="fl">18.50</span>      <span class="fl">11.12</span>   <span class="fl">1.663</span>   <span class="fl">0.0978</span> .  </span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>Residual standard error<span class="sc">:</span> <span class="dv">1367</span> on <span class="dv">207</span> degrees of freedom</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>Multiple R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.01319</span>,   Adjusted R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.008421</span> </span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>F<span class="sc">-</span>statistic<span class="sc">:</span> <span class="fl">2.767</span> on <span class="dv">1</span> and <span class="dv">207</span> DF,  p<span class="sc">-</span>value<span class="sc">:</span> <span class="fl">0.09777</span></span></code></pre></div>
<p>Plot the linear regression fit the <em>base</em> r way.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(salary<span class="sc">~</span> roe, <span class="at">data =</span> ceosal1,</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Return on equity&quot;</span>,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Salary&quot;</span>,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Salary vs return on equity&quot;</span>,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch  =</span> <span class="dv">20</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex  =</span> <span class="dv">2</span>,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">col  =</span> <span class="st">&quot;grey&quot;</span>)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(lm1_ceosal1, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">&quot;darkorange&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MEM5220_R_files/figure-html/fig1-1.png" alt="OLS regression base Rstyle" width="80%" />
<p class="caption">
(#fig:fig1)OLS regression base Rstyle
</p>
</div>
<p>Or use ggplot</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ceosal1, <span class="fu">aes</span>(<span class="at">x =</span> roe, <span class="at">y =</span> salary)) <span class="sc">+</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MEM5220_R_files/figure-html/fig2-1.png" alt="OLS regression ggplot2 style" width="80%" />
<p class="caption">
(#fig:fig2)OLS regression ggplot2 style
</p>
</div>
<p>Determine the names of the elements of the list using the <code>names()</code>
command.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(lm1_ceosal1)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a> [<span class="dv">1</span>] <span class="st">&quot;coefficients&quot;</span>  <span class="st">&quot;residuals&quot;</span>     <span class="st">&quot;effects&quot;</span>       <span class="st">&quot;rank&quot;</span>         </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a> [<span class="dv">5</span>] <span class="st">&quot;fitted.values&quot;</span> <span class="st">&quot;assign&quot;</span>        <span class="st">&quot;qr&quot;</span>            <span class="st">&quot;df.residual&quot;</span>  </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a> [<span class="dv">9</span>] <span class="st">&quot;xlevels&quot;</span>       <span class="st">&quot;call&quot;</span>          <span class="st">&quot;terms&quot;</span>         <span class="st">&quot;model&quot;</span>        </span></code></pre></div>
<p>Extract one element, for example the residuals from the list object</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(lm1_ceosal1<span class="sc">$</span>residuals) <span class="co"># head() just prints out the first 6 residual values</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span>         <span class="dv">2</span>         <span class="dv">3</span>         <span class="dv">4</span>         <span class="dv">5</span>         <span class="dv">6</span> </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">129.0581</span> <span class="sc">-</span><span class="fl">163.8543</span> <span class="sc">-</span><span class="fl">275.9692</span> <span class="sc">-</span><span class="fl">494.3483</span>  <span class="fl">149.4923</span> <span class="sc">-</span><span class="fl">188.2151</span> </span></code></pre></div>
<p>Another way to access stored information in <em>lm1_ceosal1</em> are the
<code>coef()</code>, <code>resid()</code>, and <code>fitted()</code> functions. These return the
coefficients, residuals, and fitted values, respectively.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(lm1_ceosal1)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>(Intercept)         roe </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fl">963.19134</span>    <span class="fl">18.50119</span> </span></code></pre></div>
<p>The function <code>summary()</code> is useful in many situations. We see that when
it is called on our model, it returns a good deal of information.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm1_ceosal1)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> salary <span class="sc">~</span> roe, <span class="at">data =</span> ceosal1)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>Residuals<span class="sc">:</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    Min      1Q  Median      3Q     Max </span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">1160.2</span>  <span class="sc">-</span><span class="fl">526.0</span>  <span class="sc">-</span><span class="fl">254.0</span>   <span class="fl">138.8</span> <span class="fl">13499.9</span> </span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>            Estimate Std. Error t value <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)    </span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>(Intercept)   <span class="fl">963.19</span>     <span class="fl">213.24</span>   <span class="fl">4.517</span> <span class="fl">1.05e-05</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>roe            <span class="fl">18.50</span>      <span class="fl">11.12</span>   <span class="fl">1.663</span>   <span class="fl">0.0978</span> .  </span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>Residual standard error<span class="sc">:</span> <span class="dv">1367</span> on <span class="dv">207</span> degrees of freedom</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>Multiple R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.01319</span>,   Adjusted R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.008421</span> </span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>F<span class="sc">-</span>statistic<span class="sc">:</span> <span class="fl">2.767</span> on <span class="dv">1</span> and <span class="dv">207</span> DF,  p<span class="sc">-</span>value<span class="sc">:</span> <span class="fl">0.09777</span></span></code></pre></div>
<p>The <code>summary()</code> command also returns a list, and we can again use
<code>names()</code> to learn what about the elements of this list.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(<span class="fu">summary</span>(lm1_ceosal1))</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a> [<span class="dv">1</span>] <span class="st">&quot;call&quot;</span>          <span class="st">&quot;terms&quot;</span>         <span class="st">&quot;residuals&quot;</span>     <span class="st">&quot;coefficients&quot;</span> </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a> [<span class="dv">5</span>] <span class="st">&quot;aliased&quot;</span>       <span class="st">&quot;sigma&quot;</span>         <span class="st">&quot;df&quot;</span>            <span class="st">&quot;r.squared&quot;</span>    </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a> [<span class="dv">9</span>] <span class="st">&quot;adj.r.squared&quot;</span> <span class="st">&quot;fstatistic&quot;</span>    <span class="st">&quot;cov.unscaled&quot;</span> </span></code></pre></div>
<p>So, for example, if we wanted to directly access the value of <span class="math inline">\(R^2\)</span>,
instead of copy and pasting it out of the printed statement from
<code>summary()</code>, we could do so.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm1_ceosal1)<span class="sc">$</span>r.squared</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.01318862</span></span></code></pre></div>
<hr />
<p><strong>Your turn</strong></p>
<p>Recall that the explained sum of squares (SSE) is</p>
<span class="math display">\[\begin{equation}
SSE = \sum_{i=1}^{n}(\hat{y}_{i} - \bar{y})^2 = (n-1) \times Var(\hat{y})
(\#eq:SSE)
\end{equation}\]</span>
<p>and the residual sum of squares (SSR) is</p>
<span class="math display">\[\begin{equation}
R^2 = \frac{Var(\hat{y})}{Var(y)} = 1 - \frac{Var(\hat{u})}{Var(y)}
(\#eq:SSR)
\end{equation}\]</span>
<p>One can see that the correlation between observed and fitted values is a
square root of <span class="math inline">\(R^2\)</span>.</p>
<p>Calculate <span class="math inline">\(R^2\)</span> manually:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(<span class="fu">fitted</span>(lm1_ceosal1))<span class="sc">/</span><span class="fu">var</span>(ceosal1<span class="sc">$</span>salary)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.01318862</span></span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">-</span> <span class="fu">var</span>(<span class="fu">residuals</span>(lm1_ceosal1))<span class="sc">/</span><span class="fu">var</span>(ceosal1<span class="sc">$</span>salary)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.01318862</span></span></code></pre></div>
<hr />
<p>Another useful function is the <code>predict()</code> function.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># unique(ceosal1$roe)</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>roe_sample <span class="ot">&lt;-</span><span class="fu">sample</span>(ceosal1<span class="sc">$</span>roe, <span class="dv">1</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>roe_sample</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">19.6</span></span></code></pre></div>
<p>Let’s make a prediction for salary when the return on equity is
19.6000004.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>b0hat_sample <span class="ot">&lt;-</span> <span class="fu">mean</span>(salary) <span class="sc">-</span> b1hat <span class="sc">*</span> roe_sample</span></code></pre></div>
<p>We are not restricted to observed values of the explanatory variable.
Instead we can supply also our own predictor values</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(lm1_ceosal1, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">roe =</span> <span class="dv">30</span>))</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>       <span class="dv">1</span> </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="fl">1518.227</span> </span></code></pre></div>
<p>The above code reads “predict the salary when the return on equity is 30
using the <em>lm1_ceosal1</em> model.”</p>
<hr />
<details>
<summary>
<p><strong>Overthinking</strong></p>
</summary>
<p>
<div id="regression-through-the-origin-and-regression-on-a-constant" class="section level3" number="1.1.1">
<h3 number="1.1.1"><span class="header-section-number">1.1.1</span> Regression through the Origin and Regression on a Constant</h3>
<p>Regression without intercept (through origin)</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>lm2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(salary <span class="sc">~</span>  <span class="dv">0</span> <span class="sc">+</span> roe, <span class="at">data =</span> ceosal1)</span></code></pre></div>
<p>Regression without slope</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>lm3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(salary <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> ceosal1)</span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(salary<span class="sc">~</span> roe, <span class="at">data =</span> ceosal1,</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Return on equity&quot;</span>,</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Salary&quot;</span>,</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Salary vs return on equity&quot;</span>,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch  =</span> <span class="dv">20</span>,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex  =</span> <span class="dv">2</span>,</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">col  =</span> <span class="st">&quot;grey&quot;</span>)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(lm1_ceosal1, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">&quot;darkorange&quot;</span>)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(lm2,<span class="at">lwd =</span> <span class="dv">3</span>,  <span class="at">lty =</span> <span class="dv">2</span>,   <span class="at">col =</span> <span class="st">&quot;darkblue&quot;</span>)</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(lm3, <span class="at">lwd =</span> <span class="dv">3</span>,  <span class="at">lty =</span> <span class="dv">3</span>,   <span class="at">col =</span> <span class="st">&quot;black&quot;</span>)</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topleft&quot;</span>,</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>       <span class="fu">c</span>(<span class="st">&quot;full&quot;</span>,</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;through origin&quot;</span>,</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;constant only&quot;</span>),</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd =</span><span class="dv">2</span>,</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">lty =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MEM5220_R_files/figure-html/fig3-1.png" alt="Regression through the Origin and on a Constant" width="80%" />
<p class="caption">
(#fig:fig3)Regression through the Origin and on a Constant
</p>
</div>
<p>In models without the intercept the <span class="math inline">\(R^2\)</span> loses its interpretatation.
The reason is that the <span class="math inline">\(R^2\)</span> is the ratio of explained variance to total
variance <strong>only</strong> if the intercept is included.</p>
<hr />
</p>
</details>
<hr />
<details>
<summary>
<p><strong>Overthinking</strong></p>
</summary>
<p>
</div>
<div id="simulating-slr" class="section level3" number="1.1.2">
<h3 number="1.1.2"><span class="header-section-number">1.1.2</span> Simulating SLR</h3>
<div id="expected-values-variance-and-standard-errors" class="section level5" number="1.1.2.0.1">
<h5 number="1.1.2.0.1"><span class="header-section-number">1.1.2.0.1</span> Expected Values, Variance, and Standard Errors</h5>
<p>The <strong>Gauss–Markov theorem</strong> tells us that when estimating the
parameters of the simple linear regression model <span class="math inline">\(\beta_{0}\)</span> and
<span class="math inline">\(\beta_{1}\)</span>, the <span class="math inline">\(\hat{\beta}_{0}\)</span> and <span class="math inline">\(\hat{\beta}_{1}\)</span> which we
derived are the best linear unbiased estimates, or BLUE for short. (The
actual conditions for the Gauss–Markov theorem are more relaxed than
the SLR model.)</p>
<p>In short those assumptions are:</p>
<ul>
<li>SLR.1 Linear population regression function
<span class="math inline">\(y = \beta_0 + \beta_{1} \times x + u\)</span></li>
<li>SLR.2 Random sampling of x and y from the population</li>
<li>SLR.3 Variation in the sample values: <span class="math inline">\(x_{1}, \dots , x_{n}\)</span></li>
<li>SLR.4 Zero conditional mean: <span class="math inline">\(\mathbf{E}(u|x) = 0\)</span></li>
<li>SLR.5 Homeskedasticity: <span class="math inline">\(Var(u|x) = \sigma^2\)</span></li>
</ul>
<p>Recall that under <strong>SLR.1 - SLR.4</strong> the OLS parameter estimators are
unbiased. Under <strong>SLR.1 - SLR.4</strong> the OLS parameter estimators have a
specific sampling variance.</p>
<p>Simulating a model is an important concept. In practice you will almost
never have a true model, and you will use data to attempt to recover
information about the unknown true model. With simulation, we decide the
true model and simulate data from it. Then, we apply a method to the
data, in this case least squares. Now, since we know the true model, we
can assess how well it did.</p>
<p>Simulation also helps to grasp the concepts of estimators, estimates,
unbiasedness, the sampling variance of the estimators, and the
consequences of violated assumptions.</p>
<p>Sample size</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">200</span></span></code></pre></div>
<p>True parameters</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>b0<span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="co"># standard deviation of the error term u</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="dv">5</span></span></code></pre></div>
<p>Determine the distribution of the independent variable</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>yhat1 <span class="ot">&lt;-</span> b0 <span class="sc">+</span> b1 <span class="sc">*</span> x1 <span class="co">#  Note that we do not include the error term</span></span></code></pre></div>
<p>Plot a Gaussian distribution of the dependent variable based on the
parameters</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dnorm</span>(x, <span class="at">mean =</span> yhat1, <span class="at">sd =</span> sigma), <span class="sc">-</span><span class="dv">5</span>, <span class="dv">15</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> yhat1, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;f(y|x = 5)&quot;</span>), <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>))</span></code></pre></div>
<p><img src="MEM5220_R_files/figure-html/unnamed-chunk-40-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>This represent the theoretical (true) probability distribution of <span class="math inline">\(y\)</span>,
given <span class="math inline">\(x\)</span></p>
<p>We can calculate the variance of <span class="math inline">\(b_{1}\)</span> and plot the corresponding
density function.</p>
<span class="math display">\[\begin{equation}
var(b_2) = \frac{\sigma^2}{\sum{}{}(x_1 - \bar{x})^2}
(\#eq:variancebeta)
\end{equation}\]</span>
<p>Assume that <span class="math inline">\(x_{2}\)</span> represents a second possible predictor of <span class="math inline">\(y\)</span></p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="dv">18</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(x1, n<span class="sc">/</span><span class="dv">2</span>), <span class="fu">rep</span>(x2, n<span class="sc">/</span><span class="dv">2</span>))</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>xbar <span class="ot">&lt;-</span> <span class="fu">mean</span>(x)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>sumxbar <span class="ot">&lt;-</span> <span class="fu">sum</span>((x<span class="sc">-</span>xbar)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>varb <span class="ot">&lt;-</span> (sigma<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>sumxbar</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>sdb <span class="ot">&lt;-</span><span class="fu">sqrt</span>(varb)</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>leftlim <span class="ot">&lt;-</span> b1<span class="dv">-3</span><span class="sc">*</span>sdb</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>rightlim <span class="ot">&lt;-</span> b1<span class="sc">+</span><span class="dv">3</span><span class="sc">*</span>sdb</span></code></pre></div>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dnorm</span>(x, <span class="at">mean =</span> b1, <span class="at">sd =</span> sdb), leftlim, rightlim)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> b1, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MEM5220_R_files/figure-html/fig4-1.png" alt="The theoretical (true) probability density function of b1" width="80%" />
<p class="caption">
(#fig:fig4)The theoretical (true) probability density function of b1
</p>
</div>
<p>Draw sample of size <span class="math inline">\(n\)</span></p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">4</span>, sigma)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Another way is to assume that the values for x are fixed and know</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co"># x= seq(from = 0, to = 10, length.out = n)</span></span></code></pre></div>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>u <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, sigma)</span></code></pre></div>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> b0 <span class="sc">+</span> b1 <span class="sc">*</span> x <span class="sc">+</span> u</span></code></pre></div>
<p>Estimate parameter by OLS</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>olsreg <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span>x )</span></code></pre></div>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>simulation.df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(x,y)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>population.df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(b0, b1)</span></code></pre></div>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(simulation.df,</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;x&quot;</span>,</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;y&quot;</span>,</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>     <span class="co"># main = &quot;Simulate least squares regression&quot;,</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch  =</span> <span class="dv">20</span>,</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex  =</span> <span class="dv">2</span>,</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">col  =</span> <span class="st">&quot;grey&quot;</span>)</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(olsreg, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">&quot;darkorange&quot;</span>)</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(b0, b1,  <span class="at">lwd =</span> <span class="dv">3</span>,  <span class="at">lty =</span> <span class="dv">2</span>,   <span class="at">col =</span> <span class="st">&quot;darkblue&quot;</span>)</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topleft&quot;</span>,</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>       <span class="fu">c</span>(<span class="st">&quot;OLS regression function&quot;</span>,</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;Population regression function&quot;</span>),</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd =</span><span class="dv">2</span>,</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">lty =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MEM5220_R_files/figure-html/fig5-1.png" alt="Simulated Sample and OLS Regression Line" width="80%" />
<p class="caption">
(#fig:fig5)Simulated Sample and OLS Regression Line
</p>
</div>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>lable1 <span class="ot">&lt;-</span> <span class="st">&quot;OLS regression function&quot;</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(simulation.df, <span class="fu">aes</span>(<span class="at">x =</span> x,  <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="fu">aes</span>(<span class="at">intercept=</span>b0,<span class="at">slope=</span>b1,<span class="at">colour=</span><span class="st">&quot;Population regression function&quot;</span>), <span class="at">linetype =</span><span class="st">&quot;dashed&quot;</span>, <span class="at">show.legend  =</span> <span class="cn">TRUE</span>)<span class="sc">+</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="fu">aes</span>(<span class="at">colour =</span><span class="st">&quot;OLS regression function&quot;</span>), <span class="at">method =</span> <span class="st">&quot;lm&quot;</span>,<span class="at">se=</span><span class="cn">FALSE</span>, <span class="at">show.legend =</span><span class="cn">TRUE</span>)<span class="sc">+</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">colour =</span> <span class="st">&quot;Regression functions&quot;</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>       <span class="co"># , title = &quot;Simulate least squares regression&quot;</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MEM5220_R_files/figure-html/fig6-1.png" alt="Simulated Sample and OLS Regression Line (gpplot Style)" width="80%" />
<p class="caption">
(#fig:fig6)Simulated Sample and OLS Regression Line (gpplot Style)
</p>
</div>
<p>Since the expected values and variances of our estimators are defined
over separate random samples from the same population, it makes sense to
repeat our simulation exercise over many simulated samples.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the random seed</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234567</span>)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="co"># set sample size and number of simulations</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>n<span class="ot">&lt;-</span><span class="dv">1000</span>; r<span class="ot">&lt;-</span><span class="dv">10000</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="co"># set true parameters: betas and sd of u</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>b0<span class="ot">&lt;-</span><span class="fl">1.0</span>; b1<span class="ot">&lt;-</span><span class="fl">0.5</span>; sigma<span class="ot">&lt;-</span><span class="dv">2</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize b0hat and b1hat to store results later:</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>b0hat <span class="ot">&lt;-</span> <span class="fu">numeric</span>(r)</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>b1hat <span class="ot">&lt;-</span> <span class="fu">numeric</span>(r)</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Draw a sample of x, fixed over replications:</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n,<span class="dv">4</span>,<span class="dv">1</span>)</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a><span class="co"># repeat r times:</span></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>r) {</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Draw a sample of y:</span></span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>  u <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n,<span class="dv">0</span>,sigma)</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> b0 <span class="sc">+</span> b1<span class="sc">*</span>x <span class="sc">+</span> u</span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># estimate parameters by OLS and store them in the vectors</span></span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a>  bhat <span class="ot">&lt;-</span> <span class="fu">coefficients</span>( <span class="fu">lm</span>(y<span class="sc">~</span>x) )</span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>  b0hat[j] <span class="ot">&lt;-</span> bhat[<span class="st">&quot;(Intercept)&quot;</span>]</span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a>  b1hat[j] <span class="ot">&lt;-</span> bhat[<span class="st">&quot;x&quot;</span>]</span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># MC estimate of the expected values:</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(b0hat)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.9985388</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(b1hat)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.5000466</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="co"># MC estimate of the variances:</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(b0hat)</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.0690833</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(b1hat)</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.004069063</span></span></code></pre></div>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize empty plot</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>( <span class="cn">NULL</span>, <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">8</span>), <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">6</span>), <span class="at">xlab=</span><span class="st">&quot;x&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;y&quot;</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="co"># add OLS regression lines</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) <span class="fu">abline</span>(b0hat[j],b1hat[j],<span class="at">col=</span><span class="st">&quot;gray&quot;</span>)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="co"># add population regression line</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(b0,b1,<span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="co"># add legend</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topleft&quot;</span>,<span class="fu">c</span>(<span class="st">&quot;Population&quot;</span>,<span class="st">&quot;OLS regressions&quot;</span>),</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>),<span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;black&quot;</span>,<span class="st">&quot;gray&quot;</span>))</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MEM5220_R_files/figure-html/fig7-1.png" alt="Population and Simulated OLS Regression Lines" width="80%" />
<p class="caption">
(#fig:fig7)Population and Simulated OLS Regression Lines
</p>
</div>
<p>Even though the loop solution is transparent, let us take a look at a
different, more <em>modern</em> approach.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define a function the returns the alpha -- its point estimate, standard error, etc. -- from the OLS</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n,<span class="dv">4</span>,<span class="dv">1</span>) <span class="co"># </span><span class="al">NOTE</span><span class="co"> 1: Although a normal distribution is usually defined by its mean and variance, &#39;rnorm()&#39; requires the standard deviation as input for the second moment.</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co"> 2: We use the same values for x in all samples since we draw them outside of the loop.</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>iteration <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  u <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n,<span class="dv">0</span>,sigma)</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> b0 <span class="sc">+</span> b1<span class="sc">*</span>x <span class="sc">+</span> u</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(y<span class="sc">~</span>x) <span class="sc">%&gt;%</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>    broom<span class="sc">::</span><span class="fu">tidy</span>() <span class="co"># %&gt;%</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># dplyr::filter(term == &#39;x&#39;) # One could only extract the slope</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 1000 iterations of the above simulation</span></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>MC_coef<span class="ot">&lt;-</span> <span class="fu">map_df</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>, <span class="sc">~</span><span class="fu">iteration</span>())</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(MC_coef)</span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>tibble [<span class="dv">2</span>,<span class="dv">000</span> × <span class="dv">5</span>] (S3<span class="sc">:</span> tbl_df<span class="sc">/</span>tbl<span class="sc">/</span>data.frame)</span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> term     <span class="sc">:</span> chr [<span class="dv">1</span><span class="sc">:</span><span class="dv">2000</span>] <span class="st">&quot;(Intercept)&quot;</span> <span class="st">&quot;x&quot;</span> <span class="st">&quot;(Intercept)&quot;</span> <span class="st">&quot;x&quot;</span> ...</span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> estimate <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">2000</span>] <span class="fl">1.577</span> <span class="fl">0.372</span> <span class="fl">1.44</span> <span class="fl">0.387</span> <span class="fl">1.355</span> ...</span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> std.error<span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">2000</span>] <span class="fl">0.2672</span> <span class="fl">0.0639</span> <span class="fl">0.2623</span> <span class="fl">0.0628</span> <span class="fl">0.2626</span> ...</span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> statistic<span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">2000</span>] <span class="fl">5.9</span> <span class="fl">5.82</span> <span class="fl">5.49</span> <span class="fl">6.17</span> <span class="fl">5.16</span> ...</span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> p.value  <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">2000</span>] <span class="fl">4.94e-09</span> <span class="fl">7.91e-09</span> <span class="fl">5.13e-08</span> <span class="fl">9.92e-10</span> <span class="fl">2.99e-07</span> ...</span></code></pre></div>
<p>Instead of plotting simulated and true parameter regression lines we can
take a look at the kernel density of the simulated parameter estimates</p>
<p>Figure @ref(fig:fig8) shows the simulated distribution of <span class="math inline">\(\beta_{0}\)</span>
and <span class="math inline">\(\beta_{1}\)</span> the theoretical one.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the results</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(MC_coef)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>tibble [<span class="dv">2</span>,<span class="dv">000</span> × <span class="dv">5</span>] (S3<span class="sc">:</span> tbl_df<span class="sc">/</span>tbl<span class="sc">/</span>data.frame)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> term     <span class="sc">:</span> chr [<span class="dv">1</span><span class="sc">:</span><span class="dv">2000</span>] <span class="st">&quot;(Intercept)&quot;</span> <span class="st">&quot;x&quot;</span> <span class="st">&quot;(Intercept)&quot;</span> <span class="st">&quot;x&quot;</span> ...</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> estimate <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">2000</span>] <span class="fl">1.577</span> <span class="fl">0.372</span> <span class="fl">1.44</span> <span class="fl">0.387</span> <span class="fl">1.355</span> ...</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> std.error<span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">2000</span>] <span class="fl">0.2672</span> <span class="fl">0.0639</span> <span class="fl">0.2623</span> <span class="fl">0.0628</span> <span class="fl">0.2626</span> ...</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> statistic<span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">2000</span>] <span class="fl">5.9</span> <span class="fl">5.82</span> <span class="fl">5.49</span> <span class="fl">6.17</span> <span class="fl">5.16</span> ...</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> p.value  <span class="sc">:</span> num [<span class="dv">1</span><span class="sc">:</span><span class="dv">2000</span>] <span class="fl">4.94e-09</span> <span class="fl">7.91e-09</span> <span class="fl">5.13e-08</span> <span class="fl">9.92e-10</span> <span class="fl">2.99e-07</span> ...</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>MC_coef<span class="ot">&lt;-</span> MC_coef <span class="sc">%&gt;%</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">OLScoeff =</span>  <span class="fu">ifelse</span>(term <span class="sc">==</span> <span class="st">&quot;x&quot;</span>, <span class="st">&quot;b1hat&quot;</span>, <span class="st">&quot;b0hat&quot;</span>)) <span class="sc">%&gt;%</span>  <span class="co"># rename the x to b1hat and (Intercept) to b0hat and create a new column</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Simulated =</span> <span class="fu">ifelse</span>(term <span class="sc">==</span> <span class="st">&quot;x&quot;</span>, <span class="st">&quot;b1&quot;</span>, <span class="st">&quot;b0&quot;</span>)) <span class="co">#  %&gt;%</span></span></code></pre></div>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span> MC_coef, <span class="fu">aes</span>(estimate)) <span class="sc">+</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>() <span class="sc">+</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">data =</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(MC_coef, OLScoeff <span class="sc">==</span> <span class="st">&quot;b0hat&quot;</span>), <span class="fu">aes</span>(<span class="at">xintercept=</span>b0), <span class="at">colour=</span><span class="st">&quot;pink&quot;</span>)  <span class="sc">+</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">data =</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(MC_coef, OLScoeff <span class="sc">==</span> <span class="st">&quot;b1hat&quot;</span>), <span class="fu">aes</span>(<span class="at">xintercept=</span>b1), <span class="at">colour=</span><span class="st">&quot;darkgreen&quot;</span>)  <span class="sc">+</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data=</span>MC_coef[<span class="dv">3</span>,], <span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>estimate, <span class="at">y=</span><span class="dv">8</span>, <span class="at">label=</span><span class="fu">paste</span>(<span class="st">&quot;True parameter: &quot;</span>, MC_coef[<span class="dv">3</span>,<span class="dv">7</span>])), <span class="at">colour =</span> <span class="st">&quot;pink&quot;</span>) <span class="sc">+</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data=</span>MC_coef[<span class="dv">4</span>,], <span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>estimate, <span class="at">y=</span><span class="dv">8</span>, <span class="at">label=</span><span class="fu">paste</span>(<span class="st">&quot;True parameter: &quot;</span>, MC_coef[<span class="dv">4</span>,<span class="dv">7</span>])), <span class="at">colour =</span> <span class="st">&quot;darkgreen&quot;</span>) <span class="sc">+</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( <span class="sc">~</span> OLScoeff, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>)   <span class="sc">+</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Histogram Monte Carlo Simulations and True population parameters&quot;</span>) <span class="sc">+</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MEM5220_R_files/figure-html/fig8-1.png" alt="Histogram b0 and b1 and true parameter" width="80%" />
<p class="caption">
(#fig:fig8)Histogram b0 and b1 and true parameter
</p>
</div>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>b1_sim <span class="ot">&lt;-</span> MC_coef <span class="sc">%&gt;%</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Simulated <span class="sc">==</span> <span class="st">&quot;b1&quot;</span>)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(b1_sim<span class="sc">$</span>estimate)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.5011414</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(b1_sim<span class="sc">$</span>estimate) <span class="sc">==</span> (<span class="fu">sd</span>(b1_sim<span class="sc">$</span>estimate))<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="cn">FALSE</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">var</span>(b1_sim<span class="sc">$</span>estimate) , (<span class="fu">sd</span>(b1_sim<span class="sc">$</span>estimate))<span class="sc">^</span><span class="dv">2</span>) <span class="co"># Floating point arithmetic!</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="cn">TRUE</span></span></code></pre></div>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span> b1_sim, <span class="fu">aes</span>(estimate)) <span class="sc">+</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Simulated), <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span> <span class="co"># computes and draws the kernel density, which is the smoothed version of the histogram</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># stat_function(fun = dnorm, args = list(mean = mean(b1_sim$estimate), sd = sd(b1_sim$estimate)), aes(colour = &quot;true&quot;)) +</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> dnorm, <span class="at">args =</span> <span class="fu">list</span>(<span class="at">mean =</span> <span class="fl">0.5</span>, <span class="at">sd =</span> <span class="fu">sd</span>(b1_sim<span class="sc">$</span>estimate)), <span class="fu">aes</span>(<span class="at">colour =</span> <span class="st">&quot;Population&quot;</span>)) <span class="sc">+</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># labs(</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  title = &quot;Kernel Density Monte Carlo Simulations vs. True population parameters&quot;</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ) +</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">name=</span><span class="st">&quot;&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MEM5220_R_files/figure-html/fig9-1.png" alt="Kernel Density Monte Carlo Simulations vs. True population parameters of b1" width="80%" />
<p class="caption">
(#fig:fig9)Kernel Density Monte Carlo Simulations vs. True population parameters of b1
</p>
</div>
</div>
<div id="violation-of-slr.4" class="section level5" number="1.1.2.0.2">
<h5 number="1.1.2.0.2"><span class="header-section-number">1.1.2.0.2</span> Violation of SLR.4</h5>
<p>To implement a violation of <strong>SLR.4</strong> (zero conditional mean) consider a
case where in the population <span class="math inline">\(u\)</span> is not mean independent of <span class="math inline">\(x\)</span>, for
example</p>
<p><span class="math display">\[
\mathbf{E}(u|x) = \frac{x-4}{5}
\]</span></p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the random seed</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234567</span>)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="co"># set sample size and number of simulations</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>n<span class="ot">&lt;-</span><span class="dv">1000</span>; r<span class="ot">&lt;-</span><span class="dv">10000</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="co"># set true parameters: betas and sd of u</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>b0<span class="ot">&lt;-</span><span class="dv">1</span>; b1<span class="ot">&lt;-</span><span class="fl">0.5</span>; su<span class="ot">&lt;-</span><span class="dv">2</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize b0hat and b1hat to store results later:</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>b0hat <span class="ot">&lt;-</span> <span class="fu">numeric</span>(r)</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>b1hat <span class="ot">&lt;-</span> <span class="fu">numeric</span>(r)</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Draw a sample of x, fixed over replications:</span></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n,<span class="dv">4</span>,<span class="dv">1</span>)</span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a><span class="co"># repeat r times:</span></span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>r) {</span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Draw a sample of y:</span></span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>  u <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, (x<span class="dv">-4</span>)<span class="sc">/</span><span class="dv">5</span>, su) <span class="co"># this is where manipulate the assumption of zero conditional mean</span></span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> b0 <span class="sc">+</span> b1<span class="sc">*</span>x <span class="sc">+</span> u</span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># estimate parameters by OLS and store them in the vectors</span></span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a>  bhat <span class="ot">&lt;-</span> <span class="fu">coefficients</span>( <span class="fu">lm</span>(y<span class="sc">~</span>x) )</span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a>  b0hat[j] <span class="ot">&lt;-</span> bhat[<span class="st">&quot;(Intercept)&quot;</span>]</span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a>  b1hat[j] <span class="ot">&lt;-</span> bhat[<span class="st">&quot;x&quot;</span>]</span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>OLS coefficients</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># MC estimate of the expected values:</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(b0hat)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.1985388</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(b1hat)</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.7000466</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a><span class="co"># MC estimate of the variances:</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(b0hat)</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.0690833</span></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(b1hat)</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.004069063</span></span></code></pre></div>
<p>The average estimates are far from the population parameters <span class="math inline">\(\beta_0=1\)</span>
and <span class="math inline">\(\beta_1 = 0.5\)</span>!</p>
</div>
<div id="violation-of-slr.5" class="section level5" number="1.1.2.0.3">
<h5 number="1.1.2.0.3"><span class="header-section-number">1.1.2.0.3</span> Violation of SLR.5</h5>
<p>Homoskedasticity is not required for unbiasedness but for it is a
requirement for the theorem of sampling variance. Consider the following
heteroskedastic behavior of <span class="math inline">\(u\)</span> given <span class="math inline">\(x\)</span>.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the random seed</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234567</span>)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="co"># set sample size and number of simulations</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>n<span class="ot">&lt;-</span><span class="dv">1000</span>; r<span class="ot">&lt;-</span><span class="dv">10000</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="co"># set true parameters: betas and sd of u</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>b0<span class="ot">&lt;-</span><span class="dv">1</span>; b1<span class="ot">&lt;-</span><span class="fl">0.5</span>; su<span class="ot">&lt;-</span><span class="dv">2</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize b0hat and b1hat to store results later:</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>b0hat <span class="ot">&lt;-</span> <span class="fu">numeric</span>(r)</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>b1hat <span class="ot">&lt;-</span> <span class="fu">numeric</span>(r)</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Draw a sample of x, fixed over replications:</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n,<span class="dv">4</span>,<span class="dv">1</span>)</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a><span class="co"># repeat r times:</span></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>r) {</span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Draw a sample of y:</span></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>  varu <span class="ot">&lt;-</span> <span class="dv">4</span><span class="sc">/</span><span class="fu">exp</span>(<span class="fl">4.5</span>) <span class="sc">*</span> <span class="fu">exp</span>(x)</span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>  u <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="fu">sqrt</span>(varu) )</span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> b0 <span class="sc">+</span> b1<span class="sc">*</span>x <span class="sc">+</span> u</span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># estimate parameters by OLS and store them in the vectors</span></span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>  lm_heterosced <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span>x)</span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>  bhat <span class="ot">&lt;-</span> <span class="fu">coefficients</span>( <span class="fu">lm</span>(y<span class="sc">~</span>x) )</span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a>  b0hat[j] <span class="ot">&lt;-</span> bhat[<span class="st">&quot;(Intercept)&quot;</span>]</span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a>  b1hat[j] <span class="ot">&lt;-</span> bhat[<span class="st">&quot;x&quot;</span>]</span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_heterosced) <span class="co"># just the last sample of the MC-simulation</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> y <span class="sc">~</span> x)</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>Residuals<span class="sc">:</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>     Min       1Q   Median       3Q      Max </span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">23.6742</span>  <span class="sc">-</span><span class="fl">0.9033</span>   <span class="fl">0.0052</span>   <span class="fl">1.0012</span>   <span class="fl">9.3411</span> </span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>            Estimate Std. Error t value <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)    </span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>(Intercept)  <span class="fl">1.24088</span>    <span class="fl">0.27158</span>   <span class="fl">4.569</span> <span class="fl">5.51e-06</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>x            <span class="fl">0.44561</span>    <span class="fl">0.06593</span>   <span class="fl">6.759</span> <span class="fl">2.37e-11</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>Residual standard error<span class="sc">:</span> <span class="fl">2.075</span> on <span class="dv">998</span> degrees of freedom</span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a>Multiple R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.04377</span>,   Adjusted R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.04281</span> </span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a>F<span class="sc">-</span>statistic<span class="sc">:</span> <span class="fl">45.68</span> on <span class="dv">1</span> and <span class="dv">998</span> DF,  p<span class="sc">-</span>value<span class="sc">:</span> <span class="fl">2.367e-11</span></span></code></pre></div>
<p>Plot the residual against the regressor suspected of creating
heteroskedasticity, or more generally, the fitted values of the
regression.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">residuals</span>(lm_heterosced)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>yhat <span class="ot">&lt;-</span> <span class="fu">fitted</span>(lm_heterosced)</span></code></pre></div>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, res, <span class="at">ylab =</span> <span class="st">&quot;residuals&quot;</span>)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(yhat, res, <span class="at">xlab =</span> <span class="st">&quot;fitted values&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;residuals&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MEM5220_R_files/figure-html/fig10-1.png" alt="Heteroskedasticity in the simulated data" width="80%" />
<p class="caption">
(#fig:fig10)Heteroskedasticity in the simulated data
</p>
</div>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># MC estimate of the expected values:</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(b0hat)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">1.0019</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(b1hat)</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.4992376</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="co"># MC estimate of the variances:</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(b0hat)</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.08967037</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(b1hat)</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.007264373</span></span></code></pre></div>
<p>Unbiasedness is provided but sampling variance is incorrect (compared to
the results provided above).</p>
<hr />
</p>
</details>
</div>
</div>
<div id="polynomials-and-logarithms" class="section level3" number="1.1.3">
<h3 number="1.1.3"><span class="header-section-number">1.1.3</span> Polynomials and Logarithms</h3>
<p>Sometimes the scatter plot diagram or some theoretical considerations
suggest a non-linear relationship. The most popular non-linear
transformation involve logarithms of the dependent or independent
variables and polynomial functions.</p>
<p>We will use a new dataset, <em>wage1</em>, for this section. A detailed
exploratory analysis of the dataset is left to the reader.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;wage1&quot;</span>)</span></code></pre></div>
<div id="predictor-variable-transformation" class="section level4" number="1.1.3.1">
<h4 number="1.1.3.1"><span class="header-section-number">1.1.3.1</span> Predictor variable transformation</h4>
<p>A common variance stabilizing transformation (VST) is necessary when we
see increasing variance in a fitted versus residuals plot.</p>
<p>To use the <em>log</em> of an independent variable is to make its distribution
closer to the normal distribution.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># wage1$logwage &lt;- log(wage1$wage) # one could also create a new variable</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>p1_wagehisto <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(wage1)  <span class="sc">+</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> wage), <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>)</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>p2_wagehisto <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(wage1)  <span class="sc">+</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> wage),  <span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">trans=</span><span class="st">&#39;log2&#39;</span>, <span class="st">&quot;Log Wage&quot;</span>)  <span class="co"># instead of creating a new variable with simply define that the x-scale undergoes a logarithmic transformation</span></span></code></pre></div>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(p1_wagehisto, p2_wagehisto,</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>),</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">1</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MEM5220_R_files/figure-html/fig11-1.png" alt="Histogram of wage and log(wage)" width="80%" />
<p class="caption">
(#fig:fig11)Histogram of wage and log(wage)
</p>
</div>
<p>A model with a log transformed response:</p>
<span class="math display">\[\begin{equation}
log(Y_{i}) = \beta_{0} + \beta_{1} \times x_{i} + \epsilon_{i}
\end{equation}\]</span>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>lm_wage <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> educ, <span class="at">data =</span> wage1)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>lm_wage1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(wage) <span class="sc">~</span> educ, <span class="at">data =</span>  wage1)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_wage)</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> wage <span class="sc">~</span> educ, <span class="at">data =</span> wage1)</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>Residuals<span class="sc">:</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>    Min      1Q  Median      3Q     Max </span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">5.3396</span> <span class="sc">-</span><span class="fl">2.1501</span> <span class="sc">-</span><span class="fl">0.9674</span>  <span class="fl">1.1921</span> <span class="fl">16.6085</span> </span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>            Estimate Std. Error t value <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)    </span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>(Intercept) <span class="sc">-</span><span class="fl">0.90485</span>    <span class="fl">0.68497</span>  <span class="sc">-</span><span class="fl">1.321</span>    <span class="fl">0.187</span>    </span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>educ         <span class="fl">0.54136</span>    <span class="fl">0.05325</span>  <span class="fl">10.167</span>   <span class="sc">&lt;</span><span class="fl">2e-16</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a>Residual standard error<span class="sc">:</span> <span class="fl">3.378</span> on <span class="dv">524</span> degrees of freedom</span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>Multiple R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.1648</span>,    Adjusted R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.1632</span> </span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a>F<span class="sc">-</span>statistic<span class="sc">:</span> <span class="fl">103.4</span> on <span class="dv">1</span> and <span class="dv">524</span> DF,  p<span class="sc">-</span>value<span class="sc">:</span> <span class="er">&lt;</span> <span class="fl">2.2e-16</span></span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_wage1)</span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> <span class="fu">log</span>(wage) <span class="sc">~</span> educ, <span class="at">data =</span> wage1)</span>
<span id="cb65-26"><a href="#cb65-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-27"><a href="#cb65-27" aria-hidden="true" tabindex="-1"></a>Residuals<span class="sc">:</span></span>
<span id="cb65-28"><a href="#cb65-28" aria-hidden="true" tabindex="-1"></a>     Min       1Q   Median       3Q      Max </span>
<span id="cb65-29"><a href="#cb65-29" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">2.21158</span> <span class="sc">-</span><span class="fl">0.36393</span> <span class="sc">-</span><span class="fl">0.07263</span>  <span class="fl">0.29712</span>  <span class="fl">1.52339</span> </span>
<span id="cb65-30"><a href="#cb65-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-31"><a href="#cb65-31" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb65-32"><a href="#cb65-32" aria-hidden="true" tabindex="-1"></a>            Estimate Std. Error t value <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)    </span>
<span id="cb65-33"><a href="#cb65-33" aria-hidden="true" tabindex="-1"></a>(Intercept) <span class="fl">0.583773</span>   <span class="fl">0.097336</span>   <span class="fl">5.998</span> <span class="fl">3.74e-09</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb65-34"><a href="#cb65-34" aria-hidden="true" tabindex="-1"></a>educ        <span class="fl">0.082744</span>   <span class="fl">0.007567</span>  <span class="fl">10.935</span>  <span class="sc">&lt;</span> <span class="fl">2e-16</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb65-35"><a href="#cb65-35" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb65-36"><a href="#cb65-36" aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span>
<span id="cb65-37"><a href="#cb65-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-38"><a href="#cb65-38" aria-hidden="true" tabindex="-1"></a>Residual standard error<span class="sc">:</span> <span class="fl">0.4801</span> on <span class="dv">524</span> degrees of freedom</span>
<span id="cb65-39"><a href="#cb65-39" aria-hidden="true" tabindex="-1"></a>Multiple R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.1858</span>,    Adjusted R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.1843</span> </span>
<span id="cb65-40"><a href="#cb65-40" aria-hidden="true" tabindex="-1"></a>F<span class="sc">-</span>statistic<span class="sc">:</span> <span class="fl">119.6</span> on <span class="dv">1</span> and <span class="dv">524</span> DF,  p<span class="sc">-</span>value<span class="sc">:</span> <span class="er">&lt;</span> <span class="fl">2.2e-16</span></span></code></pre></div>
<p>Plotting Diagnostics for Linear Models</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lm_wage)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MEM5220_R_files/figure-html/fig12-1.png" alt="Regression diagnostics plot base R - Linear Relationship" width="80%" /><img src="MEM5220_R_files/figure-html/fig12-2.png" alt="Regression diagnostics plot base R - Linear Relationship" width="80%" /><img src="MEM5220_R_files/figure-html/fig12-3.png" alt="Regression diagnostics plot base R - Linear Relationship" width="80%" /><img src="MEM5220_R_files/figure-html/fig12-4.png" alt="Regression diagnostics plot base R - Linear Relationship" width="80%" />
<p class="caption">
(#fig:fig12)Regression diagnostics plot base R - Linear Relationship
</p>
</div>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(lm_wage, <span class="at">which =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="at">colour =</span> <span class="st">&#39;dodgerblue3&#39;</span>,</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">smooth.colour =</span> <span class="st">&#39;red&#39;</span>, <span class="at">smooth.linetype =</span> <span class="st">&#39;dashed&#39;</span>,</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">ad.colour =</span> <span class="st">&#39;blue&#39;</span>,</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">label =</span> <span class="cn">FALSE</span>,</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">label.size =</span> <span class="dv">3</span>, <span class="at">label.n =</span> <span class="dv">5</span>, <span class="at">label.colour =</span> <span class="st">&#39;blue&#39;</span>,</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">ncol =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MEM5220_R_files/figure-html/fig13-1.png" alt="Regression diagnostics autoplot(ggplot) - Linear Relationship" width="80%" />
<p class="caption">
(#fig:fig13)Regression diagnostics autoplot(ggplot) - Linear Relationship
</p>
</div>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(lm_wage1, <span class="at">which =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="at">colour =</span> <span class="st">&#39;dodgerblue3&#39;</span>,</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">smooth.colour =</span> <span class="st">&#39;red&#39;</span>, <span class="at">smooth.linetype =</span> <span class="st">&#39;dashed&#39;</span>,</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">ad.colour =</span> <span class="st">&#39;blue&#39;</span>,</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">label =</span> <span class="cn">FALSE</span>,</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">label.size =</span> <span class="dv">3</span>, <span class="at">label.n =</span> <span class="dv">5</span>, <span class="at">label.colour =</span> <span class="st">&#39;blue&#39;</span>,</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">ncol =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MEM5220_R_files/figure-html/fig14-1.png" alt="Regression diagnostics - Non-Linear Relationship" width="80%" />
<p class="caption">
(#fig:fig14)Regression diagnostics - Non-Linear Relationship
</p>
</div>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>p1_nonlinearities <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(wage1, <span class="fu">aes</span>(<span class="at">x =</span> educ, <span class="at">y =</span> wage )) <span class="sc">+</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()   <span class="sc">+</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">trans=</span><span class="st">&#39;log2&#39;</span>, <span class="st">&quot;Log Wage&quot;</span>) <span class="sc">+</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="fu">aes</span>(<span class="at">fill=</span><span class="st">&quot;Linear Model&quot;</span>),<span class="at">size=</span><span class="dv">1</span>,<span class="at">method =</span> <span class="st">&quot;lm&quot;</span> ,<span class="at">span =</span><span class="fl">0.3</span>, <span class="at">se=</span>F) <span class="sc">+</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="st">&quot;Model Type&quot;</span>)) <span class="sc">+</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>p1_nonlinearities</span></code></pre></div>
<p><img src="MEM5220_R_files/figure-html/unnamed-chunk-61-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Note that if we re-scale the model from a log scale back to the original
scale of the data, we now have</p>
<span class="math display">\[\begin{equation}
Y_{i} = exp(\beta_{0} + \beta_{1} \times x_{i})  \times exp(\epsilon_{i})
\end{equation}\]</span>
<p>which has errors entering in a multiplicative fashion.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>log.model.df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> wage1<span class="sc">$</span>educ,</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>                           <span class="at">y =</span> <span class="fu">exp</span>(<span class="fu">fitted</span>(lm_wage1))) <span class="co"># This is essentially exp(b0_wage1 + b1_wage1 * wage1$educ)</span></span></code></pre></div>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>p2_nonlinearities <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(wage1, <span class="fu">aes</span>(<span class="at">x =</span> educ, <span class="at">y =</span> wage))  <span class="sc">+</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()   <span class="sc">+</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> log.model.df, <span class="fu">aes</span>(x, y, <span class="at">color =</span> <span class="st">&quot;Log Model&quot;</span>), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="dv">2</span>)  <span class="sc">+</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="st">&quot;Model Type&quot;</span>)) <span class="sc">+</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(p1_nonlinearities, p2_nonlinearities,</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>),</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">1</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MEM5220_R_files/figure-html/fig15-1.png" alt="Wages by Education - Different transformations" width="80%" />
<p class="caption">
(#fig:fig15)Wages by Education - Different transformations
</p>
</div>
<p>A: Plotting the data on the transformed log scale and adding the fitted
line, the relationship again appears linear, and the variation about the
fitted line looks more constant.</p>
<p>B: By plotting the data on the original scale, and adding the fitted
regression, we see an exponential relationship. However, this is still a
<em>linear</em> model, since the new transformed response, <span class="math inline">\(log(Y_{i}\)</span>, is
still a <em>linear</em> combination of the predictors. In other words, only
<span class="math inline">\(\beta\)</span> needs to be linear, not the <span class="math inline">\(x\)</span> values.</p>
<p><strong>Quadratic Model</strong></p>
<span class="math display">\[\begin{equation}
Y_{i} = \beta_{0} + \beta_{1} \times x_{i}  \beta_{2} \times x^2_{i} + \epsilon_{i}
\end{equation}\]</span>
<p>New dataset from Wooldrige: Collected from the real estate pages of the
Boston Globe during 1990. These are homes that sold in the Boston, MA
area.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;hprice1&quot;</span>, <span class="at">package =</span> <span class="st">&quot;wooldridge&quot;</span>)</span></code></pre></div>
<p>In R, independent variables involving mathematical operators can be
included in regression equation with the function <code>I()</code></p>
<p>We estimate the following regression:</p>
<span class="math display">\[\begin{equation}
hprice ~ \beta_{0} +   \beta_{1} sqrft + u
\end{equation}\]</span>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>lm_hprice <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> sqrft, <span class="at">data  =</span> hprice1)</span></code></pre></div>
<p>and a regression model that includes a squared term</p>
<span class="math display">\[\begin{equation}
hprice ~ \beta_{0} +   \beta_{1} sqrft + \beta_{2} sqrft^2 + u
\end{equation}\]</span>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>lm_hprice1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> sqrft <span class="sc">+</span> <span class="fu">I</span>(sqrft<span class="sc">^</span><span class="dv">2</span>), <span class="at">data  =</span> hprice1)</span></code></pre></div>
<p>Alternatively use the <code>poly()</code> function. Be careful of the additional
argument <code>raw</code><a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>lm_hprice2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> <span class="fu">poly</span>(sqrft, <span class="at">degree =</span> <span class="dv">2</span>),  <span class="at">data  =</span> hprice1)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>lm_hprice3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> <span class="fu">poly</span>(sqrft, <span class="at">degree =</span> <span class="dv">2</span>, <span class="at">raw =</span> <span class="cn">TRUE</span>),  <span class="at">data  =</span> hprice1) <span class="co"># if true, use raw and not orthogonal polynomials.</span></span></code></pre></div>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unname</span>(<span class="fu">coef</span>(lm_hprice1))</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>]  <span class="fl">1.849453e+02</span> <span class="sc">-</span><span class="fl">1.710855e-02</span>  <span class="fl">3.262809e-05</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="fu">unname</span>(<span class="fu">coef</span>(lm_hprice2))</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">293.5460</span> <span class="fl">754.8517</span> <span class="fl">135.6051</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="fu">unname</span>(<span class="fu">coef</span>(lm_hprice3))</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>]  <span class="fl">1.849453e+02</span> <span class="sc">-</span><span class="fl">1.710855e-02</span>  <span class="fl">3.262809e-05</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">unname</span>(<span class="fu">coef</span>(lm_hprice1)), <span class="fu">unname</span>(<span class="fu">coef</span>(lm_hprice2)))</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;Mean relative difference: 5.401501&quot;</span></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">unname</span>(<span class="fu">coef</span>(lm_hprice1)), <span class="fu">unname</span>(<span class="fu">coef</span>(lm_hprice3)))</span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="cn">TRUE</span></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">fitted</span>(lm_hprice1), <span class="fu">fitted</span>(lm_hprice2))</span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="cn">TRUE</span></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">fitted</span>(lm_hprice1), <span class="fu">fitted</span>(lm_hprice3))</span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="cn">TRUE</span></span></code></pre></div>
<p>With the function <code>all.equal()</code> we can test if all elements in two
vectors are the “nearly” the same. “Nearly” refers to the case when
<em>tolerance</em> values are exceeded.</p>
<p>Why are those values not the same depending on the <code>poly()</code> function
argument <code>raw = True</code>? In the case of <code>raw = True</code> R uses raw and not
orthogonal polynomials.</p>
<p>This can have importan implications in the case when multiple
polynimoals are used in the regression. The linear regressar <span class="math inline">\(sqrft\)</span> is
uncorrelated linearly with the squared explanatory variable <span class="math inline">\(sqrft^2\)</span>.
However, if we add a cubic term <span class="math inline">\(sqrft^3\)</span>, multicollinearty between
<span class="math inline">\(sqrft^2\)</span> and <span class="math inline">\(sqrft^3\)</span> might become and issues of the polynomials are
<em>NOT</em> orthogonalized.</p>
<p>We can also extract the standard error of our estimated coefficents
manually.</p>
<p>Starting with the variance-covariance matrix of the regression model</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>vcov_lm_hprice2 <span class="ot">&lt;-</span> <span class="fu">vcov</span>(lm_hprice2)</span></code></pre></div>
<p>Extracting only the diagonal element of the matrix and taking the square
root we obtain the standard errors as reported in <code>summary()</code> function
call.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="fu">diag</span>(vcov_lm_hprice2))</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>             (Intercept) <span class="fu">poly</span>(sqrft, <span class="at">degree =</span> <span class="dv">2</span>)<span class="dv">1</span> <span class="fu">poly</span>(sqrft, <span class="at">degree =</span> <span class="dv">2</span>)<span class="dv">2</span> </span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>                <span class="fl">6.638736</span>                <span class="fl">62.276866</span>                <span class="fl">62.276866</span> </span></code></pre></div>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_hprice2)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> price <span class="sc">~</span> <span class="fu">poly</span>(sqrft, <span class="at">degree =</span> <span class="dv">2</span>), <span class="at">data =</span> hprice1)</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>Residuals<span class="sc">:</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>     Min       1Q   Median       3Q      Max </span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">158.261</span>  <span class="sc">-</span><span class="fl">35.158</span>   <span class="sc">-</span><span class="fl">7.924</span>   <span class="fl">24.262</span>  <span class="fl">223.516</span> </span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>                         Estimate Std. Error t value <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)    </span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>(Intercept)               <span class="fl">293.546</span>      <span class="fl">6.639</span>  <span class="fl">44.217</span>   <span class="sc">&lt;</span><span class="fl">2e-16</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a><span class="fu">poly</span>(sqrft, <span class="at">degree =</span> <span class="dv">2</span>)<span class="dv">1</span>  <span class="fl">754.852</span>     <span class="fl">62.277</span>  <span class="fl">12.121</span>   <span class="sc">&lt;</span><span class="fl">2e-16</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a><span class="fu">poly</span>(sqrft, <span class="at">degree =</span> <span class="dv">2</span>)<span class="dv">2</span>  <span class="fl">135.605</span>     <span class="fl">62.277</span>   <span class="fl">2.177</span>   <span class="fl">0.0322</span> <span class="sc">*</span>  </span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a>Residual standard error<span class="sc">:</span> <span class="fl">62.28</span> on <span class="dv">85</span> degrees of freedom</span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a>Multiple R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.6408</span>,    Adjusted R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.6324</span> </span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a>F<span class="sc">-</span>statistic<span class="sc">:</span> <span class="fl">75.83</span> on <span class="dv">2</span> and <span class="dv">85</span> DF,  p<span class="sc">-</span>value<span class="sc">:</span> <span class="er">&lt;</span> <span class="fl">2.2e-16</span></span></code></pre></div>
</div>
</div>
</div>
<div id="multiple-linear-regression" class="section level2" number="1.2">
<h2 number="1.2"><span class="header-section-number">1.2</span> Multiple Linear Regression</h2>
<hr />
<p><strong>Note</strong></p>
<p>A <strong>(general) linear model</strong> is similar to the simple variant, but with
a multivariate <span class="math inline">\(x \epsilon \!R^{\rho}\)</span> and a mean given by a hyperplane
in place of a single line.</p>
<ul>
<li>General principles are the same as the simple case</li>
<li>Math is more difficult because we need to use matrices</li>
<li>Interpretation is more difficult because the <span class="math inline">\(\beta_{j}\)</span> are effects
conditional on the other variables</li>
</ul>
<p>Many would retain the same signs as the simple linear regression, but
the magnitudes would be smaller. In some cases, it is possible for the
relationship to flip directions when a second (highly correlated)
variable is added <span class="citation"><a href="#ref-dalpiaz2016" role="doc-biblioref">Dalpiaz</a> (<a href="#ref-dalpiaz2016" role="doc-biblioref">2016</a>)</span>.</p>
<hr />
<span class="math display">\[\begin{equation}
y = \beta_{0} + \beta_{1}x_{1} +  \beta_{2}x_{2} + \dots + \beta_{k}x_{k} + u
(\#eq:multipleregression)
\end{equation}\]</span>
<p>The next example from Wooldrige relates the college GPA (“cloGPA”) to
the high school GPA (“hsGPA”) and achievement test score (“ACT”) for a
sample of 141 students.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;gpa1&quot;</span>, <span class="at">package =</span> <span class="st">&quot;wooldridge&quot;</span>)</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(gpa1)</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>?gpa1</span></code></pre></div>
<p>Obtain parameter estimates</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>GPAres <span class="ot">&lt;-</span> <span class="fu">lm</span>(colGPA <span class="sc">~</span> hsGPA <span class="sc">+</span> ACT, <span class="at">data =</span> gpa1)</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(GPAres)</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> colGPA <span class="sc">~</span> hsGPA <span class="sc">+</span> ACT, <span class="at">data =</span> gpa1)</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>Residuals<span class="sc">:</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>     Min       1Q   Median       3Q      Max </span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">0.85442</span> <span class="sc">-</span><span class="fl">0.24666</span> <span class="sc">-</span><span class="fl">0.02614</span>  <span class="fl">0.28127</span>  <span class="fl">0.85357</span> </span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>            Estimate Std. Error t value <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)    </span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>(Intercept) <span class="fl">1.286328</span>   <span class="fl">0.340822</span>   <span class="fl">3.774</span> <span class="fl">0.000238</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>hsGPA       <span class="fl">0.453456</span>   <span class="fl">0.095813</span>   <span class="fl">4.733</span> <span class="fl">5.42e-06</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>ACT         <span class="fl">0.009426</span>   <span class="fl">0.010777</span>   <span class="fl">0.875</span> <span class="fl">0.383297</span>    </span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a>Residual standard error<span class="sc">:</span> <span class="fl">0.3403</span> on <span class="dv">138</span> degrees of freedom</span>
<span id="cb82-20"><a href="#cb82-20" aria-hidden="true" tabindex="-1"></a>Multiple R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.1764</span>,    Adjusted R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.1645</span> </span>
<span id="cb82-21"><a href="#cb82-21" aria-hidden="true" tabindex="-1"></a>F<span class="sc">-</span>statistic<span class="sc">:</span> <span class="fl">14.78</span> on <span class="dv">2</span> and <span class="dv">138</span> DF,  p<span class="sc">-</span>value<span class="sc">:</span> <span class="fl">1.526e-06</span></span>
<span id="cb82-22"><a href="#cb82-22" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(GPAres)[[<span class="dv">1</span>]]</span>
<span id="cb82-23"><a href="#cb82-23" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">1.286328</span></span></code></pre></div>
<p>In the multiple linear regression setting, some of the interpretations
of the coefficients change slightly. Here, <span class="math inline">\(\hat\beta_{0} =\)</span>
1.2863278 is our estimate for <span class="math inline">\(\beta_{0}\)</span> when all of the
predictors are 0. In this example this makes sense but think of the
following example:</p>
<hr />
<p><strong>Your turn</strong></p>
<p>Assume the following model:</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>mpg_model <span class="ot">=</span> <span class="fu">lm</span>(hp <span class="sc">~</span> wt <span class="sc">+</span> cyl, <span class="at">data =</span> mtcars)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(mpg_model)</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>(Intercept)          wt         cyl </span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a> <span class="sc">-</span><span class="fl">51.805567</span>    <span class="fl">1.330463</span>   <span class="fl">31.387901</span> </span></code></pre></div>
<p>How do you interpret the intercept coefficient estimate?</p>
<p>A: Here, <span class="math inline">\(\hat\beta_{0} =\)</span> -51.8055669 is our estimate for
<span class="math inline">\(\beta_{0}\)</span>, the mean gross horsepower for a car that weights 0 pounds
and has 0 cylinders. We see our estimate here is negative, which is a
physical impossibility. However, this isn’t unexpected, as we shouldn’t
expect our model to be accurate for cars which weight 0 pounds and have
no cylinders to propel the engine.</p>
<hr />
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span> (gpa1, {</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># find min-max seq for grid construction</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  min_hsGPA <span class="ot">&lt;-</span> <span class="fu">min</span>(gpa1<span class="sc">$</span>hsGPA)</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>  max_hsGPA <span class="ot">&lt;-</span> <span class="fu">max</span>(gpa1<span class="sc">$</span>hsGPA)</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>  min_ACT <span class="ot">&lt;-</span> <span class="fu">min</span>(gpa1<span class="sc">$</span>ACT)</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>  max_ACT <span class="ot">&lt;-</span> <span class="fu">max</span>(gpa1<span class="sc">$</span>ACT)</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># linear regression</span></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(colGPA <span class="sc">~</span> hsGPA <span class="sc">+</span> ACT)</span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># predict values on regular xy grid</span></span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>  hsGPA.pred <span class="ot">&lt;-</span> <span class="fu">seq</span>(min_hsGPA, max_hsGPA, <span class="at">length.out =</span> <span class="dv">30</span>)</span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>  ACT.pred <span class="ot">&lt;-</span> <span class="fu">seq</span>(min_ACT, max_ACT, <span class="at">length.out =</span> <span class="dv">30</span>)</span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a>  xy <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">hsGPA =</span> hsGPA.pred,</span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ACT =</span> ACT.pred)</span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a>  colGPA.pred <span class="ot">&lt;-</span> <span class="fu">matrix</span> (<span class="at">nrow =</span> <span class="dv">30</span>, <span class="at">ncol =</span> <span class="dv">30</span>,</span>
<span id="cb84-19"><a href="#cb84-19" aria-hidden="true" tabindex="-1"></a>                         <span class="at">data =</span> <span class="fu">predict</span>(fit, <span class="at">newdata =</span> <span class="fu">data.frame</span>(xy),</span>
<span id="cb84-20"><a href="#cb84-20" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">interval =</span> <span class="st">&quot;prediction&quot;</span>))</span>
<span id="cb84-21"><a href="#cb84-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-22"><a href="#cb84-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># fitted points for droplines to surface</span></span>
<span id="cb84-23"><a href="#cb84-23" aria-hidden="true" tabindex="-1"></a>  fitpoints <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit)</span>
<span id="cb84-24"><a href="#cb84-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-25"><a href="#cb84-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scatter3D</span>(<span class="at">z =</span> colGPA, <span class="at">x =</span> hsGPA, <span class="at">y =</span> ACT, <span class="at">pch =</span> <span class="dv">18</span>, <span class="at">cex =</span> <span class="dv">2</span>,</span>
<span id="cb84-26"><a href="#cb84-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">theta =</span> <span class="dv">20</span>, <span class="at">phi =</span> <span class="dv">20</span>, <span class="at">ticktype =</span> <span class="st">&quot;detailed&quot;</span>,</span>
<span id="cb84-27"><a href="#cb84-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">xlab =</span> <span class="st">&quot;hsGPA&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;ACT&quot;</span>, <span class="at">zlab =</span> <span class="st">&quot;colGPA&quot;</span>,</span>
<span id="cb84-28"><a href="#cb84-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">surf =</span> <span class="fu">list</span>(<span class="at">x =</span> hsGPA.pred, <span class="at">y =</span> ACT.pred, <span class="at">z =</span> colGPA.pred,</span>
<span id="cb84-29"><a href="#cb84-29" aria-hidden="true" tabindex="-1"></a>                        <span class="at">facets =</span> <span class="cn">NA</span>, <span class="at">fit =</span> fitpoints),</span>
<span id="cb84-30"><a href="#cb84-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">main =</span> <span class="st">&quot;colGPA&quot;</span>)</span>
<span id="cb84-31"><a href="#cb84-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-32"><a href="#cb84-32" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MEM5220_R_files/figure-html/fig16-1.png" alt="College GPA  High School GPA + Achievment test score" width="80%" />
<p class="caption">
(#fig:fig16)College GPA High School GPA + Achievment test score
</p>
</div>
<p>The data points (<span class="math inline">\(x_{i1}\)</span>,<span class="math inline">\(x_{i2}\)</span>,<span class="math inline">\(y_{i}\)</span>) now exist in 3-dimensional
space, so instead of fitting a line to the data, we will fit a plane.</p>
<div id="ceteris-paribus-interpretation-and-omitted-variable-bias" class="section level3" number="1.2.1">
<h3 number="1.2.1"><span class="header-section-number">1.2.1</span> Ceteris Paribus Interpretation and Omitted Variable bias</h3>
<p>Consider a regression with two explanatory variables</p>
<span class="math display">\[\begin{equation}
\hat{y} = \hat{\beta}_{0} + \hat{\beta}_{1}x_{1} +  \hat{\beta}_{2}x_{2}
(\#eq:lmtwoexplanatory)
\end{equation}\]</span>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameter estimates for full and simple model:</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>beta.hat <span class="ot">&lt;-</span> <span class="fu">coef</span>( <span class="fu">lm</span>(colGPA <span class="sc">~</span> ACT<span class="sc">+</span>hsGPA, <span class="at">data=</span>gpa1))</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>beta.hat</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>(Intercept)         ACT       hsGPA </span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a><span class="fl">1.286327767</span> <span class="fl">0.009426012</span> <span class="fl">0.453455885</span> </span></code></pre></div>
<p>Now, lets omit one variable in the regression</p>
<span class="math display">\[\begin{equation}
\hat{y} = \hat{\beta}_{0} + \hat{\beta}_{1}x_{1}
(\#eq:lmomitted)
\end{equation}\]</span>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Relation between regressors:</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>delta.tilde <span class="ot">&lt;-</span> <span class="fu">coef</span>( <span class="fu">lm</span>(hsGPA <span class="sc">~</span> ACT, <span class="at">data=</span>gpa1) )</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>delta.tilde</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>(Intercept)         ACT </span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a> <span class="fl">2.46253658</span>  <span class="fl">0.03889675</span> </span></code></pre></div>
<p>The parameter <span class="math inline">\(\hat\beta_1\)</span> is the estimated effect of increasing <span class="math inline">\(x_1\)</span>
by one unit (and <strong>NOT</strong> keeping <span class="math inline">\(x_2\)</span> fixed). It can be related to
<span class="math inline">\(\hat\beta_1\)</span> using the formula</p>
<span class="math display">\[\begin{equation}
\hat{y} = \hat{\beta}_{0} + \hat{\beta}_{1} x_{1} +  \hat{\beta}_{2}  \tilde\delta_{1}
(\#eq:lmommited)
\end{equation}\]</span>
<p>where <span class="math inline">\(\tilde\delta_{1}\)</span> is the slope parameters of the linear
regression of <span class="math inline">\(x_2\)</span> on <span class="math inline">\(x_1\)</span></p>
<span class="math display">\[\begin{equation}
\hat{x}_2 = \tilde\delta_{0} + \tilde\delta_{1} x_{1}
(\#eq:lmomitted2)
\end{equation}\]</span>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Omitted variables formula for beta1.tilde:</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>beta.hat[<span class="st">&quot;ACT&quot;</span>] <span class="sc">+</span> beta.hat[<span class="st">&quot;hsGPA&quot;</span>]<span class="sc">*</span>delta.tilde[<span class="st">&quot;ACT&quot;</span>]</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>       ACT </span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a><span class="fl">0.02706397</span> </span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Actual regression with hsGPA omitted:</span></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(colGPA <span class="sc">~</span> ACT, <span class="at">data=</span>gpa1))</span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> colGPA <span class="sc">~</span> ACT, <span class="at">data =</span> gpa1)</span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a>Residuals<span class="sc">:</span></span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a>     Min       1Q   Median       3Q      Max </span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">0.85251</span> <span class="sc">-</span><span class="fl">0.25251</span> <span class="sc">-</span><span class="fl">0.04426</span>  <span class="fl">0.26400</span>  <span class="fl">0.89336</span> </span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb87-18"><a href="#cb87-18" aria-hidden="true" tabindex="-1"></a>            Estimate Std. Error t value <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)    </span>
<span id="cb87-19"><a href="#cb87-19" aria-hidden="true" tabindex="-1"></a>(Intercept)  <span class="fl">2.40298</span>    <span class="fl">0.26420</span>   <span class="fl">9.095</span>  <span class="fl">8.8e-16</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb87-20"><a href="#cb87-20" aria-hidden="true" tabindex="-1"></a>ACT          <span class="fl">0.02706</span>    <span class="fl">0.01086</span>   <span class="fl">2.491</span>   <span class="fl">0.0139</span> <span class="sc">*</span>  </span>
<span id="cb87-21"><a href="#cb87-21" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb87-22"><a href="#cb87-22" aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span>
<span id="cb87-23"><a href="#cb87-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-24"><a href="#cb87-24" aria-hidden="true" tabindex="-1"></a>Residual standard error<span class="sc">:</span> <span class="fl">0.3656</span> on <span class="dv">139</span> degrees of freedom</span>
<span id="cb87-25"><a href="#cb87-25" aria-hidden="true" tabindex="-1"></a>Multiple R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.04275</span>,   Adjusted R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.03586</span> </span>
<span id="cb87-26"><a href="#cb87-26" aria-hidden="true" tabindex="-1"></a>F<span class="sc">-</span>statistic<span class="sc">:</span> <span class="fl">6.207</span> on <span class="dv">1</span> and <span class="dv">139</span> DF,  p<span class="sc">-</span>value<span class="sc">:</span> <span class="fl">0.0139</span></span></code></pre></div>
<p>In this example, the indirect effect is actually stronger than the
direct effect. <em>ACT</em> predicts <em>colGPA</em> mainly because it is related to
<em>hsGPA</em> which in turn is strongly related to <em>colGPA</em>.</p>
</div>
<div id="standard-errors-multicollinearity-and-vif" class="section level3" number="1.2.2">
<h3 number="1.2.2"><span class="header-section-number">1.2.2</span> Standard errors, Multicollinearity and VIF</h3>
<p>Multicollinearity means that two or more regressors in a multiple
regression model are strongly correlated. If the correlation between two
or more regressors is perfect, that is, one regressor can be written as
a linear combination of the other(s), we have perfect multicollinearity.
While strong multicollinearity in general is unpleasant as it causes the
variance of the OLS estimator to be large (we will discuss this in more
detail later), the presence of perfect multicollinearity makes it
impossible to solve for the OLS estimator, i.e., the model cannot be
estimated in the first place.</p>
<div id="perfect-multicollinearity" class="section level4" number="1.2.2.1">
<h4 number="1.2.2.1"><span class="header-section-number">1.2.2.1</span> Perfect multicollinearity</h4>
<p>We will work first with the <em>CAschools</em> data from the <strong>AER</strong> package to
simulate an example of perfect multicollinearity</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;CASchools&quot;</span>, <span class="at">package =</span> <span class="st">&quot;AER&quot;</span>)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>?CASchools</span></code></pre></div>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define the fraction of English learners</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>CASchools<span class="sc">$</span>FracEL <span class="ot">&lt;-</span> CASchools<span class="sc">$</span>english <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a><span class="co"># check the correlation between CASchools$FracEL and CASchools$english</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(CASchools<span class="sc">$</span>FracEL, CASchools<span class="sc">$</span>english)</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">1</span></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate the model</span></span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>mult.mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(read <span class="sc">~</span> students <span class="sc">+</span> english <span class="sc">+</span> FracEL, <span class="at">data =</span> CASchools)</span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a><span class="co"># obtain a summary of the model</span></span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mult.mod)</span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> read <span class="sc">~</span> students <span class="sc">+</span> english <span class="sc">+</span> FracEL, <span class="at">data =</span> CASchools)</span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-17"><a href="#cb89-17" aria-hidden="true" tabindex="-1"></a>Residuals<span class="sc">:</span></span>
<span id="cb89-18"><a href="#cb89-18" aria-hidden="true" tabindex="-1"></a>    Min      1Q  Median      3Q     Max </span>
<span id="cb89-19"><a href="#cb89-19" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">51.077</span>  <span class="sc">-</span><span class="fl">9.767</span>  <span class="sc">-</span><span class="fl">0.695</span>   <span class="fl">9.097</span>  <span class="fl">40.005</span> </span>
<span id="cb89-20"><a href="#cb89-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-21"><a href="#cb89-21" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span> (<span class="dv">1</span> not defined because of singularities)</span>
<span id="cb89-22"><a href="#cb89-22" aria-hidden="true" tabindex="-1"></a>              Estimate Std. Error t value <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)    </span>
<span id="cb89-23"><a href="#cb89-23" aria-hidden="true" tabindex="-1"></a>(Intercept)  <span class="fl">6.665e+02</span>  <span class="fl">9.771e-01</span> <span class="fl">682.054</span>   <span class="sc">&lt;</span><span class="fl">2e-16</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb89-24"><a href="#cb89-24" aria-hidden="true" tabindex="-1"></a>students     <span class="fl">3.326e-04</span>  <span class="fl">1.941e-04</span>   <span class="fl">1.714</span>   <span class="fl">0.0873</span> .  </span>
<span id="cb89-25"><a href="#cb89-25" aria-hidden="true" tabindex="-1"></a>english     <span class="sc">-</span><span class="fl">7.843e-01</span>  <span class="fl">4.153e-02</span> <span class="sc">-</span><span class="fl">18.886</span>   <span class="sc">&lt;</span><span class="fl">2e-16</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb89-26"><a href="#cb89-26" aria-hidden="true" tabindex="-1"></a>FracEL              <span class="cn">NA</span>         <span class="cn">NA</span>      <span class="cn">NA</span>       <span class="cn">NA</span>    </span>
<span id="cb89-27"><a href="#cb89-27" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb89-28"><a href="#cb89-28" aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span>
<span id="cb89-29"><a href="#cb89-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-30"><a href="#cb89-30" aria-hidden="true" tabindex="-1"></a>Residual standard error<span class="sc">:</span> <span class="fl">14.53</span> on <span class="dv">417</span> degrees of freedom</span>
<span id="cb89-31"><a href="#cb89-31" aria-hidden="true" tabindex="-1"></a>Multiple R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.4802</span>,    Adjusted R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.4777</span> </span>
<span id="cb89-32"><a href="#cb89-32" aria-hidden="true" tabindex="-1"></a>F<span class="sc">-</span>statistic<span class="sc">:</span> <span class="fl">192.6</span> on <span class="dv">2</span> and <span class="dv">417</span> DF,  p<span class="sc">-</span>value<span class="sc">:</span> <span class="er">&lt;</span> <span class="fl">2.2e-16</span></span></code></pre></div>
<p>The row <em>FracEL</em> in the coefficients section of the output consists of
NA entries since FracEL was excluded from the model.</p>
<p>Another example of perfect multicollinearity is known as the dummy
variable trap. This may occur when multiple dummy variables are used as
regressors. A common case for this is when dummies are used to sort the
data into mutually exclusive categories. For example, suppose we have
spatial information that indicates whether a school is located in the
North, West, South or East of California.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set seed for reproducibility</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="co"># generate artificial data on location</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>CASchools<span class="sc">$</span>direction <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;West&quot;</span>, <span class="st">&quot;North&quot;</span>, <span class="st">&quot;South&quot;</span>, <span class="st">&quot;East&quot;</span>),</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>                              <span class="dv">420</span>,</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>                              <span class="at">replace =</span> T)</span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate the model</span></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>mult.mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(read <span class="sc">~</span> students <span class="sc">+</span> english <span class="sc">+</span> direction, <span class="at">data =</span> CASchools)</span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a><span class="co"># obtain a model summary</span></span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mult.mod)</span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> read <span class="sc">~</span> students <span class="sc">+</span> english <span class="sc">+</span> direction, <span class="at">data =</span> CASchools)</span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true" tabindex="-1"></a>Residuals<span class="sc">:</span></span>
<span id="cb90-19"><a href="#cb90-19" aria-hidden="true" tabindex="-1"></a>    Min      1Q  Median      3Q     Max </span>
<span id="cb90-20"><a href="#cb90-20" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">51.373</span>  <span class="sc">-</span><span class="fl">9.722</span>  <span class="sc">-</span><span class="fl">0.858</span>   <span class="fl">9.071</span>  <span class="fl">39.590</span> </span>
<span id="cb90-21"><a href="#cb90-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-22"><a href="#cb90-22" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb90-23"><a href="#cb90-23" aria-hidden="true" tabindex="-1"></a>                 Estimate Std. Error t value <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)    </span>
<span id="cb90-24"><a href="#cb90-24" aria-hidden="true" tabindex="-1"></a>(Intercept)     <span class="fl">6.657e+02</span>  <span class="fl">1.546e+00</span> <span class="fl">430.691</span>   <span class="sc">&lt;</span><span class="fl">2e-16</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb90-25"><a href="#cb90-25" aria-hidden="true" tabindex="-1"></a>students        <span class="fl">3.347e-04</span>  <span class="fl">1.954e-04</span>   <span class="fl">1.713</span>   <span class="fl">0.0875</span> .  </span>
<span id="cb90-26"><a href="#cb90-26" aria-hidden="true" tabindex="-1"></a>english        <span class="sc">-</span><span class="fl">7.909e-01</span>  <span class="fl">4.246e-02</span> <span class="sc">-</span><span class="fl">18.629</span>   <span class="sc">&lt;</span><span class="fl">2e-16</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb90-27"><a href="#cb90-27" aria-hidden="true" tabindex="-1"></a>directionNorth  <span class="fl">1.736e+00</span>  <span class="fl">2.070e+00</span>   <span class="fl">0.838</span>   <span class="fl">0.4024</span>    </span>
<span id="cb90-28"><a href="#cb90-28" aria-hidden="true" tabindex="-1"></a>directionSouth  <span class="fl">4.131e-01</span>  <span class="fl">2.076e+00</span>   <span class="fl">0.199</span>   <span class="fl">0.8424</span>    </span>
<span id="cb90-29"><a href="#cb90-29" aria-hidden="true" tabindex="-1"></a>directionWest   <span class="fl">1.118e+00</span>  <span class="fl">1.992e+00</span>   <span class="fl">0.561</span>   <span class="fl">0.5748</span>    </span>
<span id="cb90-30"><a href="#cb90-30" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb90-31"><a href="#cb90-31" aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span>
<span id="cb90-32"><a href="#cb90-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-33"><a href="#cb90-33" aria-hidden="true" tabindex="-1"></a>Residual standard error<span class="sc">:</span> <span class="fl">14.57</span> on <span class="dv">414</span> degrees of freedom</span>
<span id="cb90-34"><a href="#cb90-34" aria-hidden="true" tabindex="-1"></a>Multiple R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.4812</span>,    Adjusted R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.4749</span> </span>
<span id="cb90-35"><a href="#cb90-35" aria-hidden="true" tabindex="-1"></a>F<span class="sc">-</span>statistic<span class="sc">:</span>  <span class="fl">76.8</span> on <span class="dv">5</span> and <span class="dv">414</span> DF,  p<span class="sc">-</span>value<span class="sc">:</span> <span class="er">&lt;</span> <span class="fl">2.2e-16</span></span></code></pre></div>
<p>Notice that R solves the problem on its own by generating and including
the dummies directionNorth, directionSouth and directionWest but
omitting directionEast. Of course, the omission of every other dummy
instead would achieve the same. Another solution would be to exclude the
constant and to include all dummies instead.</p>
<p>A last example considers the case where a perfect linear relationship
arises from redundant regressors. Suppose we have a regressor Spanish
speakers, <em>spanish</em>, , the percentage of English speakers in the school
where</p>
<span class="math display">\[\begin{equation}
spanish = 100 - english
\end{equation}\]</span>
<p>and both <em>spanish</em> and <em>english</em> are included in a regression model.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Percentage of english speakers</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>CASchools<span class="sc">$</span>spanish <span class="ot">&lt;-</span> <span class="dv">100</span> <span class="sc">-</span> CASchools<span class="sc">$</span>english</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate the model</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>mult.mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(read <span class="sc">~</span> students <span class="sc">+</span> english <span class="sc">+</span> spanish, <span class="at">data =</span> CASchools)</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a><span class="co"># obtain a model summary</span></span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mult.mod)</span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> read <span class="sc">~</span> students <span class="sc">+</span> english <span class="sc">+</span> spanish, <span class="at">data =</span> CASchools)</span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a>Residuals<span class="sc">:</span></span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a>    Min      1Q  Median      3Q     Max </span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">51.077</span>  <span class="sc">-</span><span class="fl">9.767</span>  <span class="sc">-</span><span class="fl">0.695</span>   <span class="fl">9.097</span>  <span class="fl">40.005</span> </span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span> (<span class="dv">1</span> not defined because of singularities)</span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a>              Estimate Std. Error t value <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)    </span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a>(Intercept)  <span class="fl">6.665e+02</span>  <span class="fl">9.771e-01</span> <span class="fl">682.054</span>   <span class="sc">&lt;</span><span class="fl">2e-16</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a>students     <span class="fl">3.326e-04</span>  <span class="fl">1.941e-04</span>   <span class="fl">1.714</span>   <span class="fl">0.0873</span> .  </span>
<span id="cb91-21"><a href="#cb91-21" aria-hidden="true" tabindex="-1"></a>english     <span class="sc">-</span><span class="fl">7.843e-01</span>  <span class="fl">4.153e-02</span> <span class="sc">-</span><span class="fl">18.886</span>   <span class="sc">&lt;</span><span class="fl">2e-16</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb91-22"><a href="#cb91-22" aria-hidden="true" tabindex="-1"></a>spanish             <span class="cn">NA</span>         <span class="cn">NA</span>      <span class="cn">NA</span>       <span class="cn">NA</span>    </span>
<span id="cb91-23"><a href="#cb91-23" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb91-24"><a href="#cb91-24" aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span>
<span id="cb91-25"><a href="#cb91-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-26"><a href="#cb91-26" aria-hidden="true" tabindex="-1"></a>Residual standard error<span class="sc">:</span> <span class="fl">14.53</span> on <span class="dv">417</span> degrees of freedom</span>
<span id="cb91-27"><a href="#cb91-27" aria-hidden="true" tabindex="-1"></a>Multiple R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.4802</span>,    Adjusted R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.4777</span> </span>
<span id="cb91-28"><a href="#cb91-28" aria-hidden="true" tabindex="-1"></a>F<span class="sc">-</span>statistic<span class="sc">:</span> <span class="fl">192.6</span> on <span class="dv">2</span> and <span class="dv">417</span> DF,  p<span class="sc">-</span>value<span class="sc">:</span> <span class="er">&lt;</span> <span class="fl">2.2e-16</span></span></code></pre></div>
<p>Once more, <code>lm()</code> refuses to estimate the full model using OLS and
excludes spanish.</p>
</div>
<div id="imperfect-multicollinearity" class="section level4" number="1.2.2.2">
<h4 number="1.2.2.2"><span class="header-section-number">1.2.2.2</span> Imperfect multicollinearity</h4>
<p>As opposed to perfect multicollinearity, imperfect multicollinearity is
— to a certain extent — less of a problem. In fact, imperfect
multicollinearity is the reason why we are interested in estimating
multiple regression models in the first place: the OLS estimator allows
us to isolate influences of correlated regressors on the dependent
variable. If it was not for these dependencies, there would not be a
reason to resort to a multiple regression approach and we could simply
work with a single-regressor model. However, this is rarely the case in
applications. We already know that ignoring dependencies among
regressors which influence the outcome variable has an adverse effect on
estimation results.</p>
<p>Simulation study: imperfect multicollinearity</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set number of observations</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize vectors of coefficients</span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>coefs1 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="st">&quot;hat_beta_1&quot;</span> <span class="ot">=</span> <span class="fu">numeric</span>(<span class="dv">10000</span>), <span class="st">&quot;hat_beta_2&quot;</span> <span class="ot">=</span> <span class="fu">numeric</span>(<span class="dv">10000</span>))</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>coefs2 <span class="ot">&lt;-</span> coefs1</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a><span class="co"># set seed</span></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a><span class="co"># loop sampling and estimation</span></span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>) {</span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># for cov(X_1,X_2) = 0.25</span></span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">&lt;-</span> <span class="fu">rmvnorm</span>(n, <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">100</span>), <span class="at">sigma =</span> <span class="fu">cbind</span>(<span class="fu">c</span>(<span class="dv">10</span>, <span class="fl">2.5</span>), <span class="fu">c</span>(<span class="fl">2.5</span>, <span class="dv">10</span>))) <span class="co"># function from the mvtnorm package</span></span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a>  u <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="at">sd =</span> <span class="dv">5</span>)</span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a>  Y <span class="ot">&lt;-</span> <span class="dv">5</span> <span class="sc">+</span> <span class="fl">2.5</span> <span class="sc">*</span> X[, <span class="dv">1</span>] <span class="sc">+</span> <span class="dv">3</span> <span class="sc">*</span> X[, <span class="dv">2</span>] <span class="sc">+</span> u</span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true" tabindex="-1"></a>  coefs1[i, ] <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> X[, <span class="dv">1</span>] <span class="sc">+</span> X[, <span class="dv">2</span>])<span class="sc">$</span>coefficients[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb92-19"><a href="#cb92-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-20"><a href="#cb92-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># for cov(X_1,X_2) = 0.85</span></span>
<span id="cb92-21"><a href="#cb92-21" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">&lt;-</span> <span class="fu">rmvnorm</span>(n, <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">100</span>), <span class="at">sigma =</span> <span class="fu">cbind</span>(<span class="fu">c</span>(<span class="dv">10</span>, <span class="fl">8.5</span>), <span class="fu">c</span>(<span class="fl">8.5</span>, <span class="dv">10</span>)))</span>
<span id="cb92-22"><a href="#cb92-22" aria-hidden="true" tabindex="-1"></a>  Y <span class="ot">&lt;-</span> <span class="dv">5</span> <span class="sc">+</span> <span class="fl">2.5</span> <span class="sc">*</span> X[, <span class="dv">1</span>] <span class="sc">+</span> <span class="dv">3</span> <span class="sc">*</span> X[, <span class="dv">2</span>] <span class="sc">+</span> u</span>
<span id="cb92-23"><a href="#cb92-23" aria-hidden="true" tabindex="-1"></a>  imperf_multicol <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> X[, <span class="dv">1</span>] <span class="sc">+</span> X[, <span class="dv">2</span>])</span>
<span id="cb92-24"><a href="#cb92-24" aria-hidden="true" tabindex="-1"></a>  coefs2[i, ] <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> X[, <span class="dv">1</span>] <span class="sc">+</span> X[, <span class="dv">2</span>])<span class="sc">$</span>coefficients[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb92-25"><a href="#cb92-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-26"><a href="#cb92-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb92-27"><a href="#cb92-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-28"><a href="#cb92-28" aria-hidden="true" tabindex="-1"></a><span class="co"># obtain variance estimates</span></span>
<span id="cb92-29"><a href="#cb92-29" aria-hidden="true" tabindex="-1"></a><span class="fu">diag</span>(<span class="fu">var</span>(coefs1))</span>
<span id="cb92-30"><a href="#cb92-30" aria-hidden="true" tabindex="-1"></a>hat_beta_1 hat_beta_2 </span>
<span id="cb92-31"><a href="#cb92-31" aria-hidden="true" tabindex="-1"></a> <span class="fl">0.5698281</span>  <span class="fl">0.8163287</span> </span></code></pre></div>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">diag</span>(<span class="fu">var</span>(coefs2))</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>hat_beta_1 hat_beta_2 </span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a> <span class="fl">0.5834243</span>  <span class="fl">0.8402187</span> </span></code></pre></div>
<p>We are interested in the variances which are the diagonal elements. We
see that due to the high collinearity, the variances of <span class="math inline">\(\hat{\beta}_1\)</span>
and <span class="math inline">\(\hat{\beta}_2\)</span> and have increased, meaning it is more difficult to
precisely estimate the true coefficients.</p>
<p>The variance inflation factor, <em>VIF</em>, accounts for (imperfect)
multicollinearity.If <span class="math inline">\(x_t\)</span> is highly related to the other regressors,
<span class="math inline">\(R^2_j\)</span> and therefore also <span class="math inline">\(VIF_j\)</span> and the variance of <span class="math inline">\(\hat\beta_j\)</span> are
large.</p>
<span class="math display">\[\begin{equation}
\frac{1}{1-R^2_j}
(\#eq:VIF)
\end{equation}\]</span>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>GPAres <span class="ot">&lt;-</span> <span class="fu">lm</span>(colGPA <span class="sc">~</span> hsGPA <span class="sc">+</span> ACT, <span class="at">data =</span> gpa1)</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>SER<span class="ot">&lt;-</span><span class="fu">summary</span>(GPAres)<span class="sc">$</span>sigma</span></code></pre></div>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># regressing hsGPA on ACT for calculation of R2 &amp; VIF</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>( R2.hsGPA  <span class="ot">&lt;-</span> <span class="fu">summary</span>( <span class="fu">lm</span>(hsGPA<span class="sc">~</span>ACT, <span class="at">data=</span>gpa1) )<span class="sc">$</span>r.squared )</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.1195815</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>( VIF.hsGPA <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>R2.hsGPA) )</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">1.135823</span></span></code></pre></div>
<p>The <strong>car</strong> package implements the command <code>vif()</code> for each regressor</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(GPAres)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>   hsGPA      ACT </span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="fl">1.135823</span> <span class="fl">1.135823</span> </span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(imperf_multicol) <span class="co"># from the simulated data</span></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>  X[, <span class="dv">1</span>]   X[, <span class="dv">2</span>] </span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a><span class="fl">4.932864</span> <span class="fl">4.932864</span> </span></code></pre></div>
</div>
</div>
<div id="reporting-regression-results" class="section level3" number="1.2.3">
<h3 number="1.2.3"><span class="header-section-number">1.2.3</span> Reporting Regression Results</h3>
<p>As we start moving towards the comparing different regression models
this section provides a discussion on how to report regression reports
in <code>R</code>. Depending on your script (R scripts, R Markdown, bookdown) and
what your desired output format is (LaTeX, word, html) the exact
approach might differ. There are multiple packages to format regression
or table output, most notably <strong>stargazer</strong><a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a>, <strong>huxtable</strong>,
<strong>Hmisc</strong> and <strong>xtable</strong>. One can also tidy the the regression output as
well as tables with <strong>broom</strong> or <strong>summarytool</strong>. The wrapper
<code>knitr::kable()</code> is a support function that renders the table in an R
Markdown in a pretty way.</p>
<div id="table" class="section level4" number="1.2.3.1">
<h4 number="1.2.3.1"><span class="header-section-number">1.2.3.1</span> Table</h4>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(gpa1[,<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>], <span class="dv">10</span>), <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">&quot;A table of the first eight columns and ten rows of the gpa1 data.&quot;</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<table>
<caption>
(#tab:unnamed-chunk-87)A table of the first eight columns and ten rows of the gpa1 data.
</caption>
<thead>
<tr>
<th style="text-align:right;">
age
</th>
<th style="text-align:right;">
soph
</th>
<th style="text-align:right;">
junior
</th>
<th style="text-align:right;">
senior
</th>
<th style="text-align:right;">
senior5
</th>
<th style="text-align:right;">
male
</th>
<th style="text-align:right;">
campus
</th>
<th style="text-align:right;">
business
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
22
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
22
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
22
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">descr</span>(gpa1[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="at">stats =</span> <span class="fu">c</span>(<span class="st">&quot;mean&quot;</span>, <span class="st">&quot;sd&quot;</span>, <span class="st">&quot;min&quot;</span>, <span class="st">&quot;med&quot;</span>, <span class="st">&quot;max&quot;</span>), <span class="at">transpose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">headings =</span> <span class="cn">TRUE</span>, <span class="at">style =</span> <span class="st">&quot;rmarkdown&quot;</span>)</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
Mean
</th>
<th style="text-align:right;">
Std.Dev
</th>
<th style="text-align:right;">
Min
</th>
<th style="text-align:right;">
Median
</th>
<th style="text-align:right;">
Max
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
age
</td>
<td style="text-align:right;">
20.8865248
</td>
<td style="text-align:right;">
1.2710637
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
30
</td>
</tr>
<tr>
<td style="text-align:left;">
junior
</td>
<td style="text-align:right;">
0.3829787
</td>
<td style="text-align:right;">
0.4878462
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
soph
</td>
<td style="text-align:right;">
0.0212766
</td>
<td style="text-align:right;">
0.1448194
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(colGPA <span class="sc">~</span> hsGPA , <span class="at">data =</span> gpa1)</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>model2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(colGPA <span class="sc">~</span> hsGPA <span class="sc">+</span> ACT, <span class="at">data =</span> gpa1)</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>model3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(colGPA <span class="sc">~</span> hsGPA <span class="sc">+</span> ACT <span class="sc">+</span> age, <span class="at">data =</span> gpa1)</span></code></pre></div>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">stargazer</span>(</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(model1,</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>       model2,</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>       model3)</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>  ,<span class="at">keep.stat =</span> <span class="fu">c</span>(<span class="st">&quot;n&quot;</span>, <span class="st">&quot;rsq&quot;</span>), <span class="at">type =</span> <span class="st">&quot;latex&quot;</span>, <span class="at">header =</span> <span class="cn">FALSE</span>))<span class="co"># to have number of observations and R^2 reported</span></span></code></pre></div>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stargazer</span>(</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(model1,</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>       model2,</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>       model3)</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>  ,<span class="at">keep.stat =</span> <span class="fu">c</span>(<span class="st">&quot;n&quot;</span>, <span class="st">&quot;rsq&quot;</span>), <span class="at">type =</span> <span class="st">&quot;html&quot;</span>, <span class="at">header =</span> <span class="cn">FALSE</span>) <span class="co"># to have number of observations and R^2 reported</span></span></code></pre></div>
<table style="text-align:center">
<tr>
<td colspan="4" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td colspan="3">
<em>Dependent variable:</em>
</td>
</tr>
<tr>
<td>
</td>
<td colspan="3" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td colspan="3">
colGPA
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(1)
</td>
<td>
(2)
</td>
<td>
(3)
</td>
</tr>
<tr>
<td colspan="4" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
hsGPA
</td>
<td>
0.482<sup>***</sup>
</td>
<td>
0.453<sup>***</sup>
</td>
<td>
0.482<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(0.090)
</td>
<td>
(0.096)
</td>
<td>
(0.099)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
ACT
</td>
<td>
</td>
<td>
0.009
</td>
<td>
0.009
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
(0.011)
</td>
<td>
(0.011)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
age
</td>
<td>
</td>
<td>
</td>
<td>
0.027
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
<td>
(0.023)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
Constant
</td>
<td>
1.415<sup>***</sup>
</td>
<td>
1.286<sup>***</sup>
</td>
<td>
0.618
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(0.307)
</td>
<td>
(0.341)
</td>
<td>
(0.663)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
<td>
</td>
<td>
</td>
</tr>
<tr>
<td colspan="4" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
Observations
</td>
<td>
141
</td>
<td>
141
</td>
<td>
141
</td>
</tr>
<tr>
<td style="text-align:left">
R<sup>2</sup>
</td>
<td>
0.172
</td>
<td>
0.176
</td>
<td>
0.185
</td>
</tr>
<tr>
<td colspan="4" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
<em>Note:</em>
</td>
<td colspan="3" style="text-align:right">
<sup><em></sup>p&lt;0.1; <sup><strong></sup>p&lt;0.05; <sup></strong></em></sup>p&lt;0.01
</td>
</tr>
</table>
<p>Including the <code>knitr::kable()</code> wrapper</p>
</div>
</div>
<div id="model-formulae" class="section level3" number="1.2.4">
<h3 number="1.2.4"><span class="header-section-number">1.2.4</span> Model Formulae</h3>
<div id="arithmetic-operations-within-a-formula" class="section level4" number="1.2.4.1">
<h4 number="1.2.4.1"><span class="header-section-number">1.2.4.1</span> Arithmetic operations within a formula</h4>
<p>A model relating to birth weight to cigarette smoking of the mother
during pregnancy and the family income.</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;bwght&quot;</span>)</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(bwght)</span></code></pre></div>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>lm1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(bwght <span class="sc">~</span> cigs <span class="sc">+</span> faminc, <span class="at">data =</span> bwght)</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Weights in pounds, direct way</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>lm2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">I</span>(bwght<span class="sc">/</span><span class="dv">16</span>) <span class="sc">~</span> cigs <span class="sc">+</span> faminc, <span class="at">data =</span> bwght)</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Packs of cigarettes</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>lm3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(bwght <span class="sc">~</span> <span class="fu">I</span>(cigs<span class="sc">/</span><span class="dv">20</span>) <span class="sc">+</span> faminc, <span class="at">data =</span> bwght)</span></code></pre></div>
<p>See table @ref(tab:regressiontable).</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">huxreg</span>(lm1, lm2, lm3) <span class="sc">%&gt;%</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_caption</span>(<span class="st">&#39;(#tab:regressiontable) Regression table&#39;</span>)  <span class="co"># #tab:foo allows to reference to a table directly in a dynamic document.</span></span></code></pre></div>
<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:unnamed-chunk-94">
<caption style="caption-side: top; text-align: center;">(#tab:unnamed-chunk-94) (#tab:regressiontable) Regression table</caption><col><col><col><col><tr>
<th style="vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></th><th style="vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(1)</th><th style="vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(2)</th><th style="vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(3)</th></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(Intercept)</th><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">116.974 ***</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">7.311 ***</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">116.974 ***</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></th><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(1.049)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.066)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(1.049)&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">cigs</th><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-0.463 ***</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-0.029 ***</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></th><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.092)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.006)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">faminc</th><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.093 **&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.006 **&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.093 **&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></th><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.029)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.002)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.029)&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">I(cigs/20)</th><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-9.268 ***</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></th><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(1.832)&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">N</th><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1388&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1388&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1388&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">R2</th><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.030&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.030&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.030&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">logLik</th><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-6130.414&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-2282.061&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-6130.414&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">AIC</th><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">12268.828&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">4572.122&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">12268.828&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th colspan="4" style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;"> *** p &lt; 0.001;  ** p &lt; 0.01;  * p &lt; 0.05.</th></tr>
</table>

<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">stargazer</span>( <span class="co"># invisible supresses additional output such as the package author name when the regression table is compiled</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(lm1,</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>       lm2,</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>       lm3)</span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>  ,<span class="at">keep.stat =</span> <span class="fu">c</span>(<span class="st">&quot;n&quot;</span>, <span class="st">&quot;rsq&quot;</span>), <span class="at">type =</span> <span class="st">&quot;latex&quot;</span>, <span class="at">header =</span> <span class="cn">FALSE</span>))<span class="co"># to have number of observations and R^2 reported}</span></span></code></pre></div>
<p>Dividing the dependent variable by 16 changes all coefficients by the
same factor <span class="math inline">\(\frac{1}{16}\)</span> and dividing the regressor by 20 changes its
coefficients by the factor 20. Other statistics like <span class="math inline">\(R^2\)</span> are
unaffected.</p>
</div>
<div id="standardization-beta-coefficients" class="section level4" number="1.2.4.2">
<h4 number="1.2.4.2"><span class="header-section-number">1.2.4.2</span> Standardization: Beta coefficients</h4>
<p>The standardized dependent variable <span class="math inline">\(y\)</span> and regressor <span class="math inline">\(x_1\)</span> are</p>
<span class="math display">\[\begin{equation}
z_y=\frac{y-\bar{y}}{sd(y)}
\end{equation}\]</span>
<p>and</p>
<span class="math display">\[\begin{equation}
z_{x1}=\frac{x_{1}-\bar{x}_{x1}}{sd(x_{1})}
\end{equation}\]</span>
<p>They measure by how many <em>standard deviations</em> <span class="math inline">\(y\)</span> changes as the
respective independent variable increases by <em>one standard deviation</em>.</p>
<p>The model does not include a constant because all averages are removed
in the standardization.</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(hprice2)</span></code></pre></div>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="fu">scale</span>(price)<span class="sc">~</span><span class="dv">0</span> <span class="sc">+</span>  <span class="fu">scale</span>(crime) <span class="sc">+</span>  <span class="fu">scale</span>(rooms) <span class="sc">+</span> <span class="fu">scale</span>(dist) <span class="sc">+</span>  <span class="fu">scale</span>(stratio), <span class="at">data =</span> hprice2)</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> <span class="fu">scale</span>(price) <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> <span class="fu">scale</span>(crime) <span class="sc">+</span> <span class="fu">scale</span>(rooms) <span class="sc">+</span> </span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale</span>(dist) <span class="sc">+</span> <span class="fu">scale</span>(stratio), <span class="at">data =</span> hprice2)</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale</span>(crime)    <span class="fu">scale</span>(rooms)     <span class="fu">scale</span>(dist)  <span class="fu">scale</span>(stratio)  </span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>     <span class="sc">-</span><span class="fl">0.191397</span>        <span class="fl">0.565694</span>        <span class="fl">0.003809</span>       <span class="sc">-</span><span class="fl">0.246953</span>  </span></code></pre></div>
</div>
<div id="logarithms-quadratics-and-polynomials" class="section level4" number="1.2.4.3">
<h4 number="1.2.4.3"><span class="header-section-number">1.2.4.3</span> Logarithms, Quadratics and Polynomials</h4>
<p>The model for house prices as in Wooldrige:</p>
<span class="math display">\[\begin{equation}
log(price) = \beta_0 +  \beta_1 log(nox) + \beta_2 log(dist) + \beta_3 rooms + \beta_4 rooms^{2} + \beta_5 stratio + u
\end{equation}\]</span>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>lm_hprice2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(price)<span class="sc">~</span>  <span class="fu">log</span>(nox) <span class="sc">+</span>  <span class="fu">log</span>(dist) <span class="sc">+</span> rooms <span class="sc">+</span> <span class="fu">I</span>(rooms<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> stratio, <span class="at">data =</span> hprice2)</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_hprice2)</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> <span class="fu">log</span>(price) <span class="sc">~</span> <span class="fu">log</span>(nox) <span class="sc">+</span> <span class="fu">log</span>(dist) <span class="sc">+</span> rooms <span class="sc">+</span> <span class="fu">I</span>(rooms<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>    stratio, <span class="at">data =</span> hprice2)</span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a>Residuals<span class="sc">:</span></span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a>     Min       1Q   Median       3Q      Max </span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">1.04285</span> <span class="sc">-</span><span class="fl">0.12774</span>  <span class="fl">0.02038</span>  <span class="fl">0.12650</span>  <span class="fl">1.25272</span> </span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a>             Estimate Std. Error t value <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)    </span>
<span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a>(Intercept) <span class="fl">13.385477</span>   <span class="fl">0.566473</span>  <span class="fl">23.630</span>  <span class="sc">&lt;</span> <span class="fl">2e-16</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb108-15"><a href="#cb108-15" aria-hidden="true" tabindex="-1"></a><span class="fu">log</span>(nox)    <span class="sc">-</span><span class="fl">0.901682</span>   <span class="fl">0.114687</span>  <span class="sc">-</span><span class="fl">7.862</span> <span class="fl">2.34e-14</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb108-16"><a href="#cb108-16" aria-hidden="true" tabindex="-1"></a><span class="fu">log</span>(dist)   <span class="sc">-</span><span class="fl">0.086781</span>   <span class="fl">0.043281</span>  <span class="sc">-</span><span class="fl">2.005</span>  <span class="fl">0.04549</span> <span class="sc">*</span>  </span>
<span id="cb108-17"><a href="#cb108-17" aria-hidden="true" tabindex="-1"></a>rooms       <span class="sc">-</span><span class="fl">0.545113</span>   <span class="fl">0.165454</span>  <span class="sc">-</span><span class="fl">3.295</span>  <span class="fl">0.00106</span> <span class="sc">**</span> </span>
<span id="cb108-18"><a href="#cb108-18" aria-hidden="true" tabindex="-1"></a><span class="fu">I</span>(rooms<span class="sc">^</span><span class="dv">2</span>)   <span class="fl">0.062261</span>   <span class="fl">0.012805</span>   <span class="fl">4.862</span> <span class="fl">1.56e-06</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb108-19"><a href="#cb108-19" aria-hidden="true" tabindex="-1"></a>stratio     <span class="sc">-</span><span class="fl">0.047590</span>   <span class="fl">0.005854</span>  <span class="sc">-</span><span class="fl">8.129</span> <span class="fl">3.42e-15</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb108-20"><a href="#cb108-20" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb108-21"><a href="#cb108-21" aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span>
<span id="cb108-22"><a href="#cb108-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-23"><a href="#cb108-23" aria-hidden="true" tabindex="-1"></a>Residual standard error<span class="sc">:</span> <span class="fl">0.2592</span> on <span class="dv">500</span> degrees of freedom</span>
<span id="cb108-24"><a href="#cb108-24" aria-hidden="true" tabindex="-1"></a>Multiple R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.6028</span>,    Adjusted R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.5988</span> </span>
<span id="cb108-25"><a href="#cb108-25" aria-hidden="true" tabindex="-1"></a>F<span class="sc">-</span>statistic<span class="sc">:</span> <span class="fl">151.8</span> on <span class="dv">5</span> and <span class="dv">500</span> DF,  p<span class="sc">-</span>value<span class="sc">:</span> <span class="er">&lt;</span> <span class="fl">2.2e-16</span></span></code></pre></div>
<ul>
<li>The quadratic term of rooms significantly positive coefficient
<span class="math inline">\(\hat\beta_4\)</span> implying that the semi-elasticity increases with more
rooms</li>
<li>The negative coefficient for rooms indicates that for small number
of rooms the price decreases and</li>
<li>the positive coefficient for <span class="math inline">\(rooms^2\)</span> implies that for “large”
value of rooms the price increases</li>
<li>The number of rooms implying the smallest price can be found as</li>
</ul>
<span class="math display">\[\begin{equation}
rooms^{\star} = \frac{-\beta_3}{2\beta_4} \approx 4.4
\end{equation}\]</span>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>beta3 <span class="ot">&lt;-</span> lm_hprice2<span class="sc">$</span>coefficients[[<span class="dv">4</span>]]</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>beta4 <span class="ot">&lt;-</span> lm_hprice2<span class="sc">$</span>coefficients[[<span class="dv">5</span>]]</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span>beta3 <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> beta4)</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">4.37763</span></span></code></pre></div>
</div>
<div id="interaction-terms" class="section level4" number="1.2.4.4">
<h4 number="1.2.4.4"><span class="header-section-number">1.2.4.4</span> Interaction terms</h4>
<p>Consider the following model,</p>
<span class="math display">\[\begin{equation}
Y = {\beta}_{0} + {\beta}_{1}x_{1} +  {\beta}_{2}x_{2} + {\beta}_{3}x_{1}x_{2} + u
(\#eq:interactionterm)
\end{equation}\]</span>
<p>where <span class="math inline">\(x_1\)</span>, <span class="math inline">\(x_2\)</span>, and <span class="math inline">\(Y\)</span> are the same as before, but we have added a
new interaction term <span class="math inline">\(x_1x_2\)</span> which multiplies <span class="math inline">\(x_1\)</span> and <span class="math inline">\(x_2\)</span>, so we
also have an additional <span class="math inline">\(\beta\)</span> parameter <span class="math inline">\(\beta_3\)</span>.</p>
<p>This model essentially creates two slopes and two intercepts, <span class="math inline">\(\beta_2\)</span>
being the difference in intercepts and <span class="math inline">\(\beta_3\)</span> being the difference in
slopes.</p>
<p>Recall that R reads <strong>x1</strong> times <strong>x2</strong> as <span class="math inline">\(y \sim x_1+x_2+x_1x_2\)</span> and
<strong>x1:x2</strong> as <span class="math inline">\(y \sim x_1x_2\)</span>.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(attend)</span></code></pre></div>
</div>
</div>
<div id="mlr-prediction" class="section level3" number="1.2.5">
<h3 number="1.2.5"><span class="header-section-number">1.2.5</span> MLR Prediction</h3>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(gpa2)</span></code></pre></div>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate model with interaction effect:</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>myres<span class="ot">&lt;-</span><span class="fu">lm</span>(stndfnl<span class="sc">~</span>atndrte<span class="sc">*</span>priGPA<span class="sc">+</span>ACT<span class="sc">+</span><span class="fu">I</span>(priGPA<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span><span class="fu">I</span>(ACT<span class="sc">^</span><span class="dv">2</span>), <span class="at">data=</span>attend)</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate for partial effect at priGPA=2.59:</span></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">coef</span>(myres)</span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>b[<span class="st">&quot;atndrte&quot;</span>] <span class="sc">+</span> <span class="fl">2.59</span><span class="sc">*</span>b[<span class="st">&quot;atndrte:priGPA&quot;</span>]</span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>    atndrte </span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a><span class="fl">0.007754572</span> </span></code></pre></div>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>Hnull <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;ACT&quot;</span>, <span class="st">&quot;I(priGPA^2)&quot;</span>)</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>linHyp2 <span class="ot">&lt;-</span> <span class="fu">linearHypothesis</span>(myres,Hnull) <span class="co"># Test wether the two regression together (at the same time)  are different from zero</span></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>broom<span class="sc">::</span><span class="fu">tidy</span>(linHyp2)</span></code></pre></div>
<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:unnamed-chunk-103">
<caption style="caption-side: top; text-align: center;">(#tab:unnamed-chunk-103) </caption><col><col><col><col><col><col><tr>
<th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">res.df</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">rss</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">df</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">sumsq</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">statistic</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">p.value</th></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">675</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">521</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;"></td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">673</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">513</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">2</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">8.53</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">5.6</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.00387</td></tr>
</table>

<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test partial effect for priGPA=2.59:</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>Hnull <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;atndrte+2.59*atndrte:priGPA&quot;</span>)</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>linHyp2 <span class="ot">&lt;-</span> <span class="fu">linearHypothesis</span>(myres,Hnull)</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>broom<span class="sc">::</span><span class="fu">tidy</span>(linHyp2)</span></code></pre></div>
<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:unnamed-chunk-104">
<caption style="caption-side: top; text-align: center;">(#tab:unnamed-chunk-104) </caption><col><col><col><col><col><col><tr>
<th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">res.df</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">rss</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">df</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">sumsq</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">statistic</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">p.value</th></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">674</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">519</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;"></td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">673</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">513</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">6.58</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">8.63</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.00341</td></tr>
</table>

<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Regress and report coefficients</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>reg <span class="ot">&lt;-</span> <span class="fu">lm</span>(colgpa<span class="sc">~</span>sat<span class="sc">+</span>hsperc<span class="sc">+</span>hsize<span class="sc">+</span><span class="fu">I</span>(hsize<span class="sc">^</span><span class="dv">2</span>),<span class="at">data=</span>gpa2)</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>reg</span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> colgpa <span class="sc">~</span> sat <span class="sc">+</span> hsperc <span class="sc">+</span> hsize <span class="sc">+</span> <span class="fu">I</span>(hsize<span class="sc">^</span><span class="dv">2</span>), <span class="at">data =</span> gpa2)</span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a>(Intercept)          sat       hsperc        hsize   <span class="fu">I</span>(hsize<span class="sc">^</span><span class="dv">2</span>)  </span>
<span id="cb115-10"><a href="#cb115-10" aria-hidden="true" tabindex="-1"></a>   <span class="fl">1.492652</span>     <span class="fl">0.001492</span>    <span class="sc">-</span><span class="fl">0.013856</span>    <span class="sc">-</span><span class="fl">0.060881</span>     <span class="fl">0.005460</span>  </span></code></pre></div>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate data set containing the regressor values for predictions</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>cvalues <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">sat=</span><span class="dv">1200</span>, <span class="at">hsperc=</span><span class="dv">30</span>, <span class="at">hsize=</span><span class="dv">5</span>)</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Point estimate of prediction</span></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(reg, cvalues)</span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>       <span class="dv">1</span> </span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a><span class="fl">2.700075</span> </span></code></pre></div>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Point estimate and 95% confidence interval</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(reg, cvalues, <span class="at">interval =</span> <span class="st">&quot;confidence&quot;</span>)</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>       fit      lwr      upr</span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="fl">2.700075</span> <span class="fl">2.661104</span> <span class="fl">2.739047</span></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Define three sets of regressor variables</span></span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>cvalues <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">sat=</span><span class="fu">c</span>(<span class="dv">1200</span>,<span class="dv">900</span>,<span class="dv">1400</span>), <span class="at">hsperc=</span><span class="fu">c</span>(<span class="dv">30</span>,<span class="dv">20</span>,<span class="dv">5</span>),</span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">hsize=</span><span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">3</span>,<span class="dv">1</span>))</span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Point estimates and 99% confidence intervals for these</span></span>
<span id="cb117-11"><a href="#cb117-11" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(reg, cvalues, <span class="at">interval =</span> <span class="st">&quot;confidence&quot;</span>, <span class="at">level=</span><span class="fl">0.99</span>)</span>
<span id="cb117-12"><a href="#cb117-12" aria-hidden="true" tabindex="-1"></a>       fit      lwr      upr</span>
<span id="cb117-13"><a href="#cb117-13" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="fl">2.700075</span> <span class="fl">2.648850</span> <span class="fl">2.751301</span></span>
<span id="cb117-14"><a href="#cb117-14" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span> <span class="fl">2.425282</span> <span class="fl">2.388540</span> <span class="fl">2.462025</span></span>
<span id="cb117-15"><a href="#cb117-15" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span> <span class="fl">3.457448</span> <span class="fl">3.385572</span> <span class="fl">3.529325</span></span></code></pre></div>
</div>
</div>
<div id="mlr-analysis-with-qualitative-regressors" class="section level2" number="1.3">
<h2 number="1.3"><span class="header-section-number">1.3</span> MLR Analysis with Qualitative Regressors</h2>
<div id="dummy-variabes" class="section level3" number="1.3.1">
<h3 number="1.3.1"><span class="header-section-number">1.3.1</span> Dummy variabes</h3>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(wage1)</span></code></pre></div>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>lm1_wage1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> female<span class="sc">+</span>educ<span class="sc">+</span>exper<span class="sc">+</span>tenure, <span class="at">data=</span>wage1)</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm1_wage1)</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> wage <span class="sc">~</span> female <span class="sc">+</span> educ <span class="sc">+</span> exper <span class="sc">+</span> tenure, <span class="at">data =</span> wage1)</span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a>Residuals<span class="sc">:</span></span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a>    Min      1Q  Median      3Q     Max </span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">7.7675</span> <span class="sc">-</span><span class="fl">1.8080</span> <span class="sc">-</span><span class="fl">0.4229</span>  <span class="fl">1.0467</span> <span class="fl">14.0075</span> </span>
<span id="cb119-11"><a href="#cb119-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-12"><a href="#cb119-12" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb119-13"><a href="#cb119-13" aria-hidden="true" tabindex="-1"></a>            Estimate Std. Error t value <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)    </span>
<span id="cb119-14"><a href="#cb119-14" aria-hidden="true" tabindex="-1"></a>(Intercept) <span class="sc">-</span><span class="fl">1.56794</span>    <span class="fl">0.72455</span>  <span class="sc">-</span><span class="fl">2.164</span>   <span class="fl">0.0309</span> <span class="sc">*</span>  </span>
<span id="cb119-15"><a href="#cb119-15" aria-hidden="true" tabindex="-1"></a>female      <span class="sc">-</span><span class="fl">1.81085</span>    <span class="fl">0.26483</span>  <span class="sc">-</span><span class="fl">6.838</span> <span class="fl">2.26e-11</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb119-16"><a href="#cb119-16" aria-hidden="true" tabindex="-1"></a>educ         <span class="fl">0.57150</span>    <span class="fl">0.04934</span>  <span class="fl">11.584</span>  <span class="sc">&lt;</span> <span class="fl">2e-16</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb119-17"><a href="#cb119-17" aria-hidden="true" tabindex="-1"></a>exper        <span class="fl">0.02540</span>    <span class="fl">0.01157</span>   <span class="fl">2.195</span>   <span class="fl">0.0286</span> <span class="sc">*</span>  </span>
<span id="cb119-18"><a href="#cb119-18" aria-hidden="true" tabindex="-1"></a>tenure       <span class="fl">0.14101</span>    <span class="fl">0.02116</span>   <span class="fl">6.663</span> <span class="fl">6.83e-11</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb119-19"><a href="#cb119-19" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb119-20"><a href="#cb119-20" aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span>
<span id="cb119-21"><a href="#cb119-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-22"><a href="#cb119-22" aria-hidden="true" tabindex="-1"></a>Residual standard error<span class="sc">:</span> <span class="fl">2.958</span> on <span class="dv">521</span> degrees of freedom</span>
<span id="cb119-23"><a href="#cb119-23" aria-hidden="true" tabindex="-1"></a>Multiple R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.3635</span>,    Adjusted R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.3587</span> </span>
<span id="cb119-24"><a href="#cb119-24" aria-hidden="true" tabindex="-1"></a>F<span class="sc">-</span>statistic<span class="sc">:</span>  <span class="fl">74.4</span> on <span class="dv">4</span> and <span class="dv">521</span> DF,  p<span class="sc">-</span>value<span class="sc">:</span> <span class="er">&lt;</span> <span class="fl">2.2e-16</span></span></code></pre></div>
<p>On average a women makes $ 2
per less than a man with the <em>same</em> education, experience, and tenure.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>lm2_wage1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(wage)<span class="sc">~</span>married<span class="sc">*</span>female<span class="sc">+</span>educ<span class="sc">+</span>exper<span class="sc">+</span><span class="fu">I</span>(exper<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span>tenure<span class="sc">+</span><span class="fu">I</span>(tenure<span class="sc">^</span><span class="dv">2</span>), <span class="at">data=</span>wage1)</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm2_wage1)</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> <span class="fu">log</span>(wage) <span class="sc">~</span> married <span class="sc">*</span> female <span class="sc">+</span> educ <span class="sc">+</span> exper <span class="sc">+</span> <span class="fu">I</span>(exper<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>    tenure <span class="sc">+</span> <span class="fu">I</span>(tenure<span class="sc">^</span><span class="dv">2</span>), <span class="at">data =</span> wage1)</span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a>Residuals<span class="sc">:</span></span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a>     Min       1Q   Median       3Q      Max </span>
<span id="cb120-10"><a href="#cb120-10" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">1.89697</span> <span class="sc">-</span><span class="fl">0.24060</span> <span class="sc">-</span><span class="fl">0.02689</span>  <span class="fl">0.23144</span>  <span class="fl">1.09197</span> </span>
<span id="cb120-11"><a href="#cb120-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-12"><a href="#cb120-12" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb120-13"><a href="#cb120-13" aria-hidden="true" tabindex="-1"></a>                 Estimate Std. Error t value <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)    </span>
<span id="cb120-14"><a href="#cb120-14" aria-hidden="true" tabindex="-1"></a>(Intercept)     <span class="fl">0.3213781</span>  <span class="fl">0.1000090</span>   <span class="fl">3.213</span> <span class="fl">0.001393</span> <span class="sc">**</span> </span>
<span id="cb120-15"><a href="#cb120-15" aria-hidden="true" tabindex="-1"></a>married         <span class="fl">0.2126757</span>  <span class="fl">0.0553572</span>   <span class="fl">3.842</span> <span class="fl">0.000137</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb120-16"><a href="#cb120-16" aria-hidden="true" tabindex="-1"></a>female         <span class="sc">-</span><span class="fl">0.1103502</span>  <span class="fl">0.0557421</span>  <span class="sc">-</span><span class="fl">1.980</span> <span class="fl">0.048272</span> <span class="sc">*</span>  </span>
<span id="cb120-17"><a href="#cb120-17" aria-hidden="true" tabindex="-1"></a>educ            <span class="fl">0.0789103</span>  <span class="fl">0.0066945</span>  <span class="fl">11.787</span>  <span class="sc">&lt;</span> <span class="fl">2e-16</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb120-18"><a href="#cb120-18" aria-hidden="true" tabindex="-1"></a>exper           <span class="fl">0.0268006</span>  <span class="fl">0.0052428</span>   <span class="fl">5.112</span> <span class="fl">4.50e-07</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb120-19"><a href="#cb120-19" aria-hidden="true" tabindex="-1"></a><span class="fu">I</span>(exper<span class="sc">^</span><span class="dv">2</span>)     <span class="sc">-</span><span class="fl">0.0005352</span>  <span class="fl">0.0001104</span>  <span class="sc">-</span><span class="fl">4.847</span> <span class="fl">1.66e-06</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb120-20"><a href="#cb120-20" aria-hidden="true" tabindex="-1"></a>tenure          <span class="fl">0.0290875</span>  <span class="fl">0.0067620</span>   <span class="fl">4.302</span> <span class="fl">2.03e-05</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb120-21"><a href="#cb120-21" aria-hidden="true" tabindex="-1"></a><span class="fu">I</span>(tenure<span class="sc">^</span><span class="dv">2</span>)    <span class="sc">-</span><span class="fl">0.0005331</span>  <span class="fl">0.0002312</span>  <span class="sc">-</span><span class="fl">2.306</span> <span class="fl">0.021531</span> <span class="sc">*</span>  </span>
<span id="cb120-22"><a href="#cb120-22" aria-hidden="true" tabindex="-1"></a>married<span class="sc">:</span>female <span class="sc">-</span><span class="fl">0.3005931</span>  <span class="fl">0.0717669</span>  <span class="sc">-</span><span class="fl">4.188</span> <span class="fl">3.30e-05</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb120-23"><a href="#cb120-23" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb120-24"><a href="#cb120-24" aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span>
<span id="cb120-25"><a href="#cb120-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-26"><a href="#cb120-26" aria-hidden="true" tabindex="-1"></a>Residual standard error<span class="sc">:</span> <span class="fl">0.3933</span> on <span class="dv">517</span> degrees of freedom</span>
<span id="cb120-27"><a href="#cb120-27" aria-hidden="true" tabindex="-1"></a>Multiple R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.4609</span>,    Adjusted R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.4525</span> </span>
<span id="cb120-28"><a href="#cb120-28" aria-hidden="true" tabindex="-1"></a>F<span class="sc">-</span>statistic<span class="sc">:</span> <span class="fl">55.25</span> on <span class="dv">8</span> and <span class="dv">517</span> DF,  p<span class="sc">-</span>value<span class="sc">:</span> <span class="er">&lt;</span> <span class="fl">2.2e-16</span></span></code></pre></div>
<hr />
<p><strong>Your turn</strong></p>
<ol style="list-style-type: decimal">
<li>What is the reference group in this model?</li>
<li>Ceteris paribus, how much more wage do single males make relative to
the reference group?</li>
<li>Ceteris paribus, how much more wage do single females make relative
to the reference group?</li>
<li>Ceteris paribus, how much less do married females make than single
females?</li>
<li>Do the results make sense economically. What socio-economic factors
could explain the results?</li>
</ol>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>df_lm2_wage1 <span class="ot">&lt;-</span> <span class="fu">tidy</span>(lm2_wage1)</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Singe male</span></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>marriedmale <span class="ot">&lt;-</span> df_lm2_wage1 <span class="sc">%&gt;%</span></span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">&quot;married&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(estimate) <span class="sc">%&gt;%</span></span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>() <span class="co"># pull out the single coefficient value of the dataframe</span></span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Single female</span></span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a>singlefemale <span class="ot">&lt;-</span> df_lm2_wage1 <span class="sc">%&gt;%</span></span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">&quot;female&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb121-10"><a href="#cb121-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(estimate) <span class="sc">%&gt;%</span></span>
<span id="cb121-11"><a href="#cb121-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>() <span class="co"># pull out the single coefficient value of the dataframe</span></span>
<span id="cb121-12"><a href="#cb121-12" aria-hidden="true" tabindex="-1"></a>marriedfemale <span class="ot">&lt;-</span> df_lm2_wage1 <span class="sc">%&gt;%</span></span>
<span id="cb121-13"><a href="#cb121-13" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">&quot;married:female&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb121-14"><a href="#cb121-14" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(estimate) <span class="sc">%&gt;%</span></span>
<span id="cb121-15"><a href="#cb121-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>() <span class="co"># pull out the single coefficient value of the dataframe</span></span>
<span id="cb121-16"><a href="#cb121-16" aria-hidden="true" tabindex="-1"></a>married<span class="ot">&lt;-</span> df_lm2_wage1 <span class="sc">%&gt;%</span></span>
<span id="cb121-17"><a href="#cb121-17" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">&quot;married&quot;</span>) <span class="sc">%&gt;%</span> <span class="co">#</span></span>
<span id="cb121-18"><a href="#cb121-18" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(estimate) <span class="sc">%&gt;%</span></span>
<span id="cb121-19"><a href="#cb121-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>() <span class="co"># pull out the single coefficient value of the dataframe</span></span></code></pre></div>
<p>A:</p>
<ol style="list-style-type: decimal">
<li>Reference group: <em>single</em> and <em>male</em></li>
<li>Cp. married males make 21%
(<code>scales::percent(marriedmale)</code>) more than single males.</li>
<li>Cp. a single female makes -11%
(<code>scales::percent(singlefemale)</code>) less than the reference group.</li>
<li>Married females make
9%
(<code>scales::percent(abs(marriedfemale) - abs(married))</code>) less than
single females.</li>
<li>There seems to be a marriage premium for men but for women the
marriage premium is negative.</li>
</ol>
<hr />
</div>
<div id="logical-variables" class="section level3" number="1.3.2">
<h3 number="1.3.2"><span class="header-section-number">1.3.2</span> Logical variables</h3>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co"># replace &quot;female&quot; with logical variable</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>wage1<span class="sc">$</span>female <span class="ot">&lt;-</span> <span class="fu">as.logical</span>(wage1<span class="sc">$</span>female)</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(wage1<span class="sc">$</span>female)</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a><span class="cn">FALSE</span>  <span class="cn">TRUE</span> </span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a>  <span class="dv">274</span>   <span class="dv">252</span> </span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-8"><a href="#cb122-8" aria-hidden="true" tabindex="-1"></a><span class="co"># regression with logical variable</span></span>
<span id="cb122-9"><a href="#cb122-9" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(wage <span class="sc">~</span> female<span class="sc">+</span>educ<span class="sc">+</span>exper<span class="sc">+</span>tenure, <span class="at">data=</span>wage1)</span>
<span id="cb122-10"><a href="#cb122-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-11"><a href="#cb122-11" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb122-12"><a href="#cb122-12" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> wage <span class="sc">~</span> female <span class="sc">+</span> educ <span class="sc">+</span> exper <span class="sc">+</span> tenure, <span class="at">data =</span> wage1)</span>
<span id="cb122-13"><a href="#cb122-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-14"><a href="#cb122-14" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb122-15"><a href="#cb122-15" aria-hidden="true" tabindex="-1"></a>(Intercept)   femaleTRUE         educ        exper       tenure  </span>
<span id="cb122-16"><a href="#cb122-16" aria-hidden="true" tabindex="-1"></a>    <span class="sc">-</span><span class="fl">1.5679</span>      <span class="sc">-</span><span class="fl">1.8109</span>       <span class="fl">0.5715</span>       <span class="fl">0.0254</span>       <span class="fl">0.1410</span>  </span></code></pre></div>
</div>
<div id="factor-variables" class="section level3" number="1.3.3">
<h3 number="1.3.3"><span class="header-section-number">1.3.3</span> Factor variables</h3>
<p>As discussed in the R introduction, categorical variables encoded as
factors are special <em>animals</em> in R. They are immensely useful in a
regression when you have a categorical variable with many levels (e.g.
“Very Bad,” “Bad,” “Good,” “Very Good”) but can create a set of subtle
issues. Here, we discuss the base R way and the more robust tidyverse
way of dealing with factors in the area of regression modelling.</p>
<p>Factor variables can be directly added to the list of regressors. R is
clever enough to implicitly add <span class="math inline">\(g-1\)</span> dummy variables if the factor has
<span class="math inline">\(g\)</span> outcomes.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(CPS1985,<span class="at">package=</span><span class="st">&quot;AER&quot;</span>)</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(CPS1985)</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;data.frame&#39;</span><span class="sc">:</span>   <span class="dv">534</span> obs. of  <span class="dv">11</span> variables<span class="sc">:</span></span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a> <span class="er">$</span> wage      <span class="sc">:</span> num  <span class="fl">5.1</span> <span class="fl">4.95</span> <span class="fl">6.67</span> <span class="dv">4</span> <span class="fl">7.5</span> ...</span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> education <span class="sc">:</span> num  <span class="dv">8</span> <span class="dv">9</span> <span class="dv">12</span> <span class="dv">12</span> <span class="dv">12</span> <span class="dv">13</span> <span class="dv">10</span> <span class="dv">12</span> <span class="dv">16</span> <span class="dv">12</span> ...</span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> experience<span class="sc">:</span> num  <span class="dv">21</span> <span class="dv">42</span> <span class="dv">1</span> <span class="dv">4</span> <span class="dv">17</span> <span class="dv">9</span> <span class="dv">27</span> <span class="dv">9</span> <span class="dv">11</span> <span class="dv">9</span> ...</span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> age       <span class="sc">:</span> num  <span class="dv">35</span> <span class="dv">57</span> <span class="dv">19</span> <span class="dv">22</span> <span class="dv">35</span> <span class="dv">28</span> <span class="dv">43</span> <span class="dv">27</span> <span class="dv">33</span> <span class="dv">27</span> ...</span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> ethnicity <span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">3</span> levels <span class="st">&quot;cauc&quot;</span>,<span class="st">&quot;hispanic&quot;</span>,..<span class="sc">:</span> <span class="dv">2</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> ...</span>
<span id="cb123-9"><a href="#cb123-9" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> region    <span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">2</span> levels <span class="st">&quot;south&quot;</span>,<span class="st">&quot;other&quot;</span><span class="sc">:</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">2</span> ...</span>
<span id="cb123-10"><a href="#cb123-10" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> gender    <span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">2</span> levels <span class="st">&quot;male&quot;</span>,<span class="st">&quot;female&quot;</span><span class="sc">:</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> ...</span>
<span id="cb123-11"><a href="#cb123-11" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> occupation<span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">6</span> levels <span class="st">&quot;worker&quot;</span>,<span class="st">&quot;technical&quot;</span>,..<span class="sc">:</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> ...</span>
<span id="cb123-12"><a href="#cb123-12" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> sector    <span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">3</span> levels <span class="st">&quot;manufacturing&quot;</span>,..<span class="sc">:</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">3</span> <span class="dv">3</span> <span class="dv">3</span> <span class="dv">3</span> <span class="dv">3</span> <span class="dv">1</span> <span class="dv">3</span> ...</span>
<span id="cb123-13"><a href="#cb123-13" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> union     <span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">2</span> levels <span class="st">&quot;no&quot;</span>,<span class="st">&quot;yes&quot;</span><span class="sc">:</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> ...</span>
<span id="cb123-14"><a href="#cb123-14" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> married   <span class="sc">:</span> Factor w<span class="sc">/</span> <span class="dv">2</span> levels <span class="st">&quot;no&quot;</span>,<span class="st">&quot;yes&quot;</span><span class="sc">:</span> <span class="dv">2</span> <span class="dv">2</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">1</span> ...</span>
<span id="cb123-15"><a href="#cb123-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Table of categories and frequencies for two factor variables:</span></span>
<span id="cb123-16"><a href="#cb123-16" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(CPS1985<span class="sc">$</span>gender)</span>
<span id="cb123-17"><a href="#cb123-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-18"><a href="#cb123-18" aria-hidden="true" tabindex="-1"></a>  male female </span>
<span id="cb123-19"><a href="#cb123-19" aria-hidden="true" tabindex="-1"></a>   <span class="dv">289</span>    <span class="dv">245</span> </span>
<span id="cb123-20"><a href="#cb123-20" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(CPS1985<span class="sc">$</span>occupation)</span>
<span id="cb123-21"><a href="#cb123-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-22"><a href="#cb123-22" aria-hidden="true" tabindex="-1"></a>    worker  technical   services     office      sales management </span>
<span id="cb123-23"><a href="#cb123-23" aria-hidden="true" tabindex="-1"></a>       <span class="dv">156</span>        <span class="dv">105</span>         <span class="dv">83</span>         <span class="dv">97</span>         <span class="dv">38</span>         <span class="dv">55</span> </span>
<span id="cb123-24"><a href="#cb123-24" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(CPS1985<span class="sc">$</span>occupation)</span>
<span id="cb123-25"><a href="#cb123-25" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;worker&quot;</span>     <span class="st">&quot;technical&quot;</span>  <span class="st">&quot;services&quot;</span>   <span class="st">&quot;office&quot;</span>     <span class="st">&quot;sales&quot;</span>     </span>
<span id="cb123-26"><a href="#cb123-26" aria-hidden="true" tabindex="-1"></a>[<span class="dv">6</span>] <span class="st">&quot;management&quot;</span></span>
<span id="cb123-27"><a href="#cb123-27" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(CPS1985<span class="sc">$</span>gender)</span>
<span id="cb123-28"><a href="#cb123-28" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">&quot;male&quot;</span>   <span class="st">&quot;female&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Directly using factor variables in regression formula:</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="fu">log</span>(wage) <span class="sc">~</span> education<span class="sc">+</span>experience<span class="sc">+</span>gender<span class="sc">+</span>occupation, <span class="at">data=</span>CPS1985)</span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> <span class="fu">log</span>(wage) <span class="sc">~</span> education <span class="sc">+</span> experience <span class="sc">+</span> gender <span class="sc">+</span> occupation, </span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> CPS1985)</span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-8"><a href="#cb124-8" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb124-9"><a href="#cb124-9" aria-hidden="true" tabindex="-1"></a>         (Intercept)             education            experience  </span>
<span id="cb124-10"><a href="#cb124-10" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.97629</span>               <span class="fl">0.07586</span>               <span class="fl">0.01188</span>  </span>
<span id="cb124-11"><a href="#cb124-11" aria-hidden="true" tabindex="-1"></a>        genderfemale   occupationtechnical    occupationservices  </span>
<span id="cb124-12"><a href="#cb124-12" aria-hidden="true" tabindex="-1"></a>            <span class="sc">-</span><span class="fl">0.22385</span>               <span class="fl">0.14246</span>              <span class="sc">-</span><span class="fl">0.21004</span>  </span>
<span id="cb124-13"><a href="#cb124-13" aria-hidden="true" tabindex="-1"></a>    occupationoffice       occupationsales  occupationmanagement  </span>
<span id="cb124-14"><a href="#cb124-14" aria-hidden="true" tabindex="-1"></a>            <span class="sc">-</span><span class="fl">0.05477</span>              <span class="sc">-</span><span class="fl">0.20757</span>               <span class="fl">0.15254</span>  </span>
<span id="cb124-15"><a href="#cb124-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-16"><a href="#cb124-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Fragile method (base R)</span></span>
<span id="cb124-17"><a href="#cb124-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Manually redefine the  reference category:</span></span>
<span id="cb124-18"><a href="#cb124-18" aria-hidden="true" tabindex="-1"></a>CPS1985<span class="sc">$</span>gender <span class="ot">&lt;-</span> <span class="fu">relevel</span>(CPS1985<span class="sc">$</span>gender,<span class="st">&quot;female&quot;</span>)</span>
<span id="cb124-19"><a href="#cb124-19" aria-hidden="true" tabindex="-1"></a>CPS1985<span class="sc">$</span>occupation <span class="ot">&lt;-</span> <span class="fu">relevel</span>(CPS1985<span class="sc">$</span>occupation,<span class="st">&quot;management&quot;</span>)</span>
<span id="cb124-20"><a href="#cb124-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-21"><a href="#cb124-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Rerun regression:</span></span>
<span id="cb124-22"><a href="#cb124-22" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="fu">log</span>(wage) <span class="sc">~</span> education<span class="sc">+</span>experience<span class="sc">+</span>gender<span class="sc">+</span>occupation, <span class="at">data=</span>CPS1985)</span>
<span id="cb124-23"><a href="#cb124-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-24"><a href="#cb124-24" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb124-25"><a href="#cb124-25" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> <span class="fu">log</span>(wage) <span class="sc">~</span> education <span class="sc">+</span> experience <span class="sc">+</span> gender <span class="sc">+</span> occupation, </span>
<span id="cb124-26"><a href="#cb124-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> CPS1985)</span>
<span id="cb124-27"><a href="#cb124-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-28"><a href="#cb124-28" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb124-29"><a href="#cb124-29" aria-hidden="true" tabindex="-1"></a>        (Intercept)            education           experience  </span>
<span id="cb124-30"><a href="#cb124-30" aria-hidden="true" tabindex="-1"></a>            <span class="fl">0.90498</span>              <span class="fl">0.07586</span>              <span class="fl">0.01188</span>  </span>
<span id="cb124-31"><a href="#cb124-31" aria-hidden="true" tabindex="-1"></a>         gendermale     occupationworker  occupationtechnical  </span>
<span id="cb124-32"><a href="#cb124-32" aria-hidden="true" tabindex="-1"></a>            <span class="fl">0.22385</span>             <span class="sc">-</span><span class="fl">0.15254</span>             <span class="sc">-</span><span class="fl">0.01009</span>  </span>
<span id="cb124-33"><a href="#cb124-33" aria-hidden="true" tabindex="-1"></a> occupationservices     occupationoffice      occupationsales  </span>
<span id="cb124-34"><a href="#cb124-34" aria-hidden="true" tabindex="-1"></a>           <span class="sc">-</span><span class="fl">0.36259</span>             <span class="sc">-</span><span class="fl">0.20731</span>             <span class="sc">-</span><span class="fl">0.36011</span>  </span></code></pre></div>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Robust method (tidyverse)</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Manually redefine the  reference category (back to default):</span></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>CPS1985 <span class="ot">&lt;-</span> CPS1985 <span class="sc">%&gt;%</span></span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gender =</span> <span class="fu">fct_relevel</span>(gender, <span class="st">&quot;female&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">occupation =</span> <span class="fu">fct_relevel</span>(occupation, <span class="st">&quot;worker&quot;</span>))</span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="fu">log</span>(wage) <span class="sc">~</span> education<span class="sc">+</span>experience<span class="sc">+</span>gender<span class="sc">+</span>occupation, <span class="at">data=</span>CPS1985)</span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-9"><a href="#cb125-9" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb125-10"><a href="#cb125-10" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> <span class="fu">log</span>(wage) <span class="sc">~</span> education <span class="sc">+</span> experience <span class="sc">+</span> gender <span class="sc">+</span> occupation, </span>
<span id="cb125-11"><a href="#cb125-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> CPS1985)</span>
<span id="cb125-12"><a href="#cb125-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-13"><a href="#cb125-13" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb125-14"><a href="#cb125-14" aria-hidden="true" tabindex="-1"></a>         (Intercept)             education            experience  </span>
<span id="cb125-15"><a href="#cb125-15" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.75244</span>               <span class="fl">0.07586</span>               <span class="fl">0.01188</span>  </span>
<span id="cb125-16"><a href="#cb125-16" aria-hidden="true" tabindex="-1"></a>          gendermale  occupationmanagement   occupationtechnical  </span>
<span id="cb125-17"><a href="#cb125-17" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.22385</span>               <span class="fl">0.15254</span>               <span class="fl">0.14246</span>  </span>
<span id="cb125-18"><a href="#cb125-18" aria-hidden="true" tabindex="-1"></a>  occupationservices      occupationoffice       occupationsales  </span>
<span id="cb125-19"><a href="#cb125-19" aria-hidden="true" tabindex="-1"></a>            <span class="sc">-</span><span class="fl">0.21004</span>              <span class="sc">-</span><span class="fl">0.05477</span>              <span class="sc">-</span><span class="fl">0.20757</span>  </span></code></pre></div>
<div id="breaking-a-numeric-variable-into-categories" class="section level4" number="1.3.3.1">
<h4 number="1.3.3.1"><span class="header-section-number">1.3.3.1</span> Breaking a numeric variable into categories</h4>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(lawsch85)</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(lawsch85<span class="sc">$</span>rank)</span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a> int [<span class="dv">1</span><span class="sc">:</span><span class="dv">156</span>] <span class="dv">128</span> <span class="dv">104</span> <span class="dv">34</span> <span class="dv">49</span> <span class="dv">95</span> <span class="dv">98</span> <span class="dv">124</span> <span class="dv">157</span> <span class="dv">145</span> <span class="dv">91</span> ...</span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define cut points for the rank</span></span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>cutpts <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">25</span>,<span class="dv">40</span>,<span class="dv">60</span>,<span class="dv">100</span>,<span class="dv">175</span>)</span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create factor variable containing ranges for the rank</span></span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a>lawsch85<span class="sc">$</span>rankcat <span class="ot">&lt;-</span> <span class="fu">cut</span>(lawsch85<span class="sc">$</span>rank, cutpts)</span></code></pre></div>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display frequencies</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(lawsch85<span class="sc">$</span>rankcat)</span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>   (<span class="dv">0</span>,<span class="dv">10</span>]   (<span class="dv">10</span>,<span class="dv">25</span>]   (<span class="dv">25</span>,<span class="dv">40</span>]   (<span class="dv">40</span>,<span class="dv">60</span>]  (<span class="dv">60</span>,<span class="dv">100</span>] (<span class="dv">100</span>,<span class="dv">175</span>] </span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>       <span class="dv">10</span>        <span class="dv">16</span>        <span class="dv">13</span>        <span class="dv">18</span>        <span class="dv">37</span>        <span class="dv">62</span> </span></code></pre></div>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Choose reference category</span></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>lawsch85<span class="sc">$</span>rankcat <span class="ot">&lt;-</span> <span class="fu">relevel</span>(lawsch85<span class="sc">$</span>rankcat,<span class="st">&quot;(100,175]&quot;</span>)</span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Run regression</span></span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(salary)<span class="sc">~</span>rankcat<span class="sc">+</span>LSAT<span class="sc">+</span>GPA<span class="sc">+</span><span class="fu">log</span>(libvol)<span class="sc">+</span><span class="fu">log</span>(cost), <span class="at">data=</span>lawsch85)</span></code></pre></div>
<p>We can perform an Anova test on the regression object</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ANOVA table</span></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">Anova</span>(res)</span></code></pre></div>
<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:unnamed-chunk-119">
<caption style="caption-side: top; text-align: center;">(#tab:unnamed-chunk-119) </caption><col><col><col><col><tr>
<th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">Sum Sq</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">Df</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">F value</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">Pr(&gt;F)</th></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1.87&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">5</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">51&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1.17e-28</td></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.0253&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">3.45&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.0655&nbsp;&nbsp;</td></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.000251</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.0342&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.854&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.0143&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1.95&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.165&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">8.21e-06</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.00112</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.973&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.924&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">126</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
</table>

<p>The regression results imply that graduates from the top 100 schools
collect a starting salary which is around 70% higher than those of the
schools below rank 100. This approximation is inaccurate with these
large numbers and the coefficient of 0.7 actually implies a difference
of ex(0.7-1) = 1.103 or 101.3%.</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Robust method (tidyverse)</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Manually redefine the  reference category (back to default):</span></span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>CPS1985 <span class="ot">&lt;-</span> CPS1985 <span class="sc">%&gt;%</span></span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gender =</span> <span class="fu">fct_relevel</span>(gender, <span class="st">&quot;female&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">occupation =</span> <span class="fu">fct_relevel</span>(occupation, <span class="st">&quot;worker&quot;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="fu">log</span>(wage) <span class="sc">~</span> education<span class="sc">+</span>experience<span class="sc">+</span>gender<span class="sc">+</span>occupation, <span class="at">data=</span>CPS1985)</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> <span class="fu">log</span>(wage) <span class="sc">~</span> education <span class="sc">+</span> experience <span class="sc">+</span> gender <span class="sc">+</span> occupation, </span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> CPS1985)</span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a>         (Intercept)             education            experience  </span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.75244</span>               <span class="fl">0.07586</span>               <span class="fl">0.01188</span>  </span>
<span id="cb131-11"><a href="#cb131-11" aria-hidden="true" tabindex="-1"></a>          gendermale  occupationmanagement   occupationtechnical  </span>
<span id="cb131-12"><a href="#cb131-12" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.22385</span>               <span class="fl">0.15254</span>               <span class="fl">0.14246</span>  </span>
<span id="cb131-13"><a href="#cb131-13" aria-hidden="true" tabindex="-1"></a>  occupationservices      occupationoffice       occupationsales  </span>
<span id="cb131-14"><a href="#cb131-14" aria-hidden="true" tabindex="-1"></a>            <span class="sc">-</span><span class="fl">0.21004</span>              <span class="sc">-</span><span class="fl">0.05477</span>              <span class="sc">-</span><span class="fl">0.20757</span>  </span></code></pre></div>
</div>
<div id="breaking-a-numeric-variable-into-categories-1" class="section level4" number="1.3.3.2">
<h4 number="1.3.3.2"><span class="header-section-number">1.3.3.2</span> Breaking a numeric variable into categories</h4>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(lawsch85)</span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(lawsch85<span class="sc">$</span>rank)</span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a> int [<span class="dv">1</span><span class="sc">:</span><span class="dv">156</span>] <span class="dv">128</span> <span class="dv">104</span> <span class="dv">34</span> <span class="dv">49</span> <span class="dv">95</span> <span class="dv">98</span> <span class="dv">124</span> <span class="dv">157</span> <span class="dv">145</span> <span class="dv">91</span> ...</span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define cut points for the rank</span></span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a>cutpts <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">25</span>,<span class="dv">40</span>,<span class="dv">60</span>,<span class="dv">100</span>,<span class="dv">175</span>)</span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create factor variable containing ranges for the rank</span></span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a>lawsch85<span class="sc">$</span>rankcat <span class="ot">&lt;-</span> <span class="fu">cut</span>(lawsch85<span class="sc">$</span>rank, cutpts)</span>
<span id="cb132-9"><a href="#cb132-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-10"><a href="#cb132-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Display frequencies</span></span>
<span id="cb132-11"><a href="#cb132-11" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(lawsch85<span class="sc">$</span>rankcat)</span>
<span id="cb132-12"><a href="#cb132-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-13"><a href="#cb132-13" aria-hidden="true" tabindex="-1"></a>   (<span class="dv">0</span>,<span class="dv">10</span>]   (<span class="dv">10</span>,<span class="dv">25</span>]   (<span class="dv">25</span>,<span class="dv">40</span>]   (<span class="dv">40</span>,<span class="dv">60</span>]  (<span class="dv">60</span>,<span class="dv">100</span>] (<span class="dv">100</span>,<span class="dv">175</span>] </span>
<span id="cb132-14"><a href="#cb132-14" aria-hidden="true" tabindex="-1"></a>       <span class="dv">10</span>        <span class="dv">16</span>        <span class="dv">13</span>        <span class="dv">18</span>        <span class="dv">37</span>        <span class="dv">62</span> </span>
<span id="cb132-15"><a href="#cb132-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-16"><a href="#cb132-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Choose reference category</span></span>
<span id="cb132-17"><a href="#cb132-17" aria-hidden="true" tabindex="-1"></a>lawsch85<span class="sc">$</span>rankcat <span class="ot">&lt;-</span> <span class="fu">relevel</span>(lawsch85<span class="sc">$</span>rankcat,<span class="st">&quot;(100,175]&quot;</span>)</span>
<span id="cb132-18"><a href="#cb132-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-19"><a href="#cb132-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Run regression</span></span>
<span id="cb132-20"><a href="#cb132-20" aria-hidden="true" tabindex="-1"></a>(res <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(salary)<span class="sc">~</span>rankcat<span class="sc">+</span>LSAT<span class="sc">+</span>GPA<span class="sc">+</span><span class="fu">log</span>(libvol)<span class="sc">+</span><span class="fu">log</span>(cost), <span class="at">data=</span>lawsch85))</span>
<span id="cb132-21"><a href="#cb132-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-22"><a href="#cb132-22" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb132-23"><a href="#cb132-23" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> <span class="fu">log</span>(salary) <span class="sc">~</span> rankcat <span class="sc">+</span> LSAT <span class="sc">+</span> GPA <span class="sc">+</span> <span class="fu">log</span>(libvol) <span class="sc">+</span> </span>
<span id="cb132-24"><a href="#cb132-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log</span>(cost), <span class="at">data =</span> lawsch85)</span>
<span id="cb132-25"><a href="#cb132-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-26"><a href="#cb132-26" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb132-27"><a href="#cb132-27" aria-hidden="true" tabindex="-1"></a>    (Intercept)    <span class="fu">rankcat</span>(<span class="dv">0</span>,<span class="dv">10</span>]   <span class="fu">rankcat</span>(<span class="dv">10</span>,<span class="dv">25</span>]   <span class="fu">rankcat</span>(<span class="dv">25</span>,<span class="dv">40</span>]  </span>
<span id="cb132-28"><a href="#cb132-28" aria-hidden="true" tabindex="-1"></a>      <span class="fl">9.1652952</span>        <span class="fl">0.6995659</span>        <span class="fl">0.5935434</span>        <span class="fl">0.3750763</span>  </span>
<span id="cb132-29"><a href="#cb132-29" aria-hidden="true" tabindex="-1"></a> <span class="fu">rankcat</span>(<span class="dv">40</span>,<span class="dv">60</span>]  <span class="fu">rankcat</span>(<span class="dv">60</span>,<span class="dv">100</span>]             LSAT              GPA  </span>
<span id="cb132-30"><a href="#cb132-30" aria-hidden="true" tabindex="-1"></a>      <span class="fl">0.2628191</span>        <span class="fl">0.1315950</span>        <span class="fl">0.0056908</span>        <span class="fl">0.0137255</span>  </span>
<span id="cb132-31"><a href="#cb132-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log</span>(libvol)        <span class="fu">log</span>(cost)  </span>
<span id="cb132-32"><a href="#cb132-32" aria-hidden="true" tabindex="-1"></a>      <span class="fl">0.0363619</span>        <span class="fl">0.0008412</span>  </span>
<span id="cb132-33"><a href="#cb132-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-34"><a href="#cb132-34" aria-hidden="true" tabindex="-1"></a><span class="co"># ANOVA table</span></span>
<span id="cb132-35"><a href="#cb132-35" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">Anova</span>(res)</span></code></pre></div>
<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:unnamed-chunk-122">
<caption style="caption-side: top; text-align: center;">(#tab:unnamed-chunk-122) </caption><col><col><col><col><tr>
<th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">Sum Sq</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">Df</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">F value</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">Pr(&gt;F)</th></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1.87&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">5</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">51&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1.17e-28</td></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.0253&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">3.45&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.0655&nbsp;&nbsp;</td></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.000251</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.0342&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.854&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.0143&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1.95&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.165&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">8.21e-06</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.00112</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.973&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.924&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">126</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
</table>

<p>The regression results imply that graduates from the top 100 schools
collect a starting salary which is around 70% higher than those of the
schools below rank 100. This approximation is inaccurate with these
large numbers and the coefficient of 0.7 actually implies a difference
of ex(0.7-1) = 1.103 or 101.3%.</p>
</div>
</div>
<div id="interactions-and-differences-in-regression-functions-across-groups" class="section level3" number="1.3.4">
<h3 number="1.3.4"><span class="header-section-number">1.3.4</span> Interactions and differences in regression functions across groups</h3>
<p>Dummy variables and factor variables can be interacted just like any
other variable</p>
<ul>
<li>Use the <em>subset</em> option of <code>lm()</code> to directly define the estimation
sample</li>
<li>The dummy variable <em>female</em> is interacted with all other regressor</li>
<li>The F test for all interaction effects is performed using the
function <code>linearHypothesis()</code> from the <strong>car</strong> package</li>
</ul>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(gpa3)</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Model with full interactions with female dummy (only for spring data)</span></span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>reg<span class="ot">&lt;-</span><span class="fu">lm</span>(cumgpa<span class="sc">~</span>female<span class="sc">*</span>(sat<span class="sc">+</span>hsperc<span class="sc">+</span>tothrs), <span class="at">data=</span>gpa3, <span class="at">subset=</span>(spring<span class="sc">==</span><span class="dv">1</span>))</span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(reg)</span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> cumgpa <span class="sc">~</span> female <span class="sc">*</span> (sat <span class="sc">+</span> hsperc <span class="sc">+</span> tothrs), <span class="at">data =</span> gpa3, </span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">subset =</span> (spring <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-11"><a href="#cb133-11" aria-hidden="true" tabindex="-1"></a>Residuals<span class="sc">:</span></span>
<span id="cb133-12"><a href="#cb133-12" aria-hidden="true" tabindex="-1"></a>     Min       1Q   Median       3Q      Max </span>
<span id="cb133-13"><a href="#cb133-13" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">1.51370</span> <span class="sc">-</span><span class="fl">0.28645</span> <span class="sc">-</span><span class="fl">0.02306</span>  <span class="fl">0.27555</span>  <span class="fl">1.24760</span> </span>
<span id="cb133-14"><a href="#cb133-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-15"><a href="#cb133-15" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb133-16"><a href="#cb133-16" aria-hidden="true" tabindex="-1"></a>                Estimate Std. Error t value <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)    </span>
<span id="cb133-17"><a href="#cb133-17" aria-hidden="true" tabindex="-1"></a>(Intercept)    <span class="fl">1.4808117</span>  <span class="fl">0.2073336</span>   <span class="fl">7.142</span> <span class="fl">5.17e-12</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb133-18"><a href="#cb133-18" aria-hidden="true" tabindex="-1"></a>female        <span class="sc">-</span><span class="fl">0.3534862</span>  <span class="fl">0.4105293</span>  <span class="sc">-</span><span class="fl">0.861</span>  <span class="fl">0.38979</span>    </span>
<span id="cb133-19"><a href="#cb133-19" aria-hidden="true" tabindex="-1"></a>sat            <span class="fl">0.0010516</span>  <span class="fl">0.0001811</span>   <span class="fl">5.807</span> <span class="fl">1.40e-08</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb133-20"><a href="#cb133-20" aria-hidden="true" tabindex="-1"></a>hsperc        <span class="sc">-</span><span class="fl">0.0084516</span>  <span class="fl">0.0013704</span>  <span class="sc">-</span><span class="fl">6.167</span> <span class="fl">1.88e-09</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb133-21"><a href="#cb133-21" aria-hidden="true" tabindex="-1"></a>tothrs         <span class="fl">0.0023441</span>  <span class="fl">0.0008624</span>   <span class="fl">2.718</span>  <span class="fl">0.00688</span> <span class="sc">**</span> </span>
<span id="cb133-22"><a href="#cb133-22" aria-hidden="true" tabindex="-1"></a>female<span class="sc">:</span>sat     <span class="fl">0.0007506</span>  <span class="fl">0.0003852</span>   <span class="fl">1.949</span>  <span class="fl">0.05211</span> .  </span>
<span id="cb133-23"><a href="#cb133-23" aria-hidden="true" tabindex="-1"></a>female<span class="sc">:</span>hsperc <span class="sc">-</span><span class="fl">0.0005498</span>  <span class="fl">0.0031617</span>  <span class="sc">-</span><span class="fl">0.174</span>  <span class="fl">0.86206</span>    </span>
<span id="cb133-24"><a href="#cb133-24" aria-hidden="true" tabindex="-1"></a>female<span class="sc">:</span>tothrs <span class="sc">-</span><span class="fl">0.0001158</span>  <span class="fl">0.0016277</span>  <span class="sc">-</span><span class="fl">0.071</span>  <span class="fl">0.94331</span>    </span>
<span id="cb133-25"><a href="#cb133-25" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb133-26"><a href="#cb133-26" aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span>
<span id="cb133-27"><a href="#cb133-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-28"><a href="#cb133-28" aria-hidden="true" tabindex="-1"></a>Residual standard error<span class="sc">:</span> <span class="fl">0.4678</span> on <span class="dv">358</span> degrees of freedom</span>
<span id="cb133-29"><a href="#cb133-29" aria-hidden="true" tabindex="-1"></a>Multiple R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.4059</span>,    Adjusted R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.3943</span> </span>
<span id="cb133-30"><a href="#cb133-30" aria-hidden="true" tabindex="-1"></a>F<span class="sc">-</span>statistic<span class="sc">:</span> <span class="fl">34.95</span> on <span class="dv">7</span> and <span class="dv">358</span> DF,  p<span class="sc">-</span>value<span class="sc">:</span> <span class="er">&lt;</span> <span class="fl">2.2e-16</span></span>
<span id="cb133-31"><a href="#cb133-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-32"><a href="#cb133-32" aria-hidden="true" tabindex="-1"></a><span class="co"># F-Test from package &quot;car&quot;. H0: the interaction coefficients are zero</span></span>
<span id="cb133-33"><a href="#cb133-33" aria-hidden="true" tabindex="-1"></a><span class="co"># matchCoefs(...) selects all coeffs with names containing &quot;female&quot;</span></span>
<span id="cb133-34"><a href="#cb133-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-35"><a href="#cb133-35" aria-hidden="true" tabindex="-1"></a><span class="fu">linearHypothesis</span>(reg, <span class="fu">matchCoefs</span>(reg, <span class="st">&quot;female&quot;</span>))</span></code></pre></div>
<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:unnamed-chunk-123">
<caption style="caption-side: top; text-align: center;">(#tab:unnamed-chunk-123) </caption><col><col><col><col><col><col><tr>
<th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">Res.Df</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">RSS</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">Df</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">Sum of Sq</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">F</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">Pr(&gt;F)</th></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">362</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">85.5</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;"></td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">358</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">78.4</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">4</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">7.16</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">8.18</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">2.54e-06</td></tr>
</table>

<p>As the p-value is much less than 0.05, we reject the null that the
interaction with female dummy is statistically insignificant.</p>
<div id="visualizing-coefficients" class="section level4" number="1.3.4.1">
<h4 number="1.3.4.1"><span class="header-section-number">1.3.4.1</span> Visualizing coefficients</h4>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>treg <span class="ot">&lt;-</span> <span class="fu">tidy</span>(reg, <span class="at">conf.int =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(treg, <span class="fu">aes</span>(estimate, term, <span class="at">color =</span> term)) <span class="sc">+</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbarh</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> conf.low, <span class="at">xmax =</span> conf.high))  <span class="sc">+</span></span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MEM5220_R_files/figure-html/fig17-1.png" alt="Coefficient plots" width="80%" />
<p class="caption">
(#fig:fig17)Coefficient plots
</p>
</div>
<p>To recap, the general form in which we specify regression models in R:</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="do">## response ~ terms</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a><span class="do">## y ~ age + sex            # age + sex main effects</span></span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a><span class="do">## y ~ age + sex + age:sex  # add second-order interaction</span></span>
<span id="cb136-5"><a href="#cb136-5" aria-hidden="true" tabindex="-1"></a><span class="do">## y ~ age*sex              # second-order interaction +</span></span>
<span id="cb136-6"><a href="#cb136-6" aria-hidden="true" tabindex="-1"></a><span class="do">##                          # all main effects</span></span>
<span id="cb136-7"><a href="#cb136-7" aria-hidden="true" tabindex="-1"></a><span class="do">## y ~ (age + sex + pressure)^2</span></span>
<span id="cb136-8"><a href="#cb136-8" aria-hidden="true" tabindex="-1"></a><span class="do">##                          # age+sex+pressure+age:sex+age:pressure...</span></span>
<span id="cb136-9"><a href="#cb136-9" aria-hidden="true" tabindex="-1"></a><span class="do">## y ~ (age + sex + pressure)^2 - sex:pressure</span></span>
<span id="cb136-10"><a href="#cb136-10" aria-hidden="true" tabindex="-1"></a><span class="do">##                          # all main effects and all 2nd order</span></span>
<span id="cb136-11"><a href="#cb136-11" aria-hidden="true" tabindex="-1"></a><span class="do">##                          # interactions except sex:pressure</span></span>
<span id="cb136-12"><a href="#cb136-12" aria-hidden="true" tabindex="-1"></a><span class="do">## y ~ (age + race)*sex     # age+race+sex+age:sex+race:sex</span></span>
<span id="cb136-13"><a href="#cb136-13" aria-hidden="true" tabindex="-1"></a><span class="do">## y ~ treatment*(age*race + age*sex) # no interact. with race,sex</span></span>
<span id="cb136-14"><a href="#cb136-14" aria-hidden="true" tabindex="-1"></a><span class="do">## sqrt(y) ~ sex*sqrt(age) + race</span></span>
<span id="cb136-15"><a href="#cb136-15" aria-hidden="true" tabindex="-1"></a><span class="do">## # functions, with dummy variables generated if</span></span>
<span id="cb136-16"><a href="#cb136-16" aria-hidden="true" tabindex="-1"></a><span class="do">## # race is an R factor (classification) variable</span></span>
<span id="cb136-17"><a href="#cb136-17" aria-hidden="true" tabindex="-1"></a><span class="do">## y ~ sex + poly(age,2)    # poly generates orthogonal polynomials</span></span>
<span id="cb136-18"><a href="#cb136-18" aria-hidden="true" tabindex="-1"></a><span class="do">## race.sex &lt;- interaction(race,sex)</span></span>
<span id="cb136-19"><a href="#cb136-19" aria-hidden="true" tabindex="-1"></a><span class="do">## y ~ age + race.sex       # for when you want dummy variables for</span></span>
<span id="cb136-20"><a href="#cb136-20" aria-hidden="true" tabindex="-1"></a><span class="do">##                          # all combinations of the factors</span></span></code></pre></div>
</div>
</div>
</div>
<div id="statistical-significance" class="section level2" number="1.4">
<h2 number="1.4"><span class="header-section-number">1.4</span> Statistical significance</h2>
<p>Selecting your results based on significance means that you’re biasing
yourself! Especially in small samples/cases of weak power, significant
results are heavily overstated.</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>reg_return <span class="ot">&lt;-</span> <span class="cf">function</span>(N) {</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Choose effect size</span></span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>  fx <span class="ot">&lt;-</span> .<span class="dv">05</span></span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">runif</span>(N) <span class="sc">&gt;</span> .<span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fu">runif</span>(N)<span class="sc">+</span>fx<span class="sc">*</span>x <span class="sc">&gt;</span> .<span class="dv">5</span>)</span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-9"><a href="#cb137-9" aria-hidden="true" tabindex="-1"></a>  m <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span>x, <span class="at">data =</span> df)</span>
<span id="cb137-10"><a href="#cb137-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-11"><a href="#cb137-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">beta =</span> m<span class="sc">$</span>coefficients[[<span class="dv">2</span>]], <span class="at">p =</span> <span class="fu">tidy</span>(<span class="fu">summary</span>(m))<span class="sc">$</span>p.value[<span class="dv">2</span>]))</span>
<span id="cb137-12"><a href="#cb137-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb137-13"><a href="#cb137-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-14"><a href="#cb137-14" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">N =</span> (<span class="dv">2</span><span class="sc">:</span><span class="dv">200</span>)<span class="sc">*</span><span class="dv">5</span>,<span class="at">iter =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>) <span class="sc">%&gt;%</span></span>
<span id="cb137-15"><a href="#cb137-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">regs =</span> <span class="fu">map</span>(N, reg_return)) <span class="sc">%&gt;%</span></span>
<span id="cb137-16"><a href="#cb137-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Difference =</span> <span class="fu">map_dbl</span>(regs,<span class="st">&quot;beta&quot;</span>),</span>
<span id="cb137-17"><a href="#cb137-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">p =</span> <span class="fu">map_dbl</span>(regs,<span class="st">&quot;p&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb137-18"><a href="#cb137-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Significant =</span> <span class="fu">ifelse</span>(p <span class="sc">&lt;=</span> .<span class="dv">05</span>,<span class="st">&quot;Sig. at 95%&quot;</span>,<span class="st">&quot;Insig.&quot;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(res, <span class="fu">aes</span>(<span class="at">x =</span> N, <span class="at">y =</span> Difference, <span class="at">color =</span> Significant)) <span class="sc">+</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="st">&#39;jitter&#39;</span>)<span class="sc">+</span></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()<span class="sc">+</span></span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> .<span class="dv">05</span>),<span class="at">linetype =</span> <span class="st">&#39;dashed&#39;</span>,<span class="at">color =</span> <span class="st">&#39;black&#39;</span>) <span class="sc">+</span></span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">85</span>, .<span class="dv">85</span>),</span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&#39;black&#39;</span>)) <span class="sc">+</span></span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Sample Size&quot;</span>,</span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Estimated Treatment vs. Control Difference&quot;</span>,</span>
<span id="cb138-9"><a href="#cb138-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Estimated Effect of Treatment by Sample Size&quot;</span>,</span>
<span id="cb138-10"><a href="#cb138-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Outcome, treatment both binary with mean .5. True treatment effect is .05&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>resbig <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">N =</span> <span class="dv">10000</span>,<span class="at">iter =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">380</span>) <span class="sc">%&gt;%</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">regs =</span> <span class="fu">map</span>(N, reg_return)) <span class="sc">%&gt;%</span></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Difference =</span> <span class="fu">map_dbl</span>(regs,<span class="st">&quot;beta&quot;</span>),</span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">p =</span> <span class="fu">map_dbl</span>(regs,<span class="st">&quot;p&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Significant =</span> <span class="fu">ifelse</span>(p <span class="sc">&lt;=</span> .<span class="dv">05</span>,<span class="st">&quot;Sig. at 95%&quot;</span>,<span class="st">&quot;Insig.&quot;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>sigonly <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>  resbig <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(Significant <span class="sc">==</span> <span class="st">&quot;Sig. at 95%&quot;</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">size =</span> <span class="st">&quot;10,000&quot;</span>),</span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>  res <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(N <span class="sc">&lt;=</span> <span class="dv">100</span>, Significant <span class="sc">==</span> <span class="st">&quot;Sig. at 95%&quot;</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">size =</span> <span class="st">&quot;10-100&quot;</span>),</span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>  res <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(dplyr<span class="sc">::</span><span class="fu">between</span>(N,<span class="dv">750</span>,<span class="dv">1000</span>), Significant <span class="sc">==</span> <span class="st">&quot;Sig. at 95%&quot;</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">size =</span> <span class="st">&quot;750-1,000&quot;</span>)</span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Sample.Size =</span> <span class="fu">factor</span>(size, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;10-100&quot;</span>,<span class="st">&quot;750-1,000&quot;</span>,<span class="st">&quot;10,000&quot;</span>)))</span></code></pre></div>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>means <span class="ot">&lt;-</span>  sigonly <span class="sc">%&gt;%</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Sample.Size) <span class="sc">%&gt;%</span></span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarize</span>(<span class="at">m =</span> <span class="fu">mean</span>(Difference)) <span class="sc">%&gt;%</span></span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(m) <span class="sc">%&gt;%</span></span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(sigonly <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(dplyr<span class="sc">::</span><span class="fu">between</span>(Difference,<span class="sc">-</span>.<span class="dv">1</span>,.<span class="dv">5</span>)), <span class="fu">aes</span>(<span class="at">x =</span> Difference, <span class="at">color =</span> Sample.Size)) <span class="sc">+</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_density</span>(<span class="at">geom=</span><span class="st">&#39;line&#39;</span>,<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()<span class="sc">+</span></span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> .<span class="dv">05</span>),<span class="at">linetype =</span> <span class="st">&#39;dashed&#39;</span>,<span class="at">color =</span> <span class="st">&#39;black&#39;</span>) <span class="sc">+</span></span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">85</span>, .<span class="dv">85</span>),</span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">&#39;black&#39;</span>)) <span class="sc">+</span></span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Estimated Difference&quot;</span>,</span>
<span id="cb142-8"><a href="#cb142-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Density&quot;</span>,</span>
<span id="cb142-9"><a href="#cb142-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Distribution of Significant Estimates by Sample Size&quot;</span>,</span>
<span id="cb142-10"><a href="#cb142-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Only includes results sig. at 95%, to demonstrate effects of selected reporting.</span><span class="sc">\n</span><span class="st">Differences outside [-.1,.5] omitted for clarity.&quot;</span>) <span class="sc">+</span></span>
<span id="cb142-11"><a href="#cb142-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>,</span>
<span id="cb142-12"><a href="#cb142-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">&quot;Mean&quot;</span>,means), <span class="at">x =</span> <span class="fu">c</span>(.<span class="dv">275</span>,.<span class="dv">15</span>,<span class="sc">-</span>.<span class="dv">02</span>), <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">7</span>,<span class="dv">18</span>,<span class="dv">35</span>))</span></code></pre></div>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(p1, p2,</span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="MEM5220_R_files/figure-html/unnamed-chunk-132-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="heteroskedasticity" class="section level2" number="1.5">
<h2 number="1.5"><span class="header-section-number">1.5</span> Heteroskedasticity</h2>
<p>The homoskedasticity assumptions SLR.5 and MLR.5 require that the
variance of the error term is unrelated to the regressors, i.e.</p>
<span class="math display">\[\begin{equation}
Var(u|x_1, \dots , x_n) = \sigma^2
\end{equation}\]</span>
<p>Unbiasedness and consistency do not depend on this assumption, but the
sampling distribution does. If homoskedasticity is violated, the
standard errors are invalid and all inferences from <span class="math inline">\(t\)</span>, <span class="math inline">\(F\)</span>, and other
tests based on them are unreliable.</p>
<p>There are various ways of dealing with heteroskedasticity in R. The
<strong>car</strong> package provides linear hypothesis. For high-dimensional fixed
effects the <strong>lfe</strong> package is a good alternative. It also allows to
specify clusters as part of the formula. A good balance between
functionality and ease of use is provided by the <strong>sandwich</strong> package
<span class="citation"><a href="#ref-Zeileis2017" role="doc-biblioref">Zeileis et al.</a> (<a href="#ref-Zeileis2017" role="doc-biblioref">2017</a>)</span>.</p>
<div id="spotting-heteroskedasticity-in-scatter-plots" class="section level3" number="1.5.1">
<h3 number="1.5.1"><span class="header-section-number">1.5.1</span> Spotting Heteroskedasticity in Scatter Plots</h3>
<p>Simulate some heteroskedastic data:</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set seed for reproducibility</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>) </span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a><span class="co"># set up vector of x coordinates</span></span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">25</span>), <span class="at">each =</span> <span class="dv">25</span>)</span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize vector of errors</span></span>
<span id="cb144-8"><a href="#cb144-8" aria-hidden="true" tabindex="-1"></a>e <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb144-9"><a href="#cb144-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-10"><a href="#cb144-10" aria-hidden="true" tabindex="-1"></a><span class="co"># sample 100 errors such that the variance increases with x</span></span>
<span id="cb144-11"><a href="#cb144-11" aria-hidden="true" tabindex="-1"></a>e[<span class="dv">1</span><span class="sc">:</span><span class="dv">25</span>] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">25</span>, <span class="at">sd =</span> <span class="dv">10</span>)</span>
<span id="cb144-12"><a href="#cb144-12" aria-hidden="true" tabindex="-1"></a>e[<span class="dv">26</span><span class="sc">:</span><span class="dv">50</span>] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">25</span>, <span class="at">sd =</span> <span class="dv">15</span>)</span>
<span id="cb144-13"><a href="#cb144-13" aria-hidden="true" tabindex="-1"></a>e[<span class="dv">51</span><span class="sc">:</span><span class="dv">75</span>] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">25</span>, <span class="at">sd =</span> <span class="dv">20</span>)</span>
<span id="cb144-14"><a href="#cb144-14" aria-hidden="true" tabindex="-1"></a>e[<span class="dv">76</span><span class="sc">:</span><span class="dv">100</span>] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">25</span>, <span class="at">sd =</span> <span class="dv">25</span>)</span>
<span id="cb144-15"><a href="#cb144-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-16"><a href="#cb144-16" aria-hidden="true" tabindex="-1"></a><span class="co"># set up y</span></span>
<span id="cb144-17"><a href="#cb144-17" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">720</span> <span class="sc">-</span> <span class="fl">3.3</span> <span class="sc">*</span> x <span class="sc">+</span> e</span>
<span id="cb144-18"><a href="#cb144-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-19"><a href="#cb144-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate the model </span></span>
<span id="cb144-20"><a href="#cb144-20" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x)</span></code></pre></div>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the data</span></span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> x, </span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">y =</span> y, </span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;An Example of Heteroskedasticity&quot;</span>,</span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Student-Teacher Ratio&quot;</span>,</span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Test Score&quot;</span>,</span>
<span id="cb145-7"><a href="#cb145-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> <span class="fl">0.5</span>, </span>
<span id="cb145-8"><a href="#cb145-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">19</span>, </span>
<span id="cb145-9"><a href="#cb145-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">27</span>), </span>
<span id="cb145-10"><a href="#cb145-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">600</span>, <span class="dv">710</span>))</span>
<span id="cb145-11"><a href="#cb145-11" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(mod, <span class="at">col =</span> <span class="st">&quot;darkred&quot;</span>)</span>
<span id="cb145-12"><a href="#cb145-12" aria-hidden="true" tabindex="-1"></a> <span class="fu">boxplot</span>(<span class="at">formula =</span> y <span class="sc">~</span> x, </span>
<span id="cb145-13"><a href="#cb145-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">add =</span> <span class="cn">TRUE</span>, </span>
<span id="cb145-14"><a href="#cb145-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">at =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">25</span>), </span>
<span id="cb145-15"><a href="#cb145-15" aria-hidden="true" tabindex="-1"></a><span class="co">#         col = alpha(&quot;gray&quot;, 0.4), </span></span>
<span id="cb145-16"><a href="#cb145-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">border =</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb145-17"><a href="#cb145-17" aria-hidden="true" tabindex="-1"></a>         )</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MEM5220_R_files/figure-html/unnamed-chunk-134-1.png" alt="Simulating heteroskedastic data" width="80%" />
<p class="caption">
(#fig:unnamed-chunk-134)Simulating heteroskedastic data
</p>
</div>
<p>Spotting heteroskedasticity in real world data</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;CPSSWEducation&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>labor_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(earnings <span class="sc">~</span> education, <span class="at">data =</span> CPSSWEducation)</span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(CPSSWEducation<span class="sc">$</span>education, </span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>     CPSSWEducation<span class="sc">$</span>earnings,</span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;education&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;earnings&quot;</span>,</span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">150</span>))</span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-7"><a href="#cb147-7" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(labor_model, </span>
<span id="cb147-8"><a href="#cb147-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">&quot;steelblue&quot;</span>, </span>
<span id="cb147-9"><a href="#cb147-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MEM5220_R_files/figure-html/fig18-1.png" alt="Heteroskedasticity in the ‘education’ data" width="80%" />
<p class="caption">
(#fig:fig18)Heteroskedasticity in the ‘education’ data
</p>
</div>
<p>Another useful method to visualize possible heteroskedasticity is to
plot the residuals against the regressors suspected of creating
heteroskedasticity, or, more generally, against the fitted values of the
regression.</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">residuals</span>(labor_model)</span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>yhat <span class="ot">&lt;-</span> <span class="fu">fitted</span>(labor_model)</span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(CPSSWEducation<span class="sc">$</span>education,res, <span class="at">xlab=</span><span class="st">&quot;education&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;residuals&quot;</span>)</span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(yhat,res, <span class="at">xlab=</span><span class="st">&quot;fitted values&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;residuals&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MEM5220_R_files/figure-html/fig19-1.png" alt="Residual plots in the ‘labor’ model " width="80%" /><img src="MEM5220_R_files/figure-html/fig19-2.png" alt="Residual plots in the ‘labor’ model " width="80%" />
<p class="caption">
(#fig:fig19)Residual plots in the ‘labor’ model
</p>
</div>
</div>
<div id="heteroskedasticity-tests" class="section level3" number="1.5.2">
<h3 number="1.5.2"><span class="header-section-number">1.5.2</span> Heteroskedasticity Tests</h3>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(gpa3, <span class="at">package=</span><span class="st">&#39;wooldridge&#39;</span>)</span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate model (only for spring data)</span></span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a>reg <span class="ot">&lt;-</span> <span class="fu">lm</span>(cumgpa<span class="sc">~</span>sat<span class="sc">+</span>hsperc<span class="sc">+</span>tothrs<span class="sc">+</span>female<span class="sc">+</span>black<span class="sc">+</span>white,</span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">data=</span>gpa3, <span class="at">subset=</span>(spring<span class="sc">==</span><span class="dv">1</span>))</span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-9"><a href="#cb149-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Breusch-Pagan (BP) Test</span></span>
<span id="cb149-10"><a href="#cb149-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-11"><a href="#cb149-11" aria-hidden="true" tabindex="-1"></a><span class="fu">bptest</span>(reg)</span>
<span id="cb149-12"><a href="#cb149-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-13"><a href="#cb149-13" aria-hidden="true" tabindex="-1"></a>    studentized Breusch<span class="sc">-</span>Pagan test</span>
<span id="cb149-14"><a href="#cb149-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-15"><a href="#cb149-15" aria-hidden="true" tabindex="-1"></a>data<span class="sc">:</span>  reg</span>
<span id="cb149-16"><a href="#cb149-16" aria-hidden="true" tabindex="-1"></a>BP <span class="ot">=</span> <span class="fl">44.557</span>, df <span class="ot">=</span> <span class="dv">6</span>, p<span class="sc">-</span>value <span class="ot">=</span> <span class="fl">5.732e-08</span></span></code></pre></div>
<p>The R function that does this job is <code>hccm()</code>, which is part of the car
package and yields a heteroskedasticity-robust coefficient covariance
matrix. This matrix can then be used with other functions, such as
<code>coeftest()</code> (instead of summary), <code>waldtest()</code> (instead of anova), or
<code>linearHypothesis()</code> to perform hypothesis testing. The function
<code>hccm()</code> takes several arguments, among which is the model for which we
want the robust standard errors and the type of standard errors we wish
to calculate.</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Usual SE:</span></span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(reg)</span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a>t test of coefficients<span class="sc">:</span></span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a>               Estimate  Std. Error t value  <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)    </span>
<span id="cb150-7"><a href="#cb150-7" aria-hidden="true" tabindex="-1"></a>(Intercept)  <span class="fl">1.47006477</span>  <span class="fl">0.22980308</span>  <span class="fl">6.3971</span> <span class="fl">4.942e-10</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb150-8"><a href="#cb150-8" aria-hidden="true" tabindex="-1"></a>sat          <span class="fl">0.00114073</span>  <span class="fl">0.00017856</span>  <span class="fl">6.3885</span> <span class="fl">5.197e-10</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb150-9"><a href="#cb150-9" aria-hidden="true" tabindex="-1"></a>hsperc      <span class="sc">-</span><span class="fl">0.00856636</span>  <span class="fl">0.00124042</span> <span class="sc">-</span><span class="fl">6.9060</span> <span class="fl">2.275e-11</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb150-10"><a href="#cb150-10" aria-hidden="true" tabindex="-1"></a>tothrs       <span class="fl">0.00250400</span>  <span class="fl">0.00073099</span>  <span class="fl">3.4255</span> <span class="fl">0.0006847</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb150-11"><a href="#cb150-11" aria-hidden="true" tabindex="-1"></a>female       <span class="fl">0.30343329</span>  <span class="fl">0.05902033</span>  <span class="fl">5.1412</span> <span class="fl">4.497e-07</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb150-12"><a href="#cb150-12" aria-hidden="true" tabindex="-1"></a>black       <span class="sc">-</span><span class="fl">0.12828368</span>  <span class="fl">0.14737012</span> <span class="sc">-</span><span class="fl">0.8705</span> <span class="fl">0.3846164</span>    </span>
<span id="cb150-13"><a href="#cb150-13" aria-hidden="true" tabindex="-1"></a>white       <span class="sc">-</span><span class="fl">0.05872173</span>  <span class="fl">0.14098956</span> <span class="sc">-</span><span class="fl">0.4165</span> <span class="fl">0.6772953</span>    </span>
<span id="cb150-14"><a href="#cb150-14" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb150-15"><a href="#cb150-15" aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span>
<span id="cb150-16"><a href="#cb150-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-17"><a href="#cb150-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Refined White heteroscedasticity-robust SE:</span></span>
<span id="cb150-18"><a href="#cb150-18" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(reg, <span class="at">vcov=</span>hccm)</span>
<span id="cb150-19"><a href="#cb150-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-20"><a href="#cb150-20" aria-hidden="true" tabindex="-1"></a>t test of coefficients<span class="sc">:</span></span>
<span id="cb150-21"><a href="#cb150-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-22"><a href="#cb150-22" aria-hidden="true" tabindex="-1"></a>               Estimate  Std. Error t value  <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)    </span>
<span id="cb150-23"><a href="#cb150-23" aria-hidden="true" tabindex="-1"></a>(Intercept)  <span class="fl">1.47006477</span>  <span class="fl">0.22938036</span>  <span class="fl">6.4089</span> <span class="fl">4.611e-10</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb150-24"><a href="#cb150-24" aria-hidden="true" tabindex="-1"></a>sat          <span class="fl">0.00114073</span>  <span class="fl">0.00019532</span>  <span class="fl">5.8402</span> <span class="fl">1.169e-08</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb150-25"><a href="#cb150-25" aria-hidden="true" tabindex="-1"></a>hsperc      <span class="sc">-</span><span class="fl">0.00856636</span>  <span class="fl">0.00144359</span> <span class="sc">-</span><span class="fl">5.9341</span> <span class="fl">6.963e-09</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb150-26"><a href="#cb150-26" aria-hidden="true" tabindex="-1"></a>tothrs       <span class="fl">0.00250400</span>  <span class="fl">0.00074930</span>  <span class="fl">3.3418</span>   <span class="fl">0.00092</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb150-27"><a href="#cb150-27" aria-hidden="true" tabindex="-1"></a>female       <span class="fl">0.30343329</span>  <span class="fl">0.06003964</span>  <span class="fl">5.0539</span> <span class="fl">6.911e-07</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb150-28"><a href="#cb150-28" aria-hidden="true" tabindex="-1"></a>black       <span class="sc">-</span><span class="fl">0.12828368</span>  <span class="fl">0.12818828</span> <span class="sc">-</span><span class="fl">1.0007</span>   <span class="fl">0.31762</span>    </span>
<span id="cb150-29"><a href="#cb150-29" aria-hidden="true" tabindex="-1"></a>white       <span class="sc">-</span><span class="fl">0.05872173</span>  <span class="fl">0.12043522</span> <span class="sc">-</span><span class="fl">0.4876</span>   <span class="fl">0.62615</span>    </span>
<span id="cb150-30"><a href="#cb150-30" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb150-31"><a href="#cb150-31" aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span>
<span id="cb150-32"><a href="#cb150-32" aria-hidden="true" tabindex="-1"></a>cov3 <span class="ot">&lt;-</span> <span class="fu">hccm</span>(reg, <span class="at">type=</span><span class="st">&quot;hc3&quot;</span>) <span class="co"># hc3 is the standard method</span></span>
<span id="cb150-33"><a href="#cb150-33" aria-hidden="true" tabindex="-1"></a>ref.HC3 <span class="ot">&lt;-</span> <span class="fu">coeftest</span>(reg, <span class="at">vcov.=</span>cov3)</span>
<span id="cb150-34"><a href="#cb150-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-35"><a href="#cb150-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Supply other White corrections</span></span>
<span id="cb150-36"><a href="#cb150-36" aria-hidden="true" tabindex="-1"></a>cov1 <span class="ot">&lt;-</span> <span class="fu">hccm</span>(reg, <span class="at">type=</span><span class="st">&quot;hc1&quot;</span>)</span>
<span id="cb150-37"><a href="#cb150-37" aria-hidden="true" tabindex="-1"></a>ref.HC1 <span class="ot">&lt;-</span> <span class="fu">coeftest</span>(reg, <span class="at">vcov.=</span>cov1)</span></code></pre></div>
<p>Another way of dealing with heteroskedasticity is to use the <code>lmrob()</code>
function from the <strong>robustbase</strong> package<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a>. This package is quite
interesting, and offers quite a lot of functions for robust linear, and
nonlinear, regression models. Running a robust linear regression is just
the same as with <code>lm()</code>:</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>regrobfit <span class="ot">&lt;-</span> <span class="fu">lmrob</span>(cumgpa<span class="sc">~</span>sat<span class="sc">+</span>hsperc<span class="sc">+</span>tothrs<span class="sc">+</span>female<span class="sc">+</span>black<span class="sc">+</span>white,</span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data=</span>gpa3, <span class="at">subset=</span>(spring<span class="sc">==</span><span class="dv">1</span>))</span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(regrobfit)</span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb151-7"><a href="#cb151-7" aria-hidden="true" tabindex="-1"></a><span class="fu">lmrob</span>(<span class="at">formula =</span> cumgpa <span class="sc">~</span> sat <span class="sc">+</span> hsperc <span class="sc">+</span> tothrs <span class="sc">+</span> female <span class="sc">+</span> black <span class="sc">+</span> white, </span>
<span id="cb151-8"><a href="#cb151-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> gpa3, <span class="at">subset =</span> (spring <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb151-9"><a href="#cb151-9" aria-hidden="true" tabindex="-1"></a> \<span class="sc">-</span><span class="ot">-&gt;</span> method <span class="ot">=</span> <span class="st">&quot;MM&quot;</span></span>
<span id="cb151-10"><a href="#cb151-10" aria-hidden="true" tabindex="-1"></a>Residuals<span class="sc">:</span></span>
<span id="cb151-11"><a href="#cb151-11" aria-hidden="true" tabindex="-1"></a>     Min       1Q   Median       3Q      Max </span>
<span id="cb151-12"><a href="#cb151-12" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">1.57535</span> <span class="sc">-</span><span class="fl">0.30124</span> <span class="sc">-</span><span class="fl">0.02834</span>  <span class="fl">0.26687</span>  <span class="fl">1.27950</span> </span>
<span id="cb151-13"><a href="#cb151-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-14"><a href="#cb151-14" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb151-15"><a href="#cb151-15" aria-hidden="true" tabindex="-1"></a>              Estimate Std. Error t value <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)    </span>
<span id="cb151-16"><a href="#cb151-16" aria-hidden="true" tabindex="-1"></a>(Intercept)  <span class="fl">1.4693758</span>  <span class="fl">0.2315018</span>   <span class="fl">6.347</span> <span class="fl">6.62e-10</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb151-17"><a href="#cb151-17" aria-hidden="true" tabindex="-1"></a>sat          <span class="fl">0.0011185</span>  <span class="fl">0.0001953</span>   <span class="fl">5.727</span> <span class="fl">2.17e-08</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb151-18"><a href="#cb151-18" aria-hidden="true" tabindex="-1"></a>hsperc      <span class="sc">-</span><span class="fl">0.0079056</span>  <span class="fl">0.0014293</span>  <span class="sc">-</span><span class="fl">5.531</span> <span class="fl">6.14e-08</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb151-19"><a href="#cb151-19" aria-hidden="true" tabindex="-1"></a>tothrs       <span class="fl">0.0021841</span>  <span class="fl">0.0007750</span>   <span class="fl">2.818</span>   <span class="fl">0.0051</span> <span class="sc">**</span> </span>
<span id="cb151-20"><a href="#cb151-20" aria-hidden="true" tabindex="-1"></a>female       <span class="fl">0.3002542</span>  <span class="fl">0.0599150</span>   <span class="fl">5.011</span> <span class="fl">8.50e-07</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb151-21"><a href="#cb151-21" aria-hidden="true" tabindex="-1"></a>black       <span class="sc">-</span><span class="fl">0.1281927</span>  <span class="fl">0.1268974</span>  <span class="sc">-</span><span class="fl">1.010</span>   <span class="fl">0.3131</span>    </span>
<span id="cb151-22"><a href="#cb151-22" aria-hidden="true" tabindex="-1"></a>white       <span class="sc">-</span><span class="fl">0.0305168</span>  <span class="fl">0.1181863</span>  <span class="sc">-</span><span class="fl">0.258</span>   <span class="fl">0.7964</span>    </span>
<span id="cb151-23"><a href="#cb151-23" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb151-24"><a href="#cb151-24" aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span>
<span id="cb151-25"><a href="#cb151-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-26"><a href="#cb151-26" aria-hidden="true" tabindex="-1"></a>Robust residual standard error<span class="sc">:</span> <span class="fl">0.4201</span> </span>
<span id="cb151-27"><a href="#cb151-27" aria-hidden="true" tabindex="-1"></a>Multiple R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.411</span>, Adjusted R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.4012</span> </span>
<span id="cb151-28"><a href="#cb151-28" aria-hidden="true" tabindex="-1"></a>Convergence <span class="cf">in</span> <span class="dv">15</span> IRWLS iterations</span>
<span id="cb151-29"><a href="#cb151-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-30"><a href="#cb151-30" aria-hidden="true" tabindex="-1"></a>Robustness weights<span class="sc">:</span> </span>
<span id="cb151-31"><a href="#cb151-31" aria-hidden="true" tabindex="-1"></a> <span class="dv">22</span> weights are <span class="sc">~</span><span class="er">=</span> <span class="fl">1.</span> The remaining <span class="dv">344</span> ones are summarized as</span>
<span id="cb151-32"><a href="#cb151-32" aria-hidden="true" tabindex="-1"></a>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span id="cb151-33"><a href="#cb151-33" aria-hidden="true" tabindex="-1"></a> <span class="fl">0.1291</span>  <span class="fl">0.8670</span>  <span class="fl">0.9471</span>  <span class="fl">0.8933</span>  <span class="fl">0.9854</span>  <span class="fl">0.9987</span> </span>
<span id="cb151-34"><a href="#cb151-34" aria-hidden="true" tabindex="-1"></a>Algorithmic parameters<span class="sc">:</span> </span>
<span id="cb151-35"><a href="#cb151-35" aria-hidden="true" tabindex="-1"></a>       tuning.chi                bb        tuning.psi        refine.tol </span>
<span id="cb151-36"><a href="#cb151-36" aria-hidden="true" tabindex="-1"></a>        <span class="fl">1.548e+00</span>         <span class="fl">5.000e-01</span>         <span class="fl">4.685e+00</span>         <span class="fl">1.000e-07</span> </span>
<span id="cb151-37"><a href="#cb151-37" aria-hidden="true" tabindex="-1"></a>          rel.tol         scale.tol         solve.tol       eps.outlier </span>
<span id="cb151-38"><a href="#cb151-38" aria-hidden="true" tabindex="-1"></a>        <span class="fl">1.000e-07</span>         <span class="fl">1.000e-10</span>         <span class="fl">1.000e-07</span>         <span class="fl">2.732e-04</span> </span>
<span id="cb151-39"><a href="#cb151-39" aria-hidden="true" tabindex="-1"></a>            eps.x warn.limit.reject warn.limit.meanrw </span>
<span id="cb151-40"><a href="#cb151-40" aria-hidden="true" tabindex="-1"></a>        <span class="fl">2.601e-09</span>         <span class="fl">5.000e-01</span>         <span class="fl">5.000e-01</span> </span>
<span id="cb151-41"><a href="#cb151-41" aria-hidden="true" tabindex="-1"></a>     nResample         max.it       best.r.s       k.fast.s          k.max </span>
<span id="cb151-42"><a href="#cb151-42" aria-hidden="true" tabindex="-1"></a>           <span class="dv">500</span>             <span class="dv">50</span>              <span class="dv">2</span>              <span class="dv">1</span>            <span class="dv">200</span> </span>
<span id="cb151-43"><a href="#cb151-43" aria-hidden="true" tabindex="-1"></a>   maxit.scale      trace.lev            mts     compute.rd fast.s.large.n </span>
<span id="cb151-44"><a href="#cb151-44" aria-hidden="true" tabindex="-1"></a>           <span class="dv">200</span>              <span class="dv">0</span>           <span class="dv">1000</span>              <span class="dv">0</span>           <span class="dv">2000</span> </span>
<span id="cb151-45"><a href="#cb151-45" aria-hidden="true" tabindex="-1"></a>                  psi           subsampling                   cov </span>
<span id="cb151-46"><a href="#cb151-46" aria-hidden="true" tabindex="-1"></a>           <span class="st">&quot;bisquare&quot;</span>         <span class="st">&quot;nonsingular&quot;</span>         <span class="st">&quot;.vcov.avar1&quot;</span> </span>
<span id="cb151-47"><a href="#cb151-47" aria-hidden="true" tabindex="-1"></a>compute.outlier.stats </span>
<span id="cb151-48"><a href="#cb151-48" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&quot;SM&quot;</span> </span>
<span id="cb151-49"><a href="#cb151-49" aria-hidden="true" tabindex="-1"></a>seed <span class="sc">:</span> <span class="fu">int</span>(<span class="dv">0</span>) </span></code></pre></div>
<p>This however, gives you different estimates than when fitting a linear
regression model. The estimates should be the same, only the standard
errors should be different. This is because the estimation method is
different, and is also robust to outlines (at least that’s my
understanding, I haven’t read the theoretical papers behind the package
yet).</p>
<p>Finally, it is also possible to bootstrap the standard errors. For this
I will use the <code>bootstrap()</code> function from the modelr package:</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>resamples <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>boot_gpa3 <span class="ot">&lt;-</span> gpa3 <span class="sc">%&gt;%</span></span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a>  modelr<span class="sc">::</span><span class="fu">bootstrap</span>(resamples)</span></code></pre></div>
<p>The column strap contains resamples of the original data. I will run my
linear regression from before on each of the resamples:</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>boot_lin_reg <span class="ot">&lt;-</span> boot_gpa3 <span class="sc">%&gt;%</span></span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">regressions =</span></span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a>           <span class="fu">map</span>(strap,</span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a>               <span class="sc">~</span><span class="fu">lm</span>(cumgpa<span class="sc">~</span>sat<span class="sc">+</span>hsperc<span class="sc">+</span>tothrs<span class="sc">+</span>female<span class="sc">+</span>black<span class="sc">+</span>white,</span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">data=</span> . , <span class="at">subset=</span>(spring<span class="sc">==</span><span class="dv">1</span>)))</span>
<span id="cb153-7"><a href="#cb153-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>We have added a new column called regressions which contains the linear
regressions on each bootstrapped sample. Now, I will create a list of
tidied regression results:</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>tidied <span class="ot">&lt;-</span> boot_lin_reg <span class="sc">%&gt;%</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tidy_lm =</span></span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a>           <span class="fu">map</span>(regressions, broom<span class="sc">::</span>tidy))</span></code></pre></div>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>tidied<span class="sc">$</span>tidy_lm[[<span class="dv">1</span>]]</span></code></pre></div>
<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:unnamed-chunk-142">
<caption style="caption-side: top; text-align: center;">(#tab:unnamed-chunk-142) </caption><col><col><col><col><col><tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">term</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">estimate</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">std.error</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">statistic</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">p.value</th></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">(Intercept)</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1.22&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.202&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">6.06</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">3.43e-09</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">sat</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.00146</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.000166</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">8.79</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">6.05e-17</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">hsperc</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">-0.00897</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.00112&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">-8&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1.74e-14</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">tothrs</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.00325</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.000721</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">4.51</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">8.73e-06</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">female</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.292&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.0547&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">5.35</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1.59e-07</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">black</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-0.117&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.115&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-1.01</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.313&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">white</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">-0.145&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.106&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">-1.37</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.171&nbsp;&nbsp;&nbsp;</td></tr>
</table>

<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>list_mods <span class="ot">&lt;-</span> tidied <span class="sc">%&gt;%</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(tidy_lm)</span></code></pre></div>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>mods_df <span class="ot">&lt;-</span> <span class="fu">map2_df</span>(list_mods,</span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">seq</span>(<span class="dv">1</span>, resamples),</span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>                   <span class="sc">~</span><span class="fu">mutate</span>(.x, <span class="at">resample =</span> .y))</span></code></pre></div>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mods_df, <span class="dv">5</span>)</span></code></pre></div>
<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:unnamed-chunk-145">
<caption style="caption-side: top; text-align: center;">(#tab:unnamed-chunk-145) </caption><col><col><col><col><col><col><tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">term</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">estimate</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">std.error</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">statistic</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">p.value</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">resample</th></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">(Intercept)</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1.22&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.202&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">6.06</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">3.43e-09</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">sat</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.00146</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.000166</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">8.79</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">6.05e-17</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">hsperc</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">-0.00897</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.00112&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">-8&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1.74e-14</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">tothrs</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.00325</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.000721</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">4.51</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">8.73e-06</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">female</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.292&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.0547&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">5.35</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1.59e-07</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1</td></tr>
</table>

<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>r.std.error <span class="ot">&lt;-</span> mods_df <span class="sc">%&gt;%</span></span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(term) <span class="sc">%&gt;%</span></span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">r.std.error =</span> <span class="fu">sd</span>(estimate))</span></code></pre></div>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>reg <span class="sc">%&gt;%</span></span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>  broom<span class="sc">::</span><span class="fu">tidy</span>()   <span class="sc">%&gt;%</span></span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(r.std.error)</span></code></pre></div>
<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:unnamed-chunk-147">
<caption style="caption-side: top; text-align: center;">(#tab:unnamed-chunk-147) </caption><col><col><col><col><col><col><tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">term</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">estimate</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">std.error</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">statistic</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">p.value</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">r.std.error</th></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">(Intercept)</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1.47&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.23&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">6.4&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">4.94e-10</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.218&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">sat</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.00114</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.000179</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">6.39&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">5.2e-10&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.000178</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">hsperc</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">-0.00857</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.00124&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">-6.91&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">2.27e-11</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.00136&nbsp;</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">tothrs</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.0025&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.000731</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">3.43&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.000685</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.000676</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">female</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.303&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.059&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">5.14&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">4.5e-07&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.0522&nbsp;&nbsp;</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">black</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-0.128&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.147&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-0.87&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.385&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.122&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">white</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">-0.0587&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.141&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">-0.416</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.677&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.121&nbsp;&nbsp;&nbsp;</td></tr>
</table>

<p>Using the whole bootstrapping procedure is longer than simply using
either one of the first two methods. However, this procedure is very
flexible and can thus be adapted to a very large range of situations.</p>
</div>
</div>
<div id="weighted-least-squares" class="section level2" number="1.6">
<h2 number="1.6"><span class="header-section-number">1.6</span> Weighted least squares</h2>
<p>Weighted Least Squares (WLS) attempts to provide a more efficient
alternative to OLS. It is a special version of a feasible generalized
least squares (FGLS) estimator.</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;k401k&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="co"># OLS (only for singles: fsize==1)</span></span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(nettfa <span class="sc">~</span> inc <span class="sc">+</span> <span class="fu">I</span>((age<span class="dv">-25</span>)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> male <span class="sc">+</span> e401k,</span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">data=</span>k401ksubs, <span class="at">subset=</span>(fsize<span class="sc">==</span><span class="dv">1</span>))</span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb162-6"><a href="#cb162-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> nettfa <span class="sc">~</span> inc <span class="sc">+</span> <span class="fu">I</span>((age <span class="sc">-</span> <span class="dv">25</span>)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> male <span class="sc">+</span> e401k, <span class="at">data =</span> k401ksubs, </span>
<span id="cb162-7"><a href="#cb162-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">subset =</span> (fsize <span class="sc">==</span> <span class="dv">1</span>))</span>
<span id="cb162-8"><a href="#cb162-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-9"><a href="#cb162-9" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb162-10"><a href="#cb162-10" aria-hidden="true" tabindex="-1"></a>    (Intercept)              inc  <span class="fu">I</span>((age <span class="sc">-</span> <span class="dv">25</span>)<span class="sc">^</span><span class="dv">2</span>)             male  </span>
<span id="cb162-11"><a href="#cb162-11" aria-hidden="true" tabindex="-1"></a>      <span class="sc">-</span><span class="fl">20.98499</span>          <span class="fl">0.77058</span>          <span class="fl">0.02513</span>          <span class="fl">2.47793</span>  </span>
<span id="cb162-12"><a href="#cb162-12" aria-hidden="true" tabindex="-1"></a>          e401k  </span>
<span id="cb162-13"><a href="#cb162-13" aria-hidden="true" tabindex="-1"></a>        <span class="fl">6.88622</span>  </span></code></pre></div>
<p>Following Wooldrige, we assume that the variance is proportional to the
income variable <em>inc.</em>. Therefore, the optimal weight is <span class="math inline">\(\frac{1}{inc}\)</span>
which is given as <em>weight</em> in the <code>lm()</code> call.</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="co"># WLS</span></span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(nettfa <span class="sc">~</span> inc <span class="sc">+</span> <span class="fu">I</span>((age<span class="dv">-25</span>)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> male <span class="sc">+</span> e401k, <span class="at">weight=</span><span class="dv">1</span><span class="sc">/</span>inc,</span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">data=</span>k401ksubs, <span class="at">subset=</span>(fsize<span class="sc">==</span><span class="dv">1</span>))</span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> nettfa <span class="sc">~</span> inc <span class="sc">+</span> <span class="fu">I</span>((age <span class="sc">-</span> <span class="dv">25</span>)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> male <span class="sc">+</span> e401k, <span class="at">data =</span> k401ksubs, </span>
<span id="cb163-7"><a href="#cb163-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">subset =</span> (fsize <span class="sc">==</span> <span class="dv">1</span>), <span class="at">weights =</span> <span class="dv">1</span><span class="sc">/</span>inc)</span>
<span id="cb163-8"><a href="#cb163-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-9"><a href="#cb163-9" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb163-10"><a href="#cb163-10" aria-hidden="true" tabindex="-1"></a>    (Intercept)              inc  <span class="fu">I</span>((age <span class="sc">-</span> <span class="dv">25</span>)<span class="sc">^</span><span class="dv">2</span>)             male  </span>
<span id="cb163-11"><a href="#cb163-11" aria-hidden="true" tabindex="-1"></a>      <span class="sc">-</span><span class="fl">16.70252</span>          <span class="fl">0.74038</span>          <span class="fl">0.01754</span>          <span class="fl">1.84053</span>  </span>
<span id="cb163-12"><a href="#cb163-12" aria-hidden="true" tabindex="-1"></a>          e401k  </span>
<span id="cb163-13"><a href="#cb163-13" aria-hidden="true" tabindex="-1"></a>        <span class="fl">5.18828</span>  </span></code></pre></div>
<p>We can also use heteroscedasticity-robust statistics to account for the
fact that our variance function might be misspecified.</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="co"># WLS</span></span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>wlsreg <span class="ot">&lt;-</span> <span class="fu">lm</span>(nettfa <span class="sc">~</span> inc <span class="sc">+</span> <span class="fu">I</span>((age<span class="dv">-25</span>)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> male <span class="sc">+</span> e401k,</span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">weight=</span><span class="dv">1</span><span class="sc">/</span>inc, <span class="at">data=</span>k401ksubs, <span class="at">subset=</span>(fsize<span class="sc">==</span><span class="dv">1</span>))</span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a><span class="co"># non-robust results</span></span>
<span id="cb164-6"><a href="#cb164-6" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(wlsreg)</span>
<span id="cb164-7"><a href="#cb164-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-8"><a href="#cb164-8" aria-hidden="true" tabindex="-1"></a>t test of coefficients<span class="sc">:</span></span>
<span id="cb164-9"><a href="#cb164-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-10"><a href="#cb164-10" aria-hidden="true" tabindex="-1"></a>                   Estimate  Std. Error t value  <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)    </span>
<span id="cb164-11"><a href="#cb164-11" aria-hidden="true" tabindex="-1"></a>(Intercept)     <span class="sc">-</span><span class="fl">16.7025205</span>   <span class="fl">1.9579947</span> <span class="sc">-</span><span class="fl">8.5304</span> <span class="sc">&lt;</span> <span class="fl">2.2e-16</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb164-12"><a href="#cb164-12" aria-hidden="true" tabindex="-1"></a>inc               <span class="fl">0.7403843</span>   <span class="fl">0.0643029</span> <span class="fl">11.5140</span> <span class="sc">&lt;</span> <span class="fl">2.2e-16</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb164-13"><a href="#cb164-13" aria-hidden="true" tabindex="-1"></a><span class="fu">I</span>((age <span class="sc">-</span> <span class="dv">25</span>)<span class="sc">^</span><span class="dv">2</span>)   <span class="fl">0.0175373</span>   <span class="fl">0.0019315</span>  <span class="fl">9.0796</span> <span class="sc">&lt;</span> <span class="fl">2.2e-16</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb164-14"><a href="#cb164-14" aria-hidden="true" tabindex="-1"></a>male              <span class="fl">1.8405293</span>   <span class="fl">1.5635872</span>  <span class="fl">1.1771</span>  <span class="fl">0.239287</span>    </span>
<span id="cb164-15"><a href="#cb164-15" aria-hidden="true" tabindex="-1"></a>e401k             <span class="fl">5.1882807</span>   <span class="fl">1.7034258</span>  <span class="fl">3.0458</span>  <span class="fl">0.002351</span> <span class="sc">**</span> </span>
<span id="cb164-16"><a href="#cb164-16" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb164-17"><a href="#cb164-17" aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span>
<span id="cb164-18"><a href="#cb164-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-19"><a href="#cb164-19" aria-hidden="true" tabindex="-1"></a><span class="co"># robust results (Refined White SE:)</span></span>
<span id="cb164-20"><a href="#cb164-20" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(wlsreg,hccm)</span>
<span id="cb164-21"><a href="#cb164-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-22"><a href="#cb164-22" aria-hidden="true" tabindex="-1"></a>t test of coefficients<span class="sc">:</span></span>
<span id="cb164-23"><a href="#cb164-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-24"><a href="#cb164-24" aria-hidden="true" tabindex="-1"></a>                   Estimate  Std. Error t value  <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)    </span>
<span id="cb164-25"><a href="#cb164-25" aria-hidden="true" tabindex="-1"></a>(Intercept)     <span class="sc">-</span><span class="fl">16.7025205</span>   <span class="fl">2.2482355</span> <span class="sc">-</span><span class="fl">7.4292</span> <span class="fl">1.606e-13</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb164-26"><a href="#cb164-26" aria-hidden="true" tabindex="-1"></a>inc               <span class="fl">0.7403843</span>   <span class="fl">0.0752396</span>  <span class="fl">9.8403</span> <span class="sc">&lt;</span> <span class="fl">2.2e-16</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb164-27"><a href="#cb164-27" aria-hidden="true" tabindex="-1"></a><span class="fu">I</span>((age <span class="sc">-</span> <span class="dv">25</span>)<span class="sc">^</span><span class="dv">2</span>)   <span class="fl">0.0175373</span>   <span class="fl">0.0025924</span>  <span class="fl">6.7650</span> <span class="fl">1.742e-11</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb164-28"><a href="#cb164-28" aria-hidden="true" tabindex="-1"></a>male              <span class="fl">1.8405293</span>   <span class="fl">1.3132477</span>  <span class="fl">1.4015</span> <span class="fl">0.1612159</span>    </span>
<span id="cb164-29"><a href="#cb164-29" aria-hidden="true" tabindex="-1"></a>e401k             <span class="fl">5.1882807</span>   <span class="fl">1.5743329</span>  <span class="fl">3.2955</span> <span class="fl">0.0009994</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb164-30"><a href="#cb164-30" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb164-31"><a href="#cb164-31" aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span>
<span id="cb164-32"><a href="#cb164-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-33"><a href="#cb164-33" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(wlsreg, <span class="at">vcov. =</span> vcovHC)</span>
<span id="cb164-34"><a href="#cb164-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-35"><a href="#cb164-35" aria-hidden="true" tabindex="-1"></a>t test of coefficients<span class="sc">:</span></span>
<span id="cb164-36"><a href="#cb164-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-37"><a href="#cb164-37" aria-hidden="true" tabindex="-1"></a>                   Estimate  Std. Error t value  <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)    </span>
<span id="cb164-38"><a href="#cb164-38" aria-hidden="true" tabindex="-1"></a>(Intercept)     <span class="sc">-</span><span class="fl">16.7025205</span>   <span class="fl">2.2482355</span> <span class="sc">-</span><span class="fl">7.4292</span> <span class="fl">1.606e-13</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb164-39"><a href="#cb164-39" aria-hidden="true" tabindex="-1"></a>inc               <span class="fl">0.7403843</span>   <span class="fl">0.0752396</span>  <span class="fl">9.8403</span> <span class="sc">&lt;</span> <span class="fl">2.2e-16</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb164-40"><a href="#cb164-40" aria-hidden="true" tabindex="-1"></a><span class="fu">I</span>((age <span class="sc">-</span> <span class="dv">25</span>)<span class="sc">^</span><span class="dv">2</span>)   <span class="fl">0.0175373</span>   <span class="fl">0.0025924</span>  <span class="fl">6.7650</span> <span class="fl">1.742e-11</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb164-41"><a href="#cb164-41" aria-hidden="true" tabindex="-1"></a>male              <span class="fl">1.8405293</span>   <span class="fl">1.3132477</span>  <span class="fl">1.4015</span> <span class="fl">0.1612159</span>    </span>
<span id="cb164-42"><a href="#cb164-42" aria-hidden="true" tabindex="-1"></a>e401k             <span class="fl">5.1882807</span>   <span class="fl">1.5743329</span>  <span class="fl">3.2955</span> <span class="fl">0.0009994</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb164-43"><a href="#cb164-43" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb164-44"><a href="#cb164-44" aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span></code></pre></div>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="co"># waldtest(wlsreg, vcov = vcovHC)</span></span></code></pre></div>
<p>The assumption that the variance is proportional to a regressor is
usually hard to justify. Typically, we do not know the variance
function; we have to estimate it. We can estimate the relation between
variance and regressors using a linear regression of the log of the
squared residuals from an initial OLS regression <span class="math inline">\(log(\hat{u}^{2})\)</span> as
the dependent variable.</p>
<p>Wooldrige suggests two version for the selection of regressors:</p>
<ul>
<li>the regressors <span class="math inline">\(x_1, \dots , x_k\)</span> from the original model similar to
the BP test</li>
<li><span class="math inline">\(\hat{y}\)</span> and <span class="math inline">\(\hat{y}^{2}\)</span> from the original model similar to the
White test</li>
</ul>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;smoke&quot;</span>)</span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a><span class="co"># OLS</span></span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a>olsreg<span class="ot">&lt;-</span><span class="fu">lm</span>(cigs<span class="sc">~</span><span class="fu">log</span>(income)<span class="sc">+</span><span class="fu">log</span>(cigpric)<span class="sc">+</span>educ<span class="sc">+</span>age<span class="sc">+</span><span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span>restaurn,</span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">data=</span>smoke)</span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a>olsreg</span>
<span id="cb166-6"><a href="#cb166-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-7"><a href="#cb166-7" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb166-8"><a href="#cb166-8" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> cigs <span class="sc">~</span> <span class="fu">log</span>(income) <span class="sc">+</span> <span class="fu">log</span>(cigpric) <span class="sc">+</span> educ <span class="sc">+</span> age <span class="sc">+</span> </span>
<span id="cb166-9"><a href="#cb166-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> restaurn, <span class="at">data =</span> smoke)</span>
<span id="cb166-10"><a href="#cb166-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-11"><a href="#cb166-11" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb166-12"><a href="#cb166-12" aria-hidden="true" tabindex="-1"></a> (Intercept)   <span class="fu">log</span>(income)  <span class="fu">log</span>(cigpric)          educ           age  </span>
<span id="cb166-13"><a href="#cb166-13" aria-hidden="true" tabindex="-1"></a>   <span class="sc">-</span><span class="fl">3.639826</span>      <span class="fl">0.880268</span>     <span class="sc">-</span><span class="fl">0.750862</span>     <span class="sc">-</span><span class="fl">0.501498</span>      <span class="fl">0.770694</span>  </span>
<span id="cb166-14"><a href="#cb166-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>)      restaurn  </span>
<span id="cb166-15"><a href="#cb166-15" aria-hidden="true" tabindex="-1"></a>   <span class="sc">-</span><span class="fl">0.009023</span>     <span class="sc">-</span><span class="fl">2.825085</span>  </span>
<span id="cb166-16"><a href="#cb166-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-17"><a href="#cb166-17" aria-hidden="true" tabindex="-1"></a><span class="co"># BP test</span></span>
<span id="cb166-18"><a href="#cb166-18" aria-hidden="true" tabindex="-1"></a><span class="fu">bptest</span>(olsreg)</span>
<span id="cb166-19"><a href="#cb166-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-20"><a href="#cb166-20" aria-hidden="true" tabindex="-1"></a>    studentized Breusch<span class="sc">-</span>Pagan test</span>
<span id="cb166-21"><a href="#cb166-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-22"><a href="#cb166-22" aria-hidden="true" tabindex="-1"></a>data<span class="sc">:</span>  olsreg</span>
<span id="cb166-23"><a href="#cb166-23" aria-hidden="true" tabindex="-1"></a>BP <span class="ot">=</span> <span class="fl">32.258</span>, df <span class="ot">=</span> <span class="dv">6</span>, p<span class="sc">-</span>value <span class="ot">=</span> <span class="fl">1.456e-05</span></span>
<span id="cb166-24"><a href="#cb166-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-25"><a href="#cb166-25" aria-hidden="true" tabindex="-1"></a><span class="co"># FGLS: estimation of the variance function</span></span>
<span id="cb166-26"><a href="#cb166-26" aria-hidden="true" tabindex="-1"></a>logu2 <span class="ot">&lt;-</span> <span class="fu">log</span>(<span class="fu">resid</span>(olsreg)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb166-27"><a href="#cb166-27" aria-hidden="true" tabindex="-1"></a>varreg<span class="ot">&lt;-</span><span class="fu">lm</span>(logu2<span class="sc">~</span><span class="fu">log</span>(income)<span class="sc">+</span><span class="fu">log</span>(cigpric)<span class="sc">+</span>educ<span class="sc">+</span>age<span class="sc">+</span><span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span>restaurn,</span>
<span id="cb166-28"><a href="#cb166-28" aria-hidden="true" tabindex="-1"></a>           <span class="at">data=</span>smoke)</span>
<span id="cb166-29"><a href="#cb166-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-30"><a href="#cb166-30" aria-hidden="true" tabindex="-1"></a><span class="co"># FGLS: WLS</span></span>
<span id="cb166-31"><a href="#cb166-31" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="fu">exp</span>(<span class="fu">fitted</span>(varreg))</span>
<span id="cb166-32"><a href="#cb166-32" aria-hidden="true" tabindex="-1"></a>wls1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(cigs<span class="sc">~</span><span class="fu">log</span>(income)<span class="sc">+</span><span class="fu">log</span>(cigpric)<span class="sc">+</span>educ<span class="sc">+</span>age<span class="sc">+</span><span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span>restaurn,</span>
<span id="cb166-33"><a href="#cb166-33" aria-hidden="true" tabindex="-1"></a>   <span class="at">weight=</span>w ,<span class="at">data=</span>smoke)</span></code></pre></div>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>modelsummary<span class="sc">::</span><span class="fu">modelsummary</span>(<span class="fu">list</span>(olsreg, wls1), <span class="at">vcov =</span> <span class="fu">c</span>(<span class="st">&quot;classical&quot;</span>), <span class="at">title =</span> <span class="st">&#39;OLS vs. WLS&#39;</span>)</span></code></pre></div>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
(#tab:unnamed-chunk-154)OLS vs. WLS
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
Model 1
</th>
<th style="text-align:center;">
Model 2
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:center;">
-3.640
</td>
<td style="text-align:center;">
5.635
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(24.079)
</td>
<td style="text-align:center;">
(17.803)
</td>
</tr>
<tr>
<td style="text-align:left;">
log(income)
</td>
<td style="text-align:center;">
0.880
</td>
<td style="text-align:center;">
1.295
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.728)
</td>
<td style="text-align:center;">
(0.437)
</td>
</tr>
<tr>
<td style="text-align:left;">
log(cigpric)
</td>
<td style="text-align:center;">
-0.751
</td>
<td style="text-align:center;">
-2.940
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(5.773)
</td>
<td style="text-align:center;">
(4.460)
</td>
</tr>
<tr>
<td style="text-align:left;">
educ
</td>
<td style="text-align:center;">
-0.501
</td>
<td style="text-align:center;">
-0.463
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.167)
</td>
<td style="text-align:center;">
(0.120)
</td>
</tr>
<tr>
<td style="text-align:left;">
age
</td>
<td style="text-align:center;">
0.771
</td>
<td style="text-align:center;">
0.482
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.160)
</td>
<td style="text-align:center;">
(0.097)
</td>
</tr>
<tr>
<td style="text-align:left;">
I(age^2)
</td>
<td style="text-align:center;">
-0.009
</td>
<td style="text-align:center;">
-0.006
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.002)
</td>
<td style="text-align:center;">
(0.001)
</td>
</tr>
<tr>
<td style="text-align:left;">
restaurn
</td>
<td style="text-align:center;">
-2.825
</td>
<td style="text-align:center;">
-3.461
</td>
</tr>
<tr>
<td style="text-align:left;box-shadow: 0px 1px">
</td>
<td style="text-align:center;box-shadow: 0px 1px">
(1.112)
</td>
<td style="text-align:center;box-shadow: 0px 1px">
(0.796)
</td>
</tr>
<tr>
<td style="text-align:left;">
Num.Obs.
</td>
<td style="text-align:center;">
807
</td>
<td style="text-align:center;">
807
</td>
</tr>
<tr>
<td style="text-align:left;">
R2
</td>
<td style="text-align:center;">
0.053
</td>
<td style="text-align:center;">
0.113
</td>
</tr>
<tr>
<td style="text-align:left;">
R2 Adj.
</td>
<td style="text-align:center;">
0.046
</td>
<td style="text-align:center;">
0.107
</td>
</tr>
<tr>
<td style="text-align:left;">
AIC
</td>
<td style="text-align:center;">
6488.5
</td>
<td style="text-align:center;">
6431.5
</td>
</tr>
<tr>
<td style="text-align:left;">
BIC
</td>
<td style="text-align:center;">
6526.0
</td>
<td style="text-align:center;">
6469.1
</td>
</tr>
<tr>
<td style="text-align:left;">
Log.Lik.
</td>
<td style="text-align:center;">
-3236.227
</td>
<td style="text-align:center;">
-3207.765
</td>
</tr>
<tr>
<td style="text-align:left;">
F
</td>
<td style="text-align:center;">
7.423
</td>
<td style="text-align:center;">
17.055
</td>
</tr>
</tbody>
</table>
<p>We have seen that using the correct estimator for your standard errors
really matters. However, econometrics does not always offer a
straightforward <strong>correct</strong> route.</p>
<p>To see this let us run a simulation<a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a></p>
<ol style="list-style-type: decimal">
<li><p>Generate a sample of size 30 from the population</p></li>
<li><p>Calculate/save OLS and WLS (×2) estimates for <span class="math inline">\(\beta_{1}\)</span></p></li>
<li><p>Calculate/save standard errors for <span class="math inline">\(\beta_{1}\)</span> using</p></li>
</ol>
<ul>
<li>Plain OLS standard errors</li>
<li>Heteroskedasticity-robust standard errors</li>
<li>WLS (correct)</li>
<li>WLS (incorrect)</li>
</ul>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameters</span></span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>b0 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a>s2 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample size</span></span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb168-7"><a href="#cb168-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate data</span></span>
<span id="cb168-8"><a href="#cb168-8" aria-hidden="true" tabindex="-1"></a>sample_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb168-9"><a href="#cb168-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">runif</span>(n, <span class="fl">0.5</span>, <span class="fl">1.5</span>),</span>
<span id="cb168-10"><a href="#cb168-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> b0 <span class="sc">+</span> b1 <span class="sc">*</span> x <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="at">sd =</span> s2 <span class="sc">*</span> x<span class="sc">^</span><span class="dv">2</span>) <span class="co"># Note the squared term at the SD</span></span>
<span id="cb168-11"><a href="#cb168-11" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="co"># OLS</span></span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>ols<span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> sample_df) </span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a><span class="co">#  OLS with robust standard errors</span></span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a>ols_rob <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(y <span class="sc">~</span> x, <span class="at">data =</span> sample_df) <span class="co"># robust standard errors</span></span>
<span id="cb169-6"><a href="#cb169-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-7"><a href="#cb169-7" aria-hidden="true" tabindex="-1"></a><span class="co"># # WLS: Correct weights</span></span>
<span id="cb169-8"><a href="#cb169-8" aria-hidden="true" tabindex="-1"></a>wls_t <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> sample_df, <span class="at">weights =</span> <span class="dv">1</span><span class="sc">/</span>x<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb169-9"><a href="#cb169-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-10"><a href="#cb169-10" aria-hidden="true" tabindex="-1"></a><span class="co"># WLS: Wrong weights</span></span>
<span id="cb169-11"><a href="#cb169-11" aria-hidden="true" tabindex="-1"></a>wls_f <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> sample_df, <span class="at">weights =</span> <span class="dv">1</span><span class="sc">/</span>x)</span></code></pre></div>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sample_df<span class="sc">$</span>x, </span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a>     sample_df<span class="sc">$</span>y,</span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">30</span>))</span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-5"><a href="#cb170-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(ols, </span>
<span id="cb170-6"><a href="#cb170-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">&quot;steelblue&quot;</span>, </span>
<span id="cb170-7"><a href="#cb170-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb170-8"><a href="#cb170-8" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(wls_t, </span>
<span id="cb170-9"><a href="#cb170-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">&quot;green&quot;</span>, </span>
<span id="cb170-10"><a href="#cb170-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb170-11"><a href="#cb170-11" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(wls_f, </span>
<span id="cb170-12"><a href="#cb170-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">&quot;pink&quot;</span>, </span>
<span id="cb170-13"><a href="#cb170-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="MEM5220_R_files/figure-html/unnamed-chunk-157-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Coefficients and standard errors</span></span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ols_rob, <span class="at">robust =</span> F)</span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-4"><a href="#cb171-4" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb171-5"><a href="#cb171-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lm_robust</span>(<span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">data =</span> sample_df)</span>
<span id="cb171-6"><a href="#cb171-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-7"><a href="#cb171-7" aria-hidden="true" tabindex="-1"></a>Standard error type<span class="sc">:</span>  HC2 </span>
<span id="cb171-8"><a href="#cb171-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-9"><a href="#cb171-9" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb171-10"><a href="#cb171-10" aria-hidden="true" tabindex="-1"></a>            Estimate Std. Error t value  <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>) CI Lower CI Upper DF</span>
<span id="cb171-11"><a href="#cb171-11" aria-hidden="true" tabindex="-1"></a>(Intercept)  <span class="sc">-</span><span class="fl">0.1397</span>     <span class="fl">0.8120</span> <span class="sc">-</span><span class="fl">0.1721</span> <span class="fl">8.646e-01</span>   <span class="sc">-</span><span class="fl">1.803</span>    <span class="fl">1.524</span> <span class="dv">28</span></span>
<span id="cb171-12"><a href="#cb171-12" aria-hidden="true" tabindex="-1"></a>x            <span class="fl">11.3689</span>     <span class="fl">0.9643</span> <span class="fl">11.7892</span> <span class="fl">2.260e-12</span>    <span class="fl">9.393</span>   <span class="fl">13.344</span> <span class="dv">28</span></span>
<span id="cb171-13"><a href="#cb171-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-14"><a href="#cb171-14" aria-hidden="true" tabindex="-1"></a>Multiple R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.8217</span> ,   Adjusted R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.8153</span> </span>
<span id="cb171-15"><a href="#cb171-15" aria-hidden="true" tabindex="-1"></a>F<span class="sc">-</span>statistic<span class="sc">:</span>   <span class="dv">139</span> on <span class="dv">1</span> and <span class="dv">28</span> DF,  p<span class="sc">-</span>value<span class="sc">:</span> <span class="fl">2.26e-12</span></span>
<span id="cb171-16"><a href="#cb171-16" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ols, <span class="at">robust =</span> T)</span>
<span id="cb171-17"><a href="#cb171-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-18"><a href="#cb171-18" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb171-19"><a href="#cb171-19" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">data =</span> sample_df)</span>
<span id="cb171-20"><a href="#cb171-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-21"><a href="#cb171-21" aria-hidden="true" tabindex="-1"></a>Residuals<span class="sc">:</span></span>
<span id="cb171-22"><a href="#cb171-22" aria-hidden="true" tabindex="-1"></a>    Min      1Q  Median      3Q     Max </span>
<span id="cb171-23"><a href="#cb171-23" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">3.4156</span> <span class="sc">-</span><span class="fl">0.6762</span>  <span class="fl">0.0081</span>  <span class="fl">0.5116</span>  <span class="fl">4.1734</span> </span>
<span id="cb171-24"><a href="#cb171-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-25"><a href="#cb171-25" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb171-26"><a href="#cb171-26" aria-hidden="true" tabindex="-1"></a>            Estimate Std. Error t value <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)    </span>
<span id="cb171-27"><a href="#cb171-27" aria-hidden="true" tabindex="-1"></a>(Intercept)  <span class="sc">-</span><span class="fl">0.1397</span>     <span class="fl">1.0450</span>  <span class="sc">-</span><span class="fl">0.134</span>    <span class="fl">0.895</span>    </span>
<span id="cb171-28"><a href="#cb171-28" aria-hidden="true" tabindex="-1"></a>x            <span class="fl">11.3689</span>     <span class="fl">1.0008</span>  <span class="fl">11.360</span> <span class="fl">5.37e-12</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb171-29"><a href="#cb171-29" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb171-30"><a href="#cb171-30" aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span>
<span id="cb171-31"><a href="#cb171-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-32"><a href="#cb171-32" aria-hidden="true" tabindex="-1"></a>Residual standard error<span class="sc">:</span> <span class="fl">1.483</span> on <span class="dv">28</span> degrees of freedom</span>
<span id="cb171-33"><a href="#cb171-33" aria-hidden="true" tabindex="-1"></a>Multiple R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.8217</span>,    Adjusted R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.8153</span> </span>
<span id="cb171-34"><a href="#cb171-34" aria-hidden="true" tabindex="-1"></a>F<span class="sc">-</span>statistic<span class="sc">:</span>   <span class="dv">129</span> on <span class="dv">1</span> and <span class="dv">28</span> DF,  p<span class="sc">-</span>value<span class="sc">:</span> <span class="fl">5.371e-12</span></span>
<span id="cb171-35"><a href="#cb171-35" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(wls_t)</span>
<span id="cb171-36"><a href="#cb171-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-37"><a href="#cb171-37" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb171-38"><a href="#cb171-38" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">data =</span> sample_df, <span class="at">weights =</span> <span class="dv">1</span><span class="sc">/</span>x<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb171-39"><a href="#cb171-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-40"><a href="#cb171-40" aria-hidden="true" tabindex="-1"></a>Weighted Residuals<span class="sc">:</span></span>
<span id="cb171-41"><a href="#cb171-41" aria-hidden="true" tabindex="-1"></a>    Min      1Q  Median      3Q     Max </span>
<span id="cb171-42"><a href="#cb171-42" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">2.3476</span> <span class="sc">-</span><span class="fl">0.7340</span> <span class="sc">-</span><span class="fl">0.0064</span>  <span class="fl">0.5909</span>  <span class="fl">3.4815</span> </span>
<span id="cb171-43"><a href="#cb171-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-44"><a href="#cb171-44" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb171-45"><a href="#cb171-45" aria-hidden="true" tabindex="-1"></a>            Estimate Std. Error t value <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)    </span>
<span id="cb171-46"><a href="#cb171-46" aria-hidden="true" tabindex="-1"></a>(Intercept)   <span class="fl">0.1557</span>     <span class="fl">0.7575</span>   <span class="fl">0.206</span>    <span class="fl">0.839</span>    </span>
<span id="cb171-47"><a href="#cb171-47" aria-hidden="true" tabindex="-1"></a>x            <span class="fl">11.0633</span>     <span class="fl">0.8480</span>  <span class="fl">13.046</span> <span class="fl">2.02e-13</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb171-48"><a href="#cb171-48" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb171-49"><a href="#cb171-49" aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span>
<span id="cb171-50"><a href="#cb171-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-51"><a href="#cb171-51" aria-hidden="true" tabindex="-1"></a>Residual standard error<span class="sc">:</span> <span class="fl">1.318</span> on <span class="dv">28</span> degrees of freedom</span>
<span id="cb171-52"><a href="#cb171-52" aria-hidden="true" tabindex="-1"></a>Multiple R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.8587</span>,    Adjusted R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.8537</span> </span>
<span id="cb171-53"><a href="#cb171-53" aria-hidden="true" tabindex="-1"></a>F<span class="sc">-</span>statistic<span class="sc">:</span> <span class="fl">170.2</span> on <span class="dv">1</span> and <span class="dv">28</span> DF,  p<span class="sc">-</span>value<span class="sc">:</span> <span class="fl">2.025e-13</span></span>
<span id="cb171-54"><a href="#cb171-54" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(wls_f)</span>
<span id="cb171-55"><a href="#cb171-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-56"><a href="#cb171-56" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb171-57"><a href="#cb171-57" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">data =</span> sample_df, <span class="at">weights =</span> <span class="dv">1</span><span class="sc">/</span>x)</span>
<span id="cb171-58"><a href="#cb171-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-59"><a href="#cb171-59" aria-hidden="true" tabindex="-1"></a>Weighted Residuals<span class="sc">:</span></span>
<span id="cb171-60"><a href="#cb171-60" aria-hidden="true" tabindex="-1"></a>    Min      1Q  Median      3Q     Max </span>
<span id="cb171-61"><a href="#cb171-61" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">2.8420</span> <span class="sc">-</span><span class="fl">0.6370</span> <span class="sc">-</span><span class="fl">0.0119</span>  <span class="fl">0.5475</span>  <span class="fl">3.8037</span> </span>
<span id="cb171-62"><a href="#cb171-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-63"><a href="#cb171-63" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb171-64"><a href="#cb171-64" aria-hidden="true" tabindex="-1"></a>             Estimate Std. Error t value <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)    </span>
<span id="cb171-65"><a href="#cb171-65" aria-hidden="true" tabindex="-1"></a>(Intercept)  <span class="fl">0.001094</span>   <span class="fl">0.883399</span>   <span class="fl">0.001</span>    <span class="fl">0.999</span>    </span>
<span id="cb171-66"><a href="#cb171-66" aria-hidden="true" tabindex="-1"></a>x           <span class="fl">11.229235</span>   <span class="fl">0.911463</span>  <span class="fl">12.320</span> <span class="fl">7.99e-13</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb171-67"><a href="#cb171-67" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb171-68"><a href="#cb171-68" aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span>
<span id="cb171-69"><a href="#cb171-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-70"><a href="#cb171-70" aria-hidden="true" tabindex="-1"></a>Residual standard error<span class="sc">:</span> <span class="fl">1.385</span> on <span class="dv">28</span> degrees of freedom</span>
<span id="cb171-71"><a href="#cb171-71" aria-hidden="true" tabindex="-1"></a>Multiple R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.8443</span>,    Adjusted R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.8387</span> </span>
<span id="cb171-72"><a href="#cb171-72" aria-hidden="true" tabindex="-1"></a>F<span class="sc">-</span>statistic<span class="sc">:</span> <span class="fl">151.8</span> on <span class="dv">1</span> and <span class="dv">28</span> DF,  p<span class="sc">-</span>value<span class="sc">:</span> <span class="fl">7.986e-13</span></span></code></pre></div>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameters</span></span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a>b0 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a>s2 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb172-5"><a href="#cb172-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample size</span></span>
<span id="cb172-6"><a href="#cb172-6" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb172-7"><a href="#cb172-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of iterations</span></span>
<span id="cb172-8"><a href="#cb172-8" aria-hidden="true" tabindex="-1"></a>n_iter <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb172-9"><a href="#cb172-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Set seed</span></span>
<span id="cb172-10"><a href="#cb172-10" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb172-11"><a href="#cb172-11" aria-hidden="true" tabindex="-1"></a><span class="co"># The simulation</span></span>
<span id="cb172-12"><a href="#cb172-12" aria-hidden="true" tabindex="-1"></a>sim_df <span class="ot">&lt;-</span> parallel<span class="sc">::</span><span class="fu">mclapply</span>(<span class="at">X =</span> <span class="dv">1</span><span class="sc">:</span>n_iter, <span class="at">FUN =</span> <span class="cf">function</span>(i, size) {</span>
<span id="cb172-13"><a href="#cb172-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generate data</span></span>
<span id="cb172-14"><a href="#cb172-14" aria-hidden="true" tabindex="-1"></a>  sample_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb172-15"><a href="#cb172-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">runif</span>(size, <span class="fl">0.5</span>, <span class="fl">1.5</span>),</span>
<span id="cb172-16"><a href="#cb172-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> b0 <span class="sc">+</span> b1 <span class="sc">*</span> x <span class="sc">+</span> <span class="fu">rnorm</span>(size, <span class="dv">0</span>, <span class="at">sd =</span> s2 <span class="sc">*</span> x<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb172-17"><a href="#cb172-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb172-18"><a href="#cb172-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># OLS</span></span>
<span id="cb172-19"><a href="#cb172-19" aria-hidden="true" tabindex="-1"></a>  ols <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(y <span class="sc">~</span> x, <span class="at">data =</span> sample_df)</span>
<span id="cb172-20"><a href="#cb172-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># WLS: Correct weights</span></span>
<span id="cb172-21"><a href="#cb172-21" aria-hidden="true" tabindex="-1"></a>  wls_t <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> sample_df, <span class="at">weights =</span> <span class="dv">1</span><span class="sc">/</span>x<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb172-22"><a href="#cb172-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># WLS: Correct weights</span></span>
<span id="cb172-23"><a href="#cb172-23" aria-hidden="true" tabindex="-1"></a>  wls_f <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> sample_df, <span class="at">weights =</span> <span class="dv">1</span><span class="sc">/</span>x)</span>
<span id="cb172-24"><a href="#cb172-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Save results</span></span>
<span id="cb172-25"><a href="#cb172-25" aria-hidden="true" tabindex="-1"></a>  iter_df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb172-26"><a href="#cb172-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>(ols, <span class="at">robust =</span> F) <span class="sc">%&gt;%</span> <span class="fu">coef</span>() <span class="sc">%&gt;%</span> magrittr<span class="sc">::</span><span class="fu">extract</span>(<span class="dv">2</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>),</span>
<span id="cb172-27"><a href="#cb172-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>(ols, <span class="at">robust =</span> T) <span class="sc">%&gt;%</span> <span class="fu">coef</span>() <span class="sc">%&gt;%</span> magrittr<span class="sc">::</span><span class="fu">extract</span>(<span class="dv">2</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>),</span>
<span id="cb172-28"><a href="#cb172-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>(wls_t) <span class="sc">%&gt;%</span> <span class="fu">coef</span>() <span class="sc">%&gt;%</span> magrittr<span class="sc">::</span><span class="fu">extract</span>(<span class="dv">2</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>),</span>
<span id="cb172-29"><a href="#cb172-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>(wls_f) <span class="sc">%&gt;%</span> <span class="fu">coef</span>() <span class="sc">%&gt;%</span> magrittr<span class="sc">::</span><span class="fu">extract</span>(<span class="dv">2</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb172-30"><a href="#cb172-30" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb172-31"><a href="#cb172-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb172-32"><a href="#cb172-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb172-33"><a href="#cb172-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">model =</span> <span class="fu">c</span>(<span class="st">&quot;OLS Hom.&quot;</span>, <span class="st">&quot;OLS Het.&quot;</span>, <span class="st">&quot;WLS T&quot;</span>, <span class="st">&quot;WLS F&quot;</span>),</span>
<span id="cb172-34"><a href="#cb172-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">iter =</span> i</span>
<span id="cb172-35"><a href="#cb172-35" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb172-36"><a href="#cb172-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return the data</span></span>
<span id="cb172-37"><a href="#cb172-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(iter_df)</span>
<span id="cb172-38"><a href="#cb172-38" aria-hidden="true" tabindex="-1"></a>}, </span>
<span id="cb172-39"><a href="#cb172-39" aria-hidden="true" tabindex="-1"></a> <span class="at">mc.cores =</span> <span class="dv">3</span>,  <span class="co"># not possbile on windows but on a Unix based system you can try to use more cores</span></span>
<span id="cb172-40"><a href="#cb172-40" aria-hidden="true" tabindex="-1"></a><span class="at">size =</span> n) <span class="sc">%&gt;%</span> <span class="fu">bind_rows</span>()</span>
<span id="cb172-41"><a href="#cb172-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Change names</span></span>
<span id="cb172-42"><a href="#cb172-42" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(sim_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;coef&quot;</span>, <span class="st">&quot;se&quot;</span>, <span class="st">&quot;model&quot;</span>, <span class="st">&quot;iter&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> sim_df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(model <span class="sc">!=</span> <span class="st">&quot;OLS Hom.&quot;</span>), <span class="fu">aes</span>(<span class="at">x =</span> coef, <span class="at">color =</span> model, <span class="at">fill =</span> model)) <span class="sc">+</span></span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">10</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb173-4"><a href="#cb173-4" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb173-5"><a href="#cb173-5" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Estimated coefficient&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb173-6"><a href="#cb173-6" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_color_viridis_d</span>(<span class="st">&quot;&quot;</span>,</span>
<span id="cb173-7"><a href="#cb173-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;OLS&quot;</span>, <span class="st">&quot;WLS Incorrect&quot;</span>, <span class="st">&quot;WLS Correct&quot;</span>),</span>
<span id="cb173-8"><a href="#cb173-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">end =</span> <span class="fl">0.9</span>, <span class="at">option =</span> <span class="st">&quot;C&quot;</span></span>
<span id="cb173-9"><a href="#cb173-9" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb173-10"><a href="#cb173-10" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_fill_viridis_d</span>(<span class="st">&quot;&quot;</span>,</span>
<span id="cb173-11"><a href="#cb173-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;OLS&quot;</span>, <span class="st">&quot;WLS Incorrect&quot;</span>, <span class="st">&quot;WLS Correct&quot;</span>),</span>
<span id="cb173-12"><a href="#cb173-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">end =</span> <span class="fl">0.9</span>, <span class="at">option =</span> <span class="st">&quot;C&quot;</span></span>
<span id="cb173-13"><a href="#cb173-13" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb173-14"><a href="#cb173-14" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">22</span>) <span class="sc">+</span></span>
<span id="cb173-15"><a href="#cb173-15" aria-hidden="true" tabindex="-1"></a><span class="fu">theme</span>(</span>
<span id="cb173-16"><a href="#cb173-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">85</span>,.<span class="dv">9</span>),</span>
<span id="cb173-17"><a href="#cb173-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># legend.background = element_blank(),</span></span>
<span id="cb173-18"><a href="#cb173-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">&quot;cm&quot;</span>)</span>
<span id="cb173-19"><a href="#cb173-19" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="MEM5220_R_files/figure-html/sim%20plot%20efficiency-1.png" width="80%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> sim_df, <span class="fu">aes</span>(<span class="at">x =</span> (coef<span class="dv">-10</span>)<span class="sc">/</span>se, <span class="at">color =</span> model, <span class="at">fill =</span> model)) <span class="sc">+</span></span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">qt</span>(<span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>), <span class="at">df =</span> <span class="dv">28</span>), <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;t statistic testing the true value&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Density&quot;</span>) <span class="sc">+</span></span>
<span id="cb174-6"><a href="#cb174-6" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_color_viridis_d</span>(<span class="st">&quot;&quot;</span>,</span>
<span id="cb174-7"><a href="#cb174-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;OLS + Het.-robust&quot;</span>, <span class="st">&quot;Plain OLS&quot;</span>, <span class="st">&quot;WLS Incorrect&quot;</span>, <span class="st">&quot;WLS Correct&quot;</span>),</span>
<span id="cb174-8"><a href="#cb174-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">end =</span> <span class="fl">0.9</span>, <span class="at">option =</span> <span class="st">&quot;C&quot;</span></span>
<span id="cb174-9"><a href="#cb174-9" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb174-10"><a href="#cb174-10" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_fill_viridis_d</span>(<span class="st">&quot;&quot;</span>,</span>
<span id="cb174-11"><a href="#cb174-11" aria-hidden="true" tabindex="-1"></a><span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;OLS + Het.-robust&quot;</span>, <span class="st">&quot;Plain OLS&quot;</span>, <span class="st">&quot;WLS Incorrect&quot;</span>, <span class="st">&quot;WLS Correct&quot;</span>),</span>
<span id="cb174-12"><a href="#cb174-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">end =</span> <span class="fl">0.9</span>, <span class="at">option =</span> <span class="st">&quot;C&quot;</span></span>
<span id="cb174-13"><a href="#cb174-13" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb174-14"><a href="#cb174-14" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">22</span>) <span class="sc">+</span></span>
<span id="cb174-15"><a href="#cb174-15" aria-hidden="true" tabindex="-1"></a><span class="fu">theme</span>(</span>
<span id="cb174-16"><a href="#cb174-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">85</span>,.<span class="dv">9</span>),</span>
<span id="cb174-17"><a href="#cb174-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># legend.background = element_blank(),</span></span>
<span id="cb174-18"><a href="#cb174-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">&quot;cm&quot;</span>)</span>
<span id="cb174-19"><a href="#cb174-19" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="MEM5220_R_files/figure-html/sim%20plot%20t%20stat-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p><strong>Estimation</strong>: Summary of <span class="math inline">\(\hat{\beta}_1\)</span>’s</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a>sim_df <span class="sc">%&gt;%</span></span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(model <span class="sc">!=</span> <span class="st">&quot;OLS Hom.&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Estimator =</span> dplyr<span class="sc">::</span><span class="fu">recode</span>(model,</span>
<span id="cb175-4"><a href="#cb175-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;OLS Het.&quot;</span> <span class="ot">=</span> <span class="st">&quot;OLS&quot;</span>,</span>
<span id="cb175-5"><a href="#cb175-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;WLS F&quot;</span> <span class="ot">=</span> <span class="st">&quot;WLS Incorrect&quot;</span>,</span>
<span id="cb175-6"><a href="#cb175-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;WLS T&quot;</span> <span class="ot">=</span> <span class="st">&quot;WLS Correct&quot;</span></span>
<span id="cb175-7"><a href="#cb175-7" aria-hidden="true" tabindex="-1"></a>  ))  <span class="sc">%&gt;%</span></span>
<span id="cb175-8"><a href="#cb175-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Estimator) <span class="sc">%&gt;%</span></span>
<span id="cb175-9"><a href="#cb175-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarize</span>(<span class="at">Mean =</span> <span class="fu">mean</span>(coef) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>), <span class="st">&#39;S.D.&#39;</span> <span class="ot">=</span> <span class="fu">mean</span>(coef) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb175-10"><a href="#cb175-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>() <span class="sc">%&gt;%</span></span>
<span id="cb175-11"><a href="#cb175-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> T)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Estimator
</th>
<th style="text-align:right;">
Mean
</th>
<th style="text-align:right;">
S.D.
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
OLS
</td>
<td style="text-align:right;">
9.992
</td>
<td style="text-align:right;">
9.992
</td>
</tr>
<tr>
<td style="text-align:left;">
WLS Correct
</td>
<td style="text-align:right;">
9.997
</td>
<td style="text-align:right;">
9.997
</td>
</tr>
<tr>
<td style="text-align:left;">
WLS Incorrect
</td>
<td style="text-align:right;">
9.994
</td>
<td style="text-align:right;">
9.994
</td>
</tr>
</tbody>
</table>
<p><strong>Inference:</strong> % of times we reject <span class="math inline">\(\beta_1\)</span></p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>sim_df <span class="sc">%&gt;%</span></span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Estimators =</span> dplyr<span class="sc">::</span><span class="fu">recode</span>(model,</span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;OLS Hom.&quot;</span> <span class="ot">=</span> <span class="st">&quot;OLS + Homosk.&quot;</span>,</span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;OLS Het.&quot;</span> <span class="ot">=</span> <span class="st">&quot;OLS + Het.-robust&quot;</span>,</span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;WLS F&quot;</span> <span class="ot">=</span> <span class="st">&quot;WLS Incorrect&quot;</span>,</span>
<span id="cb176-6"><a href="#cb176-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;WLS T&quot;</span> <span class="ot">=</span> <span class="st">&quot;WLS Correct&quot;</span></span>
<span id="cb176-7"><a href="#cb176-7" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb176-8"><a href="#cb176-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Estimators) <span class="sc">%&gt;%</span></span>
<span id="cb176-9"><a href="#cb176-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarize</span>(<span class="st">&#39;% Reject&#39;</span> <span class="ot">=</span> <span class="fu">mean</span>(<span class="fu">abs</span>(coef<span class="dv">-10</span>)<span class="sc">/</span>se <span class="sc">&gt;</span> <span class="fu">qt</span>(<span class="fl">0.975</span>, <span class="dv">28</span>)) <span class="sc">%&gt;%</span> magrittr<span class="sc">::</span><span class="fu">multiply_by</span>(<span class="dv">100</span>) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">3</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb176-10"><a href="#cb176-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>() <span class="sc">%&gt;%</span></span>
<span id="cb176-11"><a href="#cb176-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> T)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Estimators
</th>
<th style="text-align:right;">
% Reject
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
OLS + Het.-robust
</td>
<td style="text-align:right;">
6.6
</td>
</tr>
<tr>
<td style="text-align:left;">
OLS + Homosk.
</td>
<td style="text-align:right;">
6.6
</td>
</tr>
<tr>
<td style="text-align:left;">
WLS Correct
</td>
<td style="text-align:right;">
5.9
</td>
</tr>
<tr>
<td style="text-align:left;">
WLS Incorrect
</td>
<td style="text-align:right;">
6.5
</td>
</tr>
</tbody>
</table>
</div>
<div id="model-specification-and-parameter-heterogeneity" class="section level2" number="1.7">
<h2 number="1.7"><span class="header-section-number">1.7</span> Model specification and Parameter Heterogeneity</h2>
<div id="functional-form-misspecifcation" class="section level3" number="1.7.1">
<h3 number="1.7.1"><span class="header-section-number">1.7.1</span> Functional Form Misspecifcation</h3>
<p>We have seen many ways to specify the relation between the dependent
variable and the regressors. An obvious question is to ask whether or
not a given specification is “correct.”</p>
<div id="reset" class="section level4" number="1.7.1.1">
<h4 number="1.7.1.1"><span class="header-section-number">1.7.1.1</span> RESET</h4>
<p>The Regression Equation Specification Error Test (RESET) is a convenient
tool to test the null hypothesis that the functional form is adequate.</p>
<p>We can run the test ourselves or use the boxed routine <code>resettest()</code>
from the package <strong>lmtest</strong>.</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;hprice1&quot;</span>)</span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a><span class="co"># original linear regression</span></span>
<span id="cb177-3"><a href="#cb177-3" aria-hidden="true" tabindex="-1"></a>orig <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> lotsize<span class="sc">+</span>sqrft<span class="sc">+</span>bdrms, <span class="at">data=</span>hprice1)</span>
<span id="cb177-4"><a href="#cb177-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-5"><a href="#cb177-5" aria-hidden="true" tabindex="-1"></a><span class="co"># regression for RESET test</span></span>
<span id="cb177-6"><a href="#cb177-6" aria-hidden="true" tabindex="-1"></a>RESETreg <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> lotsize<span class="sc">+</span>sqrft<span class="sc">+</span>bdrms<span class="sc">+</span><span class="fu">I</span>(<span class="fu">fitted</span>(orig)<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb177-7"><a href="#cb177-7" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">I</span>(<span class="fu">fitted</span>(orig)<span class="sc">^</span><span class="dv">3</span>), <span class="at">data=</span>hprice1)</span>
<span id="cb177-8"><a href="#cb177-8" aria-hidden="true" tabindex="-1"></a>RESETreg</span>
<span id="cb177-9"><a href="#cb177-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-10"><a href="#cb177-10" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb177-11"><a href="#cb177-11" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> price <span class="sc">~</span> lotsize <span class="sc">+</span> sqrft <span class="sc">+</span> bdrms <span class="sc">+</span> <span class="fu">I</span>(<span class="fu">fitted</span>(orig)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb177-12"><a href="#cb177-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">I</span>(<span class="fu">fitted</span>(orig)<span class="sc">^</span><span class="dv">3</span>), <span class="at">data =</span> hprice1)</span>
<span id="cb177-13"><a href="#cb177-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-14"><a href="#cb177-14" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb177-15"><a href="#cb177-15" aria-hidden="true" tabindex="-1"></a>      (Intercept)            lotsize              sqrft              bdrms  </span>
<span id="cb177-16"><a href="#cb177-16" aria-hidden="true" tabindex="-1"></a>        <span class="fl">1.661e+02</span>          <span class="fl">1.537e-04</span>          <span class="fl">1.760e-02</span>          <span class="fl">2.175e+00</span>  </span>
<span id="cb177-17"><a href="#cb177-17" aria-hidden="true" tabindex="-1"></a><span class="fu">I</span>(<span class="fu">fitted</span>(orig)<span class="sc">^</span><span class="dv">2</span>)  <span class="fu">I</span>(<span class="fu">fitted</span>(orig)<span class="sc">^</span><span class="dv">3</span>)  </span>
<span id="cb177-18"><a href="#cb177-18" aria-hidden="true" tabindex="-1"></a>        <span class="fl">3.534e-04</span>          <span class="fl">1.546e-06</span>  </span>
<span id="cb177-19"><a href="#cb177-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-20"><a href="#cb177-20" aria-hidden="true" tabindex="-1"></a><span class="co"># RESET test. H0: all coeffs including &quot;fitted&quot; are=0</span></span>
<span id="cb177-21"><a href="#cb177-21" aria-hidden="true" tabindex="-1"></a><span class="fu">linearHypothesis</span>(RESETreg, <span class="fu">matchCoefs</span>(RESETreg,<span class="st">&quot;fitted&quot;</span>))</span></code></pre></div>
<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:unnamed-chunk-162">
<caption style="caption-side: top; text-align: center;">(#tab:unnamed-chunk-162) </caption><col><col><col><col><col><col><tr>
<th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">Res.Df</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">RSS</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">Df</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">Sum of Sq</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">F</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">Pr(&gt;F)</th></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">84</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">3.01e+05</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;"></td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">82</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">2.7e+05&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">2</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">3.07e+04</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">4.67</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.012</td></tr>
</table>

<p>Automatic routine:</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="co"># original linear regression</span></span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>orig <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> lotsize<span class="sc">+</span>sqrft<span class="sc">+</span>bdrms, <span class="at">data=</span>hprice1)</span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a><span class="co"># RESET test</span></span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a><span class="fu">resettest</span>(orig)</span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-7"><a href="#cb178-7" aria-hidden="true" tabindex="-1"></a>    RESET test</span>
<span id="cb178-8"><a href="#cb178-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-9"><a href="#cb178-9" aria-hidden="true" tabindex="-1"></a>data<span class="sc">:</span>  orig</span>
<span id="cb178-10"><a href="#cb178-10" aria-hidden="true" tabindex="-1"></a>RESET <span class="ot">=</span> <span class="fl">4.6682</span>, df1 <span class="ot">=</span> <span class="dv">2</span>, df2 <span class="ot">=</span> <span class="dv">82</span>, p<span class="sc">-</span>value <span class="ot">=</span> <span class="fl">0.01202</span></span></code></pre></div>
<p>Wooldrige (2016, Section 9.2) also discusses tests of non-nested models.
We can use the <code>encomptest()</code> function from the package <strong>lmtest</strong>.</p>
<p>Two alternative models for the housing price</p>
<span class="math display">\[\begin{equation}
price = \beta_0 + \beta_1 lotsize  +\beta_2 sqrft  +\beta_3 bdrms  + u
\end{equation}\]</span>
<span class="math display">\[\begin{equation}
price = \beta_0 + \beta_1 log(lotsize)  +\beta_2 log(sqrft)  +\beta_3 log(bdrms)  + u
\end{equation}\]</span>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="co"># two alternative models</span></span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span>     lotsize  <span class="sc">+</span>     sqrft  <span class="sc">+</span> bdrms, <span class="at">data=</span>hprice1)</span>
<span id="cb179-3"><a href="#cb179-3" aria-hidden="true" tabindex="-1"></a>model2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(price <span class="sc">~</span> <span class="fu">log</span>(lotsize) <span class="sc">+</span> <span class="fu">log</span>(sqrft) <span class="sc">+</span> bdrms, <span class="at">data=</span>hprice1)</span>
<span id="cb179-4"><a href="#cb179-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-5"><a href="#cb179-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Test against comprehensive model</span></span>
<span id="cb179-6"><a href="#cb179-6" aria-hidden="true" tabindex="-1"></a><span class="fu">encomptest</span>(model1,model2, <span class="at">data=</span>hprice1)</span></code></pre></div>
<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:unnamed-chunk-164">
<caption style="caption-side: top; text-align: center;">(#tab:unnamed-chunk-164) </caption><col><col><col><col><tr>
<th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">Res.Df</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">Df</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">F</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">Pr(&gt;F)</th></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">82</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">-2</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">7.86</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.000753</td></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">82</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-2</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">7.05</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.00149&nbsp;</td></tr>
</table>

<p>The output shows the “encompassing model” <span class="math inline">\(E\)</span> with all variables. Both
models are rejected against this comprehensive model.</p>
</div>
<div id="outlying-observations" class="section level4" number="1.7.1.2">
<h4 number="1.7.1.2"><span class="header-section-number">1.7.1.2</span> Outlying observations</h4>
<p>Dealing with outliers is a tricky business. R offers different packages
to test and adjust for outliers. But outliers can be a matter of opinion
and not all outlier detection methods give the same results.</p>
<p>We use functions from the <strong>car</strong> package to obtain a table of different
measures of leverage and influence for all observations.</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Regression</span></span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a>reg <span class="ot">&lt;-</span> <span class="fu">lm</span>(rdintens<span class="sc">~</span>sales<span class="sc">+</span>profmarg, <span class="at">data=</span>rdchem)</span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Studentized residuals for all observations:</span></span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a>studres <span class="ot">&lt;-</span> <span class="fu">rstudent</span>(reg)</span>
<span id="cb180-6"><a href="#cb180-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-7"><a href="#cb180-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Display extreme values:</span></span>
<span id="cb180-8"><a href="#cb180-8" aria-hidden="true" tabindex="-1"></a><span class="fu">min</span>(studres)</span>
<span id="cb180-9"><a href="#cb180-9" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="sc">-</span><span class="fl">1.818039</span></span>
<span id="cb180-10"><a href="#cb180-10" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(studres)</span>
<span id="cb180-11"><a href="#cb180-11" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">4.555033</span></span>
<span id="cb180-12"><a href="#cb180-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-13"><a href="#cb180-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Histogram (and overlayed density plot):</span></span>
<span id="cb180-14"><a href="#cb180-14" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(studres, <span class="at">freq=</span><span class="cn">FALSE</span>)</span>
<span id="cb180-15"><a href="#cb180-15" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(studres), <span class="at">lwd=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="MEM5220_R_files/figure-html/unnamed-chunk-165-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="missing-data" class="section level4" number="1.7.1.3">
<h4 number="1.7.1.3"><span class="header-section-number">1.7.1.3</span> Missing Data</h4>
<p>Missing values in data is a common phenomenon in real world problems. In
R, missing data can be represented by different values of the variable.</p>
<ul>
<li><strong>NA</strong> (not available) indicates that we do not have the information</li>
<li><strong>NaN</strong> (not a number) indicates that the value is not defined, for
example when we take the log of a negative number</li>
</ul>
<p>Base R offers many functions to detect missing observations. Sometimes
using <strong>mice</strong> and <strong>VIM</strong> package for looking at missing data pattern
and imputing missing data is even easier.</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;lawsch85&quot;</span>, <span class="at">package =</span> <span class="st">&quot;wooldridge&quot;</span> )</span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a><span class="co"># extract LSAT</span></span>
<span id="cb181-4"><a href="#cb181-4" aria-hidden="true" tabindex="-1"></a>lsat <span class="ot">&lt;-</span> lawsch85<span class="sc">$</span>LSAT</span>
<span id="cb181-5"><a href="#cb181-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-6"><a href="#cb181-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create logical indicator for missings</span></span>
<span id="cb181-7"><a href="#cb181-7" aria-hidden="true" tabindex="-1"></a>missLSAT <span class="ot">&lt;-</span> <span class="fu">is.na</span>(lawsch85<span class="sc">$</span>LSAT)</span>
<span id="cb181-8"><a href="#cb181-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-9"><a href="#cb181-9" aria-hidden="true" tabindex="-1"></a><span class="co"># LSAT and indicator for Schools No. 120-129:</span></span>
<span id="cb181-10"><a href="#cb181-10" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(lsat,missLSAT)[,<span class="dv">120</span><span class="sc">:</span><span class="dv">129</span>]</span>
<span id="cb181-11"><a href="#cb181-11" aria-hidden="true" tabindex="-1"></a>         [,<span class="dv">1</span>] [,<span class="dv">2</span>] [,<span class="dv">3</span>] [,<span class="dv">4</span>] [,<span class="dv">5</span>] [,<span class="dv">6</span>] [,<span class="dv">7</span>] [,<span class="dv">8</span>] [,<span class="dv">9</span>] [,<span class="dv">10</span>]</span>
<span id="cb181-12"><a href="#cb181-12" aria-hidden="true" tabindex="-1"></a>lsat      <span class="dv">156</span>  <span class="dv">159</span>  <span class="dv">157</span>  <span class="dv">167</span>   <span class="cn">NA</span>  <span class="dv">158</span>  <span class="dv">155</span>  <span class="dv">157</span>   <span class="cn">NA</span>   <span class="dv">163</span></span>
<span id="cb181-13"><a href="#cb181-13" aria-hidden="true" tabindex="-1"></a>missLSAT    <span class="dv">0</span>    <span class="dv">0</span>    <span class="dv">0</span>    <span class="dv">0</span>    <span class="dv">1</span>    <span class="dv">0</span>    <span class="dv">0</span>    <span class="dv">0</span>    <span class="dv">1</span>     <span class="dv">0</span></span>
<span id="cb181-14"><a href="#cb181-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-15"><a href="#cb181-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Frequencies of indicator</span></span>
<span id="cb181-16"><a href="#cb181-16" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(missLSAT)</span>
<span id="cb181-17"><a href="#cb181-17" aria-hidden="true" tabindex="-1"></a>missLSAT</span>
<span id="cb181-18"><a href="#cb181-18" aria-hidden="true" tabindex="-1"></a><span class="cn">FALSE</span>  <span class="cn">TRUE</span> </span>
<span id="cb181-19"><a href="#cb181-19" aria-hidden="true" tabindex="-1"></a>  <span class="dv">150</span>     <span class="dv">6</span> </span>
<span id="cb181-20"><a href="#cb181-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-21"><a href="#cb181-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Missings for all variables in data frame (counts)</span></span>
<span id="cb181-22"><a href="#cb181-22" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(<span class="fu">is.na</span>(lawsch85))</span>
<span id="cb181-23"><a href="#cb181-23" aria-hidden="true" tabindex="-1"></a>   rank  salary    cost    LSAT     GPA  libvol faculty     age  clsize   north </span>
<span id="cb181-24"><a href="#cb181-24" aria-hidden="true" tabindex="-1"></a>      <span class="dv">0</span>       <span class="dv">8</span>       <span class="dv">6</span>       <span class="dv">6</span>       <span class="dv">7</span>       <span class="dv">1</span>       <span class="dv">4</span>      <span class="dv">45</span>       <span class="dv">3</span>       <span class="dv">0</span> </span>
<span id="cb181-25"><a href="#cb181-25" aria-hidden="true" tabindex="-1"></a>  south    east    west lsalary studfac   top10  r11_25  r26_40  r41_60 llibvol </span>
<span id="cb181-26"><a href="#cb181-26" aria-hidden="true" tabindex="-1"></a>      <span class="dv">0</span>       <span class="dv">0</span>       <span class="dv">0</span>       <span class="dv">8</span>       <span class="dv">6</span>       <span class="dv">0</span>       <span class="dv">0</span>       <span class="dv">0</span>       <span class="dv">0</span>       <span class="dv">1</span> </span>
<span id="cb181-27"><a href="#cb181-27" aria-hidden="true" tabindex="-1"></a>  lcost </span>
<span id="cb181-28"><a href="#cb181-28" aria-hidden="true" tabindex="-1"></a>      <span class="dv">6</span> </span>
<span id="cb181-29"><a href="#cb181-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-30"><a href="#cb181-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Indicator for complete cases</span></span>
<span id="cb181-31"><a href="#cb181-31" aria-hidden="true" tabindex="-1"></a>compl <span class="ot">&lt;-</span> <span class="fu">complete.cases</span>(lawsch85)</span>
<span id="cb181-32"><a href="#cb181-32" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(compl)</span>
<span id="cb181-33"><a href="#cb181-33" aria-hidden="true" tabindex="-1"></a>compl</span>
<span id="cb181-34"><a href="#cb181-34" aria-hidden="true" tabindex="-1"></a><span class="cn">FALSE</span>  <span class="cn">TRUE</span> </span>
<span id="cb181-35"><a href="#cb181-35" aria-hidden="true" tabindex="-1"></a>   <span class="dv">66</span>    <span class="dv">90</span> </span>
<span id="cb181-36"><a href="#cb181-36" aria-hidden="true" tabindex="-1"></a><span class="co"># MICE package function to display msising values</span></span>
<span id="cb181-37"><a href="#cb181-37" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">md.pattern</span>(lawsch85, <span class="at">plot =</span> <span class="cn">FALSE</span>))</span>
<span id="cb181-38"><a href="#cb181-38" aria-hidden="true" tabindex="-1"></a>   rank north south east west top10 r11_25 r26_40 r41_60 libvol llibvol clsize</span>
<span id="cb181-39"><a href="#cb181-39" aria-hidden="true" tabindex="-1"></a><span class="dv">90</span>    <span class="dv">1</span>     <span class="dv">1</span>     <span class="dv">1</span>    <span class="dv">1</span>    <span class="dv">1</span>     <span class="dv">1</span>      <span class="dv">1</span>      <span class="dv">1</span>      <span class="dv">1</span>      <span class="dv">1</span>       <span class="dv">1</span>      <span class="dv">1</span></span>
<span id="cb181-40"><a href="#cb181-40" aria-hidden="true" tabindex="-1"></a><span class="dv">41</span>    <span class="dv">1</span>     <span class="dv">1</span>     <span class="dv">1</span>    <span class="dv">1</span>    <span class="dv">1</span>     <span class="dv">1</span>      <span class="dv">1</span>      <span class="dv">1</span>      <span class="dv">1</span>      <span class="dv">1</span>       <span class="dv">1</span>      <span class="dv">1</span></span>
<span id="cb181-41"><a href="#cb181-41" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>     <span class="dv">1</span>     <span class="dv">1</span>     <span class="dv">1</span>    <span class="dv">1</span>    <span class="dv">1</span>     <span class="dv">1</span>      <span class="dv">1</span>      <span class="dv">1</span>      <span class="dv">1</span>      <span class="dv">1</span>       <span class="dv">1</span>      <span class="dv">1</span></span>
<span id="cb181-42"><a href="#cb181-42" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>     <span class="dv">1</span>     <span class="dv">1</span>     <span class="dv">1</span>    <span class="dv">1</span>    <span class="dv">1</span>     <span class="dv">1</span>      <span class="dv">1</span>      <span class="dv">1</span>      <span class="dv">1</span>      <span class="dv">1</span>       <span class="dv">1</span>      <span class="dv">1</span></span>
<span id="cb181-43"><a href="#cb181-43" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>     <span class="dv">1</span>     <span class="dv">1</span>     <span class="dv">1</span>    <span class="dv">1</span>    <span class="dv">1</span>     <span class="dv">1</span>      <span class="dv">1</span>      <span class="dv">1</span>      <span class="dv">1</span>      <span class="dv">1</span>       <span class="dv">1</span>      <span class="dv">1</span></span>
<span id="cb181-44"><a href="#cb181-44" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>     <span class="dv">1</span>     <span class="dv">1</span>     <span class="dv">1</span>    <span class="dv">1</span>    <span class="dv">1</span>     <span class="dv">1</span>      <span class="dv">1</span>      <span class="dv">1</span>      <span class="dv">1</span>      <span class="dv">1</span>       <span class="dv">1</span>      <span class="dv">1</span></span>
<span id="cb181-45"><a href="#cb181-45" aria-hidden="true" tabindex="-1"></a>   faculty cost LSAT studfac lcost GPA salary lsalary age  </span>
<span id="cb181-46"><a href="#cb181-46" aria-hidden="true" tabindex="-1"></a><span class="dv">90</span>       <span class="dv">1</span>    <span class="dv">1</span>    <span class="dv">1</span>       <span class="dv">1</span>     <span class="dv">1</span>   <span class="dv">1</span>      <span class="dv">1</span>       <span class="dv">1</span>   <span class="dv">1</span> <span class="dv">0</span></span>
<span id="cb181-47"><a href="#cb181-47" aria-hidden="true" tabindex="-1"></a><span class="dv">41</span>       <span class="dv">1</span>    <span class="dv">1</span>    <span class="dv">1</span>       <span class="dv">1</span>     <span class="dv">1</span>   <span class="dv">1</span>      <span class="dv">1</span>       <span class="dv">1</span>   <span class="dv">0</span> <span class="dv">1</span></span>
<span id="cb181-48"><a href="#cb181-48" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>        <span class="dv">1</span>    <span class="dv">1</span>    <span class="dv">1</span>       <span class="dv">1</span>     <span class="dv">1</span>   <span class="dv">1</span>      <span class="dv">0</span>       <span class="dv">0</span>   <span class="dv">1</span> <span class="dv">2</span></span>
<span id="cb181-49"><a href="#cb181-49" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>        <span class="dv">1</span>    <span class="dv">1</span>    <span class="dv">1</span>       <span class="dv">1</span>     <span class="dv">1</span>   <span class="dv">1</span>      <span class="dv">0</span>       <span class="dv">0</span>   <span class="dv">0</span> <span class="dv">3</span></span>
<span id="cb181-50"><a href="#cb181-50" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>        <span class="dv">1</span>    <span class="dv">1</span>    <span class="dv">0</span>       <span class="dv">1</span>     <span class="dv">1</span>   <span class="dv">0</span>      <span class="dv">1</span>       <span class="dv">1</span>   <span class="dv">1</span> <span class="dv">2</span></span>
<span id="cb181-51"><a href="#cb181-51" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>        <span class="dv">1</span>    <span class="dv">1</span>    <span class="dv">0</span>       <span class="dv">1</span>     <span class="dv">1</span>   <span class="dv">0</span>      <span class="dv">1</span>       <span class="dv">1</span>   <span class="dv">0</span> <span class="dv">3</span></span></code></pre></div>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>aggr_plot <span class="ot">&lt;-</span> <span class="fu">aggr</span>(lawsch85, <span class="at">col=</span><span class="fu">c</span>(<span class="st">&#39;navyblue&#39;</span>,<span class="st">&#39;red&#39;</span>), <span class="at">numbers=</span><span class="cn">TRUE</span>, <span class="at">sortVars=</span><span class="cn">TRUE</span>, <span class="at">labels=</span><span class="fu">names</span>(lawsch85), <span class="at">cex.axis=</span>.<span class="dv">7</span>, <span class="at">gap=</span><span class="dv">3</span>, <span class="at">ylab=</span><span class="fu">c</span>(<span class="st">&quot;Histogram of missing data&quot;</span>,<span class="st">&quot;Pattern&quot;</span>))</span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a> Variables sorted by number of missings<span class="sc">:</span> </span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a> Variable       Count</span>
<span id="cb182-5"><a href="#cb182-5" aria-hidden="true" tabindex="-1"></a>      age <span class="fl">0.288461538</span></span>
<span id="cb182-6"><a href="#cb182-6" aria-hidden="true" tabindex="-1"></a>   salary <span class="fl">0.051282051</span></span>
<span id="cb182-7"><a href="#cb182-7" aria-hidden="true" tabindex="-1"></a>  lsalary <span class="fl">0.051282051</span></span>
<span id="cb182-8"><a href="#cb182-8" aria-hidden="true" tabindex="-1"></a>      GPA <span class="fl">0.044871795</span></span>
<span id="cb182-9"><a href="#cb182-9" aria-hidden="true" tabindex="-1"></a>     cost <span class="fl">0.038461538</span></span>
<span id="cb182-10"><a href="#cb182-10" aria-hidden="true" tabindex="-1"></a>     LSAT <span class="fl">0.038461538</span></span>
<span id="cb182-11"><a href="#cb182-11" aria-hidden="true" tabindex="-1"></a>  studfac <span class="fl">0.038461538</span></span>
<span id="cb182-12"><a href="#cb182-12" aria-hidden="true" tabindex="-1"></a>    lcost <span class="fl">0.038461538</span></span>
<span id="cb182-13"><a href="#cb182-13" aria-hidden="true" tabindex="-1"></a>  faculty <span class="fl">0.025641026</span></span>
<span id="cb182-14"><a href="#cb182-14" aria-hidden="true" tabindex="-1"></a>   clsize <span class="fl">0.019230769</span></span>
<span id="cb182-15"><a href="#cb182-15" aria-hidden="true" tabindex="-1"></a>   libvol <span class="fl">0.006410256</span></span>
<span id="cb182-16"><a href="#cb182-16" aria-hidden="true" tabindex="-1"></a>  llibvol <span class="fl">0.006410256</span></span>
<span id="cb182-17"><a href="#cb182-17" aria-hidden="true" tabindex="-1"></a>     rank <span class="fl">0.000000000</span></span>
<span id="cb182-18"><a href="#cb182-18" aria-hidden="true" tabindex="-1"></a>    north <span class="fl">0.000000000</span></span>
<span id="cb182-19"><a href="#cb182-19" aria-hidden="true" tabindex="-1"></a>    south <span class="fl">0.000000000</span></span>
<span id="cb182-20"><a href="#cb182-20" aria-hidden="true" tabindex="-1"></a>     east <span class="fl">0.000000000</span></span>
<span id="cb182-21"><a href="#cb182-21" aria-hidden="true" tabindex="-1"></a>     west <span class="fl">0.000000000</span></span>
<span id="cb182-22"><a href="#cb182-22" aria-hidden="true" tabindex="-1"></a>    top10 <span class="fl">0.000000000</span></span>
<span id="cb182-23"><a href="#cb182-23" aria-hidden="true" tabindex="-1"></a>   r11_25 <span class="fl">0.000000000</span></span>
<span id="cb182-24"><a href="#cb182-24" aria-hidden="true" tabindex="-1"></a>   r26_40 <span class="fl">0.000000000</span></span>
<span id="cb182-25"><a href="#cb182-25" aria-hidden="true" tabindex="-1"></a>   r41_60 <span class="fl">0.000000000</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="MEM5220_R_files/figure-html/fig20-1.png" alt="Visualizing missing data" width="80%" />
<p class="caption">
(#fig:fig20)Visualizing missing data
</p>
</div>
<p>Regression command like <code>lm()</code> have as argument <strong>na.rm=TRUE</strong>!</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Mean of a variable with missings:</span></span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(lawsch85<span class="sc">$</span>LSAT)</span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="cn">NA</span></span>
<span id="cb183-4"><a href="#cb183-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(lawsch85<span class="sc">$</span>LSAT,<span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb183-5"><a href="#cb183-5" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">158.2933</span></span>
<span id="cb183-6"><a href="#cb183-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-7"><a href="#cb183-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Regression with missings</span></span>
<span id="cb183-8"><a href="#cb183-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(<span class="fu">log</span>(salary)<span class="sc">~</span>LSAT<span class="sc">+</span>cost<span class="sc">+</span>age, <span class="at">data=</span>lawsch85))</span>
<span id="cb183-9"><a href="#cb183-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-10"><a href="#cb183-10" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb183-11"><a href="#cb183-11" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> <span class="fu">log</span>(salary) <span class="sc">~</span> LSAT <span class="sc">+</span> cost <span class="sc">+</span> age, <span class="at">data =</span> lawsch85)</span>
<span id="cb183-12"><a href="#cb183-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-13"><a href="#cb183-13" aria-hidden="true" tabindex="-1"></a>Residuals<span class="sc">:</span></span>
<span id="cb183-14"><a href="#cb183-14" aria-hidden="true" tabindex="-1"></a>     Min       1Q   Median       3Q      Max </span>
<span id="cb183-15"><a href="#cb183-15" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">0.40989</span> <span class="sc">-</span><span class="fl">0.09438</span>  <span class="fl">0.00317</span>  <span class="fl">0.10436</span>  <span class="fl">0.45483</span> </span>
<span id="cb183-16"><a href="#cb183-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-17"><a href="#cb183-17" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb183-18"><a href="#cb183-18" aria-hidden="true" tabindex="-1"></a>             Estimate Std. Error t value <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)    </span>
<span id="cb183-19"><a href="#cb183-19" aria-hidden="true" tabindex="-1"></a>(Intercept) <span class="fl">4.384e+00</span>  <span class="fl">6.781e-01</span>   <span class="fl">6.465</span> <span class="fl">4.94e-09</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb183-20"><a href="#cb183-20" aria-hidden="true" tabindex="-1"></a>LSAT        <span class="fl">3.722e-02</span>  <span class="fl">4.501e-03</span>   <span class="fl">8.269</span> <span class="fl">1.06e-12</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb183-21"><a href="#cb183-21" aria-hidden="true" tabindex="-1"></a>cost        <span class="fl">1.114e-05</span>  <span class="fl">4.321e-06</span>   <span class="fl">2.577</span> <span class="fl">0.011563</span> <span class="sc">*</span>  </span>
<span id="cb183-22"><a href="#cb183-22" aria-hidden="true" tabindex="-1"></a>age         <span class="fl">1.503e-03</span>  <span class="fl">4.354e-04</span>   <span class="fl">3.453</span> <span class="fl">0.000843</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb183-23"><a href="#cb183-23" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb183-24"><a href="#cb183-24" aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span>
<span id="cb183-25"><a href="#cb183-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-26"><a href="#cb183-26" aria-hidden="true" tabindex="-1"></a>Residual standard error<span class="sc">:</span> <span class="fl">0.1545</span> on <span class="dv">91</span> degrees of freedom</span>
<span id="cb183-27"><a href="#cb183-27" aria-hidden="true" tabindex="-1"></a>  (<span class="dv">61</span> observations deleted due to missingness)</span>
<span id="cb183-28"><a href="#cb183-28" aria-hidden="true" tabindex="-1"></a>Multiple R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.6708</span>,    Adjusted R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.6599</span> </span>
<span id="cb183-29"><a href="#cb183-29" aria-hidden="true" tabindex="-1"></a>F<span class="sc">-</span>statistic<span class="sc">:</span> <span class="fl">61.81</span> on <span class="dv">3</span> and <span class="dv">91</span> DF,  p<span class="sc">-</span>value<span class="sc">:</span> <span class="er">&lt;</span> <span class="fl">2.2e-16</span></span></code></pre></div>
<p>R packages provide multiple imputation algorithms. Without going into
detail how those algorithms work, we can use for example the
<strong>meth=“pmm”</strong> argument from the <strong>mice</strong> package to apply a predictive
mean matching as imputation method.</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We use a diffferent dataset to speed up the imputation process</span></span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> airquality</span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a>data[<span class="dv">4</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>,<span class="dv">7</span>)</span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a>data[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,<span class="dv">4</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb184-5"><a href="#cb184-5" aria-hidden="true" tabindex="-1"></a><span class="co"># tempData &lt;- mice(data,m=5,maxit=50,meth=&#39;pmm&#39;,seed=500)</span></span></code></pre></div>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(tempData)</span></span></code></pre></div>
</div>
</div>
</div>
<div id="least-absolute-deviations-lad-estimation" class="section level2" number="1.8">
<h2 number="1.8"><span class="header-section-number">1.8</span> Least absolute Deviations (LAD) Estimation</h2>
<p>As an alternative to OLS, the least absolute deviations (LAD) is less
sensitive to outliers. Instead of minimizing the sum of <em>squared</em>
residuals, it minimizes the sum of the <em>absolute values</em> of the
residuals.</p>
<p>In R, general quantile regression (and LAD as the default special case)
can easily be implemented with the command <code>reg()</code> from the <strong>quantreg</strong>
package.</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="co"># OLS Regression</span></span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a>ols <span class="ot">&lt;-</span> <span class="fu">lm</span>(rdintens <span class="sc">~</span> <span class="fu">I</span>(sales<span class="sc">/</span><span class="dv">1000</span>) <span class="sc">+</span>profmarg, <span class="at">data=</span>rdchem)</span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a><span class="co"># LAD Regression</span></span>
<span id="cb186-4"><a href="#cb186-4" aria-hidden="true" tabindex="-1"></a>lad <span class="ot">&lt;-</span> quantreg<span class="sc">::</span><span class="fu">rq</span>(rdintens <span class="sc">~</span> <span class="fu">I</span>(sales<span class="sc">/</span><span class="dv">1000</span>) <span class="sc">+</span>profmarg, <span class="at">data=</span>rdchem)</span></code></pre></div>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LAD Regression</span></span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a>lad <span class="ot">&lt;-</span> quantreg<span class="sc">::</span><span class="fu">rq</span>(rdintens <span class="sc">~</span> <span class="fu">I</span>(sales<span class="sc">/</span><span class="dv">1000</span>) <span class="sc">+</span>profmarg, <span class="at">data=</span>rdchem)</span></code></pre></div>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="co"># regression table</span></span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>texreg<span class="sc">::</span><span class="fu">screenreg</span>(<span class="fu">list</span>(ols, lad), <span class="at">custom.model.names =</span> <span class="fu">c</span>(<span class="st">&quot;OLS&quot;</span>, <span class="st">&quot;Quantreg&quot;</span>))</span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a><span class="sc">==</span><span class="er">==============================</span></span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a>             OLS        Quantreg</span>
<span id="cb188-6"><a href="#cb188-6" aria-hidden="true" tabindex="-1"></a><span class="sc">--------------------------------</span></span>
<span id="cb188-7"><a href="#cb188-7" aria-hidden="true" tabindex="-1"></a>(Intercept)   <span class="fl">2.63</span> <span class="sc">**</span><span class="er">*</span>   <span class="fl">1.62</span> <span class="sc">**</span></span>
<span id="cb188-8"><a href="#cb188-8" aria-hidden="true" tabindex="-1"></a>             (<span class="fl">0.59</span>)     (<span class="fl">0.51</span>)  </span>
<span id="cb188-9"><a href="#cb188-9" aria-hidden="true" tabindex="-1"></a>sales<span class="sc">/</span><span class="dv">1000</span>    <span class="fl">0.05</span>       <span class="fl">0.02</span>   </span>
<span id="cb188-10"><a href="#cb188-10" aria-hidden="true" tabindex="-1"></a>             (<span class="fl">0.04</span>)     (<span class="fl">0.06</span>)  </span>
<span id="cb188-11"><a href="#cb188-11" aria-hidden="true" tabindex="-1"></a>profmarg      <span class="fl">0.04</span>       <span class="fl">0.12</span> <span class="sc">*</span> </span>
<span id="cb188-12"><a href="#cb188-12" aria-hidden="true" tabindex="-1"></a>             (<span class="fl">0.05</span>)     (<span class="fl">0.05</span>)  </span>
<span id="cb188-13"><a href="#cb188-13" aria-hidden="true" tabindex="-1"></a><span class="sc">--------------------------------</span></span>
<span id="cb188-14"><a href="#cb188-14" aria-hidden="true" tabindex="-1"></a>R<span class="sc">^</span><span class="dv">2</span>           <span class="fl">0.08</span>              </span>
<span id="cb188-15"><a href="#cb188-15" aria-hidden="true" tabindex="-1"></a>Adj. R<span class="sc">^</span><span class="dv">2</span>      <span class="fl">0.01</span>              </span>
<span id="cb188-16"><a href="#cb188-16" aria-hidden="true" tabindex="-1"></a>Num. obs.    <span class="dv">32</span>         <span class="dv">32</span>      </span>
<span id="cb188-17"><a href="#cb188-17" aria-hidden="true" tabindex="-1"></a>Percentile               <span class="fl">0.50</span>   </span>
<span id="cb188-18"><a href="#cb188-18" aria-hidden="true" tabindex="-1"></a><span class="sc">==</span><span class="er">==============================</span></span>
<span id="cb188-19"><a href="#cb188-19" aria-hidden="true" tabindex="-1"></a><span class="er">***</span> p <span class="sc">&lt;</span> <span class="fl">0.001</span>; <span class="sc">**</span> p <span class="sc">&lt;</span> <span class="fl">0.01</span>; <span class="sc">*</span> p <span class="sc">&lt;</span> <span class="fl">0.05</span></span></code></pre></div>
<p>Note: LAD inferences are only valid asymptotically, so the results in
this example with <span class="math inline">\(n =32\)</span> should be taken with caution.</p>
</div>
<div id="quantile-regression" class="section level2" number="1.9">
<h2 number="1.9"><span class="header-section-number">1.9</span> Quantile regression</h2>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a>ols_mtcar <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg <span class="sc">~</span> disp <span class="sc">+</span> hp <span class="sc">+</span> <span class="fu">factor</span>(am) <span class="sc">+</span> <span class="fu">factor</span>(vs), <span class="at">data =</span> mtcars)</span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ols_mtcar)</span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb189-5"><a href="#cb189-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> mpg <span class="sc">~</span> disp <span class="sc">+</span> hp <span class="sc">+</span> <span class="fu">factor</span>(am) <span class="sc">+</span> <span class="fu">factor</span>(vs), <span class="at">data =</span> mtcars)</span>
<span id="cb189-6"><a href="#cb189-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-7"><a href="#cb189-7" aria-hidden="true" tabindex="-1"></a>Residuals<span class="sc">:</span></span>
<span id="cb189-8"><a href="#cb189-8" aria-hidden="true" tabindex="-1"></a>    Min      1Q  Median      3Q     Max </span>
<span id="cb189-9"><a href="#cb189-9" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">4.7981</span> <span class="sc">-</span><span class="fl">1.9532</span>  <span class="fl">0.0111</span>  <span class="fl">1.5665</span>  <span class="fl">5.6321</span> </span>
<span id="cb189-10"><a href="#cb189-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-11"><a href="#cb189-11" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb189-12"><a href="#cb189-12" aria-hidden="true" tabindex="-1"></a>             Estimate Std. Error t value <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)    </span>
<span id="cb189-13"><a href="#cb189-13" aria-hidden="true" tabindex="-1"></a>(Intercept) <span class="fl">24.832119</span>   <span class="fl">2.890418</span>   <span class="fl">8.591</span> <span class="fl">3.32e-09</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb189-14"><a href="#cb189-14" aria-hidden="true" tabindex="-1"></a>disp        <span class="sc">-</span><span class="fl">0.008304</span>   <span class="fl">0.010087</span>  <span class="sc">-</span><span class="fl">0.823</span>  <span class="fl">0.41757</span>    </span>
<span id="cb189-15"><a href="#cb189-15" aria-hidden="true" tabindex="-1"></a>hp          <span class="sc">-</span><span class="fl">0.037623</span>   <span class="fl">0.013846</span>  <span class="sc">-</span><span class="fl">2.717</span>  <span class="fl">0.01135</span> <span class="sc">*</span>  </span>
<span id="cb189-16"><a href="#cb189-16" aria-hidden="true" tabindex="-1"></a><span class="fu">factor</span>(am)<span class="dv">1</span>  <span class="fl">4.419257</span>   <span class="fl">1.493243</span>   <span class="fl">2.960</span>  <span class="fl">0.00634</span> <span class="sc">**</span> </span>
<span id="cb189-17"><a href="#cb189-17" aria-hidden="true" tabindex="-1"></a><span class="fu">factor</span>(vs)<span class="dv">1</span>  <span class="fl">2.052472</span>   <span class="fl">1.627096</span>   <span class="fl">1.261</span>  <span class="fl">0.21794</span>    </span>
<span id="cb189-18"><a href="#cb189-18" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb189-19"><a href="#cb189-19" aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span>
<span id="cb189-20"><a href="#cb189-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-21"><a href="#cb189-21" aria-hidden="true" tabindex="-1"></a>Residual standard error<span class="sc">:</span> <span class="fl">2.812</span> on <span class="dv">27</span> degrees of freedom</span>
<span id="cb189-22"><a href="#cb189-22" aria-hidden="true" tabindex="-1"></a>Multiple R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.8104</span>,    Adjusted R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.7823</span> </span>
<span id="cb189-23"><a href="#cb189-23" aria-hidden="true" tabindex="-1"></a>F<span class="sc">-</span>statistic<span class="sc">:</span> <span class="fl">28.85</span> on <span class="dv">4</span> and <span class="dv">27</span> DF,  p<span class="sc">-</span>value<span class="sc">:</span> <span class="fl">2.13e-09</span></span></code></pre></div>
<p>We estimate conditional quantile regressions, in the range of the 25%,
50% and 75% quantile (not that this remains linear). Standard errors are
obtained via bootstrapping.<a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a></p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a>ls_fl_quantiles <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.50</span>, <span class="fl">0.75</span>)</span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a>fit_quantiles <span class="ot">&lt;-</span> <span class="fu">rq</span>(mpg <span class="sc">~</span> disp <span class="sc">+</span> hp <span class="sc">+</span> <span class="fu">factor</span>(am),</span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">tau =</span> ls_fl_quantiles,</span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> mtcars)</span>
<span id="cb190-5"><a href="#cb190-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_quantiles, <span class="at">se =</span> <span class="st">&quot;boot&quot;</span>)</span>
<span id="cb190-6"><a href="#cb190-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-7"><a href="#cb190-7" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span> <span class="fu">rq</span>(<span class="at">formula =</span> mpg <span class="sc">~</span> disp <span class="sc">+</span> hp <span class="sc">+</span> <span class="fu">factor</span>(am), <span class="at">tau =</span> ls_fl_quantiles, </span>
<span id="cb190-8"><a href="#cb190-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> mtcars)</span>
<span id="cb190-9"><a href="#cb190-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-10"><a href="#cb190-10" aria-hidden="true" tabindex="-1"></a>tau<span class="sc">:</span> [<span class="dv">1</span>] <span class="fl">0.25</span></span>
<span id="cb190-11"><a href="#cb190-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-12"><a href="#cb190-12" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb190-13"><a href="#cb190-13" aria-hidden="true" tabindex="-1"></a>            Value    Std. Error t value  <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)</span>
<span id="cb190-14"><a href="#cb190-14" aria-hidden="true" tabindex="-1"></a>(Intercept) <span class="fl">25.34665</span>  <span class="fl">1.52247</span>   <span class="fl">16.64841</span>  <span class="fl">0.00000</span></span>
<span id="cb190-15"><a href="#cb190-15" aria-hidden="true" tabindex="-1"></a>disp        <span class="sc">-</span><span class="fl">0.02441</span>  <span class="fl">0.00823</span>   <span class="sc">-</span><span class="fl">2.96455</span>  <span class="fl">0.00613</span></span>
<span id="cb190-16"><a href="#cb190-16" aria-hidden="true" tabindex="-1"></a>hp          <span class="sc">-</span><span class="fl">0.01672</span>  <span class="fl">0.01716</span>   <span class="sc">-</span><span class="fl">0.97436</span>  <span class="fl">0.33822</span></span>
<span id="cb190-17"><a href="#cb190-17" aria-hidden="true" tabindex="-1"></a><span class="fu">factor</span>(am)<span class="dv">1</span>  <span class="fl">1.39719</span>  <span class="fl">1.39658</span>    <span class="fl">1.00044</span>  <span class="fl">0.32567</span></span>
<span id="cb190-18"><a href="#cb190-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-19"><a href="#cb190-19" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span> <span class="fu">rq</span>(<span class="at">formula =</span> mpg <span class="sc">~</span> disp <span class="sc">+</span> hp <span class="sc">+</span> <span class="fu">factor</span>(am), <span class="at">tau =</span> ls_fl_quantiles, </span>
<span id="cb190-20"><a href="#cb190-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> mtcars)</span>
<span id="cb190-21"><a href="#cb190-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-22"><a href="#cb190-22" aria-hidden="true" tabindex="-1"></a>tau<span class="sc">:</span> [<span class="dv">1</span>] <span class="fl">0.5</span></span>
<span id="cb190-23"><a href="#cb190-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-24"><a href="#cb190-24" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb190-25"><a href="#cb190-25" aria-hidden="true" tabindex="-1"></a>            Value    Std. Error t value  <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)</span>
<span id="cb190-26"><a href="#cb190-26" aria-hidden="true" tabindex="-1"></a>(Intercept) <span class="fl">27.49722</span>  <span class="fl">1.84464</span>   <span class="fl">14.90651</span>  <span class="fl">0.00000</span></span>
<span id="cb190-27"><a href="#cb190-27" aria-hidden="true" tabindex="-1"></a>disp        <span class="sc">-</span><span class="fl">0.02253</span>  <span class="fl">0.01613</span>   <span class="sc">-</span><span class="fl">1.39695</span>  <span class="fl">0.17340</span></span>
<span id="cb190-28"><a href="#cb190-28" aria-hidden="true" tabindex="-1"></a>hp          <span class="sc">-</span><span class="fl">0.02713</span>  <span class="fl">0.02393</span>   <span class="sc">-</span><span class="fl">1.13382</span>  <span class="fl">0.26648</span></span>
<span id="cb190-29"><a href="#cb190-29" aria-hidden="true" tabindex="-1"></a><span class="fu">factor</span>(am)<span class="dv">1</span>  <span class="fl">3.37328</span>  <span class="fl">1.99790</span>    <span class="fl">1.68842</span>  <span class="fl">0.10244</span></span>
<span id="cb190-30"><a href="#cb190-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-31"><a href="#cb190-31" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span> <span class="fu">rq</span>(<span class="at">formula =</span> mpg <span class="sc">~</span> disp <span class="sc">+</span> hp <span class="sc">+</span> <span class="fu">factor</span>(am), <span class="at">tau =</span> ls_fl_quantiles, </span>
<span id="cb190-32"><a href="#cb190-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> mtcars)</span>
<span id="cb190-33"><a href="#cb190-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-34"><a href="#cb190-34" aria-hidden="true" tabindex="-1"></a>tau<span class="sc">:</span> [<span class="dv">1</span>] <span class="fl">0.75</span></span>
<span id="cb190-35"><a href="#cb190-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-36"><a href="#cb190-36" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb190-37"><a href="#cb190-37" aria-hidden="true" tabindex="-1"></a>            Value    Std. Error t value  <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)</span>
<span id="cb190-38"><a href="#cb190-38" aria-hidden="true" tabindex="-1"></a>(Intercept) <span class="fl">28.06384</span>  <span class="fl">1.58871</span>   <span class="fl">17.66451</span>  <span class="fl">0.00000</span></span>
<span id="cb190-39"><a href="#cb190-39" aria-hidden="true" tabindex="-1"></a>disp         <span class="fl">0.00445</span>  <span class="fl">0.01282</span>    <span class="fl">0.34728</span>  <span class="fl">0.73098</span></span>
<span id="cb190-40"><a href="#cb190-40" aria-hidden="true" tabindex="-1"></a>hp          <span class="sc">-</span><span class="fl">0.06662</span>  <span class="fl">0.01682</span>   <span class="sc">-</span><span class="fl">3.96147</span>  <span class="fl">0.00047</span></span>
<span id="cb190-41"><a href="#cb190-41" aria-hidden="true" tabindex="-1"></a><span class="fu">factor</span>(am)<span class="dv">1</span>  <span class="fl">7.91402</span>  <span class="fl">2.47356</span>    <span class="fl">3.19944</span>  <span class="fl">0.00341</span></span></code></pre></div>
<p>Note for example that the sign of disp reverses at the 75th quantile
compared with the OLS estimate. Also note that there seems to be a
gradient at the quantile hp coefficients as well as disp.</p>
<p>There are differences between the 0.25 and 0.50 quantiles. Are those
difference between 25th and 50th conditional quantiles statistically
significant?</p>
<p>First, joint = TRUE. This is not testing if the coefficien on disp is
the same as the coefficient on hp. This is testing jointly if the
coefficients for different quantiles of disp, and different quantiles of
hp are the same for each RHS variable.</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a>ls_fl_quantiles <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.50</span>)</span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>fit_quantiles <span class="ot">&lt;-</span> <span class="fu">rq</span>(mpg <span class="sc">~</span> disp <span class="sc">+</span> hp <span class="sc">+</span> <span class="fu">factor</span>(am),</span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">tau =</span> ls_fl_quantiles,</span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> mtcars)</span>
<span id="cb191-5"><a href="#cb191-5" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fit_quantiles, <span class="at">test =</span> <span class="st">&quot;Wald&quot;</span>, <span class="at">joint=</span><span class="cn">TRUE</span>)</span>
<span id="cb191-6"><a href="#cb191-6" aria-hidden="true" tabindex="-1"></a>Quantile Regression Analysis of Deviance Table</span>
<span id="cb191-7"><a href="#cb191-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-8"><a href="#cb191-8" aria-hidden="true" tabindex="-1"></a>Model<span class="sc">:</span> mpg <span class="sc">~</span> disp <span class="sc">+</span> hp <span class="sc">+</span> <span class="fu">factor</span>(am)</span>
<span id="cb191-9"><a href="#cb191-9" aria-hidden="true" tabindex="-1"></a>Joint Test of Equality of Slopes<span class="sc">:</span> tau <span class="cf">in</span> {  <span class="fl">0.25</span> <span class="fl">0.5</span>  }</span>
<span id="cb191-10"><a href="#cb191-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-11"><a href="#cb191-11" aria-hidden="true" tabindex="-1"></a>  Df Resid Df F value <span class="fu">Pr</span>(<span class="sc">&gt;</span>F)</span>
<span id="cb191-12"><a href="#cb191-12" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="dv">3</span>       <span class="dv">61</span>  <span class="fl">0.8421</span> <span class="fl">0.4761</span></span></code></pre></div>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fit_quantiles, <span class="at">test =</span> <span class="st">&quot;Wald&quot;</span>, <span class="at">joint=</span><span class="cn">TRUE</span>)</span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a>Quantile Regression Analysis of Deviance Table</span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a>Model<span class="sc">:</span> mpg <span class="sc">~</span> disp <span class="sc">+</span> hp <span class="sc">+</span> <span class="fu">factor</span>(am)</span>
<span id="cb192-5"><a href="#cb192-5" aria-hidden="true" tabindex="-1"></a>Joint Test of Equality of Slopes<span class="sc">:</span> tau <span class="cf">in</span> {  <span class="fl">0.25</span> <span class="fl">0.5</span>  }</span>
<span id="cb192-6"><a href="#cb192-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-7"><a href="#cb192-7" aria-hidden="true" tabindex="-1"></a>  Df Resid Df F value <span class="fu">Pr</span>(<span class="sc">&gt;</span>F)</span>
<span id="cb192-8"><a href="#cb192-8" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="dv">3</span>       <span class="dv">61</span>  <span class="fl">0.8421</span> <span class="fl">0.4761</span></span></code></pre></div>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fit_quantiles, <span class="at">test =</span> <span class="st">&quot;Wald&quot;</span>, <span class="at">joint=</span><span class="cn">FALSE</span>)</span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a>Quantile Regression Analysis of Deviance Table</span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a>Model<span class="sc">:</span> mpg <span class="sc">~</span> disp <span class="sc">+</span> hp <span class="sc">+</span> <span class="fu">factor</span>(am)</span>
<span id="cb193-5"><a href="#cb193-5" aria-hidden="true" tabindex="-1"></a>Tests of Equality of Distinct Slopes<span class="sc">:</span> tau <span class="cf">in</span> {  <span class="fl">0.25</span> <span class="fl">0.5</span>  }</span>
<span id="cb193-6"><a href="#cb193-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-7"><a href="#cb193-7" aria-hidden="true" tabindex="-1"></a>            Df Resid Df F value <span class="fu">Pr</span>(<span class="sc">&gt;</span>F)</span>
<span id="cb193-8"><a href="#cb193-8" aria-hidden="true" tabindex="-1"></a>disp         <span class="dv">1</span>       <span class="dv">63</span>  <span class="fl">0.0305</span> <span class="fl">0.8619</span></span>
<span id="cb193-9"><a href="#cb193-9" aria-hidden="true" tabindex="-1"></a>hp           <span class="dv">1</span>       <span class="dv">63</span>  <span class="fl">0.5461</span> <span class="fl">0.4627</span></span>
<span id="cb193-10"><a href="#cb193-10" aria-hidden="true" tabindex="-1"></a><span class="fu">factor</span>(am)<span class="dv">1</span>  <span class="dv">1</span>       <span class="dv">63</span>  <span class="fl">1.3500</span> <span class="fl">0.2497</span></span></code></pre></div>
<p>The 1st quartile and median do not seem to be statistically different,
now include the 3rd quartile. As seen earlier, the quartiles jointly
show a gradient. Now, we can see that idisp, hp and am are separately
have statistically different</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a>ls_fl_quantiles <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.50</span>, <span class="fl">0.75</span>)</span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a>fit_quantiles <span class="ot">&lt;-</span> <span class="fu">rq</span>(mpg <span class="sc">~</span> disp <span class="sc">+</span> hp <span class="sc">+</span> <span class="fu">factor</span>(am),</span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">tau =</span> ls_fl_quantiles,</span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> mtcars)</span>
<span id="cb194-5"><a href="#cb194-5" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fit_quantiles, <span class="at">test =</span> <span class="st">&quot;Wald&quot;</span>, <span class="at">joint=</span><span class="cn">TRUE</span>)</span>
<span id="cb194-6"><a href="#cb194-6" aria-hidden="true" tabindex="-1"></a>Quantile Regression Analysis of Deviance Table</span>
<span id="cb194-7"><a href="#cb194-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-8"><a href="#cb194-8" aria-hidden="true" tabindex="-1"></a>Model<span class="sc">:</span> mpg <span class="sc">~</span> disp <span class="sc">+</span> hp <span class="sc">+</span> <span class="fu">factor</span>(am)</span>
<span id="cb194-9"><a href="#cb194-9" aria-hidden="true" tabindex="-1"></a>Joint Test of Equality of Slopes<span class="sc">:</span> tau <span class="cf">in</span> {  <span class="fl">0.25</span> <span class="fl">0.5</span> <span class="fl">0.75</span>  }</span>
<span id="cb194-10"><a href="#cb194-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-11"><a href="#cb194-11" aria-hidden="true" tabindex="-1"></a>  Df Resid Df F value   <span class="fu">Pr</span>(<span class="sc">&gt;</span>F)   </span>
<span id="cb194-12"><a href="#cb194-12" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>  <span class="dv">6</span>       <span class="dv">90</span>  <span class="fl">3.3173</span> <span class="fl">0.005367</span> <span class="sc">**</span></span>
<span id="cb194-13"><a href="#cb194-13" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb194-14"><a href="#cb194-14" aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span></code></pre></div>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fit_quantiles, <span class="at">test =</span> <span class="st">&quot;Wald&quot;</span>, <span class="at">joint=</span><span class="cn">FALSE</span>)</span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a>Quantile Regression Analysis of Deviance Table</span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-4"><a href="#cb195-4" aria-hidden="true" tabindex="-1"></a>Model<span class="sc">:</span> mpg <span class="sc">~</span> disp <span class="sc">+</span> hp <span class="sc">+</span> <span class="fu">factor</span>(am)</span>
<span id="cb195-5"><a href="#cb195-5" aria-hidden="true" tabindex="-1"></a>Tests of Equality of Distinct Slopes<span class="sc">:</span> tau <span class="cf">in</span> {  <span class="fl">0.25</span> <span class="fl">0.5</span> <span class="fl">0.75</span>  }</span>
<span id="cb195-6"><a href="#cb195-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-7"><a href="#cb195-7" aria-hidden="true" tabindex="-1"></a>            Df Resid Df F value   <span class="fu">Pr</span>(<span class="sc">&gt;</span>F)   </span>
<span id="cb195-8"><a href="#cb195-8" aria-hidden="true" tabindex="-1"></a>disp         <span class="dv">2</span>       <span class="dv">94</span>  <span class="fl">5.4903</span> <span class="fl">0.005558</span> <span class="sc">**</span></span>
<span id="cb195-9"><a href="#cb195-9" aria-hidden="true" tabindex="-1"></a>hp           <span class="dv">2</span>       <span class="dv">94</span>  <span class="fl">6.7221</span> <span class="fl">0.001868</span> <span class="sc">**</span></span>
<span id="cb195-10"><a href="#cb195-10" aria-hidden="true" tabindex="-1"></a><span class="fu">factor</span>(am)<span class="dv">1</span>  <span class="dv">2</span>       <span class="dv">94</span>  <span class="fl">7.2758</span> <span class="fl">0.001154</span> <span class="sc">**</span></span>
<span id="cb195-11"><a href="#cb195-11" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb195-12"><a href="#cb195-12" aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span></code></pre></div>
<!--chapter:end:LM.Rmd-->
</div>
</div>
<div id="IV" class="section level1" number="2">
<h1 number="2"><span class="header-section-number">2</span> Instrumental Variables and Two Stage Least Squares</h1>
<p>To load the dataset and necessary functions:</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This function 1. checks if the packages are installed. 2. It installs the packages if they were not in the list of installed packages. 3. It loads the packages into the workspace</span></span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a><span class="co"># devtools::install_github(&quot;ccolonescu/PoEdata&quot;)</span></span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a>PACKAGES<span class="ot">&lt;-</span><span class="fu">c</span>(</span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;tidyverse&quot;</span>,  <span class="co"># for data manipulation and ggplots</span></span>
<span id="cb196-5"><a href="#cb196-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;knitr&quot;</span>, <span class="co"># knit functions</span></span>
<span id="cb196-6"><a href="#cb196-6" aria-hidden="true" tabindex="-1"></a>            <span class="co"># &quot;kableExtra&quot;, # extended knit functions for objects exported from other packages</span></span>
<span id="cb196-7"><a href="#cb196-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;huxtable&quot;</span>, <span class="co">#  Regression tables, broom compatible</span></span>
<span id="cb196-8"><a href="#cb196-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;modelsummary&quot;</span>, <span class="co">#</span></span>
<span id="cb196-9"><a href="#cb196-9" aria-hidden="true" tabindex="-1"></a>            <span class="co">#  Regression tables, broom compatible</span></span>
<span id="cb196-10"><a href="#cb196-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;stargazer&quot;</span>, <span class="co"># Regression tables</span></span>
<span id="cb196-11"><a href="#cb196-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;lfe&quot;</span>, <span class="co"># Panel IV</span></span>
<span id="cb196-12"><a href="#cb196-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;fabricatr&quot;</span>, </span>
<span id="cb196-13"><a href="#cb196-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;estimatr&quot;</span>, <span class="co"># </span></span>
<span id="cb196-14"><a href="#cb196-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;skimr&quot;</span>, </span>
<span id="cb196-15"><a href="#cb196-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;gmm&quot;</span>, <span class="co"># GMM method</span></span>
<span id="cb196-16"><a href="#cb196-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;AER&quot;</span>, <span class="co">#  Functions, data sets, examples, demos, and vignettes for the book Christian Kleiber and Achim Zeileis (2008)</span></span>
<span id="cb196-17"><a href="#cb196-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;PoEdata&quot;</span>, <span class="co"># R data sets for &quot;Principles of Econometrics&quot; by Hill, Griffiths, and Lim, 4e, Wiley. https://github.com/ccolonescu/PoEdata</span></span>
<span id="cb196-18"><a href="#cb196-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;wooldridge&quot;</span>,  <span class="co"># Wooldrige Datasets</span></span>
<span id="cb196-19"><a href="#cb196-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;broom&quot;</span>, </span>
<span id="cb196-20"><a href="#cb196-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;magrittr&quot;</span>) <span class="co">#  pipes</span></span>
<span id="cb196-21"><a href="#cb196-21" aria-hidden="true" tabindex="-1"></a>inst<span class="ot">&lt;-</span><span class="fu">match</span>(PACKAGES, <span class="fu">.packages</span>(<span class="at">all=</span><span class="cn">TRUE</span>))</span>
<span id="cb196-22"><a href="#cb196-22" aria-hidden="true" tabindex="-1"></a>need<span class="ot">&lt;-</span><span class="fu">which</span>(<span class="fu">is.na</span>(inst))</span>
<span id="cb196-23"><a href="#cb196-23" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(need)<span class="sc">&gt;</span><span class="dv">0</span>) <span class="fu">install.packages</span>(PACKAGES[need])</span>
<span id="cb196-24"><a href="#cb196-24" aria-hidden="true" tabindex="-1"></a><span class="co"># if (length(need)&gt;0) pak::pkg_install(PACKAGES[need])</span></span>
<span id="cb196-25"><a href="#cb196-25" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(PACKAGES, require, <span class="at">character.only=</span>T)</span></code></pre></div>
<div id="introduction-endogeneity-problem-and-its-solution" class="section level2" number="2.1">
<h2 number="2.1"><span class="header-section-number">2.1</span> Introduction: Endogeneity Problem and its Solution</h2>
<ul>
<li>When <span class="math inline">\(Cov(x_k, \epsilon)=0\)</span> does not hold, we have <strong>endogeneity problem</strong>
<ul>
<li>We call such <span class="math inline">\(x_k\)</span> an <strong>endogenous variable</strong>.</li>
</ul></li>
<li>In this chapter, I introduce an <strong>instrumental variable</strong> estimation method, a solution to this issue.</li>
</ul>
</div>
<div id="examples-of-endogeneity-problem" class="section level2" number="2.2">
<h2 number="2.2"><span class="header-section-number">2.2</span> Examples of Endogeneity Problem</h2>
<ul>
<li>Source of endogeneity problems.
<ol style="list-style-type: decimal">
<li>Omitted variable bias</li>
<li>Measurement error</li>
<li>Simultaneity</li>
</ol></li>
</ul>
<p>For instance, quantity and price is determined by the intersection of supply and demand. Although we observe the correlation between price and quantity, we have no information about the elasticities associated with supply or demand curves.</p>
</div>
<div id="idea-of-iv-regression" class="section level2" number="2.3">
<h2 number="2.3"><span class="header-section-number">2.3</span> Idea of IV Regression</h2>
<ul>
<li>Let’s start with a simple case.</li>
</ul>
<p><span class="math display">\[
y_i = \beta_0 + \beta_1 x_i + \epsilon_i, 
\]</span></p>
<p>and <span class="math inline">\(Cov(x_i, \epsilon_i) \neq 0\)</span>.
- Now, we consider another variable <span class="math inline">\(z_i\)</span>, which we call <strong>instrumental variable (IV)</strong>.
- Instrumental variable <span class="math inline">\(z_i\)</span> should satisfies the following two conditions:
1. <strong>Independence</strong>: <span class="math inline">\(Cov(z_i, \epsilon_i) = 0\)</span>. No correlation between IV and error.
2. <strong>Relevance</strong>: <span class="math inline">\(Cov(z_i, x_i) \neq 0\)</span>. There should be correlation between IV and endogenous variable <span class="math inline">\(x_i\)</span>.
- Idea: Use the variation of <span class="math inline">\(x_i\)</span> <strong>induced by instrument <span class="math inline">\(z_i\)</span></strong> to estimate the direct (causal) effect of <span class="math inline">\(x_i\)</span> on <span class="math inline">\(y_i\)</span>, that is <span class="math inline">\(\beta_1\)</span>!.</p>
<ul>
<li>More on this:
<ol style="list-style-type: decimal">
<li>Intuitively, the OLS estimator captures the correlation between <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>.</li>
<li>If there is no correlation between <span class="math inline">\(x\)</span> and <span class="math inline">\(\epsilon\)</span>, it captures the causal effect <span class="math inline">\(\beta_1\)</span>.</li>
<li>If not, the OLS estimator captures both direct and indirect effect, the latter of which is bias.</li>
<li>Now, let’s capture the variation of <span class="math inline">\(x\)</span> due to instrument <span class="math inline">\(z\)</span>,
<ul>
<li>Such a variation should exist under <strong>relevance</strong> assumption.</li>
<li>Such a variation should not be correlated with the error under <strong>independence assumption</strong></li>
</ul></li>
<li>By looking at the correlation between such variation and <span class="math inline">\(y\)</span>, you can get the causal effect <span class="math inline">\(\beta_1\)</span>.</li>
</ol></li>
</ul>
<div class="figure" style="text-align: center">
<a href="https://github.com/yutatoyama/AppliedEconometrics/blob/master/fig_IV_idea.png" target="_blank"><img src="images/fig_IV_idea.png" alt="Idea IV. Source: Lecture notes by Yuta Toyama" width="70%" /></a>
<p class="caption">
(#fig:unnamed-chunk-182)Idea IV. Source: Lecture notes by Yuta Toyama
</p>
</div>
<p>Load and become familiar with data.</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;mroz&quot;</span>, <span class="at">package=</span><span class="st">&quot;wooldridge&quot;</span>)</span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(mroz)</span>
<span id="cb197-3"><a href="#cb197-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mroz)</span></code></pre></div>
<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:data">
<caption style="caption-side: top; text-align: center;">(#tab:data) </caption><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><col><tr>
<th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">inlf</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">hours</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">kidslt6</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">kidsge6</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">age</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">educ</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">wage</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">repwage</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">hushrs</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">husage</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">huseduc</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">huswage</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">faminc</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">mtr</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">motheduc</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">fatheduc</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">unem</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">city</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">exper</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">nwifeinc</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">lwage</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">expersq</th></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1610</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">32</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">12</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">3.35</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">2.65</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">2708</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">34</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">12</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">4.03</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1.63e+04</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.721</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">12</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">7</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">5&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">14</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">10.9&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1.21&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">196</td></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1656</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">2</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">30</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">12</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1.39</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">2.65</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">2310</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">30</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">9</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">8.44</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">2.18e+04</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.661</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">7</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">7</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">11&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">5</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">19.5&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.329&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">25</td></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1980</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">3</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">35</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">12</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">4.55</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">4.04</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">3072</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">40</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">12</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">3.58</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">2.1e+04&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.692</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">12</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">7</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">5&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">15</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">12&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1.51&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">225</td></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">456</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">3</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">34</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">12</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1.1&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">3.25</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1920</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">53</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">10</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">3.54</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">7.3e+03&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.781</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">7</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">7</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">5&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">6</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">6.8&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.0921</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">36</td></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1568</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">2</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">31</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">14</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">4.59</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">3.6&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">2000</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">32</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">12</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">10&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">2.73e+04</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">0.622</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">12</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">14</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">9.5</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">7</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">20.1&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1.52&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">49</td></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">2032</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">54</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">12</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">4.74</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">4.7&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1040</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">57</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">11</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">6.71</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1.95e+04</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.692</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">14</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">7</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">7.5</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">33</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">9.86</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1.56&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1089</td></tr>
</table>

<ul>
<li>Consider the wage regression</li>
</ul>
<p><span class="math display">\[
\log(w_i) = \beta_0 + \beta_1 educ_i + \beta_2 exper_i + \beta_3 exper_i^2 + \epsilon_i
\]</span></p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Restrict to non-missing wage observations</span></span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a>mroz1 <span class="ot">&lt;-</span> <span class="fu">subset</span>(mroz, <span class="sc">!</span><span class="fu">is.na</span>(wage))</span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the OLS lnwage regression</span></span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a>wage.ols <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(wage)<span class="sc">~</span>educ<span class="sc">+</span>exper<span class="sc">+</span><span class="fu">I</span>(exper<span class="sc">^</span><span class="dv">2</span>), <span class="at">data=</span>mroz1)</span></code></pre></div>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="co"># gather robust standard errors in a list</span></span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a>rob_se <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">sqrt</span>(<span class="fu">diag</span>(<span class="fu">vcovHC</span>(wage.ols, <span class="at">type =</span> <span class="st">&quot;HC1&quot;</span>))),</span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a>               <span class="fu">sqrt</span>(<span class="fu">diag</span>(<span class="fu">vcovHC</span>(wage.ols, <span class="at">type =</span> <span class="st">&quot;HC1&quot;</span>))))</span></code></pre></div>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stargazer</span>(wage.ols,<span class="at">se =</span> rob_se, <span class="at">type=</span><span class="st">&quot;text&quot;</span> )</span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a><span class="sc">==</span><span class="er">=============================================</span></span>
<span id="cb200-4"><a href="#cb200-4" aria-hidden="true" tabindex="-1"></a>                        Dependent variable<span class="sc">:</span>    </span>
<span id="cb200-5"><a href="#cb200-5" aria-hidden="true" tabindex="-1"></a>                    <span class="sc">---------------------------</span></span>
<span id="cb200-6"><a href="#cb200-6" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">log</span>(wage)         </span>
<span id="cb200-7"><a href="#cb200-7" aria-hidden="true" tabindex="-1"></a><span class="sc">-----------------------------------------------</span></span>
<span id="cb200-8"><a href="#cb200-8" aria-hidden="true" tabindex="-1"></a>educ                         <span class="fl">0.107</span><span class="sc">**</span><span class="er">*</span>          </span>
<span id="cb200-9"><a href="#cb200-9" aria-hidden="true" tabindex="-1"></a>                              (<span class="fl">0.013</span>)          </span>
<span id="cb200-10"><a href="#cb200-10" aria-hidden="true" tabindex="-1"></a>                                               </span>
<span id="cb200-11"><a href="#cb200-11" aria-hidden="true" tabindex="-1"></a>exper                        <span class="fl">0.042</span><span class="sc">**</span><span class="er">*</span>          </span>
<span id="cb200-12"><a href="#cb200-12" aria-hidden="true" tabindex="-1"></a>                              (<span class="fl">0.015</span>)          </span>
<span id="cb200-13"><a href="#cb200-13" aria-hidden="true" tabindex="-1"></a>                                               </span>
<span id="cb200-14"><a href="#cb200-14" aria-hidden="true" tabindex="-1"></a><span class="fu">I</span>(exper2)                     <span class="sc">-</span><span class="fl">0.001</span><span class="sc">*</span>          </span>
<span id="cb200-15"><a href="#cb200-15" aria-hidden="true" tabindex="-1"></a>                             (<span class="fl">0.0004</span>)          </span>
<span id="cb200-16"><a href="#cb200-16" aria-hidden="true" tabindex="-1"></a>                                               </span>
<span id="cb200-17"><a href="#cb200-17" aria-hidden="true" tabindex="-1"></a>Constant                     <span class="sc">-</span><span class="fl">0.522</span><span class="sc">**</span><span class="er">*</span>         </span>
<span id="cb200-18"><a href="#cb200-18" aria-hidden="true" tabindex="-1"></a>                              (<span class="fl">0.202</span>)          </span>
<span id="cb200-19"><a href="#cb200-19" aria-hidden="true" tabindex="-1"></a>                                               </span>
<span id="cb200-20"><a href="#cb200-20" aria-hidden="true" tabindex="-1"></a><span class="sc">-----------------------------------------------</span></span>
<span id="cb200-21"><a href="#cb200-21" aria-hidden="true" tabindex="-1"></a>Observations                    <span class="dv">428</span>            </span>
<span id="cb200-22"><a href="#cb200-22" aria-hidden="true" tabindex="-1"></a>R2                             <span class="fl">0.157</span>           </span>
<span id="cb200-23"><a href="#cb200-23" aria-hidden="true" tabindex="-1"></a>Adjusted R2                    <span class="fl">0.151</span>           </span>
<span id="cb200-24"><a href="#cb200-24" aria-hidden="true" tabindex="-1"></a>Residual Std. Error      <span class="fl">0.666</span> (<span class="at">df =</span> <span class="dv">424</span>)      </span>
<span id="cb200-25"><a href="#cb200-25" aria-hidden="true" tabindex="-1"></a>F Statistic           <span class="fl">26.286</span><span class="sc">**</span><span class="er">*</span> (<span class="at">df =</span> <span class="dv">3</span>; <span class="dv">424</span>)  </span>
<span id="cb200-26"><a href="#cb200-26" aria-hidden="true" tabindex="-1"></a><span class="sc">==</span><span class="er">=============================================</span></span>
<span id="cb200-27"><a href="#cb200-27" aria-hidden="true" tabindex="-1"></a>Note<span class="sc">:</span>               <span class="er">*</span>p<span class="sc">&lt;</span><span class="fl">0.1</span>; <span class="sc">**</span>p<span class="sc">&lt;</span><span class="fl">0.05</span>; <span class="sc">**</span><span class="er">*</span>p<span class="sc">&lt;</span><span class="fl">0.01</span></span></code></pre></div>
<p>However let us assume that</p>
<ul>
<li><span class="math inline">\(exper_{i}\)</span> is exogenous but <span class="math inline">\(educ_{i}\)</span> is endogenous.</li>
<li>An instrument for <span class="math inline">\(educ_{i}\)</span>, we use the years of schooling for his or her father and mother, which we call <span class="math inline">\(fatheduc_{i}\)</span> and <span class="math inline">\(motheduc_{i}\)</span>.</li>
</ul>
<div id="discussion-on-iv" class="section level3" number="2.3.1">
<h3 number="2.3.1"><span class="header-section-number">2.3.1</span> Discussion on IV</h3>
<ul>
<li>Labour economists have used family background variables as IVs for education.</li>
<li>Relevance: OK from the first stage regression.</li>
<li>Independence: A bit suspicious. Parents’ education would be correlated with child’s ability through quality of nurturing at an early age.</li>
<li>Still, we can see that these IVs can mitigate (though may not eliminate completely) the omitted variable bias.</li>
<li>Discussion on the validity of instruments is crucial in empirical research.</li>
</ul>
</div>
</div>
<div id="two-stage-least-squares-2sls" class="section level2" number="2.4">
<h2 number="2.4"><span class="header-section-number">2.4</span> Two stage least squares (2SLS)</h2>
<p>Two stage least squares is a general approach for IV estimation when we have one or more endogenous regressors and at least as many instrumental variables. First estimate the reduced, first-stage regression. Predict education regressing it on instruments. Then run the second-stage using the fitted value instead of the endogenous initial value of education. Compare the OLS estimation results with 2SLS. Note that the standard errors for the second step are incorrect since estimating the seconds step with OLS does not take into account that prediction on endogenous education variable contain prediction errors.</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1st stage: reduced form</span></span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(mroz1)</span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;data.frame&#39;</span><span class="sc">:</span>   <span class="dv">428</span> obs. of  <span class="dv">22</span> variables<span class="sc">:</span></span>
<span id="cb201-4"><a href="#cb201-4" aria-hidden="true" tabindex="-1"></a> <span class="er">$</span> inlf    <span class="sc">:</span> int  <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> ...</span>
<span id="cb201-5"><a href="#cb201-5" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> hours   <span class="sc">:</span> int  <span class="dv">1610</span> <span class="dv">1656</span> <span class="dv">1980</span> <span class="dv">456</span> <span class="dv">1568</span> <span class="dv">2032</span> <span class="dv">1440</span> <span class="dv">1020</span> <span class="dv">1458</span> <span class="dv">1600</span> ...</span>
<span id="cb201-6"><a href="#cb201-6" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> kidslt6 <span class="sc">:</span> int  <span class="dv">1</span> <span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> ...</span>
<span id="cb201-7"><a href="#cb201-7" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> kidsge6 <span class="sc">:</span> int  <span class="dv">0</span> <span class="dv">2</span> <span class="dv">3</span> <span class="dv">3</span> <span class="dv">2</span> <span class="dv">0</span> <span class="dv">2</span> <span class="dv">0</span> <span class="dv">2</span> <span class="dv">2</span> ...</span>
<span id="cb201-8"><a href="#cb201-8" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> age     <span class="sc">:</span> int  <span class="dv">32</span> <span class="dv">30</span> <span class="dv">35</span> <span class="dv">34</span> <span class="dv">31</span> <span class="dv">54</span> <span class="dv">37</span> <span class="dv">54</span> <span class="dv">48</span> <span class="dv">39</span> ...</span>
<span id="cb201-9"><a href="#cb201-9" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> educ    <span class="sc">:</span> int  <span class="dv">12</span> <span class="dv">12</span> <span class="dv">12</span> <span class="dv">12</span> <span class="dv">14</span> <span class="dv">12</span> <span class="dv">16</span> <span class="dv">12</span> <span class="dv">12</span> <span class="dv">12</span> ...</span>
<span id="cb201-10"><a href="#cb201-10" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> wage    <span class="sc">:</span> num  <span class="fl">3.35</span> <span class="fl">1.39</span> <span class="fl">4.55</span> <span class="fl">1.1</span> <span class="fl">4.59</span> ...</span>
<span id="cb201-11"><a href="#cb201-11" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> repwage <span class="sc">:</span> num  <span class="fl">2.65</span> <span class="fl">2.65</span> <span class="fl">4.04</span> <span class="fl">3.25</span> <span class="fl">3.6</span> ...</span>
<span id="cb201-12"><a href="#cb201-12" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> hushrs  <span class="sc">:</span> int  <span class="dv">2708</span> <span class="dv">2310</span> <span class="dv">3072</span> <span class="dv">1920</span> <span class="dv">2000</span> <span class="dv">1040</span> <span class="dv">2670</span> <span class="dv">4120</span> <span class="dv">1995</span> <span class="dv">2100</span> ...</span>
<span id="cb201-13"><a href="#cb201-13" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> husage  <span class="sc">:</span> int  <span class="dv">34</span> <span class="dv">30</span> <span class="dv">40</span> <span class="dv">53</span> <span class="dv">32</span> <span class="dv">57</span> <span class="dv">37</span> <span class="dv">53</span> <span class="dv">52</span> <span class="dv">43</span> ...</span>
<span id="cb201-14"><a href="#cb201-14" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> huseduc <span class="sc">:</span> int  <span class="dv">12</span> <span class="dv">9</span> <span class="dv">12</span> <span class="dv">10</span> <span class="dv">12</span> <span class="dv">11</span> <span class="dv">12</span> <span class="dv">8</span> <span class="dv">4</span> <span class="dv">12</span> ...</span>
<span id="cb201-15"><a href="#cb201-15" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> huswage <span class="sc">:</span> num  <span class="fl">4.03</span> <span class="fl">8.44</span> <span class="fl">3.58</span> <span class="fl">3.54</span> <span class="dv">10</span> ...</span>
<span id="cb201-16"><a href="#cb201-16" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> faminc  <span class="sc">:</span> num  <span class="dv">16310</span> <span class="dv">21800</span> <span class="dv">21040</span> <span class="dv">7300</span> <span class="dv">27300</span> ...</span>
<span id="cb201-17"><a href="#cb201-17" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> mtr     <span class="sc">:</span> num  <span class="fl">0.721</span> <span class="fl">0.661</span> <span class="fl">0.692</span> <span class="fl">0.781</span> <span class="fl">0.622</span> ...</span>
<span id="cb201-18"><a href="#cb201-18" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> motheduc<span class="sc">:</span> int  <span class="dv">12</span> <span class="dv">7</span> <span class="dv">12</span> <span class="dv">7</span> <span class="dv">12</span> <span class="dv">14</span> <span class="dv">14</span> <span class="dv">3</span> <span class="dv">7</span> <span class="dv">7</span> ...</span>
<span id="cb201-19"><a href="#cb201-19" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> fatheduc<span class="sc">:</span> int  <span class="dv">7</span> <span class="dv">7</span> <span class="dv">7</span> <span class="dv">7</span> <span class="dv">14</span> <span class="dv">7</span> <span class="dv">7</span> <span class="dv">3</span> <span class="dv">7</span> <span class="dv">7</span> ...</span>
<span id="cb201-20"><a href="#cb201-20" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> unem    <span class="sc">:</span> num  <span class="dv">5</span> <span class="dv">11</span> <span class="dv">5</span> <span class="dv">5</span> <span class="fl">9.5</span> <span class="fl">7.5</span> <span class="dv">5</span> <span class="dv">5</span> <span class="dv">3</span> <span class="dv">5</span> ...</span>
<span id="cb201-21"><a href="#cb201-21" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> city    <span class="sc">:</span> int  <span class="dv">0</span> <span class="dv">1</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> ...</span>
<span id="cb201-22"><a href="#cb201-22" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> exper   <span class="sc">:</span> int  <span class="dv">14</span> <span class="dv">5</span> <span class="dv">15</span> <span class="dv">6</span> <span class="dv">7</span> <span class="dv">33</span> <span class="dv">11</span> <span class="dv">35</span> <span class="dv">24</span> <span class="dv">21</span> ...</span>
<span id="cb201-23"><a href="#cb201-23" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> nwifeinc<span class="sc">:</span> num  <span class="fl">10.9</span> <span class="fl">19.5</span> <span class="dv">12</span> <span class="fl">6.8</span> <span class="fl">20.1</span> ...</span>
<span id="cb201-24"><a href="#cb201-24" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> lwage   <span class="sc">:</span> num  <span class="fl">1.2102</span> <span class="fl">0.3285</span> <span class="fl">1.5141</span> <span class="fl">0.0921</span> <span class="fl">1.5243</span> ...</span>
<span id="cb201-25"><a href="#cb201-25" aria-hidden="true" tabindex="-1"></a> <span class="sc">$</span> expersq <span class="sc">:</span> int  <span class="dv">196</span> <span class="dv">25</span> <span class="dv">225</span> <span class="dv">36</span> <span class="dv">49</span> <span class="dv">1089</span> <span class="dv">121</span> <span class="dv">1225</span> <span class="dv">576</span> <span class="dv">441</span> ...</span>
<span id="cb201-26"><a href="#cb201-26" aria-hidden="true" tabindex="-1"></a>educ.ols <span class="ot">&lt;-</span> <span class="fu">lm</span>(educ<span class="sc">~</span>exper<span class="sc">+</span><span class="fu">I</span>(exper<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span>motheduc<span class="sc">+</span>fatheduc, <span class="at">data=</span>mroz1)</span>
<span id="cb201-27"><a href="#cb201-27" aria-hidden="true" tabindex="-1"></a>educHat <span class="ot">&lt;-</span> <span class="fu">fitted</span>(educ.ols) <span class="co">#</span></span>
<span id="cb201-28"><a href="#cb201-28" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(educ.ols)</span>
<span id="cb201-29"><a href="#cb201-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-30"><a href="#cb201-30" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb201-31"><a href="#cb201-31" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> educ <span class="sc">~</span> exper <span class="sc">+</span> <span class="fu">I</span>(exper<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> motheduc <span class="sc">+</span> fatheduc, </span>
<span id="cb201-32"><a href="#cb201-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> mroz1)</span>
<span id="cb201-33"><a href="#cb201-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-34"><a href="#cb201-34" aria-hidden="true" tabindex="-1"></a>Residuals<span class="sc">:</span></span>
<span id="cb201-35"><a href="#cb201-35" aria-hidden="true" tabindex="-1"></a>    Min      1Q  Median      3Q     Max </span>
<span id="cb201-36"><a href="#cb201-36" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">7.8057</span> <span class="sc">-</span><span class="fl">1.0520</span> <span class="sc">-</span><span class="fl">0.0371</span>  <span class="fl">1.0258</span>  <span class="fl">6.3787</span> </span>
<span id="cb201-37"><a href="#cb201-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-38"><a href="#cb201-38" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb201-39"><a href="#cb201-39" aria-hidden="true" tabindex="-1"></a>             Estimate Std. Error t value <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)    </span>
<span id="cb201-40"><a href="#cb201-40" aria-hidden="true" tabindex="-1"></a>(Intercept)  <span class="fl">9.102640</span>   <span class="fl">0.426561</span>  <span class="fl">21.340</span>  <span class="sc">&lt;</span> <span class="fl">2e-16</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb201-41"><a href="#cb201-41" aria-hidden="true" tabindex="-1"></a>exper        <span class="fl">0.045225</span>   <span class="fl">0.040251</span>   <span class="fl">1.124</span>    <span class="fl">0.262</span>    </span>
<span id="cb201-42"><a href="#cb201-42" aria-hidden="true" tabindex="-1"></a><span class="fu">I</span>(exper<span class="sc">^</span><span class="dv">2</span>)  <span class="sc">-</span><span class="fl">0.001009</span>   <span class="fl">0.001203</span>  <span class="sc">-</span><span class="fl">0.839</span>    <span class="fl">0.402</span>    </span>
<span id="cb201-43"><a href="#cb201-43" aria-hidden="true" tabindex="-1"></a>motheduc     <span class="fl">0.157597</span>   <span class="fl">0.035894</span>   <span class="fl">4.391</span> <span class="fl">1.43e-05</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb201-44"><a href="#cb201-44" aria-hidden="true" tabindex="-1"></a>fatheduc     <span class="fl">0.189548</span>   <span class="fl">0.033756</span>   <span class="fl">5.615</span> <span class="fl">3.56e-08</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb201-45"><a href="#cb201-45" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb201-46"><a href="#cb201-46" aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span>
<span id="cb201-47"><a href="#cb201-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-48"><a href="#cb201-48" aria-hidden="true" tabindex="-1"></a>Residual standard error<span class="sc">:</span> <span class="fl">2.039</span> on <span class="dv">423</span> degrees of freedom</span>
<span id="cb201-49"><a href="#cb201-49" aria-hidden="true" tabindex="-1"></a>Multiple R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.2115</span>,    Adjusted R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.204</span> </span>
<span id="cb201-50"><a href="#cb201-50" aria-hidden="true" tabindex="-1"></a>F<span class="sc">-</span>statistic<span class="sc">:</span> <span class="fl">28.36</span> on <span class="dv">4</span> and <span class="dv">423</span> DF,  p<span class="sc">-</span>value<span class="sc">:</span> <span class="er">&lt;</span> <span class="fl">2.2e-16</span></span>
<span id="cb201-51"><a href="#cb201-51" aria-hidden="true" tabindex="-1"></a><span class="co"># check instrument relevance for first stage</span></span>
<span id="cb201-52"><a href="#cb201-52" aria-hidden="true" tabindex="-1"></a><span class="fu">linearHypothesis</span>(educ.ols, <span class="st">&quot;fatheduc = 0&quot;</span>, <span class="at">vcvcov =</span> vcovHAC, <span class="at">type =</span> <span class="st">&quot;HC1&quot;</span>)</span></code></pre></div>
<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:unnamed-chunk-186">
<caption style="caption-side: top; text-align: center;">(#tab:unnamed-chunk-186) </caption><col><col><col><col><col><col><tr>
<th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">Res.Df</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">RSS</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">Df</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">Sum of Sq</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">F</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">Pr(&gt;F)</th></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">424</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1.89e+03</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;"></td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;"></td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">423</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1.76e+03</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">131</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">31.5</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">3.56e-08</td></tr>
</table>

<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="fu">linearHypothesis</span>(educ.ols, <span class="fu">c</span>(<span class="st">&quot;fatheduc = 0&quot;</span>, <span class="st">&quot;motheduc = 0&quot;</span>), <span class="at">vcvcov =</span> vcovHAC, <span class="at">type =</span> <span class="st">&quot;HC1&quot;</span>)</span></code></pre></div>
<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:unnamed-chunk-186">
<caption style="caption-side: top; text-align: center;">(#tab:unnamed-chunk-186) </caption><col><col><col><col><col><col><tr>
<th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">Res.Df</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">RSS</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">Df</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">Sum of Sq</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">F</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">Pr(&gt;F)</th></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">425</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">2.22e+03</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;"></td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;"></td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">423</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1.76e+03</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">2</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">461</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">55.4</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">4.27e-22</td></tr>
</table>

<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2nd stage: </span></span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a>wage<span class="fl">.2</span>sls <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(wage)<span class="sc">~</span>educHat<span class="sc">+</span>exper<span class="sc">+</span><span class="fu">I</span>(exper<span class="sc">^</span><span class="dv">2</span>), <span class="at">data=</span>mroz1) <span class="co"># note: educHat is fitted values of educ from the first stage</span></span>
<span id="cb203-3"><a href="#cb203-3" aria-hidden="true" tabindex="-1"></a><span class="fu">stargazer</span>(wage.ols, wage<span class="fl">.2</span>sls, <span class="at">type=</span><span class="st">&quot;text&quot;</span>, <span class="at">title=</span><span class="st">&quot;Regression output table&quot;</span>)</span>
<span id="cb203-4"><a href="#cb203-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-5"><a href="#cb203-5" aria-hidden="true" tabindex="-1"></a>Regression output table</span>
<span id="cb203-6"><a href="#cb203-6" aria-hidden="true" tabindex="-1"></a><span class="sc">==</span><span class="er">=========================================================</span></span>
<span id="cb203-7"><a href="#cb203-7" aria-hidden="true" tabindex="-1"></a>                                   Dependent variable<span class="sc">:</span>     </span>
<span id="cb203-8"><a href="#cb203-8" aria-hidden="true" tabindex="-1"></a>                               <span class="sc">----------------------------</span></span>
<span id="cb203-9"><a href="#cb203-9" aria-hidden="true" tabindex="-1"></a>                                        <span class="fu">log</span>(wage)          </span>
<span id="cb203-10"><a href="#cb203-10" aria-hidden="true" tabindex="-1"></a>                                    (<span class="dv">1</span>)            (<span class="dv">2</span>)     </span>
<span id="cb203-11"><a href="#cb203-11" aria-hidden="true" tabindex="-1"></a><span class="sc">-----------------------------------------------------------</span></span>
<span id="cb203-12"><a href="#cb203-12" aria-hidden="true" tabindex="-1"></a>educ                              <span class="fl">0.107</span><span class="sc">**</span><span class="er">*</span>                 </span>
<span id="cb203-13"><a href="#cb203-13" aria-hidden="true" tabindex="-1"></a>                                  (<span class="fl">0.014</span>)                  </span>
<span id="cb203-14"><a href="#cb203-14" aria-hidden="true" tabindex="-1"></a>                                                           </span>
<span id="cb203-15"><a href="#cb203-15" aria-hidden="true" tabindex="-1"></a>educHat                                          <span class="fl">0.061</span><span class="sc">*</span>    </span>
<span id="cb203-16"><a href="#cb203-16" aria-hidden="true" tabindex="-1"></a>                                                 (<span class="fl">0.033</span>)   </span>
<span id="cb203-17"><a href="#cb203-17" aria-hidden="true" tabindex="-1"></a>                                                           </span>
<span id="cb203-18"><a href="#cb203-18" aria-hidden="true" tabindex="-1"></a>exper                             <span class="fl">0.042</span><span class="sc">**</span><span class="er">*</span>      <span class="fl">0.044</span><span class="sc">**</span><span class="er">*</span>   </span>
<span id="cb203-19"><a href="#cb203-19" aria-hidden="true" tabindex="-1"></a>                                  (<span class="fl">0.013</span>)        (<span class="fl">0.014</span>)   </span>
<span id="cb203-20"><a href="#cb203-20" aria-hidden="true" tabindex="-1"></a>                                                           </span>
<span id="cb203-21"><a href="#cb203-21" aria-hidden="true" tabindex="-1"></a><span class="fu">I</span>(exper2)                         <span class="sc">-</span><span class="fl">0.001</span><span class="sc">**</span>      <span class="sc">-</span><span class="fl">0.001</span><span class="sc">**</span>   </span>
<span id="cb203-22"><a href="#cb203-22" aria-hidden="true" tabindex="-1"></a>                                  (<span class="fl">0.0004</span>)      (<span class="fl">0.0004</span>)   </span>
<span id="cb203-23"><a href="#cb203-23" aria-hidden="true" tabindex="-1"></a>                                                           </span>
<span id="cb203-24"><a href="#cb203-24" aria-hidden="true" tabindex="-1"></a>Constant                         <span class="sc">-</span><span class="fl">0.522</span><span class="sc">**</span><span class="er">*</span>        <span class="fl">0.048</span>    </span>
<span id="cb203-25"><a href="#cb203-25" aria-hidden="true" tabindex="-1"></a>                                  (<span class="fl">0.199</span>)        (<span class="fl">0.420</span>)   </span>
<span id="cb203-26"><a href="#cb203-26" aria-hidden="true" tabindex="-1"></a>                                                           </span>
<span id="cb203-27"><a href="#cb203-27" aria-hidden="true" tabindex="-1"></a><span class="sc">-----------------------------------------------------------</span></span>
<span id="cb203-28"><a href="#cb203-28" aria-hidden="true" tabindex="-1"></a>Observations                        <span class="dv">428</span>            <span class="dv">428</span>     </span>
<span id="cb203-29"><a href="#cb203-29" aria-hidden="true" tabindex="-1"></a>R2                                 <span class="fl">0.157</span>          <span class="fl">0.050</span>    </span>
<span id="cb203-30"><a href="#cb203-30" aria-hidden="true" tabindex="-1"></a>Adjusted R2                        <span class="fl">0.151</span>          <span class="fl">0.043</span>    </span>
<span id="cb203-31"><a href="#cb203-31" aria-hidden="true" tabindex="-1"></a>Residual Std. <span class="fu">Error</span> (<span class="at">df =</span> <span class="dv">424</span>)     <span class="fl">0.666</span>          <span class="fl">0.707</span>    </span>
<span id="cb203-32"><a href="#cb203-32" aria-hidden="true" tabindex="-1"></a>F <span class="fu">Statistic</span> (<span class="at">df =</span> <span class="dv">3</span>; <span class="dv">424</span>)        <span class="fl">26.286</span><span class="sc">**</span><span class="er">*</span>      <span class="fl">7.405</span><span class="sc">**</span><span class="er">*</span>   </span>
<span id="cb203-33"><a href="#cb203-33" aria-hidden="true" tabindex="-1"></a><span class="er">===========================================================</span></span>
<span id="cb203-34"><a href="#cb203-34" aria-hidden="true" tabindex="-1"></a>Note<span class="sc">:</span>                           <span class="er">*</span>p<span class="sc">&lt;</span><span class="fl">0.1</span>; <span class="sc">**</span>p<span class="sc">&lt;</span><span class="fl">0.05</span>; <span class="sc">**</span><span class="er">*</span>p<span class="sc">&lt;</span><span class="fl">0.01</span></span></code></pre></div>
</div>
<div id="instrumental-variables" class="section level2" number="2.5">
<h2 number="2.5"><span class="header-section-number">2.5</span> Instrumental variables</h2>
<p>Use IV-regression procedure instead for having consistent estimate values and correct standard errors. The key point from the below code chunk is that the first-stage regression is going to be specified after the | and will include all exogenous variables<a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a>.</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the ivreg function to produce GIVE with correct standard errors</span></span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a>wage.give <span class="ot">&lt;-</span> <span class="fu">ivreg</span>(<span class="fu">log</span>(wage)<span class="sc">~</span>educ<span class="sc">+</span>exper<span class="sc">+</span><span class="fu">I</span>(exper<span class="sc">^</span><span class="dv">2</span>)<span class="sc">|</span> <span class="do">## The main regression. &quot;educ&quot; is endogenous</span></span>
<span id="cb204-3"><a href="#cb204-3" aria-hidden="true" tabindex="-1"></a>                    exper<span class="sc">+</span><span class="fu">I</span>(exper<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span>motheduc<span class="sc">+</span>fatheduc, <span class="at">data=</span>mroz1) <span class="do">## List all exogenous variables, including &quot;exper&quot; and I(exper^2)</span></span>
<span id="cb204-4"><a href="#cb204-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-5"><a href="#cb204-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-6"><a href="#cb204-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Alternative syntax: </span></span>
<span id="cb204-7"><a href="#cb204-7" aria-hidden="true" tabindex="-1"></a>wage.give2 <span class="ot">&lt;-</span> </span>
<span id="cb204-8"><a href="#cb204-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ivreg</span>(</span>
<span id="cb204-9"><a href="#cb204-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log</span>(wage) <span class="sc">~</span> educ <span class="sc">+</span> exper<span class="sc">+</span><span class="fu">I</span>(exper<span class="sc">^</span><span class="dv">2</span>) <span class="sc">|</span> </span>
<span id="cb204-10"><a href="#cb204-10" aria-hidden="true" tabindex="-1"></a>      . <span class="sc">-</span>(educ) <span class="sc">+</span> motheduc<span class="sc">+</span>fatheduc, <span class="do">## Alternative way of specifying the first-stage.</span></span>
<span id="cb204-11"><a href="#cb204-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> mroz1</span>
<span id="cb204-12"><a href="#cb204-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb204-13"><a href="#cb204-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-14"><a href="#cb204-14" aria-hidden="true" tabindex="-1"></a><span class="fu">stargazer</span>(wage.ols, wage<span class="fl">.2</span>sls, wage.give, <span class="at">type=</span><span class="st">&quot;text&quot;</span>, <span class="at">title=</span><span class="st">&quot;Regression output table&quot;</span>)</span>
<span id="cb204-15"><a href="#cb204-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-16"><a href="#cb204-16" aria-hidden="true" tabindex="-1"></a>Regression output table</span>
<span id="cb204-17"><a href="#cb204-17" aria-hidden="true" tabindex="-1"></a><span class="sc">==</span><span class="er">============================================================</span></span>
<span id="cb204-18"><a href="#cb204-18" aria-hidden="true" tabindex="-1"></a>                                     Dependent variable<span class="sc">:</span>      </span>
<span id="cb204-19"><a href="#cb204-19" aria-hidden="true" tabindex="-1"></a>                               <span class="sc">-------------------------------</span></span>
<span id="cb204-20"><a href="#cb204-20" aria-hidden="true" tabindex="-1"></a>                                          <span class="fu">log</span>(wage)           </span>
<span id="cb204-21"><a href="#cb204-21" aria-hidden="true" tabindex="-1"></a>                                      OLS         instrumental</span>
<span id="cb204-22"><a href="#cb204-22" aria-hidden="true" tabindex="-1"></a>                                                    variable  </span>
<span id="cb204-23"><a href="#cb204-23" aria-hidden="true" tabindex="-1"></a>                                  (<span class="dv">1</span>)      (<span class="dv">2</span>)        (<span class="dv">3</span>)     </span>
<span id="cb204-24"><a href="#cb204-24" aria-hidden="true" tabindex="-1"></a><span class="sc">--------------------------------------------------------------</span></span>
<span id="cb204-25"><a href="#cb204-25" aria-hidden="true" tabindex="-1"></a>educ                           <span class="fl">0.107</span><span class="sc">**</span><span class="er">*</span>              <span class="fl">0.061</span><span class="sc">*</span>   </span>
<span id="cb204-26"><a href="#cb204-26" aria-hidden="true" tabindex="-1"></a>                                (<span class="fl">0.014</span>)             (<span class="fl">0.031</span>)   </span>
<span id="cb204-27"><a href="#cb204-27" aria-hidden="true" tabindex="-1"></a>                                                              </span>
<span id="cb204-28"><a href="#cb204-28" aria-hidden="true" tabindex="-1"></a>educHat                                   <span class="fl">0.061</span><span class="sc">*</span>              </span>
<span id="cb204-29"><a href="#cb204-29" aria-hidden="true" tabindex="-1"></a>                                         (<span class="fl">0.033</span>)              </span>
<span id="cb204-30"><a href="#cb204-30" aria-hidden="true" tabindex="-1"></a>                                                              </span>
<span id="cb204-31"><a href="#cb204-31" aria-hidden="true" tabindex="-1"></a>exper                          <span class="fl">0.042</span><span class="sc">**</span><span class="er">*</span>  <span class="fl">0.044</span><span class="sc">**</span><span class="er">*</span>   <span class="fl">0.044</span><span class="sc">**</span><span class="er">*</span>  </span>
<span id="cb204-32"><a href="#cb204-32" aria-hidden="true" tabindex="-1"></a>                                (<span class="fl">0.013</span>)  (<span class="fl">0.014</span>)    (<span class="fl">0.013</span>)   </span>
<span id="cb204-33"><a href="#cb204-33" aria-hidden="true" tabindex="-1"></a>                                                              </span>
<span id="cb204-34"><a href="#cb204-34" aria-hidden="true" tabindex="-1"></a><span class="fu">I</span>(exper2)                      <span class="sc">-</span><span class="fl">0.001</span><span class="sc">**</span>  <span class="sc">-</span><span class="fl">0.001</span><span class="sc">**</span>   <span class="sc">-</span><span class="fl">0.001</span><span class="sc">**</span>  </span>
<span id="cb204-35"><a href="#cb204-35" aria-hidden="true" tabindex="-1"></a>                               (<span class="fl">0.0004</span>)  (<span class="fl">0.0004</span>)   (<span class="fl">0.0004</span>)  </span>
<span id="cb204-36"><a href="#cb204-36" aria-hidden="true" tabindex="-1"></a>                                                              </span>
<span id="cb204-37"><a href="#cb204-37" aria-hidden="true" tabindex="-1"></a>Constant                       <span class="sc">-</span><span class="fl">0.522</span><span class="sc">**</span><span class="er">*</span>  <span class="fl">0.048</span>      <span class="fl">0.048</span>    </span>
<span id="cb204-38"><a href="#cb204-38" aria-hidden="true" tabindex="-1"></a>                                (<span class="fl">0.199</span>)  (<span class="fl">0.420</span>)    (<span class="fl">0.400</span>)   </span>
<span id="cb204-39"><a href="#cb204-39" aria-hidden="true" tabindex="-1"></a>                                                              </span>
<span id="cb204-40"><a href="#cb204-40" aria-hidden="true" tabindex="-1"></a><span class="sc">--------------------------------------------------------------</span></span>
<span id="cb204-41"><a href="#cb204-41" aria-hidden="true" tabindex="-1"></a>Observations                      <span class="dv">428</span>      <span class="dv">428</span>        <span class="dv">428</span>     </span>
<span id="cb204-42"><a href="#cb204-42" aria-hidden="true" tabindex="-1"></a>R2                               <span class="fl">0.157</span>    <span class="fl">0.050</span>      <span class="fl">0.136</span>    </span>
<span id="cb204-43"><a href="#cb204-43" aria-hidden="true" tabindex="-1"></a>Adjusted R2                      <span class="fl">0.151</span>    <span class="fl">0.043</span>      <span class="fl">0.130</span>    </span>
<span id="cb204-44"><a href="#cb204-44" aria-hidden="true" tabindex="-1"></a>Residual Std. <span class="fu">Error</span> (<span class="at">df =</span> <span class="dv">424</span>)   <span class="fl">0.666</span>    <span class="fl">0.707</span>      <span class="fl">0.675</span>    </span>
<span id="cb204-45"><a href="#cb204-45" aria-hidden="true" tabindex="-1"></a>F <span class="fu">Statistic</span> (<span class="at">df =</span> <span class="dv">3</span>; <span class="dv">424</span>)      <span class="fl">26.286</span><span class="sc">**</span><span class="er">*</span> <span class="fl">7.405</span><span class="sc">**</span><span class="er">*</span>             </span>
<span id="cb204-46"><a href="#cb204-46" aria-hidden="true" tabindex="-1"></a><span class="er">==============================================================</span></span>
<span id="cb204-47"><a href="#cb204-47" aria-hidden="true" tabindex="-1"></a>Note<span class="sc">:</span>                              <span class="er">*</span>p<span class="sc">&lt;</span><span class="fl">0.1</span>; <span class="sc">**</span>p<span class="sc">&lt;</span><span class="fl">0.05</span>; <span class="sc">**</span><span class="er">*</span>p<span class="sc">&lt;</span><span class="fl">0.01</span></span></code></pre></div>
<p>Our second IV option comes from the estimatr package that we saw earlier. This will default to using HC2 robust standard errors although, as before, we could specify other options if we so wished (including clustering).</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="co"># library(estimatr) ## Already loaded</span></span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Run the IV regression with robust SEs</span></span>
<span id="cb205-4"><a href="#cb205-4" aria-hidden="true" tabindex="-1"></a>wage.give_robust <span class="ot">&lt;-</span> </span>
<span id="cb205-5"><a href="#cb205-5" aria-hidden="true" tabindex="-1"></a>  estimatr<span class="sc">::</span><span class="fu">iv_robust</span>( <span class="do">## We only need to change the function call. Everything else stays the same.</span></span>
<span id="cb205-6"><a href="#cb205-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log</span>(wage) <span class="sc">~</span>educ<span class="sc">+</span>exper<span class="sc">+</span><span class="fu">I</span>(exper<span class="sc">^</span><span class="dv">2</span>)<span class="sc">|</span> </span>
<span id="cb205-7"><a href="#cb205-7" aria-hidden="true" tabindex="-1"></a>                    exper<span class="sc">+</span><span class="fu">I</span>(exper<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span>motheduc<span class="sc">+</span>fatheduc, <span class="at">data=</span>mroz1)</span>
<span id="cb205-8"><a href="#cb205-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-9"><a href="#cb205-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(wage.give_robust, <span class="at">diagnostics =</span> <span class="cn">TRUE</span>)</span>
<span id="cb205-10"><a href="#cb205-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-11"><a href="#cb205-11" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb205-12"><a href="#cb205-12" aria-hidden="true" tabindex="-1"></a>estimatr<span class="sc">::</span><span class="fu">iv_robust</span>(<span class="at">formula =</span> <span class="fu">log</span>(wage) <span class="sc">~</span> educ <span class="sc">+</span> exper <span class="sc">+</span> <span class="fu">I</span>(exper<span class="sc">^</span><span class="dv">2</span>) <span class="sc">|</span> </span>
<span id="cb205-13"><a href="#cb205-13" aria-hidden="true" tabindex="-1"></a>    exper <span class="sc">+</span> <span class="fu">I</span>(exper<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> motheduc <span class="sc">+</span> fatheduc, <span class="at">data =</span> mroz1)</span>
<span id="cb205-14"><a href="#cb205-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-15"><a href="#cb205-15" aria-hidden="true" tabindex="-1"></a>Standard error type<span class="sc">:</span>  HC2 </span>
<span id="cb205-16"><a href="#cb205-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-17"><a href="#cb205-17" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb205-18"><a href="#cb205-18" aria-hidden="true" tabindex="-1"></a>             Estimate Std. Error t value <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)  CI Lower   CI Upper  DF</span>
<span id="cb205-19"><a href="#cb205-19" aria-hidden="true" tabindex="-1"></a>(Intercept)  <span class="fl">0.048100</span>  <span class="fl">0.4307514</span>  <span class="fl">0.1117</span> <span class="fl">0.911141</span> <span class="sc">-</span><span class="fl">0.798574</span>  <span class="fl">8.948e-01</span> <span class="dv">424</span></span>
<span id="cb205-20"><a href="#cb205-20" aria-hidden="true" tabindex="-1"></a>educ         <span class="fl">0.061397</span>  <span class="fl">0.0334146</span>  <span class="fl">1.8374</span> <span class="fl">0.066848</span> <span class="sc">-</span><span class="fl">0.004282</span>  <span class="fl">1.271e-01</span> <span class="dv">424</span></span>
<span id="cb205-21"><a href="#cb205-21" aria-hidden="true" tabindex="-1"></a>exper        <span class="fl">0.044170</span>  <span class="fl">0.0156233</span>  <span class="fl">2.8272</span> <span class="fl">0.004918</span>  <span class="fl">0.013462</span>  <span class="fl">7.488e-02</span> <span class="dv">424</span></span>
<span id="cb205-22"><a href="#cb205-22" aria-hidden="true" tabindex="-1"></a><span class="fu">I</span>(exper<span class="sc">^</span><span class="dv">2</span>)  <span class="sc">-</span><span class="fl">0.000899</span>  <span class="fl">0.0004337</span> <span class="sc">-</span><span class="fl">2.0730</span> <span class="fl">0.038777</span> <span class="sc">-</span><span class="fl">0.001751</span> <span class="sc">-</span><span class="fl">4.658e-05</span> <span class="dv">424</span></span>
<span id="cb205-23"><a href="#cb205-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-24"><a href="#cb205-24" aria-hidden="true" tabindex="-1"></a>Multiple R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.1357</span> ,   Adjusted R<span class="sc">-</span>squared<span class="sc">:</span>  <span class="fl">0.1296</span> </span>
<span id="cb205-25"><a href="#cb205-25" aria-hidden="true" tabindex="-1"></a>F<span class="sc">-</span>statistic<span class="sc">:</span> <span class="fl">6.117</span> on <span class="dv">3</span> and <span class="dv">424</span> DF,  p<span class="sc">-</span>value<span class="sc">:</span> <span class="fl">0.0004426</span></span></code></pre></div>
<p>As a third option we can use the <code>lfe:felm()</code> function. It has a slightly different (more Stata like) syntax but works also very well for <a href="#panel">panel data</a> models.</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a>wage.give_felm <span class="ot">&lt;-</span> </span>
<span id="cb206-2"><a href="#cb206-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">felm</span>(</span>
<span id="cb206-3"><a href="#cb206-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log</span>(wage) <span class="sc">~</span> exper<span class="sc">+</span><span class="fu">I</span>(exper<span class="sc">^</span><span class="dv">2</span>) <span class="sc">|</span></span>
<span id="cb206-4"><a href="#cb206-4" aria-hidden="true" tabindex="-1"></a>      <span class="dv">0</span> <span class="sc">|</span> <span class="do">## No FEs</span></span>
<span id="cb206-5"><a href="#cb206-5" aria-hidden="true" tabindex="-1"></a>      (educ <span class="sc">~</span> motheduc<span class="sc">+</span>fatheduc), <span class="do">## First-stage. Note the surrounding parentheses</span></span>
<span id="cb206-6"><a href="#cb206-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> mroz1</span>
<span id="cb206-7"><a href="#cb206-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb206-8"><a href="#cb206-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(wage.give_felm)</span>
<span id="cb206-9"><a href="#cb206-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-10"><a href="#cb206-10" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb206-11"><a href="#cb206-11" aria-hidden="true" tabindex="-1"></a>   <span class="fu">felm</span>(<span class="at">formula =</span> <span class="fu">log</span>(wage) <span class="sc">~</span> exper <span class="sc">+</span> <span class="fu">I</span>(exper<span class="sc">^</span><span class="dv">2</span>) <span class="sc">|</span> <span class="dv">0</span> <span class="sc">|</span> (educ <span class="sc">~</span> motheduc <span class="sc">+</span>      fatheduc), <span class="at">data =</span> mroz1) </span>
<span id="cb206-12"><a href="#cb206-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-13"><a href="#cb206-13" aria-hidden="true" tabindex="-1"></a>Residuals<span class="sc">:</span></span>
<span id="cb206-14"><a href="#cb206-14" aria-hidden="true" tabindex="-1"></a>    Min      1Q  Median      3Q     Max </span>
<span id="cb206-15"><a href="#cb206-15" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">3.0986</span> <span class="sc">-</span><span class="fl">0.3196</span>  <span class="fl">0.0551</span>  <span class="fl">0.3689</span>  <span class="fl">2.3493</span> </span>
<span id="cb206-16"><a href="#cb206-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-17"><a href="#cb206-17" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb206-18"><a href="#cb206-18" aria-hidden="true" tabindex="-1"></a>              Estimate Std. Error t value <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)   </span>
<span id="cb206-19"><a href="#cb206-19" aria-hidden="true" tabindex="-1"></a>(Intercept)  <span class="fl">0.0481003</span>  <span class="fl">0.4003281</span>   <span class="fl">0.120</span>  <span class="fl">0.90442</span>   </span>
<span id="cb206-20"><a href="#cb206-20" aria-hidden="true" tabindex="-1"></a>exper        <span class="fl">0.0441704</span>  <span class="fl">0.0134325</span>   <span class="fl">3.288</span>  <span class="fl">0.00109</span> <span class="sc">**</span></span>
<span id="cb206-21"><a href="#cb206-21" aria-hidden="true" tabindex="-1"></a><span class="fu">I</span>(exper<span class="sc">^</span><span class="dv">2</span>)  <span class="sc">-</span><span class="fl">0.0008990</span>  <span class="fl">0.0004017</span>  <span class="sc">-</span><span class="fl">2.238</span>  <span class="fl">0.02574</span> <span class="sc">*</span> </span>
<span id="cb206-22"><a href="#cb206-22" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">educ(fit)</span><span class="st">`</span>  <span class="fl">0.0613966</span>  <span class="fl">0.0314367</span>   <span class="fl">1.953</span>  <span class="fl">0.05147</span> . </span>
<span id="cb206-23"><a href="#cb206-23" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb206-24"><a href="#cb206-24" aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span>
<span id="cb206-25"><a href="#cb206-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-26"><a href="#cb206-26" aria-hidden="true" tabindex="-1"></a>Residual standard error<span class="sc">:</span> <span class="fl">0.6747</span> on <span class="dv">424</span> degrees of freedom</span>
<span id="cb206-27"><a href="#cb206-27" aria-hidden="true" tabindex="-1"></a>Multiple R<span class="sc">-</span><span class="fu">squared</span>(full model)<span class="sc">:</span> <span class="fl">0.1357</span>   Adjusted R<span class="sc">-</span>squared<span class="sc">:</span> <span class="fl">0.1296</span> </span>
<span id="cb206-28"><a href="#cb206-28" aria-hidden="true" tabindex="-1"></a>Multiple R<span class="sc">-</span><span class="fu">squared</span>(proj model)<span class="sc">:</span> <span class="fl">0.1357</span>   Adjusted R<span class="sc">-</span>squared<span class="sc">:</span> <span class="fl">0.1296</span> </span>
<span id="cb206-29"><a href="#cb206-29" aria-hidden="true" tabindex="-1"></a>F<span class="sc">-</span><span class="fu">statistic</span>(full model)<span class="sc">:</span><span class="fl">8.141</span> on <span class="dv">3</span> and <span class="dv">424</span> DF, p<span class="sc">-</span>value<span class="sc">:</span> <span class="fl">2.787e-05</span> </span>
<span id="cb206-30"><a href="#cb206-30" aria-hidden="true" tabindex="-1"></a>F<span class="sc">-</span><span class="fu">statistic</span>(proj model)<span class="sc">:</span> <span class="fl">8.141</span> on <span class="dv">3</span> and <span class="dv">424</span> DF, p<span class="sc">-</span>value<span class="sc">:</span> <span class="fl">2.787e-05</span> </span>
<span id="cb206-31"><a href="#cb206-31" aria-hidden="true" tabindex="-1"></a>F<span class="sc">-</span><span class="fu">statistic</span>(endog. vars)<span class="sc">:</span><span class="fl">3.814</span> on <span class="dv">1</span> and <span class="dv">424</span> DF, p<span class="sc">-</span>value<span class="sc">:</span> <span class="fl">0.05147</span> </span></code></pre></div>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a>huxtable<span class="sc">::</span><span class="fu">huxreg</span>(wage.give, wage.give_robust, wage.give_felm)</span></code></pre></div>
<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:unnamed-chunk-191">
<caption style="caption-side: top; text-align: center;">(#tab:unnamed-chunk-191) </caption><col><col><col><col><tr>
<th style="vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></th><th style="vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(1)</th><th style="vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(2)</th><th style="vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(3)</th></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(Intercept)</th><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.048&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.048&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.048&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></th><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.400)&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.431)&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.400)&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">educ</th><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.061&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.061&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></th><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.031)&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.033)&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">exper</th><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.044 **</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.044 **</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.044 **</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></th><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.013)&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.016)&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.013)&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">I(exper^2)</th><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-0.001 *&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-0.001 *&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-0.001 *&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></th><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.000)&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.000)&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.000)&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">`educ(fit)`</th><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.061&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></th><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.031)&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">N</th><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">428&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">428&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">428&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">R2</th><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.136&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.136&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.136&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th colspan="4" style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;"> *** p &lt; 0.001;  ** p &lt; 0.01;  * p &lt; 0.05.</th></tr>
</table>

<p>Test for weak instruments, perform Hausman test for endogeneity with null hypothesis of no endogeneity. The Sargan instrument validity test helps to check on the accuracy of instruments.</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a>ivtest.ols <span class="ot">&lt;-</span> <span class="fu">lm</span>(educ<span class="sc">~</span>exper<span class="sc">+</span><span class="fu">I</span>(exper<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span>motheduc<span class="sc">+</span>fatheduc, </span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">data=</span>mroz1)</span>
<span id="cb208-3"><a href="#cb208-3" aria-hidden="true" tabindex="-1"></a><span class="fu">stargazer</span>(ivtest.ols, <span class="at">type=</span><span class="st">&quot;text&quot;</span>, <span class="at">title=</span><span class="st">&quot;Instruments&quot;</span>)</span>
<span id="cb208-4"><a href="#cb208-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-5"><a href="#cb208-5" aria-hidden="true" tabindex="-1"></a>Instruments</span>
<span id="cb208-6"><a href="#cb208-6" aria-hidden="true" tabindex="-1"></a><span class="sc">==</span><span class="er">=============================================</span></span>
<span id="cb208-7"><a href="#cb208-7" aria-hidden="true" tabindex="-1"></a>                        Dependent variable<span class="sc">:</span>    </span>
<span id="cb208-8"><a href="#cb208-8" aria-hidden="true" tabindex="-1"></a>                    <span class="sc">---------------------------</span></span>
<span id="cb208-9"><a href="#cb208-9" aria-hidden="true" tabindex="-1"></a>                               educ            </span>
<span id="cb208-10"><a href="#cb208-10" aria-hidden="true" tabindex="-1"></a><span class="sc">-----------------------------------------------</span></span>
<span id="cb208-11"><a href="#cb208-11" aria-hidden="true" tabindex="-1"></a>exper                          <span class="fl">0.045</span>           </span>
<span id="cb208-12"><a href="#cb208-12" aria-hidden="true" tabindex="-1"></a>                              (<span class="fl">0.040</span>)          </span>
<span id="cb208-13"><a href="#cb208-13" aria-hidden="true" tabindex="-1"></a>                                               </span>
<span id="cb208-14"><a href="#cb208-14" aria-hidden="true" tabindex="-1"></a><span class="fu">I</span>(exper2)                     <span class="sc">-</span><span class="fl">0.001</span>           </span>
<span id="cb208-15"><a href="#cb208-15" aria-hidden="true" tabindex="-1"></a>                              (<span class="fl">0.001</span>)          </span>
<span id="cb208-16"><a href="#cb208-16" aria-hidden="true" tabindex="-1"></a>                                               </span>
<span id="cb208-17"><a href="#cb208-17" aria-hidden="true" tabindex="-1"></a>motheduc                     <span class="fl">0.158</span><span class="sc">**</span><span class="er">*</span>          </span>
<span id="cb208-18"><a href="#cb208-18" aria-hidden="true" tabindex="-1"></a>                              (<span class="fl">0.036</span>)          </span>
<span id="cb208-19"><a href="#cb208-19" aria-hidden="true" tabindex="-1"></a>                                               </span>
<span id="cb208-20"><a href="#cb208-20" aria-hidden="true" tabindex="-1"></a>fatheduc                     <span class="fl">0.190</span><span class="sc">**</span><span class="er">*</span>          </span>
<span id="cb208-21"><a href="#cb208-21" aria-hidden="true" tabindex="-1"></a>                              (<span class="fl">0.034</span>)          </span>
<span id="cb208-22"><a href="#cb208-22" aria-hidden="true" tabindex="-1"></a>                                               </span>
<span id="cb208-23"><a href="#cb208-23" aria-hidden="true" tabindex="-1"></a>Constant                     <span class="fl">9.103</span><span class="sc">**</span><span class="er">*</span>          </span>
<span id="cb208-24"><a href="#cb208-24" aria-hidden="true" tabindex="-1"></a>                              (<span class="fl">0.427</span>)          </span>
<span id="cb208-25"><a href="#cb208-25" aria-hidden="true" tabindex="-1"></a>                                               </span>
<span id="cb208-26"><a href="#cb208-26" aria-hidden="true" tabindex="-1"></a><span class="sc">-----------------------------------------------</span></span>
<span id="cb208-27"><a href="#cb208-27" aria-hidden="true" tabindex="-1"></a>Observations                    <span class="dv">428</span>            </span>
<span id="cb208-28"><a href="#cb208-28" aria-hidden="true" tabindex="-1"></a>R2                             <span class="fl">0.211</span>           </span>
<span id="cb208-29"><a href="#cb208-29" aria-hidden="true" tabindex="-1"></a>Adjusted R2                    <span class="fl">0.204</span>           </span>
<span id="cb208-30"><a href="#cb208-30" aria-hidden="true" tabindex="-1"></a>Residual Std. Error      <span class="fl">2.039</span> (<span class="at">df =</span> <span class="dv">423</span>)      </span>
<span id="cb208-31"><a href="#cb208-31" aria-hidden="true" tabindex="-1"></a>F Statistic           <span class="fl">28.360</span><span class="sc">**</span><span class="er">*</span> (<span class="at">df =</span> <span class="dv">4</span>; <span class="dv">423</span>)  </span>
<span id="cb208-32"><a href="#cb208-32" aria-hidden="true" tabindex="-1"></a><span class="sc">==</span><span class="er">=============================================</span></span>
<span id="cb208-33"><a href="#cb208-33" aria-hidden="true" tabindex="-1"></a>Note<span class="sc">:</span>               <span class="er">*</span>p<span class="sc">&lt;</span><span class="fl">0.1</span>; <span class="sc">**</span>p<span class="sc">&lt;</span><span class="fl">0.05</span>; <span class="sc">**</span><span class="er">*</span>p<span class="sc">&lt;</span><span class="fl">0.01</span></span>
<span id="cb208-34"><a href="#cb208-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-35"><a href="#cb208-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Test rejects that parents education coefficients are zero</span></span>
<span id="cb208-36"><a href="#cb208-36" aria-hidden="true" tabindex="-1"></a><span class="fu">linearHypothesis</span>(ivtest.ols, <span class="fu">c</span>(<span class="st">&quot;motheduc=0&quot;</span>, <span class="st">&quot;fatheduc=0&quot;</span>))</span></code></pre></div>
<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:unnamed-chunk-192">
<caption style="caption-side: top; text-align: center;">(#tab:unnamed-chunk-192) </caption><col><col><col><col><col><col><tr>
<th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">Res.Df</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">RSS</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">Df</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">Sum of Sq</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">F</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">Pr(&gt;F)</th></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">425</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">2.22e+03</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;"></td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;"></td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">423</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1.76e+03</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">2</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">461</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">55.4</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">4.27e-22</td></tr>
</table>

<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test does not reject the zero effect of experience on education</span></span>
<span id="cb209-2"><a href="#cb209-2" aria-hidden="true" tabindex="-1"></a><span class="fu">linearHypothesis</span>(ivtest.ols, <span class="fu">c</span>(<span class="st">&quot;exper=0&quot;</span>,<span class="st">&quot;I(exper^2)=0&quot;</span>))</span></code></pre></div>
<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:unnamed-chunk-193">
<caption style="caption-side: top; text-align: center;">(#tab:unnamed-chunk-193) </caption><col><col><col><col><col><col><tr>
<th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">Res.Df</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">RSS</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">Df</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">Sum of Sq</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">F</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">Pr(&gt;F)</th></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">425</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">1.77e+03</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;"></td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">423</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">1.76e+03</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">2</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">7.6</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.914</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.402</td></tr>
</table>

<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Diagnostics tests for IV:</span></span>
<span id="cb210-2"><a href="#cb210-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Weak instruments test: H0 All instruments are weak</span></span>
<span id="cb210-3"><a href="#cb210-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Hausman test for endogeneity, where the null hypothesis is  no endogeneity</span></span>
<span id="cb210-4"><a href="#cb210-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sargan instrument validity test: H0 instruments are valid</span></span>
<span id="cb210-5"><a href="#cb210-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(wage.give, <span class="at">diagnostics=</span><span class="cn">TRUE</span>)</span>
<span id="cb210-6"><a href="#cb210-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-7"><a href="#cb210-7" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb210-8"><a href="#cb210-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ivreg</span>(<span class="at">formula =</span> <span class="fu">log</span>(wage) <span class="sc">~</span> educ <span class="sc">+</span> exper <span class="sc">+</span> <span class="fu">I</span>(exper<span class="sc">^</span><span class="dv">2</span>) <span class="sc">|</span> exper <span class="sc">+</span> </span>
<span id="cb210-9"><a href="#cb210-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">I</span>(exper<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> motheduc <span class="sc">+</span> fatheduc, <span class="at">data =</span> mroz1)</span>
<span id="cb210-10"><a href="#cb210-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-11"><a href="#cb210-11" aria-hidden="true" tabindex="-1"></a>Residuals<span class="sc">:</span></span>
<span id="cb210-12"><a href="#cb210-12" aria-hidden="true" tabindex="-1"></a>    Min      1Q  Median      3Q     Max </span>
<span id="cb210-13"><a href="#cb210-13" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">3.0986</span> <span class="sc">-</span><span class="fl">0.3196</span>  <span class="fl">0.0551</span>  <span class="fl">0.3689</span>  <span class="fl">2.3493</span> </span>
<span id="cb210-14"><a href="#cb210-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-15"><a href="#cb210-15" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb210-16"><a href="#cb210-16" aria-hidden="true" tabindex="-1"></a>              Estimate Std. Error t value <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)   </span>
<span id="cb210-17"><a href="#cb210-17" aria-hidden="true" tabindex="-1"></a>(Intercept)  <span class="fl">0.0481003</span>  <span class="fl">0.4003281</span>   <span class="fl">0.120</span>  <span class="fl">0.90442</span>   </span>
<span id="cb210-18"><a href="#cb210-18" aria-hidden="true" tabindex="-1"></a>educ         <span class="fl">0.0613966</span>  <span class="fl">0.0314367</span>   <span class="fl">1.953</span>  <span class="fl">0.05147</span> . </span>
<span id="cb210-19"><a href="#cb210-19" aria-hidden="true" tabindex="-1"></a>exper        <span class="fl">0.0441704</span>  <span class="fl">0.0134325</span>   <span class="fl">3.288</span>  <span class="fl">0.00109</span> <span class="sc">**</span></span>
<span id="cb210-20"><a href="#cb210-20" aria-hidden="true" tabindex="-1"></a><span class="fu">I</span>(exper<span class="sc">^</span><span class="dv">2</span>)  <span class="sc">-</span><span class="fl">0.0008990</span>  <span class="fl">0.0004017</span>  <span class="sc">-</span><span class="fl">2.238</span>  <span class="fl">0.02574</span> <span class="sc">*</span> </span>
<span id="cb210-21"><a href="#cb210-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-22"><a href="#cb210-22" aria-hidden="true" tabindex="-1"></a>Diagnostic tests<span class="sc">:</span></span>
<span id="cb210-23"><a href="#cb210-23" aria-hidden="true" tabindex="-1"></a>                 df1 df2 statistic p<span class="sc">-</span>value    </span>
<span id="cb210-24"><a href="#cb210-24" aria-hidden="true" tabindex="-1"></a>Weak instruments   <span class="dv">2</span> <span class="dv">423</span>    <span class="fl">55.400</span>  <span class="sc">&lt;</span><span class="fl">2e-16</span> <span class="sc">**</span><span class="er">*</span></span>
<span id="cb210-25"><a href="#cb210-25" aria-hidden="true" tabindex="-1"></a>Wu<span class="sc">-</span>Hausman         <span class="dv">1</span> <span class="dv">423</span>     <span class="fl">2.793</span>  <span class="fl">0.0954</span> .  </span>
<span id="cb210-26"><a href="#cb210-26" aria-hidden="true" tabindex="-1"></a>Sargan             <span class="dv">1</span>  <span class="cn">NA</span>     <span class="fl">0.378</span>  <span class="fl">0.5386</span>    </span>
<span id="cb210-27"><a href="#cb210-27" aria-hidden="true" tabindex="-1"></a><span class="sc">---</span></span>
<span id="cb210-28"><a href="#cb210-28" aria-hidden="true" tabindex="-1"></a>Signif. codes<span class="sc">:</span>  <span class="dv">0</span> <span class="st">&#39;***&#39;</span> <span class="fl">0.001</span> <span class="st">&#39;**&#39;</span> <span class="fl">0.01</span> <span class="st">&#39;*&#39;</span> <span class="fl">0.05</span> <span class="st">&#39;.&#39;</span> <span class="fl">0.1</span> <span class="st">&#39; &#39;</span> <span class="dv">1</span></span>
<span id="cb210-29"><a href="#cb210-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-30"><a href="#cb210-30" aria-hidden="true" tabindex="-1"></a>Residual standard error<span class="sc">:</span> <span class="fl">0.6747</span> on <span class="dv">424</span> degrees of freedom</span>
<span id="cb210-31"><a href="#cb210-31" aria-hidden="true" tabindex="-1"></a>Multiple R<span class="sc">-</span>Squared<span class="sc">:</span> <span class="fl">0.1357</span>, Adjusted R<span class="sc">-</span>squared<span class="sc">:</span> <span class="fl">0.1296</span> </span>
<span id="cb210-32"><a href="#cb210-32" aria-hidden="true" tabindex="-1"></a>Wald test<span class="sc">:</span> <span class="fl">8.141</span> on <span class="dv">3</span> and <span class="dv">424</span> DF,  p<span class="sc">-</span>value<span class="sc">:</span> <span class="fl">2.787e-05</span> </span></code></pre></div>
<div id="overidentifying-restrictions-test" class="section level3" number="2.5.1">
<h3 number="2.5.1"><span class="header-section-number">2.5.1</span> Overidentifying Restrictions Test</h3>
<p>If there is correlation between an instrument and the error term, IV regression is not consistent. The overidentifying restrictions test (also called the <span class="math inline">\(J\)</span>-test) is an approach to test the hypothesis that additional instruments are exogenous. For the <span class="math inline">\(J\)</span>-test to be applicable there need to be more instruments than endogenous regressors.</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="co"># IV regression</span></span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a>wage.give <span class="ot">&lt;-</span> <span class="fu">ivreg</span>(<span class="fu">log</span>(wage)<span class="sc">~</span>educ<span class="sc">+</span>exper<span class="sc">+</span><span class="fu">I</span>(exper<span class="sc">^</span><span class="dv">2</span>)<span class="sc">|</span></span>
<span id="cb211-3"><a href="#cb211-3" aria-hidden="true" tabindex="-1"></a>                    exper<span class="sc">+</span><span class="fu">I</span>(exper<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span>motheduc<span class="sc">+</span>fatheduc, <span class="at">data=</span>mroz1)</span>
<span id="cb211-4"><a href="#cb211-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-5"><a href="#cb211-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Auxiliary regression</span></span>
<span id="cb211-6"><a href="#cb211-6" aria-hidden="true" tabindex="-1"></a>res.aux <span class="ot">&lt;-</span>  <span class="fu">lm</span>(<span class="fu">residuals</span>(wage.give) <span class="sc">~</span> exper<span class="sc">+</span><span class="fu">I</span>(exper<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span>motheduc<span class="sc">+</span>fatheduc</span>
<span id="cb211-7"><a href="#cb211-7" aria-hidden="true" tabindex="-1"></a>                       , <span class="at">data=</span>mroz1) </span>
<span id="cb211-8"><a href="#cb211-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-9"><a href="#cb211-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-10"><a href="#cb211-10" aria-hidden="true" tabindex="-1"></a>wage.ORTest <span class="ot">&lt;-</span> <span class="fu">linearHypothesis</span>(res.aux, <span class="fu">c</span>(<span class="st">&quot;motheduc=0&quot;</span>,<span class="st">&quot;fatheduc=0&quot;</span>, <span class="st">&quot;exper=0&quot;</span>, <span class="st">&quot;I(exper^2)=0&quot;</span>), <span class="at">test =</span> <span class="st">&quot;Chisq&quot;</span>)</span>
<span id="cb211-11"><a href="#cb211-11" aria-hidden="true" tabindex="-1"></a><span class="co"># wage.ORTest &lt;- linearHypothesis(res.aux, c(&quot;fatheduc=0&quot;))</span></span>
<span id="cb211-12"><a href="#cb211-12" aria-hidden="true" tabindex="-1"></a>wage.ORTest</span></code></pre></div>
<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:unnamed-chunk-195">
<caption style="caption-side: top; text-align: center;">(#tab:unnamed-chunk-195) </caption><col><col><col><col><col><col><tr>
<th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">Res.Df</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">RSS</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">Df</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">Sum of Sq</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">Chisq</th><th style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: bold;">Pr(&gt;Chisq)</th></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">427</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">193</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;"></td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; background-color: rgb(242, 242, 242); font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0.4pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">423</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">193</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">4</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.171</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.374</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.985</td></tr>
</table>

<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculations for test</span></span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a>( r2 <span class="ot">&lt;-</span> <span class="fu">summary</span>(res.aux)<span class="sc">$</span>r.squared )</span>
<span id="cb212-3"><a href="#cb212-3" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.0008833444</span></span>
<span id="cb212-4"><a href="#cb212-4" aria-hidden="true" tabindex="-1"></a>( n <span class="ot">&lt;-</span> <span class="fu">nobs</span>(res.aux))</span>
<span id="cb212-5"><a href="#cb212-5" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">428</span></span>
<span id="cb212-6"><a href="#cb212-6" aria-hidden="true" tabindex="-1"></a>( teststat <span class="ot">&lt;-</span> n<span class="sc">*</span>r2 )</span>
<span id="cb212-7"><a href="#cb212-7" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.3780714</span></span>
<span id="cb212-8"><a href="#cb212-8" aria-hidden="true" tabindex="-1"></a>( pval <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">-</span><span class="fu">pchisq</span>(teststat,<span class="dv">1</span>) )</span>
<span id="cb212-9"><a href="#cb212-9" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.5386372</span></span>
<span id="cb212-10"><a href="#cb212-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-11"><a href="#cb212-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute correct p-value for the J-statistic</span></span>
<span id="cb212-12"><a href="#cb212-12" aria-hidden="true" tabindex="-1"></a><span class="fu">pchisq</span>(wage.ORTest[<span class="dv">2</span>,<span class="dv">5</span>], <span class="at">df =</span> <span class="dv">1</span>, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span>
<span id="cb212-13"><a href="#cb212-13" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="fl">0.5408401</span></span></code></pre></div>
</div>
<div id="multiple-instruments" class="section level3" number="2.5.2">
<h3 number="2.5.2"><span class="header-section-number">2.5.2</span> Multiple instruments</h3>
<p>In principle, one is not restricted to use only one instrument. Adding a second instrument improves your explanatory power in the first stage. Recall that an IV changes what you are estimating. With an instrumental variable you get a local average treatment effect. The local average treatment effect refers to the treatment effect for the subset of the sample that takes the treatment if and only if they were assigned to the treatment. So the stronger the the individual is effected by the instrument, the stronger the treatment effect is weighted.</p>
<p>With two instruments ones get the weighted average of local average treatment effect of the first instrument and the local average treatment effect from the second instrument.</p>
<p>As it is not trivial to find one good instrument not to speak of two instruments, we will use simulated data.</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fabricatr package to simulate some data</span></span>
<span id="cb213-2"><a href="#cb213-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb213-3"><a href="#cb213-3" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">fabricate</span>(</span>
<span id="cb213-4"><a href="#cb213-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> <span class="dv">100</span>, </span>
<span id="cb213-5"><a href="#cb213-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Y =</span>  <span class="fu">rpois</span>(N, <span class="at">lambda =</span> <span class="dv">4</span>), <span class="co"># Poisson distribution</span></span>
<span id="cb213-6"><a href="#cb213-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Z1 =</span> <span class="fu">rbinom</span>(N, <span class="dv">1</span>, <span class="at">prob =</span> <span class="fl">0.4</span>),</span>
<span id="cb213-7"><a href="#cb213-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Z2 =</span> <span class="fu">rbinom</span>(N, <span class="dv">1</span>, <span class="at">prob =</span> <span class="fl">0.4</span>),</span>
<span id="cb213-8"><a href="#cb213-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">X1 =</span> Z1 <span class="sc">*</span> <span class="fu">rbinom</span>(N, <span class="dv">1</span>, <span class="at">prob =</span> <span class="fl">0.8</span>)  <span class="sc">+</span> Z2 <span class="sc">*</span> <span class="fu">rbinom</span>(N, <span class="dv">1</span>, <span class="at">prob =</span> <span class="fl">0.8</span>),</span>
<span id="cb213-9"><a href="#cb213-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">X2 =</span> <span class="fu">rnorm</span>(N)</span>
<span id="cb213-10"><a href="#cb213-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="fu">skim</span>(dat)</span></code></pre></div>
<table style="width: auto;" class="table table-condensed">
<caption>
(#tab:unnamed-chunk-198)Data summary
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Name
</td>
<td style="text-align:left;">
dat
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of rows
</td>
<td style="text-align:left;">
100
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of columns
</td>
<td style="text-align:left;">
6
</td>
</tr>
<tr>
<td style="text-align:left;">
_______________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Column type frequency:
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
character
</td>
<td style="text-align:left;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
________________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Group variables
</td>
<td style="text-align:left;">
None
</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left;">
skim_variable
</th>
<th style="text-align:right;">
n_missing
</th>
<th style="text-align:right;">
complete_rate
</th>
<th style="text-align:right;">
min
</th>
<th style="text-align:right;">
max
</th>
<th style="text-align:right;">
empty
</th>
<th style="text-align:right;">
n_unique
</th>
<th style="text-align:right;">
whitespace
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
ID
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
100
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left;">
skim_variable
</th>
<th style="text-align:right;">
n_missing
</th>
<th style="text-align:right;">
complete_rate
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
p0
</th>
<th style="text-align:right;">
p25
</th>
<th style="text-align:right;">
p50
</th>
<th style="text-align:right;">
p75
</th>
<th style="text-align:right;">
p100
</th>
<th style="text-align:left;">
hist
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Y
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4.15
</td>
<td style="text-align:right;">
1.86
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
3.00
</td>
<td style="text-align:right;">
4.00
</td>
<td style="text-align:right;">
6.00
</td>
<td style="text-align:right;">
9.00
</td>
<td style="text-align:left;">
▁▇▇▅▁
</td>
</tr>
<tr>
<td style="text-align:left;">
Z1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.48
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:left;">
▇▁▁▁▅
</td>
</tr>
<tr>
<td style="text-align:left;">
Z2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.38
</td>
<td style="text-align:right;">
0.49
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:left;">
▇▁▁▁▅
</td>
</tr>
<tr>
<td style="text-align:left;">
X1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.58
</td>
<td style="text-align:right;">
0.64
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.50
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
2.00
</td>
<td style="text-align:left;">
▇▁▇▁▁
</td>
</tr>
<tr>
<td style="text-align:left;">
X2
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-0.10
</td>
<td style="text-align:right;">
0.89
</td>
<td style="text-align:right;">
-2.88
</td>
<td style="text-align:right;">
-0.85
</td>
<td style="text-align:right;">
-0.06
</td>
<td style="text-align:right;">
0.59
</td>
<td style="text-align:right;">
1.51
</td>
<td style="text-align:left;">
▁▃▇▇▆
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a>datOLS <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> X1 <span class="sc">+</span> X2, <span class="at">data =</span> dat)</span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a><span class="co"># start with 2STL </span></span>
<span id="cb215-3"><a href="#cb215-3" aria-hidden="true" tabindex="-1"></a>fsOLS <span class="ot">&lt;-</span> <span class="fu">lm</span>(X1 <span class="sc">~</span> Z1 <span class="sc">+</span> X2, <span class="at">data =</span> dat) <span class="co"># try with first instrument</span></span>
<span id="cb215-4"><a href="#cb215-4" aria-hidden="true" tabindex="-1"></a>X1HAT <span class="ot">&lt;-</span> <span class="fu">fitted</span>(fsOLS) <span class="co"># </span></span>
<span id="cb215-5"><a href="#cb215-5" aria-hidden="true" tabindex="-1"></a>dat2sls <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> X1HAT<span class="sc">+</span> X2, <span class="at">data =</span> dat)</span></code></pre></div>
<p>Use the estimatr package</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a>iv <span class="ot">&lt;-</span> estimatr<span class="sc">::</span><span class="fu">iv_robust</span>(Y <span class="sc">~</span> X1 <span class="sc">+</span> X2 <span class="sc">|</span> Z1 <span class="sc">+</span> X2, <span class="at">data =</span> dat)</span></code></pre></div>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a>iv2 <span class="ot">&lt;-</span> estimatr<span class="sc">::</span><span class="fu">iv_robust</span>(Y <span class="sc">~</span> X1 <span class="sc">+</span> X2 <span class="sc">|</span> Z1 <span class="sc">+</span> Z2 <span class="sc">+</span> X2, <span class="at">data =</span> dat)</span></code></pre></div>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a>modelsummary<span class="sc">::</span><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">&quot;OLS&quot;</span> <span class="ot">=</span> datOLS, <span class="st">&quot;2SLS&quot;</span> <span class="ot">=</span> dat2sls, <span class="st">&quot;IV1&quot;</span> <span class="ot">=</span> iv,<span class="st">&quot;IV2&quot;</span> <span class="ot">=</span> iv2))</span></code></pre></div>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:center;">
OLS
</th>
<th style="text-align:center;">
2SLS
</th>
<th style="text-align:center;">
IV1
</th>
<th style="text-align:center;">
IV2
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:center;">
3.982
</td>
<td style="text-align:center;">
3.966
</td>
<td style="text-align:center;">
3.966
</td>
<td style="text-align:center;">
4.012
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.251)
</td>
<td style="text-align:center;">
(0.332)
</td>
<td style="text-align:center;">
(0.316)
</td>
<td style="text-align:center;">
(0.209)
</td>
</tr>
<tr>
<td style="text-align:left;">
X1
</td>
<td style="text-align:center;">
0.342
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
0.369
</td>
<td style="text-align:center;">
0.289
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.295)
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
(0.493)
</td>
<td style="text-align:center;">
(0.297)
</td>
</tr>
<tr>
<td style="text-align:left;">
X2
</td>
<td style="text-align:center;">
0.301
</td>
<td style="text-align:center;">
0.304
</td>
<td style="text-align:center;">
0.304
</td>
<td style="text-align:center;">
0.296
</td>
</tr>
<tr>
<td style="text-align:left;">
</td>
<td style="text-align:center;">
(0.212)
</td>
<td style="text-align:center;">
(0.217)
</td>
<td style="text-align:center;">
(0.189)
</td>
<td style="text-align:center;">
(0.199)
</td>
</tr>
<tr>
<td style="text-align:left;">
X1HAT
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
0.369
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:left;box-shadow: 0px 1px">
</td>
<td style="text-align:center;box-shadow: 0px 1px">
</td>
<td style="text-align:center;box-shadow: 0px 1px">
(0.483)
</td>
<td style="text-align:center;box-shadow: 0px 1px">
</td>
<td style="text-align:center;box-shadow: 0px 1px">
</td>
</tr>
<tr>
<td style="text-align:left;">
Num.Obs.
</td>
<td style="text-align:center;">
100
</td>
<td style="text-align:center;">
100
</td>
<td style="text-align:center;">
100
</td>
<td style="text-align:center;">
100
</td>
</tr>
<tr>
<td style="text-align:left;">
R2
</td>
<td style="text-align:center;">
0.029
</td>
<td style="text-align:center;">
0.022
</td>
<td style="text-align:center;">
0.029
</td>
<td style="text-align:center;">
0.029
</td>
</tr>
<tr>
<td style="text-align:left;">
R2 Adj.
</td>
<td style="text-align:center;">
0.009
</td>
<td style="text-align:center;">
0.002
</td>
<td style="text-align:center;">
0.009
</td>
<td style="text-align:center;">
0.009
</td>
</tr>
<tr>
<td style="text-align:left;">
AIC
</td>
<td style="text-align:center;">
412.0
</td>
<td style="text-align:center;">
412.8
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:left;">
BIC
</td>
<td style="text-align:center;">
422.4
</td>
<td style="text-align:center;">
423.2
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Log.Lik.
</td>
<td style="text-align:center;">
-201.993
</td>
<td style="text-align:center;">
-202.381
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:left;">
F
</td>
<td style="text-align:center;">
1.469
</td>
<td style="text-align:center;">
1.083
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:left;">
p.value.endogeneity
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:left;">
p.value.overid
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:left;">
p.value.weakinst
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:left;">
se_type
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
HC2
</td>
<td style="text-align:center;">
HC2
</td>
</tr>
<tr>
<td style="text-align:left;">
statistic.endogeneity
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:left;">
statistic.overid
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:left;">
statistic.weakinst
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
</tr>
</tbody>
</table>
<p>Diagnostics</p>
<ol style="list-style-type: decimal">
<li>F-statistic for all the instruments in the first stage</li>
</ol>
<p>That is a common way of looking for weak instruments.</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a>iv2diag <span class="ot">&lt;-</span> iv2<span class="sc">$</span>diagnostic_first_stage_fstatistic</span>
<span id="cb219-2"><a href="#cb219-2" aria-hidden="true" tabindex="-1"></a>scales<span class="sc">::</span><span class="fu">number</span>(iv2<span class="sc">$</span>diagnostic_first_stage_fstatistic, <span class="at">accuracy =</span> .<span class="dv">01</span>)</span>
<span id="cb219-3"><a href="#cb219-3" aria-hidden="true" tabindex="-1"></a><span class="fu">character</span>(<span class="dv">0</span>)</span></code></pre></div>
<p>We observe a very low p-value and a F-statistic of around . We can reject the Null Hypothesis of joint weak instruments.</p>
<ol start="2" style="list-style-type: decimal">
<li>Overidentification test for multiple instruments</li>
</ol>
<p>If we have multiple instruments and we assume that <strong>at least one of them</strong> is correct we can check the other one against. So if the two different instruments give two very different results either one of them might be</p>
<p>A. Endogenous and by that should not be an instrument
B. Or potentially they are picking two different local instruments</p>
<p>Note that we are looking for differences in the second-stage coefficients. It is okay if the effects in the first stage are different.</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a>iv2<span class="sc">$</span>diagnostic_overid_test</span>
<span id="cb220-2"><a href="#cb220-2" aria-hidden="true" tabindex="-1"></a><span class="cn">NULL</span></span></code></pre></div>
<p>We can’t reject that that the two different effects are the same no matter which instruments we use. That tells us that if least one of our instruments is valid, we can also assume that the second one is valid. If we would fail that hypothesis test we have to assume that at least one of our instrument is endogenous, without knowing which one.</p>
</div>
</div>
<div id="gmm-iv" class="section level2" number="2.6">
<h2 number="2.6"><span class="header-section-number">2.6</span> GMM IV</h2>
<p>In any 2SLS/IV setting, you need to mind the requirements for valid instruments - <em>exogeneity</em> and <em>relevance</em>.
GMM improves on 2SLS if homoskedasticity assumption is not met.</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a>reg_gmm <span class="ot">&lt;-</span> <span class="fu">gmm</span>(<span class="fu">log</span>(wage)<span class="sc">~</span>educ<span class="sc">+</span>exper<span class="sc">+</span><span class="fu">I</span>(exper<span class="sc">^</span><span class="dv">2</span>), <span class="sc">~</span>exper<span class="sc">+</span><span class="fu">I</span>(exper<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span>motheduc<span class="sc">+</span>fatheduc, <span class="at">data=</span>mroz1)</span>
<span id="cb221-2"><a href="#cb221-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(reg_gmm)</span>
<span id="cb221-3"><a href="#cb221-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-4"><a href="#cb221-4" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb221-5"><a href="#cb221-5" aria-hidden="true" tabindex="-1"></a><span class="fu">gmm</span>(<span class="at">g =</span> <span class="fu">log</span>(wage) <span class="sc">~</span> educ <span class="sc">+</span> exper <span class="sc">+</span> <span class="fu">I</span>(exper<span class="sc">^</span><span class="dv">2</span>), <span class="at">x =</span> <span class="sc">~</span>exper <span class="sc">+</span> <span class="fu">I</span>(exper<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb221-6"><a href="#cb221-6" aria-hidden="true" tabindex="-1"></a>    motheduc <span class="sc">+</span> fatheduc, <span class="at">data =</span> mroz1)</span>
<span id="cb221-7"><a href="#cb221-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-8"><a href="#cb221-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-9"><a href="#cb221-9" aria-hidden="true" tabindex="-1"></a>Method<span class="sc">:</span>  twoStep </span>
<span id="cb221-10"><a href="#cb221-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-11"><a href="#cb221-11" aria-hidden="true" tabindex="-1"></a>Kernel<span class="sc">:</span>  Quadratic <span class="fu">Spectral</span>(with <span class="at">bw =</span>  <span class="fl">0.28778</span> )</span>
<span id="cb221-12"><a href="#cb221-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-13"><a href="#cb221-13" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb221-14"><a href="#cb221-14" aria-hidden="true" tabindex="-1"></a>             Estimate     Std. Error   t value      <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)   </span>
<span id="cb221-15"><a href="#cb221-15" aria-hidden="true" tabindex="-1"></a>(Intercept)   <span class="fl">0.00310758</span>   <span class="fl">0.46562510</span>   <span class="fl">0.00667399</span>   <span class="fl">0.99467496</span></span>
<span id="cb221-16"><a href="#cb221-16" aria-hidden="true" tabindex="-1"></a>educ          <span class="fl">0.06430017</span>   <span class="fl">0.03689420</span>   <span class="fl">1.74282596</span>   <span class="fl">0.08136402</span></span>
<span id="cb221-17"><a href="#cb221-17" aria-hidden="true" tabindex="-1"></a>exper         <span class="fl">0.04549282</span>   <span class="fl">0.01436735</span>   <span class="fl">3.16640338</span>   <span class="fl">0.00154337</span></span>
<span id="cb221-18"><a href="#cb221-18" aria-hidden="true" tabindex="-1"></a><span class="fu">I</span>(exper<span class="sc">^</span><span class="dv">2</span>)   <span class="sc">-</span><span class="fl">0.00093366</span>   <span class="fl">0.00039618</span>  <span class="sc">-</span><span class="fl">2.35663415</span>   <span class="fl">0.01844141</span></span>
<span id="cb221-19"><a href="#cb221-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-20"><a href="#cb221-20" aria-hidden="true" tabindex="-1"></a>J<span class="sc">-</span>Test<span class="sc">:</span> degrees of freedom is <span class="dv">1</span> </span>
<span id="cb221-21"><a href="#cb221-21" aria-hidden="true" tabindex="-1"></a>                J<span class="sc">-</span>test   P<span class="sc">-</span>value</span>
<span id="cb221-22"><a href="#cb221-22" aria-hidden="true" tabindex="-1"></a>Test <span class="fu">E</span>(g)<span class="ot">=</span><span class="dv">0</span><span class="sc">:</span>    <span class="fl">0.37641</span>  <span class="fl">0.53953</span></span>
<span id="cb221-23"><a href="#cb221-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-24"><a href="#cb221-24" aria-hidden="true" tabindex="-1"></a>Initial values of the coefficients</span>
<span id="cb221-25"><a href="#cb221-25" aria-hidden="true" tabindex="-1"></a>  (Intercept)          educ         exper    <span class="fu">I</span>(exper<span class="sc">^</span><span class="dv">2</span>) </span>
<span id="cb221-26"><a href="#cb221-26" aria-hidden="true" tabindex="-1"></a> <span class="fl">0.0481002982</span>  <span class="fl">0.0613966289</span>  <span class="fl">0.0441703937</span> <span class="sc">-</span><span class="fl">0.0008989696</span> </span></code></pre></div>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(reg_gmm, <span class="at">which =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="MEM5220_R_files/figure-html/unnamed-chunk-206-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stargazer</span>(wage.ols, wage<span class="fl">.2</span>sls, wage.give,reg_gmm, <span class="at">type=</span><span class="st">&quot;text&quot;</span>, <span class="at">title=</span><span class="st">&quot;Regression output table&quot;</span>)</span>
<span id="cb223-2"><a href="#cb223-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-3"><a href="#cb223-3" aria-hidden="true" tabindex="-1"></a>Regression output table</span>
<span id="cb223-4"><a href="#cb223-4" aria-hidden="true" tabindex="-1"></a><span class="sc">==</span><span class="er">=====================================================================</span></span>
<span id="cb223-5"><a href="#cb223-5" aria-hidden="true" tabindex="-1"></a>                                         Dependent variable<span class="sc">:</span>           </span>
<span id="cb223-6"><a href="#cb223-6" aria-hidden="true" tabindex="-1"></a>                               <span class="sc">----------------------------------------</span></span>
<span id="cb223-7"><a href="#cb223-7" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">log</span>(wage)                </span>
<span id="cb223-8"><a href="#cb223-8" aria-hidden="true" tabindex="-1"></a>                                      OLS         instrumental   GMM   </span>
<span id="cb223-9"><a href="#cb223-9" aria-hidden="true" tabindex="-1"></a>                                                    variable           </span>
<span id="cb223-10"><a href="#cb223-10" aria-hidden="true" tabindex="-1"></a>                                  (<span class="dv">1</span>)      (<span class="dv">2</span>)        (<span class="dv">3</span>)        (<span class="dv">4</span>)   </span>
<span id="cb223-11"><a href="#cb223-11" aria-hidden="true" tabindex="-1"></a><span class="sc">-----------------------------------------------------------------------</span></span>
<span id="cb223-12"><a href="#cb223-12" aria-hidden="true" tabindex="-1"></a>educ                           <span class="fl">0.107</span><span class="sc">**</span><span class="er">*</span>              <span class="fl">0.061</span><span class="sc">*</span>     <span class="fl">0.064</span><span class="sc">*</span> </span>
<span id="cb223-13"><a href="#cb223-13" aria-hidden="true" tabindex="-1"></a>                                (<span class="fl">0.014</span>)             (<span class="fl">0.031</span>)    (<span class="fl">0.037</span>) </span>
<span id="cb223-14"><a href="#cb223-14" aria-hidden="true" tabindex="-1"></a>                                                                       </span>
<span id="cb223-15"><a href="#cb223-15" aria-hidden="true" tabindex="-1"></a>educHat                                   <span class="fl">0.061</span><span class="sc">*</span>                       </span>
<span id="cb223-16"><a href="#cb223-16" aria-hidden="true" tabindex="-1"></a>                                         (<span class="fl">0.033</span>)                       </span>
<span id="cb223-17"><a href="#cb223-17" aria-hidden="true" tabindex="-1"></a>                                                                       </span>
<span id="cb223-18"><a href="#cb223-18" aria-hidden="true" tabindex="-1"></a>exper                          <span class="fl">0.042</span><span class="sc">**</span><span class="er">*</span>  <span class="fl">0.044</span><span class="sc">**</span><span class="er">*</span>   <span class="fl">0.044</span><span class="sc">**</span><span class="er">*</span>   <span class="fl">0.045</span><span class="sc">**</span><span class="er">*</span></span>
<span id="cb223-19"><a href="#cb223-19" aria-hidden="true" tabindex="-1"></a>                                (<span class="fl">0.013</span>)  (<span class="fl">0.014</span>)    (<span class="fl">0.013</span>)    (<span class="fl">0.014</span>) </span>
<span id="cb223-20"><a href="#cb223-20" aria-hidden="true" tabindex="-1"></a>                                                                       </span>
<span id="cb223-21"><a href="#cb223-21" aria-hidden="true" tabindex="-1"></a><span class="fu">I</span>(exper2)                      <span class="sc">-</span><span class="fl">0.001</span><span class="sc">**</span>  <span class="sc">-</span><span class="fl">0.001</span><span class="sc">**</span>   <span class="sc">-</span><span class="fl">0.001</span><span class="sc">**</span>   <span class="sc">-</span><span class="fl">0.001</span><span class="sc">**</span></span>
<span id="cb223-22"><a href="#cb223-22" aria-hidden="true" tabindex="-1"></a>                               (<span class="fl">0.0004</span>)  (<span class="fl">0.0004</span>)   (<span class="fl">0.0004</span>)   (<span class="fl">0.0004</span>)</span>
<span id="cb223-23"><a href="#cb223-23" aria-hidden="true" tabindex="-1"></a>                                                                       </span>
<span id="cb223-24"><a href="#cb223-24" aria-hidden="true" tabindex="-1"></a>Constant                       <span class="sc">-</span><span class="fl">0.522</span><span class="sc">**</span><span class="er">*</span>  <span class="fl">0.048</span>      <span class="fl">0.048</span>      <span class="fl">0.003</span>  </span>
<span id="cb223-25"><a href="#cb223-25" aria-hidden="true" tabindex="-1"></a>                                (<span class="fl">0.199</span>)  (<span class="fl">0.420</span>)    (<span class="fl">0.400</span>)    (<span class="fl">0.466</span>) </span>
<span id="cb223-26"><a href="#cb223-26" aria-hidden="true" tabindex="-1"></a>                                                                       </span>
<span id="cb223-27"><a href="#cb223-27" aria-hidden="true" tabindex="-1"></a><span class="sc">-----------------------------------------------------------------------</span></span>
<span id="cb223-28"><a href="#cb223-28" aria-hidden="true" tabindex="-1"></a>Observations                      <span class="dv">428</span>      <span class="dv">428</span>        <span class="dv">428</span>        <span class="dv">428</span>   </span>
<span id="cb223-29"><a href="#cb223-29" aria-hidden="true" tabindex="-1"></a>R2                               <span class="fl">0.157</span>    <span class="fl">0.050</span>      <span class="fl">0.136</span>             </span>
<span id="cb223-30"><a href="#cb223-30" aria-hidden="true" tabindex="-1"></a>Adjusted R2                      <span class="fl">0.151</span>    <span class="fl">0.043</span>      <span class="fl">0.130</span>             </span>
<span id="cb223-31"><a href="#cb223-31" aria-hidden="true" tabindex="-1"></a>Residual Std. <span class="fu">Error</span> (<span class="at">df =</span> <span class="dv">424</span>)   <span class="fl">0.666</span>    <span class="fl">0.707</span>      <span class="fl">0.675</span>             </span>
<span id="cb223-32"><a href="#cb223-32" aria-hidden="true" tabindex="-1"></a>F <span class="fu">Statistic</span> (<span class="at">df =</span> <span class="dv">3</span>; <span class="dv">424</span>)      <span class="fl">26.286</span><span class="sc">**</span><span class="er">*</span> <span class="fl">7.405</span><span class="sc">**</span><span class="er">*</span>                      </span>
<span id="cb223-33"><a href="#cb223-33" aria-hidden="true" tabindex="-1"></a><span class="er">=======================================================================</span></span>
<span id="cb223-34"><a href="#cb223-34" aria-hidden="true" tabindex="-1"></a>Note<span class="sc">:</span>                                       <span class="er">*</span>p<span class="sc">&lt;</span><span class="fl">0.1</span>; <span class="sc">**</span>p<span class="sc">&lt;</span><span class="fl">0.05</span>; <span class="sc">**</span><span class="er">*</span>p<span class="sc">&lt;</span><span class="fl">0.01</span></span></code></pre></div>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a>gmm_2sls <span class="ot">&lt;-</span> <span class="fu">tsls</span>(<span class="fu">log</span>(wage)<span class="sc">~</span>educ<span class="sc">+</span>exper<span class="sc">+</span><span class="fu">I</span>(exper<span class="sc">^</span><span class="dv">2</span>), <span class="sc">~</span>exper<span class="sc">+</span><span class="fu">I</span>(exper<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span>motheduc<span class="sc">+</span>fatheduc, <span class="at">data=</span>mroz1) <span class="co"># Note the tsls command of the gmm package </span></span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(gmm_2sls)</span>
<span id="cb224-3"><a href="#cb224-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-4"><a href="#cb224-4" aria-hidden="true" tabindex="-1"></a>Call<span class="sc">:</span></span>
<span id="cb224-5"><a href="#cb224-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tsls</span>(<span class="at">g =</span> <span class="fu">log</span>(wage) <span class="sc">~</span> educ <span class="sc">+</span> exper <span class="sc">+</span> <span class="fu">I</span>(exper<span class="sc">^</span><span class="dv">2</span>), <span class="at">x =</span> <span class="sc">~</span>exper <span class="sc">+</span> </span>
<span id="cb224-6"><a href="#cb224-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">I</span>(exper<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> motheduc <span class="sc">+</span> fatheduc, <span class="at">data =</span> mroz1)</span>
<span id="cb224-7"><a href="#cb224-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-8"><a href="#cb224-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-9"><a href="#cb224-9" aria-hidden="true" tabindex="-1"></a>Method<span class="sc">:</span>  Two Stage Least <span class="fu">Squares</span>(Meat <span class="at">type =</span> Classical) </span>
<span id="cb224-10"><a href="#cb224-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-11"><a href="#cb224-11" aria-hidden="true" tabindex="-1"></a>Coefficients<span class="sc">:</span></span>
<span id="cb224-12"><a href="#cb224-12" aria-hidden="true" tabindex="-1"></a>             Estimate     Std. Error   t value      <span class="fu">Pr</span>(<span class="sc">&gt;</span><span class="er">|</span>t<span class="sc">|</span>)   </span>
<span id="cb224-13"><a href="#cb224-13" aria-hidden="true" tabindex="-1"></a>(Intercept)   <span class="fl">0.04810030</span>   <span class="fl">0.40032808</span>   <span class="fl">0.12015220</span>   <span class="fl">0.90436258</span></span>
<span id="cb224-14"><a href="#cb224-14" aria-hidden="true" tabindex="-1"></a>educ          <span class="fl">0.06139663</span>   <span class="fl">0.03143670</span>   <span class="fl">1.95302425</span>   <span class="fl">0.05081672</span></span>
<span id="cb224-15"><a href="#cb224-15" aria-hidden="true" tabindex="-1"></a>exper         <span class="fl">0.04417039</span>   <span class="fl">0.01343248</span>   <span class="fl">3.28832862</span>   <span class="fl">0.00100784</span></span>
<span id="cb224-16"><a href="#cb224-16" aria-hidden="true" tabindex="-1"></a><span class="fu">I</span>(exper<span class="sc">^</span><span class="dv">2</span>)   <span class="sc">-</span><span class="fl">0.00089897</span>   <span class="fl">0.00040169</span>  <span class="sc">-</span><span class="fl">2.23799307</span>   <span class="fl">0.02522151</span></span>
<span id="cb224-17"><a href="#cb224-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-18"><a href="#cb224-18" aria-hidden="true" tabindex="-1"></a>J<span class="sc">-</span>Test<span class="sc">:</span> degrees of freedom is <span class="dv">1</span> </span>
<span id="cb224-19"><a href="#cb224-19" aria-hidden="true" tabindex="-1"></a>                J<span class="sc">-</span>test   P<span class="sc">-</span>value</span>
<span id="cb224-20"><a href="#cb224-20" aria-hidden="true" tabindex="-1"></a>Test <span class="fu">E</span>(g)<span class="ot">=</span><span class="dv">0</span><span class="sc">:</span>    <span class="fl">0.37807</span>  <span class="fl">0.53864</span></span>
<span id="cb224-21"><a href="#cb224-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-22"><a href="#cb224-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-23"><a href="#cb224-23" aria-hidden="true" tabindex="-1"></a> First stage F<span class="sc">-</span>statistics<span class="sc">:</span> </span>
<span id="cb224-24"><a href="#cb224-24" aria-hidden="true" tabindex="-1"></a>educ <span class="sc">:</span> <span class="fu">F</span>( <span class="dv">4</span> ,  <span class="dv">423</span> ) <span class="ot">=</span>  <span class="fl">28.36041</span>  (P<span class="sc">-</span><span class="at">Vavue =</span>  <span class="dv">0</span> )</span></code></pre></div>
<p>Use the package <strong>huxtable</strong> to produce a nice regression table</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&quot;huxtable&quot;) #  install package if necessary</span></span>
<span id="cb225-2"><a href="#cb225-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(huxtable)</span>
<span id="cb225-3"><a href="#cb225-3" aria-hidden="true" tabindex="-1"></a>regressiontable <span class="ot">&lt;-</span><span class="fu">huxreg</span>(wage.ols, wage<span class="fl">.2</span>sls, wage.give,reg_gmm, gmm_2sls)</span>
<span id="cb225-4"><a href="#cb225-4" aria-hidden="true" tabindex="-1"></a><span class="fu">caption</span>(regressiontable) <span class="ot">&lt;-</span> <span class="st">&quot;Regression output table&quot;</span></span>
<span id="cb225-5"><a href="#cb225-5" aria-hidden="true" tabindex="-1"></a>regressiontable</span></code></pre></div>
<table class="huxtable" style="border-collapse: collapse; border: 0px; margin-bottom: 2em; margin-top: 2em; ; margin-left: auto; margin-right: auto;  " id="tab:unnamed-chunk-209">
<caption style="caption-side: top; text-align: center;">(#tab:unnamed-chunk-209) Regression output table</caption><col><col><col><col><col><col><tr>
<th style="vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></th><th style="vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(1)</th><th style="vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(2)</th><th style="vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(3)</th><th style="vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(4)</th><th style="vertical-align: top; text-align: center; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(5)</th></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(Intercept)</th><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-0.522 **&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.048&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.048&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.003&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.048&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></th><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.199)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.420)&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.400)&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.466)&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.400)&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">educ</th><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.107 ***</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.061&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.064&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.061&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></th><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.014)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.031)&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.037)&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.031)&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">exper</th><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.042 **&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.044 **</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.044 **</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.045 **</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.044 **</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></th><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.013)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.014)&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.013)&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.014)&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.013)&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">I(exper^2)</th><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-0.001 *&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-0.001 *&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-0.001 *&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-0.001 *&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-0.001 *&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></th><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.000)&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.000)&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.000)&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.000)&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.000)&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">educHat</th><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.061&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;"></th><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">(0.033)&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">N</th><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">428&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">428&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">428&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">428&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">428&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">R2</th><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.157&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.050&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">0.136&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">logLik</th><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-431.599&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">-457.174&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">AIC</th><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">873.198&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">924.349&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td></tr>
<tr>
<th colspan="6" style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0pt 0pt;    padding: 6pt 6pt 6pt 6pt; font-weight: normal;"> *** p &lt; 0.001;  ** p &lt; 0.01;  * p &lt; 0.05.</th></tr>
</table>

</div>
<div id="panel-iv" class="section level2" number="2.7">
<h2 number="2.7"><span class="header-section-number">2.7</span> Panel IV</h2>
<p>One of the specificities of panel data models is that the error term is modelled as having two components, and individual and an idiosyncratic term. Therefore, the correlation between covariates and instrumental variables, on the other hand, and the errors of the model, on the other hand, must be analysed separately for each component of the error.</p>
<!--chapter:end:IV.Rmd-->
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="unnumbered">References</h1>
<!--chapter:end:references.Rmd-->
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-colonescu2018" class="csl-entry">
Colonescu, Constantin. 2018. <em>Using <span>R</span> for <span>Principles</span> of <span>Econometrics</span></em>. <span>Lulu.com</span>.
</div>
<div id="ref-dalpiaz2016" class="csl-entry">
Dalpiaz, David. 2016. <em>Applied Statistics</em>. <a href="http://www.stat.illinois.edu">http://www.stat.illinois.edu</a>.
</div>
<div id="ref-Hanck2018" class="csl-entry">
Hanck, Christopher, Martin Arnold, Alexander Gerber, and Martin Schmelzer. 2018. <em>Using <span>R</span> for <span>Introduction</span> to <span>Econometrics</span></em>. <a href="https://emwikts1970.github.io/URFITE-Bookdown/">https://emwikts1970.github.io/URFITE-Bookdown/</a>.
</div>
<div id="ref-heiss2016using" class="csl-entry">
Heiss, Florian. 2016. <em>Using r for Introductory Econometrics</em>. Florian Heiss.
</div>
<div id="ref-hill2008principles" class="csl-entry">
Hill, R Carter, William E Griffiths, Guay C Lim, and Mark Andrew Lim. 2008. <em>Principles of Econometrics</em>. Vol. 5. Wiley Hoboken, NJ.
</div>
<div id="ref-oswald2018introduction" class="csl-entry">
Oswald, Florian, and Jean-Marc Robin. 2018. <em>Introduction to Econometrics with r</em>. github.com. <a href="https://scpoecon.github.io/ScPoEconometrics/">https://scpoecon.github.io/ScPoEconometrics/</a>.
</div>
<div id="ref-Rodrigues2018" class="csl-entry">
Rodrigues, Bruno. 2018. <span>“Econometrics and <span>Free Software</span>.”</span> 2018. <a href="http://www.brodrigues.co/blog/2018-07-08-rob_stderr/">http://www.brodrigues.co/blog/2018-07-08-rob_stderr/</a>.
</div>
<div id="ref-team2013r" class="csl-entry">
Team, R Core. 2013. <span>“R: A Language and Environment for Statistical Computing [Internet].”</span> <em>Vienna, Austria: R Foundation for Statistical Computing</em>.
</div>
<div id="ref-wooldridge2015introductory" class="csl-entry">
Wooldridge, Jeffrey M. 2015. <em>Introductory Econometrics: A Modern Approach</em>. Nelson Education.
</div>
<div id="ref-Zeileis2017" class="csl-entry">
Zeileis, Achim, Thomas Lumley, Susanne Berger, and Nathaniel Graham. 2017. <em>Sandwich: <span>Robust Covariance Matrix Estimators</span></em> (version 2.4-0). <a href="https://CRAN.R-project.org/package=sandwich">https://CRAN.R-project.org/package=sandwich</a>.
</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Heiss (2016) builds on the popular Introductory Econometrics by Wooldridge (2016) and demonstrates how to replicate the applications discussed therein using R.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p><a href="https://books.google.ee/books/about/Introductory_Econometrics_A_Modern_Appro.html?id=wUF4BwAAQBAJ&amp;source=kp_cover&amp;redir_esc=y">Introductory Econometrics: A Modern Approach</a>.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>The <code>poly()</code> argument also requires complete observations. You
can use <code>raw</code> argument to estimate the term with missing
observations but be aware of the consequences!<a href="#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>Stargazer supports ton of options, including theming the LaTex
output to journal styles. However, stargazer was written before R
Markdown was really a thing, so it has excellent support for HTML
and LaTeX output, but that’s it. Including stargazer tables in an R
Markdown document is a hassle. <strong>huxtable</strong> on the the contrary
plays really nice with <strong>broom</strong> and the <strong>tidyverse</strong>. For more
info see Andrew Heiss
<a href="https://www.andrewheiss.com/blog/2018/03/08/amelia-broom-huxtable/">blog</a>.<a href="#fnref4" class="footnote-back">↩︎</a></p></li>
<li id="fn5"><p>This example has been adapted from the blog post of
<span class="citation"><a href="#ref-Rodrigues2018" role="doc-biblioref">Rodrigues</a> (<a href="#ref-Rodrigues2018" role="doc-biblioref">2018</a>)</span><a href="#fnref5" class="footnote-back">↩︎</a></p></li>
<li id="fn6"><p>This simulation is based on an example from Ed Rubin’s
<a href="EC421S20">https://raw.githack.com/edrubin/EC421S20/master/notes/05-heteroskedasticity/05-heteroskedasticity.html#118</a>
course.<a href="#fnref6" class="footnote-back">↩︎</a></p></li>
<li id="fn7"><p>The quantile regression subsection is adapted from <a href="https://github.com/FanWangEcon/R4Econ">Fan Wang
lecture notes</a><a href="#fnref7" class="footnote-back">↩︎</a></p></li>
<li id="fn8"><p>Note that we did not specify the endogenous variable (i.e. “educ”) directly. Rather, we told R which are the exogenous variables. It then figured out which were the endogenous variables that needed to be instrumented and ran the necessary first-stage regression(s) in the background.<a href="#fnref8" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
<!--bookdown:body:end-->
            </section>

          </div>
        </div>
      </div>
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
    </div>
  </div>
<!--bookdown:config-->

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
